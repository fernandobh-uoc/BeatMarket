import{a as U,b as le}from"./chunk-UIHM3IIJ.js";import{a as vt,b as bt,c as yt,d as qt}from"./chunk-375QIGGA.js";import{a as ht,b as Ut,c as Ct,d as Lt}from"./chunk-I27DK3TE.js";import{A as pt,F as dt,G as _t,H as ft,O as gt,a as H,b as et,d as tt,f as it,g as nt,h as ot,i as at,n as rt,p as st,t as lt,v as ct,w as mt,x as ut}from"./chunk-FBV753BW.js";import{a as xt,b as zt}from"./chunk-3FWRLNF5.js";import"./chunk-6NUGH5FF.js";import{f as Q,g as He,h as q,j as Ke,k as Ye,n as We,o as Mt,t as Xe,u as It}from"./chunk-VQCHUAXV.js";import{b as Je,e as Ot}from"./chunk-K5TY53DO.js";import"./chunk-4XKNA7IF.js";import"./chunk-4FRKXPG4.js";import"./chunk-E4HNE3PW.js";import"./chunk-P2UHFIXP.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-GTZXGHKK.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import{Aa as Ze,Ba as $e,Ca as Qe,Q as ke,S as Ne,_ as Oe,aa as Me,ba as Ie,c as w,d as Se,da as Ue,e as we,i as De,j as Ee,k as Re,ka as Le,l as Fe,la as ze,oa as qe,q as Ve,s as Te,u as Pe,v as Ae,va as Be,wa as je,xa as Ge}from"./chunk-BQ2OOKCX.js";import{$ as m,Ab as xe,Ca as D,Cb as Nt,D as b,Da as x,Ea as u,Kb as ve,L as h,Lb as be,M as C,Ma as ae,Na as _e,Pb as ye,Qa as c,Ra as re,Sa as fe,V as O,W as M,Y as f,Ya as se,_ as ue,ea as ie,fa as $,hb as I,ia as pe,ib as ge,jb as he,ka as g,m as N,n as Pt,nb as R,qa as y,s as G,sa as p,ta as de,ua as ne,v as At,va as oe,w as kt,wa as s,xa as r,ya as S,z as Z,zb as Ce}from"./chunk-DHHGUDQP.js";import"./chunk-OHMQXWFK.js";import"./chunk-S6VCIYOJ.js";import"./chunk-25CU3KXX.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as z,f as A,j as B,k as j,o as v}from"./chunk-FIPIWZQS.js";var Y,K,St=A(()=>{"use strict";R();He();K=class{constructor(){j(this,Y,b(Q))}validate(){return o=>v(this,null,function*(){return(yield B(this,Y).getUserByEmail(o.value.toLowerCase(),!1))?{emailExists:!0}:null})}};Y=new WeakMap});var W,J,wt=A(()=>{"use strict";R();He();J=class{constructor(){j(this,W,b(Q))}validate(){return o=>v(this,null,function*(){return(yield B(this,W).getUserByUsername(o.value))?{usernameExists:!0}:null})}};W=new WeakMap});var X,Dt=A(()=>{"use strict";R();Nt();zt();At();le();X=class{constructor(){this.http=b(xe),this.API_KEY=xt.zipcodeStack.apiKey,this.lastZipCode=null,this.lastCountry=null,this.lastResult=null,this.cityResult=f(null)}validate(){return o=>v(this,null,function*(){var d,_,E,F,T,L;let n=o.parent;if(!n)return null;let e=o.value,t=(d=n.get("country"))==null?void 0:d.value;if(!e||!t)return null;if(e===this.lastZipCode&&t===this.lastCountry)return this.lastResult;let a=(_=U.find(V=>V.nameES.toUpperCase()===t.toUpperCase()))==null?void 0:_.iso2;if(!a)return{zipValidationFailed:!0};let l=new Ce().set("apikey",this.API_KEY).set("codes",e).set("country",a);try{let V=yield N(this.http.get("https://api.zipcodestack.com/v1/search",{params:l})),P=(E=V==null?void 0:V.results)!=null?E:[];if(!(P&&!Array.isArray(P)&&((F=P[e])==null?void 0:F.length)>0))return this.cityResult.set(null),this.setCache(e,t,{invalidZipCode:!0}),{invalidZipCode:!0};let k=(L=(T=P[e][0])==null?void 0:T.city)!=null?L:null;return this.cityResult.set(k),this.setCache(e,t,null),null}catch{return this.cityResult.set(null),this.setCache(e,t,{zipValidationFailed:!0}),{zipValidationFailed:!0}}})}setCache(o,n,e){this.lastZipCode=o,this.lastCountry=n,this.lastResult=e}}});function Zt(i,o){i&1&&(s(0,"ion-text",12),c(1,"El email es obligatorio"),r())}function $t(i,o){i&1&&(s(0,"ion-text",12),c(1,"El email es inv\xE1lido"),r())}function Qt(i,o){if(i&1&&g(0,Zt,2,0,"ion-text",12)(1,$t,2,0,"ion-text",12),i&2){let n,e,t=u(2);p(!((n=t.registerForm.get("emailData.email"))==null||n.errors==null)&&n.errors.required?0:-1),m(),p(!((e=t.registerForm.get("emailData.email"))==null||e.errors==null)&&e.errors.email||!((e=t.registerForm.get("emailData.email"))==null||e.errors==null)&&e.errors.emailExists?1:-1)}}function Ht(i,o){if(i&1){let n=D();s(0,"div",1)(1,"div",8)(2,"ion-label",9),c(3,"Email"),r(),s(4,"ion-input",10),x("ionFocus",function(){h(n);let t=u();return C(t.controlFocus.emit("email"))})("ionBlur",function(){h(n);let t=u();return C(t.controlBlur.emit("email"))}),S(5,"ion-icon",11),r(),g(6,Qt,2,2),r()()}if(i&2){let n,e=u();m(6),p(e.submitAttempts().email()&&((n=e.registerForm.get("emailData.email"))!=null&&n.errors)?6:-1)}}function Kt(i,o){i&1&&(s(0,"ion-text",12),c(1,"El nombre de usuario es obligatorio"),r())}function Yt(i,o){i&1&&(s(0,"ion-text",12),c(1,"El nombre de usuario es demasiado corto"),r())}function Jt(i,o){i&1&&(s(0,"ion-text",12),c(1,"Ese nombre de usuario ya est\xE1 en uso"),r())}function Wt(i,o){if(i&1&&g(0,Kt,2,0,"ion-text",12)(1,Yt,2,0,"ion-text",12)(2,Jt,2,0,"ion-text",12),i&2){let n,e,t,a=u(2);p(!((n=a.registerForm.get("userData.username"))==null||n.errors==null)&&n.errors.required?0:-1),m(),p(!((e=a.registerForm.get("userData.username"))==null||e.errors==null)&&e.errors.minlength?1:-1),m(),p(!((t=a.registerForm.get("userData.username"))==null||t.errors==null)&&t.errors.usernameExists?2:-1)}}function Xt(i,o){i&1&&(s(0,"ion-text",12),c(1,"La contrase\xF1a es obligatoria"),r())}function ei(i,o){i&1&&(s(0,"ion-text",12),c(1,"La contrase\xF1a debe tener al menos 6 caracteres, una letra y un n\xFAmero"),r())}function ti(i,o){if(i&1&&g(0,Xt,2,0,"ion-text",12)(1,ei,2,0,"ion-text",12),i&2){let n,e,t=u(2);p(!((n=t.registerForm.get("userData.password"))==null||n.errors==null)&&n.errors.required?0:-1),m(),p(!((e=t.registerForm.get("userData.password"))==null||e.errors==null)&&e.errors.pattern?1:-1)}}function ii(i,o){if(i&1){let n=D();s(0,"div",2)(1,"div",8)(2,"ion-label",9),c(3,"Nombre de usuario"),r(),s(4,"ion-input",13),x("ionFocus",function(){h(n);let t=u();return C(t.controlFocus.emit("userData"))}),S(5,"ion-icon",14),r(),g(6,Wt,3,3),r(),s(7,"div",8)(8,"ion-label",9),c(9,"Contrase\xF1a"),r(),s(10,"ion-input",15),x("ionFocus",function(){h(n);let t=u();return C(t.controlFocus.emit("userData"))}),S(11,"ion-icon",16)(12,"ion-input-password-toggle",17),r(),g(13,ti,2,2),r(),s(14,"div",18)(15,"ion-label",9),c(16,"Avatar (opcional)"),r(),s(17,"ion-avatar",19),x("click",function(){h(n);let t=u();return C(t.uploadAvatar.emit())}),S(18,"img",20),r()()()}if(i&2){let n,e,t=u();m(6),p(t.submitAttempts().userData()&&((n=t.registerForm.get("userData.username"))!=null&&n.errors)?6:-1),m(4),y("clearOnEdit",!1),m(3),p(t.submitAttempts().userData()&&((e=t.registerForm.get("userData.password"))!=null&&e.errors)?13:-1),m(5),y("src",t.avatarDataURL()||"../../../../../../assets/user-avatar-default-shade.svg",ue)}}function ni(i,o){i&1&&(s(0,"ion-text",12),c(1,"El nombre es obligatorio"),r())}function oi(i,o){if(i&1&&g(0,ni,2,0,"ion-text",12),i&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.firstName"))==null||n.errors==null)&&n.errors.required?0:-1)}}function ai(i,o){i&1&&(s(0,"ion-text",12),c(1,"Los apellidos son obligatorios"),r())}function ri(i,o){if(i&1&&g(0,ai,2,0,"ion-text",12),i&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.lastName"))==null||n.errors==null)&&n.errors.required?0:-1)}}function si(i,o){if(i&1&&(s(0,"ion-select-option",28),c(1),r()),i&2){let n=o.$implicit;y("value",n.nameES),m(),re(n.nameES)}}function li(i,o){i&1&&(s(0,"ion-text",12),c(1,"El c\xF3digo postal es obligatorio"),r())}function ci(i,o){i&1&&(s(0,"ion-text",12),c(1,"El c\xF3digo postal es demasiado corto"),r())}function mi(i,o){if(i&1&&g(0,li,2,0,"ion-text",12)(1,ci,2,0,"ion-text",12),i&2){let n,e,t=u(2);p(!((n=t.registerForm.get("personalData.zipcode"))==null||n.errors==null)&&n.errors.required?0:-1),m(),p(!((e=t.registerForm.get("personalData.zipcode"))==null||e.errors==null)&&e.errors.minlength?1:-1)}}function ui(i,o){i&1&&(s(0,"ion-text",12),c(1,"El c\xF3digo postal no es v\xE1lido"),r())}function pi(i,o){i&1&&(s(0,"ion-text",12),c(1,"La ciudad es obligatoria"),r())}function di(i,o){if(i&1&&g(0,pi,2,0,"ion-text",12),i&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.city"))==null||n.errors==null)&&n.errors.required?0:-1)}}function _i(i,o){i&1&&(s(0,"ion-text",12),c(1,"La direcci\xF3n es obligatoria"),r())}function fi(i,o){if(i&1&&g(0,_i,2,0,"ion-text",12),i&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.address"))==null||n.errors==null)&&n.errors.required?0:-1)}}function gi(i,o){if(i&1){let n=D();s(0,"div",3)(1,"div",8)(2,"ion-label",21),c(3,"Nombre"),r(),s(4,"ion-input",22),x("ionFocus",function(){h(n);let t=u();return C(t.controlFocus.emit("personalData"))}),S(5,"ion-icon",23),r(),g(6,oi,1,1),r(),s(7,"div",8)(8,"ion-label",9),c(9,"Apellidos"),r(),s(10,"ion-input",24),x("ionFocus",function(){h(n);let t=u();return C(t.controlFocus.emit("personalData"))}),S(11,"ion-icon",23),r(),g(12,ri,1,1),r(),s(13,"div",25)(14,"ion-label",9),c(15,"Pa\xEDs"),r(),s(16,"ion-select",26),x("ionChange",function(t){h(n);let a=u();return C(a.onCountryChange(t))}),S(17,"ion-icon",27),ne(18,si,2,2,"ion-select-option",28,Gt),r()(),s(20,"div",29)(21,"div",30)(22,"ion-label",9),c(23,"C\xF3digo postal"),r(),s(24,"ion-input",31),x("ionFocus",function(){h(n);let t=u();return C(t.controlFocus.emit("personalData"))}),S(25,"ion-icon",32),r(),g(26,mi,2,2)(27,ui,2,0,"ion-text",12),r(),s(28,"div",33)(29,"ion-label",9),c(30,"Ciudad"),r(),s(31,"ion-input",34),S(32,"ion-icon",35),r(),g(33,di,1,1),r()(),s(34,"div",8)(35,"ion-label",9),c(36,"Direcci\xF3n"),r(),s(37,"ion-input",36),x("ionFocus",function(){h(n);let t=u();return C(t.controlFocus.emit("personalData"))}),S(38,"ion-icon",37),r(),g(39,fi,1,1),r()()}if(i&2){let n,e,t,a,l,d,_=u();m(6),p(_.submitAttempts().personalData()&&((n=_.registerForm.get("personalData.firstName"))!=null&&n.errors)?6:-1),m(6),p(_.submitAttempts().personalData()&&((e=_.registerForm.get("personalData.lastName"))!=null&&e.errors)?12:-1),m(4),y("interfaceOptions",se(7,Bt)),m(2),oe(_.countries),m(8),p(_.submitAttempts().personalData()&&((t=_.registerForm.get("personalData.zipcode"))!=null&&t.errors)?26:-1),m(),p(!((a=_.registerForm.get("personalData.zipcode"))==null||a.errors==null)&&a.errors.invalidZipCode||!((a=_.registerForm.get("personalData.zipcode"))==null||a.errors==null)&&a.errors.zipValidationFailed?27:-1),m(6),p(_.submitAttempts().personalData()&&((l=_.registerForm.get("personalData.city"))!=null&&l.errors)?33:-1),m(6),p(_.submitAttempts().personalData()&&((d=_.registerForm.get("personalData.address"))!=null&&d.errors)?39:-1)}}function hi(i,o){if(i&1){let n=D();s(0,"div",40)(1,"ion-checkbox",43),x("ionChange",function(t){h(n);let a=u(2);return C(a.onRoleChange(t))}),c(2),r()()}if(i&2){let n=o.$implicit;m(),y("value",n),m(),fe(" ",n," ")}}function Ci(i,o){if(i&1){let n=D();s(0,"div",4)(1,"div",8)(2,"ion-label",9),c(3,"Roles (opcional)"),r(),s(4,"ion-text",38),c(5,"Elige los roles que m\xE1s se identifiquen con tu actividad musical"),r(),s(6,"div",39),ne(7,hi,3,2,"div",40,de),r()(),s(9,"div",41)(10,"ion-label",9),c(11,"Biograf\xEDa (opcional)"),r(),s(12,"ion-textarea",42),x("ionFocus",function(){h(n);let t=u();return C(t.controlFocus.emit("otherData"))}),r()()()}if(i&2){let n=u();m(7),oe(n.roles)}}function xi(i,o){i&1&&S(0,"ion-spinner",45)}function vi(i,o){if(i&1){let n=D();s(0,"div",6)(1,"ion-button",44),x("click",function(){h(n);let t=u();return C(t.nextStep.emit())}),c(2," Continuar "),g(3,xi,1,0,"ion-spinner",45),r(),s(4,"ion-text"),c(5,"\xBFYa tienes cuenta? "),s(6,"a",46),c(7,"Ingresar"),r()()()}if(i&2){let n=u();m(),y("disabled",n.loadingStates().email()),m(2),p(n.loadingStates().email()?3:-1),m(3),y("routerLink",se(3,jt))}}function bi(i,o){i&1&&S(0,"ion-spinner",45)}function yi(i,o){if(i&1){let n=D();s(0,"ion-button",47),x("click",function(){h(n);let t=u();return C(t.nextStep.emit())}),c(1," Continuar "),g(2,bi,1,0,"ion-spinner",45),r()}if(i&2){let n=u();y("disabled",n.loadingStates().userData()),m(2),p(n.loadingStates().userData()?2:-1)}}function Si(i,o){i&1&&S(0,"ion-spinner",45)}function wi(i,o){if(i&1){let n=D();s(0,"ion-button",47),x("click",function(){h(n);let t=u();return C(t.nextStep.emit())}),c(1," Continuar "),g(2,Si,1,0,"ion-spinner",45),r()}if(i&2){let n=u();y("disabled",n.loadingStates().personalData()),m(2),p(n.loadingStates().personalData()?2:-1)}}function Di(i,o){if(i&1&&(s(0,"ion-text",12),c(1),r()),i&2){let n=u(2);m(),re(n.authProviderErrorMessage())}}function Ei(i,o){i&1&&S(0,"ion-spinner",45)}function Ri(i,o){if(i&1){let n=D();g(0,Di,2,1,"ion-text",12),s(1,"ion-button",47),x("click",function(){h(n);let t=u();return C(t.formSubmit.emit())}),c(2," Finalizar "),g(3,Ei,1,0,"ion-spinner",45),r()}if(i&2){let n=u();p(n.submitAttempts().register()&&n.authProviderErrorMessage()?0:-1),m(),y("disabled",n.loadingStates().register()),m(2),p(n.loadingStates().register()?3:-1)}}var Bt,jt,Gt,ee,Et=A(()=>{"use strict";R();ye();Ae();Qe();St();wt();Dt();et();gt();le();Ye();R();Ae();Bt=()=>({cssClass:"custom-action-sheet"}),jt=()=>["/auth/login"],Gt=(i,o)=>o.iso2;ee=(()=>{let o=class o{constructor(){this.fb=b(Te),this.emailValidator=new K,this.usernameValidator=new J,this.zipcodeValidator=new X,this.formReady=f(!1),this.step=M(1),this.nextStep=O(),this.formSubmit=O(),this.submitAttempts=M({email:f(!1),userData:f(!1),personalData:f(!1),register:f(!1)}),this.loadingStates=M({email:f(!1),userData:f(!1),personalData:f(!1),register:f(!1)}),this.controlFocus=O(),this.controlBlur=O(),this.uploadAvatar=O(),this.authProviderErrorMessage=M(""),this.formattedDate=f(new Date().toLocaleDateString("es-ES")),this.avatarDataURL=M(""),this.countries=U,this.roles=[q.Amateur,q.Professional,q.Collector,q.Student],H({atOutline:ot,atCircleOutline:nt,atCircle:it,personCircleOutline:dt,keyOutline:mt,checkmarkCircleOutline:rt,closeCircleOutline:st,calendarOutline:at,globeOutline:lt,pinOutline:ft,mailOutline:pt,homeOutline:ct,locationOutline:ut,personOutline:_t}),ge(()=>{if(!this.formReady())return;let e=this.zipcodeValidator.cityResult(),t=this.registerForm.get("personalData.city");e&&t&&t.setValue(e)})}ngOnInit(){this.initForm(),this.formReady.set(!0)}initForm(){this.registerForm=this.fb.group({emailData:this.fb.group({email:this.fb.control("",{validators:[w.required,w.email],asyncValidators:[this.emailValidator.validate()],updateOn:"blur"})}),userData:this.fb.group({username:this.fb.control("",{validators:[w.required,w.minLength(4)],asyncValidators:[this.usernameValidator.validate()],updateOn:"blur"}),password:this.fb.control("",{validators:[w.required,w.pattern(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/)],updateOn:"blur"})}),personalData:this.fb.group({firstName:this.fb.control("",{validators:[w.required],updateOn:"blur"}),lastName:this.fb.control("",{validators:[w.required],updateOn:"blur"}),address:this.fb.control("",{validators:[w.required],updateOn:"blur"}),country:this.fb.control("Espa\xF1a",{validators:[w.required],updateOn:"blur"}),zipcode:this.fb.control("",{validators:[w.required,w.minLength(3)],asyncValidators:[this.zipcodeValidator.validate()],updateOn:"blur"}),city:this.fb.control("",{validators:[w.required],updateOn:"blur"})}),otherData:this.fb.group({roles:this.fb.array([]),bio:this.fb.control("")})})}onRoleChange(e){let t=this.registerForm.get("otherData.roles");if(e.detail.checked)t.push(this.fb.control(e.detail.value));else{let a=t.controls.findIndex(l=>l.value===e.detail.value);a>=0&&t.removeAt(a)}}onCountryChange(e){return v(this,null,function*(){let t=e.detail.value,a=this.registerForm.get("personalData.country"),l=this.registerForm.get("personalData.zipcode");a==null||a.setValue(t),l==null||l.updateValueAndValidity()})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=$({type:o,selectors:[["app-register-form"]],inputs:{step:[1,"step"],submitAttempts:[1,"submitAttempts"],loadingStates:[1,"loadingStates"],authProviderErrorMessage:[1,"authProviderErrorMessage"],avatarDataURL:[1,"avatarDataURL"]},outputs:{nextStep:"nextStep",formSubmit:"formSubmit",controlFocus:"controlFocus",controlBlur:"controlBlur",uploadAvatar:"uploadAvatar"},decls:10,vars:3,consts:[[3,"formGroup"],["formGroupName","emailData",1,"inputs-container"],["formGroupName","userData",1,"inputs-container"],["formGroupName","personalData",1,"inputs-container"],["formGroupName","otherData",1,"inputs-container"],[1,"buttons-container"],[1,"button-subtitle-container"],["type","button",3,"disabled"],[1,"input-wrapper"],["color","light",1,"custom"],["formControlName","email","type","email",1,"custom",3,"ionFocus","ionBlur"],["slot","start","name","at-circle"],["color","danger",1,"error-text"],["formControlName","username","type","text",1,"custom",3,"ionFocus"],["name","person-circle-outline","slot","start"],["formControlName","password","type","password",1,"custom",3,"ionFocus","clearOnEdit"],["slot","start","name","key-outline"],["slot","end","color","light"],[1,"input-wrapper-row"],["slot","start",3,"click"],["alt","Avatar de usuario por defecto",3,"src"],[1,"custom"],["formControlName","firstName","type","text",1,"custom",3,"ionFocus"],["slot","start","name","person-outline"],["formControlName","lastName","type","text",1,"custom",3,"ionFocus"],[1,"input-wrapper","country-input-wrapper"],["formControlName","country","aria-label","Country","interface","action-sheet",1,"custom","select-input",3,"ionChange","interfaceOptions"],["slot","start","name","globe-outline"],["color","light",3,"value"],[1,"zipcode-city-container"],[1,"input-wrapper","zipcode-input"],["formControlName","zipcode","type","text","maxlength","5","inputmode","numeric",1,"custom",3,"ionFocus"],["name","mail-outline","slot","start"],[1,"input-wrapper","city-input"],["formControlName","city","type","text",1,"custom"],["slot","start","name","location-outline"],["formControlName","address","type","text",1,"custom",3,"ionFocus"],["slot","start","name","home-outline"],[1,"roles-subtitle"],[1,"checkboxes-container"],[1,"checkbox-wrapper"],[1,"input-wrapper","bio-wrapper"],["formControlName","bio",1,"custom",3,"ionFocus"],["labelPlacement","end","color","light",3,"ionChange","value"],[3,"click","disabled"],["name","crescent"],[1,"inline-link",3,"routerLink"],["type","button",3,"click","disabled"]],template:function(t,a){if(t&1&&(s(0,"form",0),g(1,Ht,7,1,"div",1)(2,ii,19,4,"div",2)(3,gi,40,8,"div",3)(4,Ci,13,0,"div",4),r(),s(5,"div",5),g(6,vi,8,4,"div",6)(7,yi,3,2,"ion-button",7)(8,wi,3,2,"ion-button",7)(9,Ri,4,3),r()),t&2){let l,d;y("formGroup",a.registerForm),m(),p((l=a.step())===1?1:l===2?2:l===3?3:l===4?4:-1),m(5),p((d=a.step())===1?6:d===2?7:d===3?8:d===4?9:-1)}},dependencies:[ze,be,$e,Be,Ne,je,qe,ke,Ge,Ie,Ue,Ze,Le,Pe,De,Se,we,Ve,Ee,Fe,Re],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1 0 0;justify-content:space-between;gap:3rem}ion-datetime-button.custom[_ngcontent-%COMP%]{min-height:3rem}ion-datetime-button[_ngcontent-%COMP%]::part(native){background-color:var(--ion-color-dark-tint);display:flex;flex-direction:row;align-items:center;align-self:stretch;gap:.5rem}.zipcode-city-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:1rem}.zipcode-city-container[_ngcontent-%COMP%]   .zipcode-input[_ngcontent-%COMP%]{width:40%;min-height:8rem}.zipcode-city-container[_ngcontent-%COMP%]   .city-input[_ngcontent-%COMP%]{width:55%}.country-input-wrapper[_ngcontent-%COMP%]{width:100%}.roles-subtitle[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--ion-color-light-shade);font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.checkboxes-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem}.checkbox-wrapper[_ngcontent-%COMP%]{display:flex;width:8rem}.bio-wrapper[_ngcontent-%COMP%]{margin-top:1rem}.buttons-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.buttons-container[_ngcontent-%COMP%]:has(ion-button.ios){margin-bottom:24px}.buttons-container[_ngcontent-%COMP%]   .button-subtitle-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}.custom-action-sheet[_ngcontent-%COMP%]{--button-color: var(--ion-color-light);--button-background-hover: var(--ion-color-light-tint);--button-color-activated: var(--ion-color-light-shade)}"]});let i=o;return i})()});var Rt,Ft=A(()=>{"use strict";le();R();Rt=(()=>{let o=class o{transform(e,...t){let a=U.find(l=>l.nameES.toUpperCase()===e.toUpperCase());return a?a.iso2:""}};o.\u0275fac=function(t){return new(t||o)},o.\u0275pipe=pe({name:"countryNameToCode",type:o,pure:!0}),o.\u0275prov=Z({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})()});var Vt,Tt=A(()=>{"use strict";R();qt();Ye();It();Mt();Ut();Ft();R();Vt=(()=>{let o=class o{constructor(){this.authService=b(Xe),this.cartService=b(ht),this.cache=b(We),this.countryNameToCodePipe=b(Rt),this.profilePictureDataURL=f(null),this.loading=f(!1),this.errorMessage=f(""),this.registerState=I(()=>{var e;return{profilePictureDataURL:(e=this.profilePictureDataURL())!=null?e:"",loading:this.loading(),errorMessage:this.errorMessage()}}),this.getAvatarData=()=>v(this,null,function*(){try{let e=yield yt.getPhoto({quality:80,allowEditing:!1,resultType:bt.DataUrl,source:vt.Prompt});this.profilePictureDataURL.set(e.dataUrl)}catch(e){console.error(`Error al seleccionar avatar: ${e}`)}}),this.setAvatarDataNotNative=e=>{var d;let t=e.target;if(!((d=t.files)!=null&&d.length))return;let a=t.files[0],l=new FileReader;l.onload=()=>{let _=l.result;this.profilePictureDataURL.set(_)},l.readAsDataURL(a)},this.removeProfilePicture=()=>v(this,null,function*(){this.profilePictureDataURL.set(null)}),this.registerUser=e=>v(this,null,function*(){var t,a,l,d,_,E,F,T,L,V,P,te;this.loading.set(!0);try{let k=yield this.cache.get("fcmToken"),me=yield this.authService.register({method:"email",userData:{email:(t=e.email)!=null?t:"",username:(a=e.username)!=null?a:"",password:(l=e.password)!=null?l:"",name:{first:(d=e.firstName)!=null?d:"",last:(_=e.lastName)!=null?_:""},address:{line1:(E=e.address)!=null?E:"",city:(F=e.city)!=null?F:"",country:(T=e.country)!=null?T:"",countryCode:this.countryNameToCodePipe.transform(e.country),zipcode:(L=e.zipcode)!=null?L:""},roles:(V=e.roles)!=null?V:[],bio:(P=e.bio)!=null?P:"",fcmToken:k,profilePictureDataURL:(te=this.profilePictureDataURL())!=null?te:""}});Ke(me)&&(yield this.cartService.createCart(me._id)),this.loading.set(!1),this.errorMessage.set("")}catch(k){console.error(k),this.loading.set(!1),this.errorMessage.set(k)}})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=Z({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})()});function Vi(i,o){i&1&&(s(0,"h1"),c(1,"\xBFCu\xE1l es tu email?"),r(),s(2,"h4"),c(3,"Introduce el email con el que quieres iniciar sesi\xF3n en BeatMarket"),r())}function Ti(i,o){i&1&&(s(0,"h1"),c(1,"Rellena tus datos de usuario"),r())}function Pi(i,o){i&1&&(s(0,"h1"),c(1,"Rellena tus datos personales"),r())}function Ai(i,o){i&1&&(s(0,"h1"),c(1,"Cu\xE9ntanos sobre ti"),r())}var Fi,On,ki=A(()=>{R();Pt();kt();Qe();et();gt();Et();Tt();Ot();ye();Lt();R();Fi=["fileInput"];On=(()=>{let o=class o{constructor(){this.router=b(ve),this.registerService=b(Vt),this.registerFormComponent=ie(ee),this.step=f(1),this.totalSteps=4,this.progressBarValue=I(()=>this.step()/this.totalSteps),this.errorMessage=I(()=>this.registerService.registerState().errorMessage),this.profilePictureDataURL=I(()=>this.registerService.registerState().profilePictureDataURL),this.submitAttempts={email:f(!1),userData:f(!1),personalData:f(!1),register:f(!1)},this.loadingStates={email:f(!1),userData:f(!1),personalData:f(!1),register:he(()=>this.registerService.registerState().loading)},this.nextStep=()=>{var e,t,a;if(this.step()===1){this.submitAttempts.email.set(!0),this.handleNextStepEmail((e=this.registerFormComponent())==null?void 0:e.registerForm);return}if(this.step()===2){this.submitAttempts.userData.set(!0),this.handleNextStepUserData((t=this.registerFormComponent())==null?void 0:t.registerForm);return}if(this.step()===3){this.submitAttempts.personalData.set(!0),this.handleNextStepPersonalData((a=this.registerFormComponent())==null?void 0:a.registerForm);return}},this.prevStep=()=>{this.step.set(this.step()-1)},this.resetForm=()=>{var e;(e=this.registerFormComponent())==null||e.registerForm.reset()},this.fileInput=ie("fileInput"),this.onAvatarUpload=()=>v(this,null,function*(){var e;Je.isNativePlatform()?yield this.registerService.getAvatarData():(e=this.fileInput())==null||e.nativeElement.click()}),this.handleFileInput=e=>{this.registerService.setAvatarDataNotNative(e)},this.handleNextStepEmail=e=>v(this,null,function*(){var a;let t=e==null?void 0:e.get("emailData.email");if(t&&(t==null||t.updateValueAndValidity(),t.pending&&(this.loadingStates.email.set(!0),yield N(t.statusChanges.pipe(G(l=>l!=="PENDING"))),this.loadingStates.email.set(!1)),(a=e==null?void 0:e.get("emailData"))!=null&&a.valid)){this.step.set(this.step()+1);return}}),this.handleNextStepUserData=e=>v(this,null,function*(){var l;let t=e==null?void 0:e.get("userData.username"),a=e==null?void 0:e.get("userData.password");!t||!a||(t==null||t.updateValueAndValidity(),a==null||a.updateValueAndValidity(),t.pending&&(this.loadingStates.userData.set(!0),yield N(t.statusChanges.pipe(G(d=>d!=="PENDING"))),this.loadingStates.userData.set(!1)),(l=e==null?void 0:e.get("userData"))!=null&&l.valid&&this.step.set(this.step()+1))}),this.handleNextStepPersonalData=e=>v(this,null,function*(){var F;let t=e==null?void 0:e.get("personalData.firstName"),a=e==null?void 0:e.get("personalData.lastName"),l=e==null?void 0:e.get("personalData.address"),d=e==null?void 0:e.get("personalData.city"),_=e==null?void 0:e.get("personalData.zipcode"),E=e==null?void 0:e.get("personalData.country");!t||!a||!l||!d||!_||!E||(t==null||t.updateValueAndValidity(),a==null||a.updateValueAndValidity(),l==null||l.updateValueAndValidity(),d==null||d.updateValueAndValidity(),E==null||E.updateValueAndValidity(),t.pending&&(this.loadingStates.personalData.set(!0),yield N(t.statusChanges.pipe(G(T=>T!=="PENDING"))),this.loadingStates.personalData.set(!1)),(F=e==null?void 0:e.get("personalData"))!=null&&F.valid&&this.step.set(this.step()+1))}),H({arrowBackOutline:tt})}ionViewDidLeave(){this.registerService.removeProfilePicture()}onControlFocus(e){this.submitAttempts.email.set(!1),this.submitAttempts.userData.set(!1),this.submitAttempts.personalData.set(!1),this.submitAttempts.register.set(!1)}handleRegister(){return v(this,null,function*(){var t;let e=(t=this.registerFormComponent())==null?void 0:t.registerForm;yield this.registerService.registerUser(z(z(z(z({},e==null?void 0:e.value.emailData),e==null?void 0:e.value.userData),e==null?void 0:e.value.personalData),e==null?void 0:e.value.otherData)),this.errorMessage()||(this.resetForm(),this.step.set(1),this.router.navigate(["/auth/welcome"]))})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=$({type:o,selectors:[["app-register"]],viewQuery:function(t,a){t&1&&(ae(a.registerFormComponent,ee,5),ae(a.fileInput,Fi,5)),t&2&&_e(2)},decls:13,vars:12,consts:[["fileInput",""],["type","arrow-back","title","Registro",3,"backPressed","showSearch","showCart","showProgressBar","progressBarValue","backActionType"],[3,"fullscreen"],[1,"container"],[1,"title-form-container"],[1,"title-container"],[3,"controlFocus","uploadAvatar","nextStep","formSubmit","step","submitAttempts","loadingStates","avatarDataURL","authProviderErrorMessage"],["type","file","accept","image/*","hidden","",3,"change"]],template:function(t,a){if(t&1){let l=D();s(0,"ion-header")(1,"app-toolbar",1),x("backPressed",function(){return h(l),C(a.prevStep())}),r()(),s(2,"ion-content",2)(3,"div",3)(4,"div",4)(5,"div",5),g(6,Vi,4,0)(7,Ti,2,0,"h1")(8,Pi,2,0,"h1")(9,Ai,2,0,"h1"),r(),s(10,"app-register-form",6),x("controlFocus",function(_){return h(l),C(a.onControlFocus(_))})("uploadAvatar",function(){return h(l),C(a.onAvatarUpload())})("nextStep",function(){return h(l),C(a.nextStep())})("formSubmit",function(){return h(l),C(a.handleRegister())}),r(),s(11,"input",7,0),x("change",function(_){return h(l),C(a.handleFileInput(_))}),r()()()()}if(t&2){let l;m(),y("showSearch",!1)("showCart",!1)("showProgressBar",!0)("progressBarValue",a.progressBarValue())("backActionType",a.step()===1?"default":"emit"),m(),y("fullscreen",!0),m(4),p((l=a.step())===1?6:l===2?7:l===3?8:l===4?9:-1),m(4),y("step",a.step())("submitAttempts",a.submitAttempts)("loadingStates",a.loadingStates)("avatarDataURL",a.profilePictureDataURL())("authProviderErrorMessage",a.errorMessage())}},dependencies:[Ct,Oe,Me,ee],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;min-height:100%;gap:1rem}.title-form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;gap:1.5rem}.title-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-light)}"]});let i=o;return i})()});ki();export{On as RegisterPage};
