import{c as we,d as ke}from"./chunk-DG3LOJG6.js";import{F as _e,O as be,a as x,b as de,d as ge,p as fe,w as he}from"./chunk-FBV753BW.js";import"./chunk-4RNTT74T.js";import{f as ce,g as xe,n as ue,o as Pe,t as pe,u as Ee}from"./chunk-VQCHUAXV.js";import"./chunk-K5TY53DO.js";import"./chunk-4XKNA7IF.js";import"./chunk-4FRKXPG4.js";import"./chunk-E4HNE3PW.js";import"./chunk-P2UHFIXP.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-GTZXGHKK.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import{$ as oe,Ba as me,R as ee,Z as te,aa as ie,c as I,ca as ne,d as J,e as K,i as W,j as X,ka as re,l as Y,na as se,r as Z,s as T,t as $,u as O,va as ae,wa as le}from"./chunk-DOH43VTP.js";import{$ as l,D as p,Da as g,Ea as k,Kb as Q,Lb as z,Ma as B,Na as j,Pb as H,Qa as c,Ra as N,V as F,W as v,Y as h,Ya as U,ea as V,fa as y,hb as S,ib as D,jb as G,ka as _,nb as b,qa as d,sa as f,vb as q,wa as r,xa as n,xb as Te,ya as M,z as A}from"./chunk-DHHGUDQP.js";import"./chunk-OHMQXWFK.js";import"./chunk-S6VCIYOJ.js";import"./chunk-25CU3KXX.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{f as E,k as L,m as R,o as C}from"./chunk-FIPIWZQS.js";function Oe(e,o){e&1&&(r(0,"ion-text",5),c(1,"Introduce un email o un nombre de usuario"),n())}function Le(e,o){e&1&&(r(0,"ion-label",7),c(1,"\xBFOlvidaste la contrase\xF1a?"),n()),e&2&&d("routerLink",U(1,Ie))}function Re(e,o){e&1&&(r(0,"ion-text",5),c(1,"Introduce una contrase\xF1a"),n())}function Ae(e,o){if(e&1&&(r(0,"ion-text",15),c(1),n()),e&2){let w=k(2);l(),N(w.authErrorMessage())}}function Ve(e,o){if(e&1&&_(0,Re,2,0,"ion-text",5)(1,Ae,2,1,"ion-text",15),e&2){let w,i=k();f(!((w=i.loginForm.get("password"))==null||w.errors==null)&&w.errors.required?0:-1),l(),f(i.authErrorMessage()?1:-1)}}function Be(e,o){e&1&&M(0,"ion-spinner",13)}var Ie,P,Fe=E(()=>{"use strict";b();O();H();me();de();be();b();O();Ie=()=>["/auth/password-reset"];P=(()=>{var o,ve;let i=class i{constructor(){L(this,o);this.fb=p(Z),this.submitAttempted=v(!1),this.loading=v(!1),this.forgotPasswordVisible=v(!1),this.authErrorMessage=v(""),this.controlFocus=F(),this.formSubmit=F(),this.goToRegister=F(),x({personCircleOutline:_e,keyOutline:he,closeCircleOutline:fe})}ngOnInit(){R(this,o,ve).call(this)}};o=new WeakSet,ve=function(){this.loginForm=this.fb.group({emailOrUsername:["",{validators:[I.required],updateOn:"blur"}],password:["",{validators:[I.required],updateOn:"blur"}]})},i.\u0275fac=function(s){return new(s||i)},i.\u0275cmp=y({type:i,selectors:[["app-login-form"]],inputs:{submitAttempted:[1,"submitAttempted"],loading:[1,"loading"],forgotPasswordVisible:[1,"forgotPasswordVisible"],authErrorMessage:[1,"authErrorMessage"]},outputs:{controlFocus:"controlFocus",formSubmit:"formSubmit",goToRegister:"goToRegister"},decls:24,vars:7,consts:[[3,"formGroup"],[1,"input-wrapper"],["color","light",1,"custom"],["formControlName","emailOrUsername","type","email",1,"custom",3,"ionFocus"],["slot","start","name","person-circle-outline"],["color","danger",1,"error-text"],[1,"password-labels-wrapper"],[1,"custom","link","forgot-password",3,"routerLink"],["formControlName","password","type","password",1,"custom",3,"ionFocus","clearOnEdit"],["slot","start","name","key-outline"],["slot","end","color","light"],[1,"button-subtitle-container"],[3,"click","disabled"],["name","crescent"],[1,"inline-link",3,"click"],["color","danger",1,"error-text","auth-error"]],template:function(s,t){if(s&1&&(r(0,"form",0)(1,"div",1)(2,"ion-label",2),c(3,"Email o nombre de usuario"),n(),r(4,"ion-input",3),g("ionFocus",function(){return t.controlFocus.emit("emailOrUsername")}),M(5,"ion-icon",4),n(),_(6,Oe,2,0,"ion-text",5),n(),r(7,"div",1)(8,"div",6)(9,"ion-label",2),c(10,"Contrase\xF1a"),n(),_(11,Le,2,2,"ion-label",7),n(),r(12,"ion-input",8),g("ionFocus",function(){return t.controlFocus.emit("password")}),M(13,"ion-icon",9)(14,"ion-input-password-toggle",10),n(),_(15,Ve,2,2),n()(),r(16,"div",11)(17,"ion-button",12),g("click",function(){return t.formSubmit.emit(t.loginForm.value)}),c(18," Ingresar "),_(19,Be,1,0,"ion-spinner",13),n(),r(20,"ion-text"),c(21,"\xBFNo tienes cuenta? "),r(22,"a",14),g("click",function(){return t.goToRegister.emit()}),c(23,"Reg\xEDstrate"),n()()()),s&2){let u;d("formGroup",t.loginForm),l(6),f(t.submitAttempted()&&(!((u=t.loginForm.get("emailOrUsername"))==null||u.errors==null)&&u.errors.required)?6:-1),l(5),f(t.forgotPasswordVisible()?11:-1),l(),d("clearOnEdit",!1),l(3),f(t.submitAttempted()?15:-1),l(2),d("disabled",t.loading()),l(2),f(t.loading()?19:-1)}},dependencies:[ae,re,z,se,ne,le,ie,ee,T,W,J,K,$,X,Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1;justify-content:space-between;gap:1rem}form[_ngcontent-%COMP%]{margin-top:4rem}.link[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer}.password-labels-wrapper[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center}.password-labels-wrapper[_ngcontent-%COMP%]   .forgot-password[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem);text-decoration:underline;cursor:pointer}.button-subtitle-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}.button-subtitle-container[_ngcontent-%COMP%]:has(ion-button.ios){margin-bottom:24px}.auth-error[_ngcontent-%COMP%]{margin-top:1rem}"]});let e=i;return e})()});var je,ye,Me=E(()=>{"use strict";b();xe();Ee();Pe();b();je="Credenciales incorrectas.",ye=(()=>{let o=class o{constructor(){this.authService=p(pe),this.userRepository=p(ce),this.cache=p(ue),this.loading=h(!1),this.errorMessage=h(""),this.loginState=S(()=>({loading:this.loading(),errorMessage:this.errorMessage()}))}login(m){return C(this,arguments,function*({emailOrUsername:i,password:a}){this.loading.set(!0),this.errorMessage.set("");let s=i,t=null,u=yield this.cache.get("fcmToken");try{if(t=yield this.userRepository.getUserByEmail(i),!t){if(t=yield this.userRepository.getUserByUsername(i),!t)throw new Error("Credenciales incorrectas.");s=t.email}yield this.authService.login({method:"email",credentials:{email:s,password:a}}),yield this.userRepository.updateUser({_id:t._id,fcmToken:u}),this.errorMessage.set(""),this.loading.set(!1)}catch(Se){console.warn(Se),this.errorMessage.set(je),this.loading.set(!1)}})}resetPassword(){return C(this,null,function*(){})}};o.\u0275fac=function(a){return new(a||o)},o.\u0275prov=A({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})()});var gt,Ne=E(()=>{b();Te();O();H();me();Fe();de();be();Me();ke();b();gt=(()=>{let o=class o{constructor(){this.router=p(Q),this.loginService=p(ye),this.loading=S(()=>this.loginService.loginState().loading),this.errorMessage=G(()=>{var i;return(i=this.loginService.loginState().errorMessage)!=null?i:""}),this.loginFormComponent=V(P),this.submitAttempted=h(!1),this.forgotPasswordVisible=h(!1),x({arrowBackOutline:ge}),D(()=>{this.errorMessage()&&this.forgotPasswordVisible.set(!0)})}onControlFocus(i){this.submitAttempted.set(!1),this.errorMessage.set("")}onBackPressed(){this.router.navigate(["/auth/landing"])}onGoToRegister(){console.log(this.loading()),this.loading()||this.router.navigate(["/auth/register"])}login(m){return C(this,arguments,function*({emailOrUsername:i,password:a}){var s,t;this.submitAttempted.set(!0),this.errorMessage.set(""),(t=(s=this.loginFormComponent())==null?void 0:s.loginForm)!=null&&t.valid&&(yield this.loginService.login({emailOrUsername:i,password:a}),this.errorMessage()||this.router.navigate(["/tabs"]))})}};o.\u0275fac=function(a){return new(a||o)},o.\u0275cmp=y({type:o,selectors:[["app-login"]],viewQuery:function(a,m){a&1&&B(m.loginFormComponent,P,5),a&2&&j()},decls:5,vars:7,consts:[["type","arrow-back","title","Ingresar","backActionType","emit",3,"backPressed","showSearch","showCart"],[3,"fullscreen"],[1,"container"],[3,"controlFocus","formSubmit","goToRegister","authErrorMessage","submitAttempted","loading","forgotPasswordVisible"]],template:function(a,m){a&1&&(r(0,"ion-header")(1,"app-toolbar",0),g("backPressed",function(){return m.onBackPressed()}),n()(),r(2,"ion-content",1)(3,"div",2)(4,"app-login-form",3),g("controlFocus",function(t){return m.onControlFocus(t)})("formSubmit",function(t){return m.login(t)})("goToRegister",function(){return m.onGoToRegister()}),n()()()),a&2&&(l(),d("showSearch",!1)("showCart",!1),l(),d("fullscreen",!0),l(2),d("authErrorMessage",m.errorMessage())("submitAttempted",m.submitAttempted())("loading",m.loading())("forgotPasswordVisible",m.forgotPasswordVisible()))},dependencies:[we,oe,P,te,q,T],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;min-height:100%;gap:1rem}"]});let e=o;return e})()});Ne();export{gt as LoginPage};
