import{a as kg,b as QT}from"./chunk-TTKGVFI5.js";import{a as Cg,b as HT}from"./chunk-PIDRDD2T.js";import{a as Ng,b as YT}from"./chunk-V3MBJDVW.js";import{a as hs,b as $T}from"./chunk-Y6E222S6.js";import{A as It,B as ls,C as Je,D as Lr,E as Qo,F as wt,G as $t,H as ke,I as Et,J as lg,K as jt,L as Yo,M as he,N as jn,a as eg,b as tg,c as tl,d as ng,e as Wo,f as nl,g as rl,h as Ko,i as Ie,j as rg,k as ig,l as sg,m as og,n as ag,o as il,p as Ho,q as fn,r as Dr,s as cg,t as $n,u as Or,v as xr,w as Vr,x as ug,y as ne,z as us}from"./chunk-42PVXCFM.js";import{i as Tg,j as Ag,k as Rg,l as bg,m as Sg,n as Pg,o as KT}from"./chunk-ZLVYX7G6.js";import{a as Tt,b as ra,c as wg,d as ia}from"./chunk-CC7RULIL.js";import{a as Eg,b as WT}from"./chunk-EJ3JXVBZ.js";import{a as Ig,b as GT}from"./chunk-3FWRLNF5.js";import{a as vg,b as jT,d as zT}from"./chunk-6NUGH5FF.js";import{a as hg,c as MT,d as dg,e as FT,f as Jo,g as fg,i as Xo,k as pg,l as mg,m as UT,n as gg,o as BT,p as _g,q as qT,t as na,u as yg}from"./chunk-VQCHUAXV.js";import{b as Zo,c as ea,e as ta}from"./chunk-K5TY53DO.js";import"./chunk-4XKNA7IF.js";import"./chunk-4FRKXPG4.js";import"./chunk-E4HNE3PW.js";import"./chunk-P2UHFIXP.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-GTZXGHKK.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import{Ca as Zm,K as Qm,N as Ym,P as Jm,ua as Xm,w as Hm}from"./chunk-BQ2OOKCX.js";import{B as ln,Bb as jm,C as km,Cb as VT,D as ee,Db as LT,E as Ce,F as hn,G as Nm,H as zo,I as vt,Jb as zm,Kb as Go,Mb as Gm,Nb as Wm,Ob as Km,Pb as el,R as dn,S as Dm,U as rt,Y as Om,Z as xm,a as as,bb as Bm,cb as qm,d as Sm,db as Zu,e as Pm,f as jo,fa as Vm,h as xT,i as Yu,j as Ju,l as Bn,na as Lm,nb as ce,o as be,p as qt,t as Xu,u as qn,v as cs,w as Cm,wa as Mm,xa as Fm,ya as Um,yb as $m,z as _e}from"./chunk-DHHGUDQP.js";import"./chunk-OHMQXWFK.js";import"./chunk-S6VCIYOJ.js";import"./chunk-25CU3KXX.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as ue,b as Fe,e as bm,f as Q,g as OT,i as un,n as Bt,o as p}from"./chunk-FIPIWZQS.js";var JT,XT,pn=Q(()=>{"use strict";jn();jn();JT="firebase",XT="11.6.1";he(JT,XT,"app")});function Gn(r,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(r).getImmediate({optional:!0})}function ZT(r,e){!Og&&(Dg>Mr.SILENT||Zu())&&(Og=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Dg>=e&&console.warn(`Firebase API called outside injection context: ${r.name}`)}function eA(r){let e=ee(rt,{optional:!0});return e?e.runOutsideAngular(()=>r()):r()}function zn(r){let e=ee(rt,{optional:!0});return e?e.run(()=>r()):r()}var Rt,mn,Mr,Dg,sa,bt,Og,tA,K,Fr=Q(()=>{"use strict";ce();ce();pn();MT();cs();Cm();Rt=new Bm("ANGULARFIRE2_VERSION");mn=(r,e)=>{let t=e?[e]:Yo(),n=[];return t.forEach(i=>{i.container.getProvider(r).instances.forEach(o=>{n.includes(o)||n.push(o)})}),n},Mr=function(r){return r[r.SILENT=0]="SILENT",r[r.WARN=1]="WARN",r[r.VERBOSE=2]="VERBOSE",r}(Mr||{}),Dg=Zu()&&typeof Zone<"u"?Mr.WARN:Mr.SILENT,sa=class{zone;delegate;constructor(e,t=Pm){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){let i=this.zone,s=function(o){i?i.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])};return this.delegate.schedule(s,t,n)}},bt=(()=>{let e=class e{outsideAngular;insideAngular;constructor(){let n=ee(rt);this.outsideAngular=n.runOutsideAngular(()=>new sa(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=n.run(()=>new sa(typeof Zone>"u"?void 0:Zone.current,Sm))}};un(e,"\u0275fac",function(i){return new(i||e)}),un(e,"\u0275prov",_e({token:e,factory:e.\u0275fac,providedIn:"root"}));let r=e;return r})(),Og=!1;tA=(r,e,t)=>(...n)=>(e&&setTimeout(e,0),vt(t,()=>zn(()=>r.apply(void 0,n)))),K=(r,e,t)=>(t||(t=e?Mr.WARN:Mr.VERBOSE),function(){let n,i=arguments,s,o,c;try{s=ee(bt),o=ee(Dm),c=ee(zo)}catch{return ZT(r,t),r.apply(this,i)}for(let h=0;h<arguments.length;h++)typeof i[h]=="function"&&(e&&(n||(n=zn(()=>o.add()))),i[h]=tA(i[h],n,c));let u=eA(()=>r.apply(this,i));return e?u instanceof as?u.pipe(Ju(s.outsideAngular),Yu(s.insideAngular),hg(c)):u instanceof Promise?zn(()=>new Promise((h,f)=>{o.run(()=>u).then(g=>vt(c,()=>zn(()=>h(g))),g=>vt(c,()=>zn(()=>f(g))))})):typeof u=="function"&&n?function(){return setTimeout(n,0),u.apply(this,arguments)}:zn(()=>u):u instanceof as?u.pipe(Ju(s.outsideAngular),Yu(s.insideAngular)):zn(()=>u)})});function nA(r){return r&&r.length===1?r[0]:new ut(jt())}function sA(r){return(e,t)=>{let n=t.get(xm);he("angularfire",Rt.full,"core"),he("angularfire",Rt.full,"app"),he("angular",qm.full,n.toString());let i=e.runOutsideAngular(()=>r(t));return new ut(i)}}function xg(r,...e){return hn([rA,iA,{provide:sl,useFactory:sA(r),multi:!0,deps:[rt,dn,bt,...e]}])}var ut,zt,sl,rA,iA,Vg,ds=Q(()=>{"use strict";pn();pn();ce();Fr();ut=class{constructor(e){return e}},zt=class{constructor(){return Yo()}};sl=new ln("angularfire2._apps"),rA={provide:ut,useFactory:nA,deps:[[new Ce,sl]]},iA={provide:zt,deps:[[new Ce,sl]]};Vg=K(lg,!0)});function lt(r){return oA.get(r)||Object.assign({},aA)}function Ug(){return cA}function hA(r){return new Promise(e=>{setTimeout(e,r)})}function Bg(r){if(!lt(r).activated)throw gn.create("use-before-activation",{appName:r.name})}function qg(n,i){return p(this,arguments,function*({url:r,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let A=yield o.getHeartbeatsHeader();A&&(s["X-Firebase-Client"]=A)}let c={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(r,c)}catch(A){throw gn.create("fetch-network-error",{originalErrorMessage:A==null?void 0:A.message})}if(u.status!==200)throw gn.create("fetch-status-error",{httpStatus:u.status});let h;try{h=yield u.json()}catch(A){throw gn.create("fetch-parse-error",{originalErrorMessage:A==null?void 0:A.message})}let f=h.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw gn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});let g=Number(f[1])*1e3,y=Date.now();return{token:h.token,expireTimeMillis:y+g,issuedAtTimeMillis:y}})}function $g(r,e){let{projectId:t,appId:n,apiKey:i}=r.options;return{url:`${uA}/projects/${t}/apps/${n}:${lA}?key=${i}`,body:{debug_token:e}}}function mA(){return oa||(oa=new Promise((r,e)=>{try{let t=indexedDB.open(fA,pA);t.onsuccess=n=>{r(n.target.result)},t.onerror=n=>{var i;e(gn.create("storage-open",{originalErrorMessage:(i=n.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=n=>{let i=n.target.result;switch(n.oldVersion){case 0:i.createObjectStore(ul,{keyPath:"compositeKey"})}}}catch(t){e(gn.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}}),oa)}function gA(r,e){return _A(yA(r),e)}function _A(r,e){return p(this,null,function*(){let n=(yield mA()).transaction(ul,"readwrite"),s=n.objectStore(ul).put({compositeKey:r,value:e});return new Promise((o,c)=>{s.onsuccess=u=>{o()},n.onerror=u=>{var h;c(gn.create("storage-set",{originalErrorMessage:(h=u.target.error)===null||h===void 0?void 0:h.message}))}})})}function yA(r){return`${r.options.appId}-${r.name}`}function ol(r,e){return Ho()?gA(r,e).catch(t=>{fs.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function jg(){return Ug().enabled}function zg(){return p(this,null,function*(){let r=Ug();if(r.enabled&&r.token)return r.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}function IA(r){return eg.encodeString(JSON.stringify(r),!1)}function ll(r,e=!1,t=!1){return p(this,null,function*(){let n=r.app;Bg(n);let i=lt(n),s=i.token,o;if(s&&!ps(s)&&(i.token=void 0,s=void 0),!s){let h=yield i.cachedTokenPromise;h&&(ps(h)?s=h:yield ol(n,void 0))}if(!e&&s&&ps(s))return{token:s.token};let c=!1;if(jg())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=qg($g(n,yield zg()),r.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),c=!0);let h=yield i.exchangeTokenPromise;return yield ol(n,h),i.token=h,{token:h.token}}catch(h){return h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?fs.warn(h.message):t&&fs.error(h),al(h)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),c=!0),s=yield lt(n).exchangeTokenPromise}catch(h){h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?fs.warn(h.message):t&&fs.error(h),o=h}let u;return s?o?ps(s)?u={token:s.token,internalError:o}:u=al(o):(u={token:s.token},i.token=s,yield ol(n,s)):u=al(o),c&&AA(n,u),u})}function wA(r){return p(this,null,function*(){let e=r.app;Bg(e);let{provider:t}=lt(e);if(jg()){let n=yield zg(),{token:i}=yield qg($g(e,n),r.heartbeatServiceProvider);return{token:i}}else{let{token:n}=yield t.getToken();return{token:n}}})}function EA(r,e,t,n){let{app:i}=r,s=lt(i),o={next:t,error:n,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&ps(s.token)){let c=s.token;Promise.resolve().then(()=>{t({token:c.token}),Mg(r)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Mg(r))}function Gg(r,e){let t=lt(r),n=t.tokenObservers.filter(i=>i.next!==e);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function Mg(r){let{app:e}=r,t=lt(e),n=t.tokenRefresher;n||(n=TA(r),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function TA(r){let{app:e}=r;return new cl(()=>p(this,null,function*(){let t=lt(e),n;if(t.token?n=yield ll(r,!0):n=yield ll(r),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=lt(e);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,i),Math.max(0,n-Date.now())}else return 0},Lg.RETRIAL_MIN_WAIT,Lg.RETRIAL_MAX_WAIT)}function AA(r,e){let t=lt(r).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function ps(r){return r.expireTimeMillis-Date.now()>0}function al(r){return{token:IA(vA),error:r}}function RA(r,e){return new hl(r,e)}function bA(r){return{getToken:e=>ll(r,e),getLimitedUseToken:()=>wA(r),addTokenListener:e=>EA(r,"INTERNAL",e),removeTokenListener:e=>Gg(r.app,e)}}function kA(){wt(new It(CA,r=>{let e=r.getProvider("app").getImmediate(),t=r.getProvider("heartbeat");return RA(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,e,t)=>{r.getProvider(Fg).initialize()})),wt(new It(Fg,r=>{let e=r.getProvider("app-check").getImmediate();return bA(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),he(SA,PA)}var oA,aA,cA,uA,lA,Lg,bk,cl,dA,gn,fA,pA,ul,oa,fs,vA,hl,SA,PA,CA,Fg,Wg=Q(()=>{"use strict";jn();ls();us();Qo();oA=new Map,aA={activated:!1,tokenObservers:[]},cA={initialized:!1,enabled:!1};uA="https://content-firebaseappcheck.googleapis.com/v1",lA="exchangeDebugToken",Lg={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},bk=24*60*60*1e3;cl=class{constructor(e,t,n,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return p(this,null,function*(){this.stop();try{this.pending=new rl,this.pending.promise.catch(t=>{}),yield hA(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new rl,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};dA={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},gn=new Dr("appCheck","AppCheck",dA);fA="firebase-app-check-database",pA=1,ul="firebase-app-check-store",oa=null;fs=new Lr("@firebase/app-check");vA={error:"UNKNOWN_ERROR"};hl=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=lt(this.app);for(let t of e)Gg(this.app,t.next);return Promise.resolve()}};SA="@firebase/app-check",PA="0.8.13";CA="app-check",Fg="app-check-internal";kA()});var dl=Q(()=>{"use strict";Wg()});var NA,_n,DA,Uk,aa=Q(()=>{"use strict";Fr();pn();dl();dl();NA="app-check",_n=class{constructor(){return mn(NA)}},DA=["localhost","0.0.0.0","127.0.0.1"],Uk=typeof window<"u"&&DA.includes(window.location.hostname)});function c_(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function OA(r,...e){fa.logLevel<=Je.WARN&&fa.warn(`Auth (${Et}): ${r}`,...e)}function ua(r,...e){fa.logLevel<=Je.ERROR&&fa.error(`Auth (${Et}): ${r}`,...e)}function it(r,...e){throw xl(r,...e)}function ht(r,...e){return xl(r,...e)}function Ol(r,e,t){let n=Object.assign(Object.assign({},u_()),{[e]:t});return new Dr("auth","Firebase",n).create(e,{appName:r.name})}function Kt(r){return Ol(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function xA(r,e,t){let n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&it(r,"argument-error"),Ol(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function xl(r,...e){if(typeof r!="string"){let t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return l_.create(r,...e)}function q(r,e,...t){if(!r)throw xl(e,...t)}function Gt(r){let e="INTERNAL ASSERTION FAILED: "+r;throw ua(e),new Error(e)}function Ht(r,e){r||Gt(e)}function ml(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function VA(){return Kg()==="http:"||Kg()==="https:"}function Kg(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}function LA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(VA()||sg()||"connection"in navigator)?navigator.onLine:!0}function MA(){if(typeof navigator>"u")return null;let r=navigator;return r.languages&&r.languages[0]||r.language||null}function Vl(r,e){Ht(r.emulator,"Emulator should always be set here");let{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}function Qt(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}function dt(s,o,c,u){return p(this,arguments,function*(r,e,t,n,i={}){return h_(r,i,()=>p(this,null,function*(){let h={},f={};n&&(e==="GET"?f=n:h={body:JSON.stringify(n)});let g=Or(Object.assign({key:r.config.apiKey},f)).slice(1),y=yield r._getAdditionalHeaders();y["Content-Type"]="application/json",r.languageCode&&(y["X-Firebase-Locale"]=r.languageCode);let A=Object.assign({method:e,headers:y},h);return ig()||(A.referrerPolicy="no-referrer"),pa.fetch()(yield d_(r,r.config.apiHost,t,g),A)}))})}function h_(r,e,t){return p(this,null,function*(){r._canInitEmulator=!1;let n=Object.assign(Object.assign({},FA),e);try{let i=new gl(r),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw ca(r,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let c=s.ok?o.errorMessage:o.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw ca(r,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw ca(r,"email-already-in-use",o);if(u==="USER_DISABLED")throw ca(r,"user-disabled",o);let f=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Ol(r,f,h);it(r,f)}}catch(i){if(i instanceof fn)throw i;it(r,"network-request-failed",{message:String(i)})}})}function As(s,o,c,u){return p(this,arguments,function*(r,e,t,n,i={}){let h=yield dt(r,e,t,n,i);return"mfaPendingCredential"in h&&it(r,"multi-factor-auth-required",{_serverResponse:h}),h})}function d_(r,e,t,n){return p(this,null,function*(){let i=`${e}${t}?${n}`,s=r,o=s.config.emulator?Vl(r.config,i):`${r.config.apiScheme}://${i}`;return UA.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}function qA(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}function ca(r,e,t){let n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);let i=ht(r,e,n);return i.customData._tokenResponse=t,i}function Hg(r){return r!==void 0&&r.enterprise!==void 0}function $A(r,e){return p(this,null,function*(){return dt(r,"GET","/v2/recaptchaConfig",Qt(r,e))})}function jA(r,e){return p(this,null,function*(){return dt(r,"POST","/v1/accounts:delete",e)})}function ma(r,e){return p(this,null,function*(){return dt(r,"POST","/v1/accounts:lookup",e)})}function gs(r){if(r)try{let e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Ll(r,e=!1){return p(this,null,function*(){let t=ne(r),n=yield t.getIdToken(e),i=Ml(n);q(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:n,authTime:gs(fl(i.auth_time)),issuedAtTime:gs(fl(i.iat)),expirationTime:gs(fl(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}})}function fl(r){return Number(r)*1e3}function Ml(r){let[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return ua("JWT malformed, contained fewer than 3 sections"),null;try{let i=tg(t);return i?JSON.parse(i):(ua("Failed to decode base64 JWT payload"),null)}catch(i){return ua("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function Qg(r){let e=Ml(r);return q(e,"internal-error"),q(typeof e.exp<"u","internal-error"),q(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Kn(r,e,t=!1){return p(this,null,function*(){if(t)return e;try{return yield e}catch(n){throw n instanceof fn&&zA(n)&&r.auth.currentUser===r&&(yield r.auth.signOut()),n}})}function zA({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}function ga(r){return p(this,null,function*(){var e;let t=r.auth,n=yield r.getIdToken(),i=yield Kn(r,ma(t,{idToken:n}));q(i==null?void 0:i.users.length,t,"internal-error");let s=i.users[0];r._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?f_(s.providerUserInfo):[],c=GA(r.providerData,o),u=r.isAnonymous,h=!(r.email&&s.passwordHash)&&!(c!=null&&c.length),f=u?h:!1,g={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new ys(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(r,g)})}function Fl(r){return p(this,null,function*(){let e=ne(r);yield ga(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function GA(r,e){return[...r.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function f_(r){return r.map(e=>{var{providerId:t}=e,n=jo(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}function WA(r,e){return p(this,null,function*(){let t=yield h_(r,{},()=>p(this,null,function*(){let n=Or({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=r.config,o=yield d_(r,i,"/v1/token",`key=${s}`),c=yield r._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",pa.fetch()(o,{method:"POST",headers:c,body:n})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function KA(r,e){return p(this,null,function*(){return dt(r,"POST","/v2/accounts:revokeToken",Qt(r,e))})}function yn(r,e){q(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}function Wt(r){Ht(r instanceof Function,"Expected a class definition");let e=Yg.get(r);return e?(Ht(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,Yg.set(r,e),e)}function la(r,e,t){return`firebase:${r}:${e}:${t}`}function Jg(r){let e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(__(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(p_(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(v_(e))return"Blackberry";if(I_(e))return"Webos";if(m_(e))return"Safari";if((e.includes("chrome/")||g_(e))&&!e.includes("edge/"))return"Chrome";if(y_(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function p_(r=Ie()){return/firefox\//i.test(r)}function m_(r=Ie()){let e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function g_(r=Ie()){return/crios\//i.test(r)}function __(r=Ie()){return/iemobile/i.test(r)}function y_(r=Ie()){return/android/i.test(r)}function v_(r=Ie()){return/blackberry/i.test(r)}function I_(r=Ie()){return/webos/i.test(r)}function Ul(r=Ie()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function QA(r=Ie()){var e;return Ul(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function YA(){return ag()&&document.documentMode===10}function w_(r=Ie()){return Ul(r)||y_(r)||I_(r)||v_(r)||/windows phone/i.test(r)||__(r)}function E_(r,e=[]){let t;switch(r){case"Browser":t=Jg(Ie());break;case"Worker":t=`${Jg(Ie())}-${r}`;break;default:t=r}let n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Et}/${n}`}function JA(t){return p(this,arguments,function*(r,e={}){return dt(r,"GET","/v2/passwordPolicy",Qt(r,e))})}function Yt(r){return ne(r)}function ZA(r){ba=r}function T_(r){return ba.loadJS(r)}function eR(){return ba.recaptchaEnterpriseScript}function tR(){return ba.gapiScript}function A_(r){return`__${r}${Math.floor(Math.random()*1e6)}`}function ms(r,e,t,n=!1,i=!1){return p(this,null,function*(){let s=new Rl(r),o;if(i)o=R_;else try{o=yield s.verify(t)}catch{o=yield s.verify(t,!0)}let c=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){let u=c.phoneEnrollmentInfo.phoneNumber,h=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){let u=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return n?Object.assign(c,{captchaResp:o}):Object.assign(c,{captchaResponse:o}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c})}function va(r,e,t,n,i){return p(this,null,function*(){var s,o;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((s=r._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let c=yield ms(r,e,t,t==="getOobCode");return n(r,c)}else return n(r,e).catch(c=>p(this,null,function*(){if(c.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let u=yield ms(r,e,t,t==="getOobCode");return n(r,u)}else return Promise.reject(c)}));else if(i==="PHONE_PROVIDER")if(!((o=r._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("PHONE_PROVIDER")){let c=yield ms(r,e,t);return n(r,c).catch(u=>p(this,null,function*(){var h;if(((h=r._getRecaptchaConfig())===null||h===void 0?void 0:h.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(u.code==="auth/missing-recaptcha-token"||u.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let f=yield ms(r,e,t,!1,!0);return n(r,f)}return Promise.reject(u)}))}else{let c=yield ms(r,e,t,!1,!0);return n(r,c)}else return Promise.reject(i+" provider is not supported.")})}function Sa(r,e){let t=$t(r,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if($n(s,e!=null?e:{}))return i;it(i,"already-initialized")}return t.initialize({options:e})}function rR(r,e){let t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(Wt);e!=null&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function Bl(r,e,t){let n=Yt(r);q(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");let i=!!(t!=null&&t.disableWarnings),s=b_(e),{host:o,port:c}=iR(e),u=c===null?"":`:${c}`,h={url:`${s}//${o}${u}/`},f=Object.freeze({host:o,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){q(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),q($n(h,n.config.emulator)&&$n(f,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=h,n.emulatorConfig=f,n.settings.appVerificationDisabledForTesting=!0,i||sR()}function b_(r){let e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function iR(r){let e=b_(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};let n=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let s=i[1];return{host:s,port:Xg(n.substr(s.length+1))}}else{let[s,o]=n.split(":");return{host:s,port:Xg(o)}}}function Xg(r){if(!r)return null;let e=Number(r);return isNaN(e)?null:e}function sR(){function r(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}function oR(r,e){return p(this,null,function*(){return dt(r,"POST","/v1/accounts:update",e)})}function aR(r,e){return p(this,null,function*(){return dt(r,"POST","/v1/accounts:signUp",e)})}function cR(r,e){return p(this,null,function*(){return As(r,"POST","/v1/accounts:signInWithPassword",Qt(r,e))})}function uR(r,e){return p(this,null,function*(){return dt(r,"POST","/v1/accounts:sendOobCode",Qt(r,e))})}function lR(r,e){return p(this,null,function*(){return uR(r,e)})}function hR(r,e){return p(this,null,function*(){return As(r,"POST","/v1/accounts:signInWithEmailLink",Qt(r,e))})}function dR(r,e){return p(this,null,function*(){return As(r,"POST","/v1/accounts:signInWithEmailLink",Qt(r,e))})}function Ur(r,e){return p(this,null,function*(){return As(r,"POST","/v1/accounts:signInWithIdp",Qt(r,e))})}function pR(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function mR(r){let e=xr(Vr(r)).link,t=e?xr(Vr(e)).deep_link_id:null,n=xr(Vr(r)).deep_link_id;return(n?xr(Vr(n)).link:null)||n||t||e||r}function gR(r,e){return p(this,null,function*(){return As(r,"POST","/v1/accounts:signUp",Qt(r,e))})}function Zg(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}function P_(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?bl._fromErrorAndOperation(r,s,e,n):s})}function _R(r,e,t=!1){return p(this,null,function*(){let n=yield Kn(r,e._linkToIdToken(r.auth,yield r.getIdToken()),t);return $r._forOperation(r,"link",n)})}function yR(r,e,t=!1){return p(this,null,function*(){let{auth:n}=r;if(ke(n.app))return Promise.reject(Kt(n));let i="reauthenticate";try{let s=yield Kn(r,P_(n,i,e,r),t);q(s.idToken,n,"internal-error");let o=Ml(s.idToken);q(o,n,"internal-error");let{sub:c}=o;return q(r.uid===c,n,"user-mismatch"),$r._forOperation(r,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&it(n,"user-mismatch"),s}})}function C_(r,e,t=!1){return p(this,null,function*(){if(ke(r.app))return Promise.reject(Kt(r));let n="signIn",i=yield P_(r,n,e),s=yield $r._fromIdTokenResponse(r,n,i);return t||(yield r._updateCurrentUser(s.user)),s})}function $l(r,e){return p(this,null,function*(){return C_(Yt(r),e)})}function vR(r,e,t){var n;q(((n=t.url)===null||n===void 0?void 0:n.length)>0,r,"invalid-continue-uri"),q(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,r,"invalid-dynamic-link-domain"),q(typeof t.linkDomain>"u"||t.linkDomain.length>0,r,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(q(t.iOS.bundleId.length>0,r,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(q(t.android.packageName.length>0,r,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}function k_(r){return p(this,null,function*(){let e=Yt(r);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function jl(r,e,t){return p(this,null,function*(){let n=Yt(r),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&vR(n,i,t),yield va(n,i,"getOobCode",lR,"EMAIL_PASSWORD_PROVIDER")})}function zl(r,e,t){return p(this,null,function*(){if(ke(r.app))return Promise.reject(Kt(r));let n=Yt(r),o=yield va(n,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",gR,"EMAIL_PASSWORD_PROVIDER").catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&k_(r),u}),c=yield $r._fromIdTokenResponse(n,"signIn",o);return yield n._updateCurrentUser(c.user),c})}function Gl(r,e,t){return ke(r.app)?Promise.reject(Kt(r)):$l(ne(r),S_.credential(e,t)).catch(n=>p(this,null,function*(){throw n.code==="auth/password-does-not-meet-requirements"&&k_(r),n}))}function IR(r,e){return p(this,null,function*(){return dt(r,"POST","/v1/accounts:update",e)})}function Wl(n,i){return p(this,arguments,function*(r,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let s=ne(r),c={idToken:yield s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},u=yield Kn(s,IR(s.auth,c));s.displayName=u.displayName||null,s.photoURL=u.photoUrl||null;let h=s.providerData.find(({providerId:f})=>f==="password");h&&(h.displayName=s.displayName,h.photoURL=s.photoURL),yield s._updateTokensIfNecessary(u)})}function Kl(r,e){return wR(ne(r),null,e)}function wR(r,e,t){return p(this,null,function*(){let{auth:n}=r,s={idToken:yield r.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);let o=yield Kn(r,oR(n,s));yield r._updateTokensIfNecessary(o,!0)})}function Hl(r,e,t,n){return ne(r).onIdTokenChanged(e,t,n)}function Ql(r,e,t){return ne(r).beforeAuthStateChanged(e,t)}function Yl(r,e,t,n){return ne(r).onAuthStateChanged(e,t,n)}function Jl(r){return ne(r).signOut()}function bR(r){return Promise.all(r.map(e=>p(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}function Zl(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}function St(){return window}function PR(r){St().location.href=r}function D_(){return typeof St().WorkerGlobalScope<"u"&&typeof St().importScripts=="function"}function CR(){return p(this,null,function*(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function kR(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function NR(){return D_()?self:null}function Pa(r,e){return r.transaction([Ta],e?"readwrite":"readonly").objectStore(Ta)}function OR(){let r=indexedDB.deleteDatabase(O_);return new Hn(r).toPromise()}function Pl(){let r=indexedDB.open(O_,DR);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{let n=r.result;try{n.createObjectStore(Ta,{keyPath:x_})}catch(i){t(i)}}),r.addEventListener("success",()=>p(this,null,function*(){let n=r.result;n.objectStoreNames.contains(Ta)?e(n):(n.close(),yield OR(),e(yield Pl()))}))})}function e_(r,e,t){return p(this,null,function*(){let n=Pa(r,!0).put({[x_]:e,value:t});return new Hn(n).toPromise()})}function xR(r,e){return p(this,null,function*(){let t=Pa(r,!1).get(e),n=yield new Hn(t).toPromise();return n===void 0?null:n.value})}function t_(r,e){let t=Pa(r,!0).delete(e);return new Hn(t).toPromise()}function V_(r,e){return e?Wt(e):(q(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}function FR(r){return C_(r.auth,new Ts(r),r.bypassAuthState)}function UR(r){let{auth:e,user:t}=r;return q(t,e,"internal-error"),yR(t,new Ts(r),r.bypassAuthState)}function BR(r){return p(this,null,function*(){let{auth:e,user:t}=r;return q(t,e,"internal-error"),_R(t,new Ts(r),r.bypassAuthState)})}function eh(r,e,t){return p(this,null,function*(){if(ke(r.app))return Promise.reject(ht(r,"operation-not-supported-in-this-environment"));let n=Yt(r);xA(r,e,Is);let i=V_(n,t);return new $R(n,"signInViaPopup",e,i).executeNotNull()})}function zR(r,e){return p(this,null,function*(){let t=KR(e),n=WR(r);if(!(yield n._isAvailable()))return!1;let i=(yield n._get(t))==="true";return yield n._remove(t),i})}function GR(r,e){ha.set(r._key(),e)}function WR(r){return Wt(r._redirectPersistence)}function KR(r){return la(jR,r.config.apiKey,r.name)}function HR(r,e,t=!1){return p(this,null,function*(){if(ke(r.app))return Promise.reject(Kt(r));let n=Yt(r),i=V_(n,e),o=yield new Cl(n,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield n._persistUserIfCurrent(o.user),yield n._setRedirectUser(null,e)),o})}function n_(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function L_({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function YR(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return L_(r);default:return!1}}function JR(t){return p(this,arguments,function*(r,e={}){return dt(r,"GET","/v1/projects",e)})}function eb(r){return p(this,null,function*(){if(r.config.emulator)return;let{authorizedDomains:e}=yield JR(r);for(let t of e)try{if(tb(t))return}catch{}it(r,"unauthorized-domain")})}function tb(r){let e=ml(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){let o=new URL(r);return o.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!ZR.test(t))return!1;if(XR.test(r))return n===r;let i=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}function r_(){let r=St().___jsl;if(r!=null&&r.H){for(let e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function rb(r){return new Promise((e,t)=>{var n,i,s;function o(){r_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{r_(),t(ht(r,"network-request-failed"))},timeout:nb.get()})}if(!((i=(n=St().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=St().gapi)===null||s===void 0)&&s.load)o();else{let c=A_("iframefcb");return St()[c]=()=>{gapi.load?o():t(ht(r,"network-request-failed"))},T_(`${tR()}?onload=${c}`).catch(u=>t(u))}}).catch(e=>{throw da=null,e})}function ib(r){return da=da||rb(r),da}function lb(r){let e=r.config;q(e.authDomain,r,"auth-domain-config-required");let t=e.emulator?Vl(e,ab):`https://${r.config.authDomain}/${ob}`,n={apiKey:e.apiKey,appName:r.name,v:Et},i=ub.get(r.config.apiHost);i&&(n.eid=i);let s=r._getFrameworks();return s.length&&(n.fw=s.join(",")),`${t}?${Or(n).slice(1)}`}function hb(r){return p(this,null,function*(){let e=yield ib(r),t=St().gapi;return q(t,r,"internal-error"),e.open({where:document.body,url:lb(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:cb,dontclear:!0},n=>new Promise((i,s)=>p(this,null,function*(){yield n.restyle({setHideOnLeave:!1});let o=ht(r,"network-request-failed"),c=St().setTimeout(()=>{s(o)},sb.get());function u(){St().clearTimeout(c),i(n)}n.ping(u).then(u,()=>{s(o)})})))})}function _b(r,e,t,n=fb,i=pb){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString(),c="",u=Object.assign(Object.assign({},db),{width:n.toString(),height:i.toString(),top:s,left:o}),h=Ie().toLowerCase();t&&(c=g_(h)?mb:t),p_(h)&&(e=e||gb,u.scrollbars="yes");let f=Object.entries(u).reduce((y,[A,N])=>`${y}${A}=${N},`,"");if(QA(h)&&c!=="_self")return yb(e||"",c),new Ra(null);let g=window.open(e||"",c,f);q(g,r,"popup-blocked");try{g.focus()}catch{}return new Ra(g)}function yb(r,e){let t=document.createElement("a");t.href=r,t.target=e;let n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}function i_(r,e,t,n,i,s){return p(this,null,function*(){q(r.config.authDomain,r,"auth-domain-config-required"),q(r.config.apiKey,r,"invalid-api-key");let o={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:Et,eventId:i};if(e instanceof Is){e.setDefaultLanguage(r.languageCode),o.providerId=e.providerId||"",cg(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[f,g]of Object.entries(s||{}))o[f]=g}if(e instanceof ws){let f=e.getScopes().filter(g=>g!=="");f.length>0&&(o.scopes=f.join(","))}r.tenantId&&(o.tid=r.tenantId);let c=o;for(let f of Object.keys(c))c[f]===void 0&&delete c[f];let u=yield r._getAppCheckToken(),h=u?`#${wb}=${encodeURIComponent(u)}`:"";return`${Eb(r)}?${Or(c).slice(1)}${h}`})}function Eb({config:r}){return r.emulator?Vl(r,Ib):`https://${r.authDomain}/${vb}`}function Tb(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Ab(r){wt(new It("auth",(e,{options:t})=>{let n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=n.options;q(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});let u={apiKey:o,authDomain:c,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:E_(r)},h=new El(n,i,s,u);return rR(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),wt(new It("auth-internal",e=>{let t=Yt(e.getProvider("auth").getImmediate());return(n=>new Dl(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),he(s_,o_,Tb(r)),he(s_,o_,"esm2017")}function th(r=jt()){let e=$t(r,"auth");if(e.isInitialized())return e.getImmediate();let t=Sa(r,{popupRedirectResolver:M_,persistence:[Ca,N_,Xl]}),n=nl("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(n,location.origin);if(location.origin===s.origin){let o=Sb(s.toString());Ql(t,o,()=>o(t.currentUser)),Hl(t,c=>o(c))}}let i=ng("auth");return i&&Bl(t,`http://${i}`),t}function Pb(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}var u_,l_,fa,Wn,pa,FA,UA,BA,gl,_l,yl,ys,_s,vn,Yg,HA,vl,_a,Il,XA,wl,El,ya,ba,Tl,Al,nR,R_,Rl,Br,vs,fR,qr,Ia,S_,Is,ws,Es,ql,$r,bl,wa,Ea,ER,TR,AR,N_,RR,Xl,SR,Sl,O_,DR,Ta,x_,Hn,VR,LR,MR,Ca,Hk,Qk,Ts,Aa,qR,$R,jR,ha,Cl,QR,kl,XR,ZR,nb,da,sb,ob,ab,cb,ub,db,fb,pb,mb,gb,Ra,vb,Ib,wb,pl,Nl,M_,s_,o_,Dl,Rb,bb,a_,Sb,F_=Q(()=>{"use strict";jn();us();Qo();xT();ls();u_=c_,l_=new Dr("auth","Firebase",c_());fa=new Lr("@firebase/auth");Wn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ht(t>e,"Short delay should be less than long delay!"),this.isMobile=rg()||og()}get(){return LA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};pa=class{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Gt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Gt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Gt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};FA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};UA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],BA=new Wn(3e4,6e4);gl=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(ht(this.auth,"network-request-failed")),BA.get())})}};_l=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return qA(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};yl=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>p(this,null,function*(){yield this.iteration()}),t)}iteration(){return p(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};ys=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=gs(this.lastLoginAt),this.creationTime=gs(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};_s=class r{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){q(e.idToken,"internal-error"),q(typeof e.idToken<"u","internal-error"),q(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Qg(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){q(e.length!==0,"internal-error");let t=Qg(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return p(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(q(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return p(this,null,function*(){let{accessToken:n,refreshToken:i,expiresIn:s}=yield WA(e,t);this.updateTokensAndExpiration(n,i,Number(s))})}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:s}=t,o=new r;return n&&(q(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),i&&(q(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(q(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new r,this.toJSON())}_performRefresh(){return Gt("not implemented")}};vn=class r{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=jo(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ys(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return p(this,null,function*(){let t=yield Kn(this,this.stsTokenManager.getToken(this.auth,e));return q(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Ll(this,e)}reload(){return Fl(this)}_assign(e){this!==e&&(q(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new r(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){q(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return p(this,null,function*(){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&(yield ga(this)),yield this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)})}delete(){return p(this,null,function*(){if(ke(this.auth.app))return Promise.reject(Kt(this.auth));let e=yield this.getIdToken();return yield Kn(this,jA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,o,c,u,h,f;let g=(n=t.displayName)!==null&&n!==void 0?n:void 0,y=(i=t.email)!==null&&i!==void 0?i:void 0,A=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,N=(o=t.photoURL)!==null&&o!==void 0?o:void 0,D=(c=t.tenantId)!==null&&c!==void 0?c:void 0,k=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,$=(h=t.createdAt)!==null&&h!==void 0?h:void 0,U=(f=t.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:M,emailVerified:j,isAnonymous:X,providerData:G,stsTokenManager:w}=t;q(M&&w,e,"internal-error");let _=_s.fromJSON(this.name,w);q(typeof M=="string",e,"internal-error"),yn(g,e.name),yn(y,e.name),q(typeof j=="boolean",e,"internal-error"),q(typeof X=="boolean",e,"internal-error"),yn(A,e.name),yn(N,e.name),yn(D,e.name),yn(k,e.name),yn($,e.name),yn(U,e.name);let I=new r({uid:M,auth:e,email:y,emailVerified:j,displayName:g,isAnonymous:X,photoURL:N,phoneNumber:A,tenantId:D,stsTokenManager:_,createdAt:$,lastLoginAt:U});return G&&Array.isArray(G)&&(I.providerData=G.map(E=>Object.assign({},E))),k&&(I._redirectEventId=k),I}static _fromIdTokenResponse(e,t,n=!1){return p(this,null,function*(){let i=new _s;i.updateFromServerResponse(t);let s=new r({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return yield ga(s),s})}static _fromGetAccountInfoResponse(e,t,n){return p(this,null,function*(){let i=t.users[0];q(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?f_(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),c=new _s;c.updateFromIdToken(n);let u=new r({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new ys(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(u,h),u})}};Yg=new Map;HA=(()=>{class r{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return p(this,null,function*(){return!0})}_set(t,n){return p(this,null,function*(){this.storage[t]=n})}_get(t){return p(this,null,function*(){let n=this.storage[t];return n===void 0?null:n})}_remove(t){return p(this,null,function*(){delete this.storage[t]})}_addListener(t,n){}_removeListener(t,n){}}return r.type="NONE",r})(),vl=HA;_a=class r{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:i,name:s}=this.auth;this.fullUserKey=la(this.userKey,i.apiKey,s),this.fullPersistenceKey=la("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return p(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield ma(this.auth,{idToken:e}).catch(()=>{});return t?vn._fromGetAccountInfoResponse(this.auth,t,e):null}return vn._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return p(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return p(this,null,function*(){if(!t.length)return new r(Wt(vl),e,n);let i=(yield Promise.all(t.map(h=>p(this,null,function*(){if(yield h._isAvailable())return h})))).filter(h=>h),s=i[0]||Wt(vl),o=la(n,e.config.apiKey,e.name),c=null;for(let h of t)try{let f=yield h._get(o);if(f){let g;if(typeof f=="string"){let y=yield ma(e,{idToken:f}).catch(()=>{});if(!y)break;g=yield vn._fromGetAccountInfoResponse(e,y,f)}else g=vn._fromJSON(e,f);h!==s&&(c=g),s=h;break}}catch{}let u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new r(s,e,n):(s=u[0],c&&(yield s._set(o,c.toJSON())),yield Promise.all(t.map(h=>p(this,null,function*(){if(h!==s)try{yield h._remove(o)}catch{}}))),new r(s,e,n))})}};Il=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=s=>new Promise((o,c)=>{try{let u=e(s);o(u)}catch(u){c(u)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return p(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)yield n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}})}};XA=6,wl=class{constructor(e){var t,n,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:XA,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,s,o,c;let u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(n=u.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(s=u.containsUppercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};El=class{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ya(this),this.idTokenSubscription=new ya(this),this.beforeStateQueue=new Il(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=l_,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Wt(t)),this._initializationPromise=this.queue(()=>p(this,null,function*(){var n,i,s;if(!this._deleted&&(this.persistenceManager=yield _a.create(this,e),(n=this._resolvePersistenceManagerAvailable)===null||n===void 0||n.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return p(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return p(this,null,function*(){try{let t=yield ma(this,{idToken:e}),n=yield vn._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return p(this,null,function*(){var t;if(ke(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}let n=yield this.assertedPersistence.getCurrentUser(),i=n,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i==null?void 0:i._redirectEventId,u=yield this.tryRedirectSignIn(e);(!o||o===c)&&(u!=null&&u.user)&&(i=u.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return q(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return p(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return p(this,null,function*(){try{yield ga(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=MA()}_delete(){return p(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return p(this,null,function*(){if(ke(this.app))return Promise.reject(Kt(this));let t=e?ne(e):null;return t&&q(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return p(this,null,function*(){if(!this._deleted)return e&&q(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>p(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return p(this,null,function*(){return ke(this.app)?Promise.reject(Kt(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return ke(this.app)?Promise.reject(Kt(this)):this.queue(()=>p(this,null,function*(){yield this.assertedPersistence.setPersistence(Wt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return p(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return p(this,null,function*(){let e=yield JA(this),t=new wl(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Dr("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}revokeAccessToken(e){return p(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),yield KA(this,n)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return p(this,null,function*(){let n=yield this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return p(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Wt(e)||this._popupRedirectResolver;q(t,this,"argument-error"),this.redirectPersistenceManager=yield _a.create(this,[Wt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return p(this,null,function*(){var t,n;return this._isInitialized&&(yield this.queue(()=>p(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return p(this,null,function*(){if(e===this.currentUser)return this.queue(()=>p(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(q(c,this,"internal-error"),c.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,n,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}directlySetCurrentUser(e){return p(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return q(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=E_(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return p(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();n&&(t["X-Firebase-Client"]=n);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return p(this,null,function*(){var e;if(ke(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t!=null&&t.error&&OA(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token})}};ya=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=ug(t=>this.observer=t)}get next(){return q(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};ba={loadJS(){return p(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};Tl=class{constructor(){this.enterprise=new Al}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},Al=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},nR="recaptcha-enterprise",R_="NO_RECAPTCHA",Rl=class{constructor(e){this.type=nR,this.auth=Yt(e)}verify(e="verify",t=!1){return p(this,null,function*(){function n(s){return p(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,c)=>p(this,null,function*(){$A(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let h=new _l(u);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,o(h.siteKey)}}).catch(u=>{c(u)})}))})}function i(s,o,c){let u=window.grecaptcha;Hg(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(h=>{o(h)}).catch(()=>{o(R_)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Tl().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{n(this.auth).then(c=>{if(!t&&Hg(window.grecaptcha))i(c,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=eR();u.length!==0&&(u+=c),T_(u).then(()=>{i(c,s,o)}).catch(h=>{o(h)})}}).catch(c=>{o(c)})})})}};Br=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Gt("not implemented")}_getIdTokenResponse(e){return Gt("not implemented")}_linkToIdToken(e,t){return Gt("not implemented")}_getReauthenticationResolver(e){return Gt("not implemented")}};vs=class r extends Br{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new r(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new r(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return p(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return va(e,t,"signInWithPassword",cR,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return hR(e,{email:this._email,oobCode:this._password});default:it(e,"internal-error")}})}_linkToIdToken(e,t){return p(this,null,function*(){switch(this.signInMethod){case"password":let n={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return va(e,n,"signUpPassword",aR,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return dR(e,{idToken:t,email:this._email,oobCode:this._password});default:it(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};fR="http://localhost",qr=class r extends Br{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new r(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):it("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=jo(t,["providerId","signInMethod"]);if(!n||!i)return null;let o=new r(n,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){let t=this.buildRequest();return Ur(e,t)}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,Ur(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,Ur(e,t)}buildRequest(){let e={requestUri:fR,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Or(t)}return e}};Ia=class r{constructor(e){var t,n,i,s,o,c;let u=xr(Vr(e)),h=(t=u.apiKey)!==null&&t!==void 0?t:null,f=(n=u.oobCode)!==null&&n!==void 0?n:null,g=pR((i=u.mode)!==null&&i!==void 0?i:null);q(h&&f&&g,"argument-error"),this.apiKey=h,this.operation=g,this.code=f,this.continueUrl=(s=u.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=u.lang)!==null&&o!==void 0?o:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=mR(e);try{return new r(t)}catch{return null}}};S_=(()=>{class r{constructor(){this.providerId=r.PROVIDER_ID}static credential(t,n){return vs._fromEmailAndPassword(t,n)}static credentialWithLink(t,n){let i=Ia.parseLink(n);return q(i,"argument-error"),vs._fromEmailAndCode(t,i.code,i.tenantId)}}r.PROVIDER_ID="password",r.EMAIL_PASSWORD_SIGN_IN_METHOD="password",r.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return r})(),Is=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};ws=class extends Is{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}},Es=class r extends ws{static credentialFromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;return q("providerId"in t&&"signInMethod"in t,"argument-error"),qr._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return q(e.idToken||e.accessToken,"argument-error"),qr._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return r.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return r.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:i,pendingToken:s,nonce:o,providerId:c}=e;if(!n&&!i&&!t&&!s||!c)return null;try{return new r(c)._credential({idToken:t,accessToken:n,nonce:o,pendingToken:s})}catch{return null}}};ql=(()=>{class r extends ws{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return qr._fromParams({providerId:r.PROVIDER_ID,signInMethod:r.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return r.credentialFromTaggedObject(t)}static credentialFromError(t){return r.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:n,oauthAccessToken:i}=t;if(!n&&!i)return null;try{return r.credential(n,i)}catch{return null}}}r.GOOGLE_SIGN_IN_METHOD="google.com",r.PROVIDER_ID="google.com";return r})();$r=class r{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,i=!1){return p(this,null,function*(){let s=yield vn._fromIdTokenResponse(e,n,i),o=Zg(n);return new r({user:s,providerId:o,_tokenResponse:n,operationType:t})})}static _forOperation(e,t,n){return p(this,null,function*(){yield e._updateTokensIfNecessary(n,!0);let i=Zg(n);return new r({user:e,providerId:i,_tokenResponse:n,operationType:t})})}};bl=class r extends fn{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,r.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new r(e,t,n,i)}};wa="__sak";Ea=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(wa,"1"),this.storage.removeItem(wa),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};ER=1e3,TR=10,AR=(()=>{class r extends Ea{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,n)=>this.onStorageEvent(t,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=w_(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let n of Object.keys(this.listeners)){let i=this.storage.getItem(n),s=this.localCache[n];i!==s&&t(n,s,i)}}onStorageEvent(t,n=!1){if(!t.key){this.forAllChangedKeys((c,u,h)=>{this.notifyListeners(c,h)});return}let i=t.key;n?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!n&&this.localCache[i]===c||this.notifyListeners(i,c)},o=this.storage.getItem(i);YA()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,TR):s()}notifyListeners(t,n){this.localCache[t]=n;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,n,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:n,newValue:i}),!0)})},ER)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(n)}_removeListener(t,n){this.listeners[t]&&(this.listeners[t].delete(n),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,n){return p(this,null,function*(){yield Bt(r.prototype,this,"_set").call(this,t,n),this.localCache[t]=JSON.stringify(n)})}_get(t){return p(this,null,function*(){let n=yield Bt(r.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(n),n})}_remove(t){return p(this,null,function*(){yield Bt(r.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return r.type="LOCAL",r})(),N_=AR;RR=(()=>{class r extends Ea{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,n){}_removeListener(t,n){}}return r.type="SESSION",r})(),Xl=RR;SR=(()=>{class r{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let n=this.receivers.find(s=>s.isListeningto(t));if(n)return n;let i=new r(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return p(this,null,function*(){let n=t,{eventId:i,eventType:s,data:o}=n.data,c=this.handlersMap[s];if(!(c!=null&&c.size))return;n.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let u=Array.from(c).map(f=>p(this,null,function*(){return f(n.origin,o)})),h=yield bR(u);n.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:h})})}_subscribe(t,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(n)}_unsubscribe(t,n){this.handlersMap[t]&&n&&this.handlersMap[t].delete(n),(!n||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}r.receivers=[];return r})();Sl=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){return p(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((c,u)=>{let h=Zl("",20);i.port1.start();let f=setTimeout(()=>{u(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(g){let y=g;if(y.data.eventId===h)switch(y.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(y.data.response);break;default:clearTimeout(f),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};O_="firebaseLocalStorageDb",DR=1,Ta="firebaseLocalStorage",x_="fbase_key",Hn=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};VR=800,LR=3,MR=(()=>{class r{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return p(this,null,function*(){return this.db?this.db:(this.db=yield Pl(),this.db)})}_withRetries(t){return p(this,null,function*(){let n=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(n++>LR)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return p(this,null,function*(){return D_()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return p(this,null,function*(){this.receiver=SR._getInstance(NR()),this.receiver._subscribe("keyChanged",(t,n)=>p(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(n.key)}})),this.receiver._subscribe("ping",(t,n)=>p(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return p(this,null,function*(){var t,n;if(this.activeServiceWorker=yield CR(),!this.activeServiceWorker)return;this.sender=new Sl(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((n=i[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return p(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||kR()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return p(this,null,function*(){try{if(!indexedDB)return!1;let t=yield Pl();return yield e_(t,wa,"1"),yield t_(t,wa),!0}catch{}return!1})}_withPendingWrite(t){return p(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,n){return p(this,null,function*(){return this._withPendingWrite(()=>p(this,null,function*(){return yield this._withRetries(i=>e_(i,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)}))})}_get(t){return p(this,null,function*(){let n=yield this._withRetries(i=>xR(i,t));return this.localCache[t]=n,n})}_remove(t){return p(this,null,function*(){return this._withPendingWrite(()=>p(this,null,function*(){return yield this._withRetries(n=>t_(n,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return p(this,null,function*(){let t=yield this._withRetries(s=>{let o=Pa(s,!1).getAll();return new Hn(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let n=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),n.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),n.push(s));return n})}notifyListeners(t,n){this.localCache[t]=n;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>p(this,null,function*(){return this._poll()}),VR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(n)}_removeListener(t,n){this.listeners[t]&&(this.listeners[t].delete(n),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return r.type="LOCAL",r})(),Ca=MR;Hk=A_("rcb"),Qk=new Wn(3e4,6e4);Ts=class extends Br{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ur(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ur(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ur(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};Aa=class{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>p(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}onAuthEvent(e){return p(this,null,function*(){let{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:o,type:c}=e;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(u))}catch(h){this.reject(h)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return FR;case"linkViaPopup":case"linkViaRedirect":return BR;case"reauthViaPopup":case"reauthViaRedirect":return UR;default:it(this.auth,"internal-error")}}resolve(e){Ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};qR=new Wn(2e3,1e4);$R=(()=>{class r extends Aa{constructor(t,n,i,s,o){super(t,n,s,o),this.provider=i,this.authWindow=null,this.pollId=null,r.currentPopupAction&&r.currentPopupAction.cancel(),r.currentPopupAction=this}executeNotNull(){return p(this,null,function*(){let t=yield this.execute();return q(t,this.auth,"internal-error"),t})}onExecution(){return p(this,null,function*(){Ht(this.filter.length===1,"Popup operations only handle one event");let t=Zl();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(ht(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(ht(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,r.currentPopupAction=null}pollUserCancellation(){let t=()=>{var n,i;if(!((i=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ht(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,qR.get())};t()}}r.currentPopupAction=null;return r})(),jR="pendingRedirect",ha=new Map,Cl=class r extends Aa{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){return p(this,null,function*(){let e=ha.get(this.auth._key());if(!e){try{let n=(yield zR(this.resolver,this.auth))?yield Bt(r.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}ha.set(this.auth._key(),e)}return this.bypassAuthState||ha.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return p(this,null,function*(){if(e.type==="signInViaRedirect")return Bt(r.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Bt(r.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return p(this,null,function*(){})}cleanUp(){}};QR=10*60*1e3,kl=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!YR(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!L_(e)){let i=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(ht(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=QR&&this.cachedEventUids.clear(),this.cachedEventUids.has(n_(e))}saveEventToCache(e){this.cachedEventUids.add(n_(e)),this.lastProcessedEventTime=Date.now()}};XR=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ZR=/^https?/;nb=new Wn(3e4,6e4);da=null;sb=new Wn(5e3,15e3),ob="__/auth/iframe",ab="emulator/auth/iframe",cb={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ub=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);db={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},fb=500,pb=600,mb="_blank",gb="http://localhost",Ra=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};vb="__/auth/handler",Ib="emulator/auth/handler",wb=encodeURIComponent("fac");pl="webStorageSupport",Nl=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Xl,this._completeRedirectFn=HR,this._overrideRedirectResult=GR}_openPopup(e,t,n,i){return p(this,null,function*(){var s;Ht((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield i_(e,t,n,ml(),i);return _b(e,o,Zl())})}_openRedirect(e,t,n,i){return p(this,null,function*(){yield this._originValidation(e);let s=yield i_(e,t,n,ml(),i);return PR(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Ht(s,"If manager is not set, promise should be"),s)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}initAndGetManager(e){return p(this,null,function*(){let t=yield hb(e),n=new kl(e);return t.register("authEvent",i=>(q(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(pl,{type:pl},i=>{var s;let o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[pl];o!==void 0&&t(!!o),it(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=eb(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return w_()||m_()||Ul()}},M_=Nl,s_="@firebase/auth",o_="1.10.1";Dl=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return p(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){q(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};Rb=5*60,bb=nl("authIdTokenMaxAge")||Rb,a_=null,Sb=r=>e=>p(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>bb)return;let i=t==null?void 0:t.token;a_!==i&&(a_=i,yield fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});ZA({loadJS(r){return new Promise((e,t)=>{let n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=i=>{let s=ht("internal-error");s.customData=i,t(s)},n.type="text/javascript",n.charset="UTF-8",Pb().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Ab("Browser")});var U_=Q(()=>{"use strict";F_();jn();us();Qo();ls()});var nh=Q(()=>{"use strict";U_()});function dS(r,e){let t=Gn(B_,r,e);return t&&new Qn(t)}function fS(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new Qn(n)}}function q_(r,...e){return he("angularfire",Rt.full,"auth"),hn([mS,pS,{provide:rh,useFactory:fS(r),multi:!0,deps:[rt,dn,bt,zt,[new Ce,_n],...e]}])}var B_,Qn,Yn,rh,pS,mS,$_,j_,z_,G_,W_,K_,H_,Q_,Y_,J_,Rs=Q(()=>{"use strict";Fr();ce();ds();aa();pn();nh();nh();B_="auth",Qn=class{constructor(e){return e}},Yn=class{constructor(){return mn(B_)}},rh=new ln("angularfire2.auth-instances");pS={provide:Yn,deps:[[new Ce,rh]]},mS={provide:Qn,useFactory:dS,deps:[[new Ce,rh],ut]};$_=K(zl,!0,2),j_=K(th,!0),z_=K(Sa,!0),G_=K(Yl,!0),W_=K(jl,!0,2),K_=K(Gl,!0,2),H_=K(eh,!0,2),Q_=K(Jl,!0,2),Y_=K(Kl,!0,2),J_=K(Wl,!0,2)});var X_,Z_,Jt,ih,ey=Q(()=>{"use strict";X_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Z_={};(function(){var r;function e(w,_){function I(){}I.prototype=_.prototype,w.D=_.prototype,w.prototype=new I,w.prototype.constructor=w,w.C=function(E,T,b){for(var v=Array(arguments.length-2),Mt=2;Mt<arguments.length;Mt++)v[Mt-2]=arguments[Mt];return _.prototype[T].apply(E,v)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,_,I){I||(I=0);var E=Array(16);if(typeof _=="string")for(var T=0;16>T;++T)E[T]=_.charCodeAt(I++)|_.charCodeAt(I++)<<8|_.charCodeAt(I++)<<16|_.charCodeAt(I++)<<24;else for(T=0;16>T;++T)E[T]=_[I++]|_[I++]<<8|_[I++]<<16|_[I++]<<24;_=w.g[0],I=w.g[1],T=w.g[2];var b=w.g[3],v=_+(b^I&(T^b))+E[0]+3614090360&4294967295;_=I+(v<<7&4294967295|v>>>25),v=b+(T^_&(I^T))+E[1]+3905402710&4294967295,b=_+(v<<12&4294967295|v>>>20),v=T+(I^b&(_^I))+E[2]+606105819&4294967295,T=b+(v<<17&4294967295|v>>>15),v=I+(_^T&(b^_))+E[3]+3250441966&4294967295,I=T+(v<<22&4294967295|v>>>10),v=_+(b^I&(T^b))+E[4]+4118548399&4294967295,_=I+(v<<7&4294967295|v>>>25),v=b+(T^_&(I^T))+E[5]+1200080426&4294967295,b=_+(v<<12&4294967295|v>>>20),v=T+(I^b&(_^I))+E[6]+2821735955&4294967295,T=b+(v<<17&4294967295|v>>>15),v=I+(_^T&(b^_))+E[7]+4249261313&4294967295,I=T+(v<<22&4294967295|v>>>10),v=_+(b^I&(T^b))+E[8]+1770035416&4294967295,_=I+(v<<7&4294967295|v>>>25),v=b+(T^_&(I^T))+E[9]+2336552879&4294967295,b=_+(v<<12&4294967295|v>>>20),v=T+(I^b&(_^I))+E[10]+4294925233&4294967295,T=b+(v<<17&4294967295|v>>>15),v=I+(_^T&(b^_))+E[11]+2304563134&4294967295,I=T+(v<<22&4294967295|v>>>10),v=_+(b^I&(T^b))+E[12]+1804603682&4294967295,_=I+(v<<7&4294967295|v>>>25),v=b+(T^_&(I^T))+E[13]+4254626195&4294967295,b=_+(v<<12&4294967295|v>>>20),v=T+(I^b&(_^I))+E[14]+2792965006&4294967295,T=b+(v<<17&4294967295|v>>>15),v=I+(_^T&(b^_))+E[15]+1236535329&4294967295,I=T+(v<<22&4294967295|v>>>10),v=_+(T^b&(I^T))+E[1]+4129170786&4294967295,_=I+(v<<5&4294967295|v>>>27),v=b+(I^T&(_^I))+E[6]+3225465664&4294967295,b=_+(v<<9&4294967295|v>>>23),v=T+(_^I&(b^_))+E[11]+643717713&4294967295,T=b+(v<<14&4294967295|v>>>18),v=I+(b^_&(T^b))+E[0]+3921069994&4294967295,I=T+(v<<20&4294967295|v>>>12),v=_+(T^b&(I^T))+E[5]+3593408605&4294967295,_=I+(v<<5&4294967295|v>>>27),v=b+(I^T&(_^I))+E[10]+38016083&4294967295,b=_+(v<<9&4294967295|v>>>23),v=T+(_^I&(b^_))+E[15]+3634488961&4294967295,T=b+(v<<14&4294967295|v>>>18),v=I+(b^_&(T^b))+E[4]+3889429448&4294967295,I=T+(v<<20&4294967295|v>>>12),v=_+(T^b&(I^T))+E[9]+568446438&4294967295,_=I+(v<<5&4294967295|v>>>27),v=b+(I^T&(_^I))+E[14]+3275163606&4294967295,b=_+(v<<9&4294967295|v>>>23),v=T+(_^I&(b^_))+E[3]+4107603335&4294967295,T=b+(v<<14&4294967295|v>>>18),v=I+(b^_&(T^b))+E[8]+1163531501&4294967295,I=T+(v<<20&4294967295|v>>>12),v=_+(T^b&(I^T))+E[13]+2850285829&4294967295,_=I+(v<<5&4294967295|v>>>27),v=b+(I^T&(_^I))+E[2]+4243563512&4294967295,b=_+(v<<9&4294967295|v>>>23),v=T+(_^I&(b^_))+E[7]+1735328473&4294967295,T=b+(v<<14&4294967295|v>>>18),v=I+(b^_&(T^b))+E[12]+2368359562&4294967295,I=T+(v<<20&4294967295|v>>>12),v=_+(I^T^b)+E[5]+4294588738&4294967295,_=I+(v<<4&4294967295|v>>>28),v=b+(_^I^T)+E[8]+2272392833&4294967295,b=_+(v<<11&4294967295|v>>>21),v=T+(b^_^I)+E[11]+1839030562&4294967295,T=b+(v<<16&4294967295|v>>>16),v=I+(T^b^_)+E[14]+4259657740&4294967295,I=T+(v<<23&4294967295|v>>>9),v=_+(I^T^b)+E[1]+2763975236&4294967295,_=I+(v<<4&4294967295|v>>>28),v=b+(_^I^T)+E[4]+1272893353&4294967295,b=_+(v<<11&4294967295|v>>>21),v=T+(b^_^I)+E[7]+4139469664&4294967295,T=b+(v<<16&4294967295|v>>>16),v=I+(T^b^_)+E[10]+3200236656&4294967295,I=T+(v<<23&4294967295|v>>>9),v=_+(I^T^b)+E[13]+681279174&4294967295,_=I+(v<<4&4294967295|v>>>28),v=b+(_^I^T)+E[0]+3936430074&4294967295,b=_+(v<<11&4294967295|v>>>21),v=T+(b^_^I)+E[3]+3572445317&4294967295,T=b+(v<<16&4294967295|v>>>16),v=I+(T^b^_)+E[6]+76029189&4294967295,I=T+(v<<23&4294967295|v>>>9),v=_+(I^T^b)+E[9]+3654602809&4294967295,_=I+(v<<4&4294967295|v>>>28),v=b+(_^I^T)+E[12]+3873151461&4294967295,b=_+(v<<11&4294967295|v>>>21),v=T+(b^_^I)+E[15]+530742520&4294967295,T=b+(v<<16&4294967295|v>>>16),v=I+(T^b^_)+E[2]+3299628645&4294967295,I=T+(v<<23&4294967295|v>>>9),v=_+(T^(I|~b))+E[0]+4096336452&4294967295,_=I+(v<<6&4294967295|v>>>26),v=b+(I^(_|~T))+E[7]+1126891415&4294967295,b=_+(v<<10&4294967295|v>>>22),v=T+(_^(b|~I))+E[14]+2878612391&4294967295,T=b+(v<<15&4294967295|v>>>17),v=I+(b^(T|~_))+E[5]+4237533241&4294967295,I=T+(v<<21&4294967295|v>>>11),v=_+(T^(I|~b))+E[12]+1700485571&4294967295,_=I+(v<<6&4294967295|v>>>26),v=b+(I^(_|~T))+E[3]+2399980690&4294967295,b=_+(v<<10&4294967295|v>>>22),v=T+(_^(b|~I))+E[10]+4293915773&4294967295,T=b+(v<<15&4294967295|v>>>17),v=I+(b^(T|~_))+E[1]+2240044497&4294967295,I=T+(v<<21&4294967295|v>>>11),v=_+(T^(I|~b))+E[8]+1873313359&4294967295,_=I+(v<<6&4294967295|v>>>26),v=b+(I^(_|~T))+E[15]+4264355552&4294967295,b=_+(v<<10&4294967295|v>>>22),v=T+(_^(b|~I))+E[6]+2734768916&4294967295,T=b+(v<<15&4294967295|v>>>17),v=I+(b^(T|~_))+E[13]+1309151649&4294967295,I=T+(v<<21&4294967295|v>>>11),v=_+(T^(I|~b))+E[4]+4149444226&4294967295,_=I+(v<<6&4294967295|v>>>26),v=b+(I^(_|~T))+E[11]+3174756917&4294967295,b=_+(v<<10&4294967295|v>>>22),v=T+(_^(b|~I))+E[2]+718787259&4294967295,T=b+(v<<15&4294967295|v>>>17),v=I+(b^(T|~_))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+_&4294967295,w.g[1]=w.g[1]+(T+(v<<21&4294967295|v>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+b&4294967295}n.prototype.u=function(w,_){_===void 0&&(_=w.length);for(var I=_-this.blockSize,E=this.B,T=this.h,b=0;b<_;){if(T==0)for(;b<=I;)i(this,w,b),b+=this.blockSize;if(typeof w=="string"){for(;b<_;)if(E[T++]=w.charCodeAt(b++),T==this.blockSize){i(this,E),T=0;break}}else for(;b<_;)if(E[T++]=w[b++],T==this.blockSize){i(this,E),T=0;break}}this.h=T,this.o+=_},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var _=1;_<w.length-8;++_)w[_]=0;var I=8*this.o;for(_=w.length-8;_<w.length;++_)w[_]=I&255,I/=256;for(this.u(w),w=Array(16),_=I=0;4>_;++_)for(var E=0;32>E;E+=8)w[I++]=this.g[_]>>>E&255;return w};function s(w,_){var I=c;return Object.prototype.hasOwnProperty.call(I,w)?I[w]:I[w]=_(w)}function o(w,_){this.h=_;for(var I=[],E=!0,T=w.length-1;0<=T;T--){var b=w[T]|0;E&&b==_||(I[T]=b,E=!1)}this.g=I}var c={};function u(w){return-128<=w&&128>w?s(w,function(_){return new o([_|0],0>_?-1:0)}):new o([w|0],0>w?-1:0)}function h(w){if(isNaN(w)||!isFinite(w))return g;if(0>w)return k(h(-w));for(var _=[],I=1,E=0;w>=I;E++)_[E]=w/I|0,I*=4294967296;return new o(_,0)}function f(w,_){if(w.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(w.charAt(0)=="-")return k(f(w.substring(1),_));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(_,8)),E=g,T=0;T<w.length;T+=8){var b=Math.min(8,w.length-T),v=parseInt(w.substring(T,T+b),_);8>b?(b=h(Math.pow(_,b)),E=E.j(b).add(h(v))):(E=E.j(I),E=E.add(h(v)))}return E}var g=u(0),y=u(1),A=u(16777216);r=o.prototype,r.m=function(){if(D(this))return-k(this).m();for(var w=0,_=1,I=0;I<this.g.length;I++){var E=this.i(I);w+=(0<=E?E:4294967296+E)*_,_*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(N(this))return"0";if(D(this))return"-"+k(this).toString(w);for(var _=h(Math.pow(w,6)),I=this,E="";;){var T=j(I,_).g;I=$(I,T.j(_));var b=((0<I.g.length?I.g[0]:I.h)>>>0).toString(w);if(I=T,N(I))return b+E;for(;6>b.length;)b="0"+b;E=b+E}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function N(w){if(w.h!=0)return!1;for(var _=0;_<w.g.length;_++)if(w.g[_]!=0)return!1;return!0}function D(w){return w.h==-1}r.l=function(w){return w=$(this,w),D(w)?-1:N(w)?0:1};function k(w){for(var _=w.g.length,I=[],E=0;E<_;E++)I[E]=~w.g[E];return new o(I,~w.h).add(y)}r.abs=function(){return D(this)?k(this):this},r.add=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0,T=0;T<=_;T++){var b=E+(this.i(T)&65535)+(w.i(T)&65535),v=(b>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);E=v>>>16,b&=65535,v&=65535,I[T]=v<<16|b}return new o(I,I[I.length-1]&-2147483648?-1:0)};function $(w,_){return w.add(k(_))}r.j=function(w){if(N(this)||N(w))return g;if(D(this))return D(w)?k(this).j(k(w)):k(k(this).j(w));if(D(w))return k(this.j(k(w)));if(0>this.l(A)&&0>w.l(A))return h(this.m()*w.m());for(var _=this.g.length+w.g.length,I=[],E=0;E<2*_;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var T=0;T<w.g.length;T++){var b=this.i(E)>>>16,v=this.i(E)&65535,Mt=w.i(T)>>>16,$i=w.i(T)&65535;I[2*E+2*T]+=v*$i,U(I,2*E+2*T),I[2*E+2*T+1]+=b*$i,U(I,2*E+2*T+1),I[2*E+2*T+1]+=v*Mt,U(I,2*E+2*T+1),I[2*E+2*T+2]+=b*Mt,U(I,2*E+2*T+2)}for(E=0;E<_;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=_;E<2*_;E++)I[E]=0;return new o(I,0)};function U(w,_){for(;(w[_]&65535)!=w[_];)w[_+1]+=w[_]>>>16,w[_]&=65535,_++}function M(w,_){this.g=w,this.h=_}function j(w,_){if(N(_))throw Error("division by zero");if(N(w))return new M(g,g);if(D(w))return _=j(k(w),_),new M(k(_.g),k(_.h));if(D(_))return _=j(w,k(_)),new M(k(_.g),_.h);if(30<w.g.length){if(D(w)||D(_))throw Error("slowDivide_ only works with positive integers.");for(var I=y,E=_;0>=E.l(w);)I=X(I),E=X(E);var T=G(I,1),b=G(E,1);for(E=G(E,2),I=G(I,2);!N(E);){var v=b.add(E);0>=v.l(w)&&(T=T.add(I),b=v),E=G(E,1),I=G(I,1)}return _=$(w,T.j(_)),new M(T,_)}for(T=g;0<=w.l(_);){for(I=Math.max(1,Math.floor(w.m()/_.m())),E=Math.ceil(Math.log(I)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),b=h(I),v=b.j(_);D(v)||0<v.l(w);)I-=E,b=h(I),v=b.j(_);N(b)&&(b=y),T=T.add(b),w=$(w,v)}return new M(T,w)}r.A=function(w){return j(this,w).h},r.and=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)&w.i(E);return new o(I,this.h&w.h)},r.or=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)|w.i(E);return new o(I,this.h|w.h)},r.xor=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)^w.i(E);return new o(I,this.h^w.h)};function X(w){for(var _=w.g.length+1,I=[],E=0;E<_;E++)I[E]=w.i(E)<<1|w.i(E-1)>>>31;return new o(I,w.h)}function G(w,_){var I=_>>5;_%=32;for(var E=w.g.length-I,T=[],b=0;b<E;b++)T[b]=0<_?w.i(b+I)>>>_|w.i(b+I+1)<<32-_:w.i(b+I);return new o(T,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,ih=Z_.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,Jt=Z_.Integer=o}).apply(typeof X_<"u"?X_:typeof self<"u"?self:typeof window<"u"?window:{})});var ka,Xt,sh,gS,jr,oh,bs,Na,ah,ch,uh,ty=Q(()=>{"use strict";ka=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Xt={};(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof ka=="object"&&ka];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function i(a,l){if(l)e:{var d=n;a=a.split(".");for(var m=0;m<a.length-1;m++){var R=a[m];if(!(R in d))break e;d=d[R]}a=a[a.length-1],m=d[a],l=l(m),l!=m&&l!=null&&e(d,a,{configurable:!0,writable:!0,value:l})}}function s(a,l){a instanceof String&&(a+="");var d=0,m=!1,R={next:function(){if(!m&&d<a.length){var P=d++;return{value:l(P,a[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return R[Symbol.iterator]=function(){return R},R}i("Array.prototype.values",function(a){return a||function(){return s(this,function(l,d){return d})}});var o=o||{},c=this||self;function u(a){var l=typeof a;return l=l!="object"?l:a?Array.isArray(a)?"array":l:"null",l=="array"||l=="object"&&typeof a.length=="number"}function h(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function f(a,l,d){return a.call.apply(a.bind,arguments)}function g(a,l,d){if(!a)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var R=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(R,m),a.apply(l,R)}}return function(){return a.apply(l,arguments)}}function y(a,l,d){return y=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,y.apply(null,arguments)}function A(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),a.apply(this,m)}}function N(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(m,R,P){for(var V=Array(arguments.length-2),ae=2;ae<arguments.length;ae++)V[ae-2]=arguments[ae];return l.prototype[R].apply(m,V)}}function D(a){let l=a.length;if(0<l){let d=Array(l);for(let m=0;m<l;m++)d[m]=a[m];return d}return[]}function k(a,l){for(let d=1;d<arguments.length;d++){let m=arguments[d];if(u(m)){let R=a.length||0,P=m.length||0;a.length=R+P;for(let V=0;V<P;V++)a[R+V]=m[V]}else a.push(m)}}class ${constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function U(a){return/^[\s\xa0]*$/.test(a)}function M(){var a=c.navigator;return a&&(a=a.userAgent)?a:""}function j(a){return j[" "](a),a}j[" "]=function(){};var X=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function G(a,l,d){for(let m in a)l.call(d,a[m],m,a)}function w(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function _(a){let l={};for(let d in a)l[d]=a[d];return l}let I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(a,l){let d,m;for(let R=1;R<arguments.length;R++){m=arguments[R];for(d in m)a[d]=m[d];for(let P=0;P<I.length;P++)d=I[P],Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}}function T(a){var l=1;a=a.split(":");let d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function b(a){c.setTimeout(()=>{throw a},0)}function v(){var a=Ru;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class Mt{constructor(){this.h=this.g=null}add(l,d){let m=$i.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}}var $i=new $(()=>new ZE,a=>a.reset());class ZE{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let ji,zi=!1,Ru=new Mt,Rp=()=>{let a=c.Promise.resolve(void 0);ji=()=>{a.then(eT)}};var eT=()=>{for(var a;a=v();){try{a.h.call(a.g)}catch(d){b(d)}var l=$i;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}zi=!1};function sn(){this.s=this.s,this.C=this.C}sn.prototype.s=!1,sn.prototype.ma=function(){this.s||(this.s=!0,this.N())},sn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function xe(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}xe.prototype.h=function(){this.defaultPrevented=!0};var tT=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};c.addEventListener("test",d,l),c.removeEventListener("test",d,l)}catch{}return a}();function Gi(a,l){if(xe.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,m=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(X){e:{try{j(l.nodeName);var R=!0;break e}catch{}R=!1}R||(l=null)}}else d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:nT[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Gi.aa.h.call(this)}}N(Gi,xe);var nT={2:"touch",3:"pen",4:"mouse"};Gi.prototype.h=function(){Gi.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Wi="closure_listenable_"+(1e6*Math.random()|0),rT=0;function iT(a,l,d,m,R){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=R,this.key=++rT,this.da=this.fa=!1}function bo(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function So(a){this.src=a,this.g={},this.h=0}So.prototype.add=function(a,l,d,m,R){var P=a.toString();a=this.g[P],a||(a=this.g[P]=[],this.h++);var V=Su(a,l,m,R);return-1<V?(l=a[V],d||(l.fa=!1)):(l=new iT(l,this.src,P,!!m,R),l.fa=d,a.push(l)),l};function bu(a,l){var d=l.type;if(d in a.g){var m=a.g[d],R=Array.prototype.indexOf.call(m,l,void 0),P;(P=0<=R)&&Array.prototype.splice.call(m,R,1),P&&(bo(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Su(a,l,d,m){for(var R=0;R<a.length;++R){var P=a[R];if(!P.da&&P.listener==l&&P.capture==!!d&&P.ha==m)return R}return-1}var Pu="closure_lm_"+(1e6*Math.random()|0),Cu={};function bp(a,l,d,m,R){if(m&&m.once)return Pp(a,l,d,m,R);if(Array.isArray(l)){for(var P=0;P<l.length;P++)bp(a,l[P],d,m,R);return null}return d=Ou(d),a&&a[Wi]?a.K(l,d,h(m)?!!m.capture:!!m,R):Sp(a,l,d,!1,m,R)}function Sp(a,l,d,m,R,P){if(!l)throw Error("Invalid event type");var V=h(R)?!!R.capture:!!R,ae=Nu(a);if(ae||(a[Pu]=ae=new So(a)),d=ae.add(l,d,m,V,P),d.proxy)return d;if(m=sT(),d.proxy=m,m.src=a,m.listener=d,a.addEventListener)tT||(R=V),R===void 0&&(R=!1),a.addEventListener(l.toString(),m,R);else if(a.attachEvent)a.attachEvent(kp(l.toString()),m);else if(a.addListener&&a.removeListener)a.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function sT(){function a(d){return l.call(a.src,a.listener,d)}let l=oT;return a}function Pp(a,l,d,m,R){if(Array.isArray(l)){for(var P=0;P<l.length;P++)Pp(a,l[P],d,m,R);return null}return d=Ou(d),a&&a[Wi]?a.L(l,d,h(m)?!!m.capture:!!m,R):Sp(a,l,d,!0,m,R)}function Cp(a,l,d,m,R){if(Array.isArray(l))for(var P=0;P<l.length;P++)Cp(a,l[P],d,m,R);else m=h(m)?!!m.capture:!!m,d=Ou(d),a&&a[Wi]?(a=a.i,l=String(l).toString(),l in a.g&&(P=a.g[l],d=Su(P,d,m,R),-1<d&&(bo(P[d]),Array.prototype.splice.call(P,d,1),P.length==0&&(delete a.g[l],a.h--)))):a&&(a=Nu(a))&&(l=a.g[l.toString()],a=-1,l&&(a=Su(l,d,m,R)),(d=-1<a?l[a]:null)&&ku(d))}function ku(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[Wi])bu(l.i,a);else{var d=a.type,m=a.proxy;l.removeEventListener?l.removeEventListener(d,m,a.capture):l.detachEvent?l.detachEvent(kp(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=Nu(l))?(bu(d,a),d.h==0&&(d.src=null,l[Pu]=null)):bo(a)}}}function kp(a){return a in Cu?Cu[a]:Cu[a]="on"+a}function oT(a,l){if(a.da)a=!0;else{l=new Gi(l,this);var d=a.listener,m=a.ha||a.src;a.fa&&ku(a),a=d.call(m,l)}return a}function Nu(a){return a=a[Pu],a instanceof So?a:null}var Du="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ou(a){return typeof a=="function"?a:(a[Du]||(a[Du]=function(l){return a.handleEvent(l)}),a[Du])}function Ve(){sn.call(this),this.i=new So(this),this.M=this,this.F=null}N(Ve,sn),Ve.prototype[Wi]=!0,Ve.prototype.removeEventListener=function(a,l,d,m){Cp(this,a,l,d,m)};function $e(a,l){var d,m=a.F;if(m)for(d=[];m;m=m.F)d.push(m);if(a=a.M,m=l.type||l,typeof l=="string")l=new xe(l,a);else if(l instanceof xe)l.target=l.target||a;else{var R=l;l=new xe(m,a),E(l,R)}if(R=!0,d)for(var P=d.length-1;0<=P;P--){var V=l.g=d[P];R=Po(V,m,!0,l)&&R}if(V=l.g=a,R=Po(V,m,!0,l)&&R,R=Po(V,m,!1,l)&&R,d)for(P=0;P<d.length;P++)V=l.g=d[P],R=Po(V,m,!1,l)&&R}Ve.prototype.N=function(){if(Ve.aa.N.call(this),this.i){var a=this.i,l;for(l in a.g){for(var d=a.g[l],m=0;m<d.length;m++)bo(d[m]);delete a.g[l],a.h--}}this.F=null},Ve.prototype.K=function(a,l,d,m){return this.i.add(String(a),l,!1,d,m)},Ve.prototype.L=function(a,l,d,m){return this.i.add(String(a),l,!0,d,m)};function Po(a,l,d,m){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();for(var R=!0,P=0;P<l.length;++P){var V=l[P];if(V&&!V.da&&V.capture==d){var ae=V.listener,Pe=V.ha||V.src;V.fa&&bu(a.i,V),R=ae.call(Pe,m)!==!1&&R}}return R&&!m.defaultPrevented}function Np(a,l,d){if(typeof a=="function")d&&(a=y(a,d));else if(a&&typeof a.handleEvent=="function")a=y(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:c.setTimeout(a,l||0)}function Dp(a){a.g=Np(()=>{a.g=null,a.i&&(a.i=!1,Dp(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class aT extends sn{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Dp(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ki(a){sn.call(this),this.h=a,this.g={}}N(Ki,sn);var Op=[];function xp(a){G(a.g,function(l,d){this.g.hasOwnProperty(d)&&ku(l)},a),a.g={}}Ki.prototype.N=function(){Ki.aa.N.call(this),xp(this)},Ki.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xu=c.JSON.stringify,cT=c.JSON.parse,uT=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function Vu(){}Vu.prototype.h=null;function Vp(a){return a.h||(a.h=a.i())}function Lp(){}var Hi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Lu(){xe.call(this,"d")}N(Lu,xe);function Mu(){xe.call(this,"c")}N(Mu,xe);var Ln={},Mp=null;function Co(){return Mp=Mp||new Ve}Ln.La="serverreachability";function Fp(a){xe.call(this,Ln.La,a)}N(Fp,xe);function Qi(a){let l=Co();$e(l,new Fp(l))}Ln.STAT_EVENT="statevent";function Up(a,l){xe.call(this,Ln.STAT_EVENT,a),this.stat=l}N(Up,xe);function je(a){let l=Co();$e(l,new Up(l,a))}Ln.Ma="timingevent";function Bp(a,l){xe.call(this,Ln.Ma,a),this.size=l}N(Bp,xe);function Yi(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},l)}function Ji(){this.g=!0}Ji.prototype.xa=function(){this.g=!1};function lT(a,l,d,m,R,P){a.info(function(){if(a.g)if(P)for(var V="",ae=P.split("&"),Pe=0;Pe<ae.length;Pe++){var re=ae[Pe].split("=");if(1<re.length){var Le=re[0];re=re[1];var Me=Le.split("_");V=2<=Me.length&&Me[1]=="type"?V+(Le+"="+re+"&"):V+(Le+"=redacted&")}}else V=null;else V=P;return"XMLHTTP REQ ("+m+") [attempt "+R+"]: "+l+`
`+d+`
`+V})}function hT(a,l,d,m,R,P,V){a.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+R+"]: "+l+`
`+d+`
`+P+" "+V})}function Pr(a,l,d,m){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+fT(a,d)+(m?" "+m:"")})}function dT(a,l){a.info(function(){return"TIMEOUT: "+l})}Ji.prototype.info=function(){};function fT(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var m=d[a];if(!(2>m.length)){var R=m[1];if(Array.isArray(R)&&!(1>R.length)){var P=R[0];if(P!="noop"&&P!="stop"&&P!="close")for(var V=1;V<R.length;V++)R[V]=""}}}}return xu(d)}catch{return l}}var ko={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},qp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Fu;function No(){}N(No,Vu),No.prototype.g=function(){return new XMLHttpRequest},No.prototype.i=function(){return{}},Fu=new No;function on(a,l,d,m){this.j=a,this.i=l,this.l=d,this.R=m||1,this.U=new Ki(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new $p}function $p(){this.i=null,this.g="",this.h=!1}var jp={},Uu={};function Bu(a,l,d){a.L=1,a.v=Vo(Ft(l)),a.m=d,a.P=!0,zp(a,null)}function zp(a,l){a.F=Date.now(),Do(a),a.A=Ft(a.v);var d=a.A,m=a.R;Array.isArray(m)||(m=[String(m)]),im(d.i,"t",m),a.C=0,d=a.j.J,a.h=new $p,a.g=Em(a.j,d?l:null,!a.m),0<a.O&&(a.M=new aT(y(a.Y,a,a.g),a.O)),l=a.U,d=a.g,m=a.ca;var R="readystatechange";Array.isArray(R)||(R&&(Op[0]=R.toString()),R=Op);for(var P=0;P<R.length;P++){var V=bp(d,R[P],m||l.handleEvent,!1,l.h||l);if(!V)break;l.g[V.key]=V}l=a.H?_(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),Qi(),lT(a.i,a.u,a.A,a.l,a.R,a.m)}on.prototype.ca=function(a){a=a.target;let l=this.M;l&&Ut(a)==3?l.j():this.Y(a)},on.prototype.Y=function(a){try{if(a==this.g)e:{let Me=Ut(this.g);var l=this.g.Ba();let Nr=this.g.Z();if(!(3>Me)&&(Me!=3||this.g&&(this.h.h||this.g.oa()||hm(this.g)))){this.J||Me!=4||l==7||(l==8||0>=Nr?Qi(3):Qi(2)),qu(this);var d=this.g.Z();this.X=d;t:if(Gp(this)){var m=hm(this.g);a="";var R=m.length,P=Ut(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Mn(this),Xi(this);var V="";break t}this.h.i=new c.TextDecoder}for(l=0;l<R;l++)this.h.h=!0,a+=this.h.i.decode(m[l],{stream:!(P&&l==R-1)});m.length=0,this.h.g+=a,this.C=0,V=this.h.g}else V=this.g.oa();if(this.o=d==200,hT(this.i,this.u,this.A,this.l,this.R,Me,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ae,Pe=this.g;if((ae=Pe.g?Pe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(ae)){var re=ae;break t}}re=null}if(d=re)Pr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,$u(this,d);else{this.o=!1,this.s=3,je(12),Mn(this),Xi(this);break e}}if(this.P){d=!0;let ct;for(;!this.J&&this.C<V.length;)if(ct=pT(this,V),ct==Uu){Me==4&&(this.s=4,je(14),d=!1),Pr(this.i,this.l,null,"[Incomplete Response]");break}else if(ct==jp){this.s=4,je(15),Pr(this.i,this.l,V,"[Invalid Chunk]"),d=!1;break}else Pr(this.i,this.l,ct,null),$u(this,ct);if(Gp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Me!=4||V.length!=0||this.h.h||(this.s=1,je(16),d=!1),this.o=this.o&&d,!d)Pr(this.i,this.l,V,"[Invalid Chunked Response]"),Mn(this),Xi(this);else if(0<V.length&&!this.W){this.W=!0;var Le=this.j;Le.g==this&&Le.ba&&!Le.M&&(Le.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),Hu(Le),Le.M=!0,je(11))}}else Pr(this.i,this.l,V,null),$u(this,V);Me==4&&Mn(this),this.o&&!this.J&&(Me==4?ym(this.j,this):(this.o=!1,Do(this)))}else NT(this.g),d==400&&0<V.indexOf("Unknown SID")?(this.s=3,je(12)):(this.s=0,je(13)),Mn(this),Xi(this)}}}catch{}finally{}};function Gp(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function pT(a,l){var d=a.C,m=l.indexOf(`
`,d);return m==-1?Uu:(d=Number(l.substring(d,m)),isNaN(d)?jp:(m+=1,m+d>l.length?Uu:(l=l.slice(m,m+d),a.C=m+d,l)))}on.prototype.cancel=function(){this.J=!0,Mn(this)};function Do(a){a.S=Date.now()+a.I,Wp(a,a.I)}function Wp(a,l){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Yi(y(a.ba,a),l)}function qu(a){a.B&&(c.clearTimeout(a.B),a.B=null)}on.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(dT(this.i,this.A),this.L!=2&&(Qi(),je(17)),Mn(this),this.s=2,Xi(this)):Wp(this,this.S-a)};function Xi(a){a.j.G==0||a.J||ym(a.j,a)}function Mn(a){qu(a);var l=a.M;l&&typeof l.ma=="function"&&l.ma(),a.M=null,xp(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function $u(a,l){try{var d=a.j;if(d.G!=0&&(d.g==a||ju(d.h,a))){if(!a.K&&ju(d.h,a)&&d.G==3){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var R=m;if(R[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)Bo(d),Fo(d);else break e;Ku(d),je(18)}}else d.za=R[1],0<d.za-d.T&&37500>R[2]&&d.F&&d.v==0&&!d.C&&(d.C=Yi(y(d.Za,d),6e3));if(1>=Qp(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Un(d,11)}else if((a.K||d.g==a)&&Bo(d),!U(l))for(R=d.Da.g.parse(l),l=0;l<R.length;l++){let re=R[l];if(d.T=re[0],re=re[1],d.G==2)if(re[0]=="c"){d.K=re[1],d.ia=re[2];let Le=re[3];Le!=null&&(d.la=Le,d.j.info("VER="+d.la));let Me=re[4];Me!=null&&(d.Aa=Me,d.j.info("SVER="+d.Aa));let Nr=re[5];Nr!=null&&typeof Nr=="number"&&0<Nr&&(m=1.5*Nr,d.L=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;let ct=a.g;if(ct){let $o=ct.g?ct.g.getResponseHeader("X-Client-Wire-Protocol"):null;if($o){var P=m.h;P.g||$o.indexOf("spdy")==-1&&$o.indexOf("quic")==-1&&$o.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(zu(P,P.h),P.h=null))}if(m.D){let Qu=ct.g?ct.g.getResponseHeader("X-HTTP-Session-Id"):null;Qu&&(m.ya=Qu,le(m.I,m.D,Qu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),m=d;var V=a;if(m.qa=wm(m,m.J?m.ia:null,m.W),V.K){Yp(m.h,V);var ae=V,Pe=m.L;Pe&&(ae.I=Pe),ae.B&&(qu(ae),Do(ae)),m.g=V}else gm(m);0<d.i.length&&Uo(d)}else re[0]!="stop"&&re[0]!="close"||Un(d,7);else d.G==3&&(re[0]=="stop"||re[0]=="close"?re[0]=="stop"?Un(d,7):Wu(d):re[0]!="noop"&&d.l&&d.l.ta(re),d.v=0)}}Qi(4)}catch{}}var mT=class{constructor(a,l){this.g=a,this.map=l}};function Kp(a){this.l=a||10,c.PerformanceNavigationTiming?(a=c.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Hp(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Qp(a){return a.h?1:a.g?a.g.size:0}function ju(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function zu(a,l){a.g?a.g.add(l):a.h=l}function Yp(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}Kp.prototype.cancel=function(){if(this.i=Jp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Jp(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.D);return l}return D(a.i)}function gT(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var l=[],d=a.length,m=0;m<d;m++)l.push(a[m]);return l}l=[],d=0;for(m in a)l[d++]=a[m];return l}function _T(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(let m in a)l[d++]=m;return l}}}function Xp(a,l){if(a.forEach&&typeof a.forEach=="function")a.forEach(l,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,l,void 0);else for(var d=_T(a),m=gT(a),R=m.length,P=0;P<R;P++)l.call(void 0,m[P],d&&d[P],a)}var Zp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function yT(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var m=a[d].indexOf("="),R=null;if(0<=m){var P=a[d].substring(0,m);R=a[d].substring(m+1)}else P=a[d];l(P,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Fn(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof Fn){this.h=a.h,Oo(this,a.j),this.o=a.o,this.g=a.g,xo(this,a.s),this.l=a.l;var l=a.i,d=new ts;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),em(this,d),this.m=a.m}else a&&(l=String(a).match(Zp))?(this.h=!1,Oo(this,l[1]||"",!0),this.o=Zi(l[2]||""),this.g=Zi(l[3]||"",!0),xo(this,l[4]),this.l=Zi(l[5]||"",!0),em(this,l[6]||"",!0),this.m=Zi(l[7]||"")):(this.h=!1,this.i=new ts(null,this.h))}Fn.prototype.toString=function(){var a=[],l=this.j;l&&a.push(es(l,tm,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(es(l,tm,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(es(d,d.charAt(0)=="/"?wT:IT,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",es(d,TT)),a.join("")};function Ft(a){return new Fn(a)}function Oo(a,l,d){a.j=d?Zi(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function xo(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function em(a,l,d){l instanceof ts?(a.i=l,AT(a.i,a.h)):(d||(l=es(l,ET)),a.i=new ts(l,a.h))}function le(a,l,d){a.i.set(l,d)}function Vo(a){return le(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Zi(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function es(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,vT),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function vT(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var tm=/[#\/\?@]/g,IT=/[#\?:]/g,wT=/[#\?]/g,ET=/[#\?@]/g,TT=/#/g;function ts(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function an(a){a.g||(a.g=new Map,a.h=0,a.i&&yT(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}r=ts.prototype,r.add=function(a,l){an(this),this.i=null,a=Cr(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function nm(a,l){an(a),l=Cr(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function rm(a,l){return an(a),l=Cr(a,l),a.g.has(l)}r.forEach=function(a,l){an(this),this.g.forEach(function(d,m){d.forEach(function(R){a.call(l,R,m,this)},this)},this)},r.na=function(){an(this);let a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){let R=a[m];for(let P=0;P<R.length;P++)d.push(l[m])}return d},r.V=function(a){an(this);let l=[];if(typeof a=="string")rm(this,a)&&(l=l.concat(this.g.get(Cr(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},r.set=function(a,l){return an(this),this.i=null,a=Cr(this,a),rm(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},r.get=function(a,l){return a?(a=this.V(a),0<a.length?String(a[0]):l):l};function im(a,l,d){nm(a,l),0<d.length&&(a.i=null,a.g.set(Cr(a,l),D(d)),a.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];let P=encodeURIComponent(String(m)),V=this.V(m);for(m=0;m<V.length;m++){var R=P;V[m]!==""&&(R+="="+encodeURIComponent(String(V[m]))),a.push(R)}}return this.i=a.join("&")};function Cr(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function AT(a,l){l&&!a.j&&(an(a),a.i=null,a.g.forEach(function(d,m){var R=m.toLowerCase();m!=R&&(nm(this,m),im(this,R,d))},a)),a.j=l}function RT(a,l){let d=new Ji;if(c.Image){let m=new Image;m.onload=A(cn,d,"TestLoadImage: loaded",!0,l,m),m.onerror=A(cn,d,"TestLoadImage: error",!1,l,m),m.onabort=A(cn,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=A(cn,d,"TestLoadImage: timeout",!1,l,m),c.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=a}else l(!1)}function bT(a,l){let d=new Ji,m=new AbortController,R=setTimeout(()=>{m.abort(),cn(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:m.signal}).then(P=>{clearTimeout(R),P.ok?cn(d,"TestPingServer: ok",!0,l):cn(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(R),cn(d,"TestPingServer: error",!1,l)})}function cn(a,l,d,m,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),m(d)}catch{}}function ST(){this.g=new uT}function PT(a,l,d){let m=d||"";try{Xp(a,function(R,P){let V=R;h(R)&&(V=xu(R)),l.push(m+P+"="+encodeURIComponent(V))})}catch(R){throw l.push(m+"type="+encodeURIComponent("_badmap")),R}}function ns(a){this.l=a.Ub||null,this.j=a.eb||!1}N(ns,Vu),ns.prototype.g=function(){return new Lo(this.l,this.j)},ns.prototype.i=function(a){return function(){return a}}({});function Lo(a,l){Ve.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(Lo,Ve),r=Lo.prototype,r.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,is(this)},r.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||c).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,rs(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,is(this)),this.g&&(this.readyState=3,is(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;sm(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function sm(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?rs(this):is(this),this.readyState==3&&sm(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,rs(this))},r.Qa=function(a){this.g&&(this.response=a,rs(this))},r.ga=function(){this.g&&rs(this)};function rs(a){a.readyState=4,a.l=null,a.j=null,a.v=null,is(a)}r.setRequestHeader=function(a,l){this.u.append(a,l)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function is(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Lo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function om(a){let l="";return G(a,function(d,m){l+=m,l+=":",l+=d,l+=`\r
`}),l}function Gu(a,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=om(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):le(a,l,d))}function pe(a){Ve.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(pe,Ve);var CT=/^https?$/i,kT=["POST","PUT"];r=pe.prototype,r.Ha=function(a){this.J=a},r.ea=function(a,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Fu.g(),this.v=this.o?Vp(this.o):Vp(Fu),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(P){am(this,P);return}if(a=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var R in m)d.set(R,m[R]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())d.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(P=>P.toLowerCase()=="content-type"),R=c.FormData&&a instanceof c.FormData,!(0<=Array.prototype.indexOf.call(kT,l,void 0))||m||R||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,V]of d)this.g.setRequestHeader(P,V);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{lm(this),this.u=!0,this.g.send(a),this.u=!1}catch(P){am(this,P)}};function am(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,cm(a),Mo(a)}function cm(a){a.A||(a.A=!0,$e(a,"complete"),$e(a,"error"))}r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,$e(this,"complete"),$e(this,"abort"),Mo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Mo(this,!0)),pe.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?um(this):this.bb())},r.bb=function(){um(this)};function um(a){if(a.h&&typeof o<"u"&&(!a.v[1]||Ut(a)!=4||a.Z()!=2)){if(a.u&&Ut(a)==4)Np(a.Ea,0,a);else if($e(a,"readystatechange"),Ut(a)==4){a.h=!1;try{let V=a.Z();e:switch(V){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=V===0){var R=String(a.D).match(Zp)[1]||null;!R&&c.self&&c.self.location&&(R=c.self.location.protocol.slice(0,-1)),m=!CT.test(R?R.toLowerCase():"")}d=m}if(d)$e(a,"complete"),$e(a,"success");else{a.m=6;try{var P=2<Ut(a)?a.g.statusText:""}catch{P=""}a.l=P+" ["+a.Z()+"]",cm(a)}}finally{Mo(a)}}}}function Mo(a,l){if(a.g){lm(a);let d=a.g,m=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||$e(a,"ready");try{d.onreadystatechange=m}catch{}}}function lm(a){a.I&&(c.clearTimeout(a.I),a.I=null)}r.isActive=function(){return!!this.g};function Ut(a){return a.g?a.g.readyState:0}r.Z=function(){try{return 2<Ut(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),cT(l)}};function hm(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function NT(a){let l={};a=(a.g&&2<=Ut(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<a.length;m++){if(U(a[m]))continue;var d=T(a[m]);let R=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let P=l[R]||[];l[R]=P,P.push(d)}w(l,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ss(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function dm(a){this.Aa=0,this.i=[],this.j=new Ji,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ss("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ss("baseRetryDelayMs",5e3,a),this.cb=ss("retryDelaySeedMs",1e4,a),this.Wa=ss("forwardChannelMaxRetries",2,a),this.wa=ss("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Kp(a&&a.concurrentRequestLimit),this.Da=new ST,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=dm.prototype,r.la=8,r.G=1,r.connect=function(a,l,d,m){je(0),this.W=a,this.H=l||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=wm(this,null,this.W),Uo(this)};function Wu(a){if(fm(a),a.G==3){var l=a.U++,d=Ft(a.I);if(le(d,"SID",a.K),le(d,"RID",l),le(d,"TYPE","terminate"),os(a,d),l=new on(a,a.j,l),l.L=2,l.v=Vo(Ft(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=l.v,d=!0),d||(l.g=Em(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Do(l)}Im(a)}function Fo(a){a.g&&(Hu(a),a.g.cancel(),a.g=null)}function fm(a){Fo(a),a.u&&(c.clearTimeout(a.u),a.u=null),Bo(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&c.clearTimeout(a.s),a.s=null)}function Uo(a){if(!Hp(a.h)&&!a.s){a.s=!0;var l=a.Ga;ji||Rp(),zi||(ji(),zi=!0),Ru.add(l,a),a.B=0}}function DT(a,l){return Qp(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=l.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Yi(y(a.Ga,a,l),vm(a,a.B)),a.B++,!0)}r.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let R=new on(this,this.j,a),P=this.o;if(this.S&&(P?(P=_(P),E(P,this.S)):P=this.S),this.m!==null||this.O||(R.H=P,P=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=mm(this,R,l),d=Ft(this.I),le(d,"RID",a),le(d,"CVER",22),this.D&&le(d,"X-HTTP-Session-Id",this.D),os(this,d),P&&(this.O?l="headers="+encodeURIComponent(String(om(P)))+"&"+l:this.m&&Gu(d,this.m,P)),zu(this.h,R),this.Ua&&le(d,"TYPE","init"),this.P?(le(d,"$req",l),le(d,"SID","null"),R.T=!0,Bu(R,d,null)):Bu(R,d,l),this.G=2}}else this.G==3&&(a?pm(this,a):this.i.length==0||Hp(this.h)||pm(this))};function pm(a,l){var d;l?d=l.l:d=a.U++;let m=Ft(a.I);le(m,"SID",a.K),le(m,"RID",d),le(m,"AID",a.T),os(a,m),a.m&&a.o&&Gu(m,a.m,a.o),d=new on(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=mm(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),zu(a.h,d),Bu(d,m,l)}function os(a,l){a.H&&G(a.H,function(d,m){le(l,m,d)}),a.l&&Xp({},function(d,m){le(l,m,d)})}function mm(a,l,d){d=Math.min(a.i.length,d);var m=a.l?y(a.l.Na,a.l,a):null;e:{var R=a.i;let P=-1;for(;;){let V=["count="+d];P==-1?0<d?(P=R[0].g,V.push("ofs="+P)):P=0:V.push("ofs="+P);let ae=!0;for(let Pe=0;Pe<d;Pe++){let re=R[Pe].g,Le=R[Pe].map;if(re-=P,0>re)P=Math.max(0,R[Pe].g-100),ae=!1;else try{PT(Le,V,"req"+re+"_")}catch{m&&m(Le)}}if(ae){m=V.join("&");break e}}}return a=a.i.splice(0,d),l.D=a,m}function gm(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;ji||Rp(),zi||(ji(),zi=!0),Ru.add(l,a),a.v=0}}function Ku(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Yi(y(a.Fa,a),vm(a,a.v)),a.v++,!0)}r.Fa=function(){if(this.u=null,_m(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Yi(y(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,je(10),Fo(this),_m(this))};function Hu(a){a.A!=null&&(c.clearTimeout(a.A),a.A=null)}function _m(a){a.g=new on(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var l=Ft(a.qa);le(l,"RID","rpc"),le(l,"SID",a.K),le(l,"AID",a.T),le(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&le(l,"TO",a.ja),le(l,"TYPE","xmlhttp"),os(a,l),a.m&&a.o&&Gu(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=Vo(Ft(l)),d.m=null,d.P=!0,zp(d,a)}r.Za=function(){this.C!=null&&(this.C=null,Fo(this),Ku(this),je(19))};function Bo(a){a.C!=null&&(c.clearTimeout(a.C),a.C=null)}function ym(a,l){var d=null;if(a.g==l){Bo(a),Hu(a),a.g=null;var m=2}else if(ju(a.h,l))d=l.D,Yp(a.h,l),m=1;else return;if(a.G!=0){if(l.o)if(m==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var R=a.B;m=Co(),$e(m,new Bp(m,d)),Uo(a)}else gm(a);else if(R=l.s,R==3||R==0&&0<l.X||!(m==1&&DT(a,l)||m==2&&Ku(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),R){case 1:Un(a,5);break;case 4:Un(a,10);break;case 3:Un(a,6);break;default:Un(a,2)}}}function vm(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function Un(a,l){if(a.j.info("Error code "+l),l==2){var d=y(a.fb,a),m=a.Xa;let R=!m;m=new Fn(m||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Oo(m,"https"),Vo(m),R?RT(m.toString(),d):bT(m.toString(),d)}else je(2);a.G=0,a.l&&a.l.sa(l),Im(a),fm(a)}r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),je(2)):(this.j.info("Failed to ping google.com"),je(1))};function Im(a){if(a.G=0,a.ka=[],a.l){let l=Jp(a.h);(l.length!=0||a.i.length!=0)&&(k(a.ka,l),k(a.ka,a.i),a.h.i.length=0,D(a.i),a.i.length=0),a.l.ra()}}function wm(a,l,d){var m=d instanceof Fn?Ft(d):new Fn(d);if(m.g!="")l&&(m.g=l+"."+m.g),xo(m,m.s);else{var R=c.location;m=R.protocol,l=l?l+"."+R.hostname:R.hostname,R=+R.port;var P=new Fn(null);m&&Oo(P,m),l&&(P.g=l),R&&xo(P,R),d&&(P.l=d),m=P}return d=a.D,l=a.ya,d&&l&&le(m,d,l),le(m,"VER",a.la),os(a,m),m}function Em(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Ca&&!a.pa?new pe(new ns({eb:d})):new pe(a.pa),l.Ha(a.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Tm(){}r=Tm.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function qo(){}qo.prototype.g=function(a,l){return new Ye(a,l)};function Ye(a,l){Ve.call(this),this.g=new dm(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!U(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!U(l)&&(this.g.D=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new kr(this)}N(Ye,Ve),Ye.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ye.prototype.close=function(){Wu(this.g)},Ye.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=xu(a),a=d);l.i.push(new mT(l.Ya++,a)),l.G==3&&Uo(l)},Ye.prototype.N=function(){this.g.l=null,delete this.j,Wu(this.g),delete this.g,Ye.aa.N.call(this)};function Am(a){Lu.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(let d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}N(Am,Lu);function Rm(){Mu.call(this),this.status=1}N(Rm,Mu);function kr(a){this.g=a}N(kr,Tm),kr.prototype.ua=function(){$e(this.g,"a")},kr.prototype.ta=function(a){$e(this.g,new Am(a))},kr.prototype.sa=function(a){$e(this.g,new Rm)},kr.prototype.ra=function(){$e(this.g,"b")},qo.prototype.createWebChannel=qo.prototype.g,Ye.prototype.send=Ye.prototype.o,Ye.prototype.open=Ye.prototype.m,Ye.prototype.close=Ye.prototype.close,uh=Xt.createWebChannelTransport=function(){return new qo},ch=Xt.getStatEventTarget=function(){return Co()},ah=Xt.Event=Ln,Na=Xt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ko.NO_ERROR=0,ko.TIMEOUT=8,ko.HTTP_ERROR=6,bs=Xt.ErrorCode=ko,qp.COMPLETE="complete",oh=Xt.EventType=qp,Lp.EventType=Hi,Hi.OPEN="a",Hi.CLOSE="b",Hi.ERROR="c",Hi.MESSAGE="d",Ve.prototype.listen=Ve.prototype.K,jr=Xt.WebChannel=Lp,gS=Xt.FetchXmlHttpFactory=ns,pe.prototype.listenOnce=pe.prototype.L,pe.prototype.getLastError=pe.prototype.Ka,pe.prototype.getLastErrorCode=pe.prototype.Ba,pe.prototype.getStatus=pe.prototype.Z,pe.prototype.getResponseJson=pe.prototype.Oa,pe.prototype.getResponseText=pe.prototype.oa,pe.prototype.send=pe.prototype.ea,pe.prototype.setWithCredentials=pe.prototype.Ha,sh=Xt.XhrIo=pe}).apply(typeof ka<"u"?ka:typeof self<"u"?self:typeof window<"u"?window:{})});function Yr(){return hr.logLevel}function O(r,...e){if(hr.logLevel<=Je.DEBUG){let t=e.map(ff);hr.debug(`Firestore (${Ci}): ${r}`,...t)}}function ze(r,...e){if(hr.logLevel<=Je.ERROR){let t=e.map(ff);hr.error(`Firestore (${Ci}): ${r}`,...t)}}function oi(r,...e){if(hr.logLevel<=Je.WARN){let t=e.map(ff);hr.warn(`Firestore (${Ci}): ${r}`,...t)}}function ff(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}function F(r,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,gv(r,n,t)}function gv(r,e,t){let n=`FIRESTORE (${Ci}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw ze(n),new Error(n)}function B(r,e,t,n){let i="Unexpected state";typeof t=="string"?i=t:n=t,r||gv(e,i,n)}function H(r,e){return r}function _S(r){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}function _v(){return new TextEncoder}function W(r,e){return r<e?-1:r>e?1:0}function Eh(r,e){let t=0;for(;t<r.length&&t<e.length;){let n=r.codePointAt(t),i=e.codePointAt(t);if(n!==i){if(n<128&&i<128)return W(n,i);{let s=_v(),o=yS(s.encode(iy(r,t)),s.encode(iy(e,t)));return o!==0?o:W(n,i)}}t+=n>65535?2:1}return W(r.length,e.length)}function iy(r,e){return r.codePointAt(e)>65535?r.substring(e,e+2):r.substring(e,e+1)}function yS(r,e){for(let t=0;t<r.length&&t<e.length;++t)if(r[t]!==e[t])return W(r[t],e[t]);return W(r.length,e.length)}function ai(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function yv(r){return r+"\0"}function Th(r){return r.fields.find(e=>e.kind===2)}function Xn(r){return r.fields.filter(e=>e.kind!==2)}function IS(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=z.fromTimestamp(n===1e9?new J(t+1,0):new J(t,n));return new at(i,L.empty(),e)}function vv(r){return new at(r.readTime,r.key,Ms)}function pf(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(r.documentKey,e.documentKey),t!==0?t:W(r.largestBatchId,e.largestBatchId))}function Ir(r){return p(this,null,function*(){if(r.code!==C.FAILED_PRECONDITION||r.message!==Iv)throw r;O("LocalStore","Unexpectedly lost primary lease")})}function wv(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function xn(r){return r.name==="IndexedDbTransactionError"}function er(r){return new S((e,t)=>{r.onsuccess=n=>{let i=n.target.result;e(i)},r.onerror=n=>{let i=mf(n.target.error);t(i)}})}function mf(r){let e=ui.M(Ie());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return cy||(cy=!0,setTimeout(()=>{throw n},0)),n}}return r}function Qc(r){return r==null}function Us(r){return r===0&&1/r==-1/0}function wS(r){return typeof r=="number"&&Number.isInteger(r)&&!Us(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Be(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=uy(e)),e=ES(r.get(t),e);return uy(e)}function ES(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case Ya:t+="";break;default:t+=s}}return t}function uy(r){return r+Ya+""}function Pt(r){let e=r.length;if(B(e>=2,64408,{path:r}),e===2)return B(r.charAt(0)===Ya&&r.charAt(1)==="",56145,{path:r}),ie.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let o=r.indexOf(Ya,s);switch((o<0||o>t)&&F(50515,{path:r}),r.charAt(o+1)){case"":let c=r.substring(s,o),u;i.length===0?u=c:(i+=c,u=i,i=""),n.push(u);break;case"":i+=r.substring(s,o),i+="\0";break;case"":i+=r.substring(s,o+1);break;default:F(61167,{path:r})}s=o+2}return new ie(n)}function Ma(r,e){return[r,Be(e)]}function Ev(r,e,t){return[r,Be(e),t]}function Ae(r,e){let t=H(r);return ui.N(t.he,e)}function dy(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Vn(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Nv(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function Gr(r){return r.hasNext()?r.getNext():void 0}function en(r){if(B(!!r,39018),typeof r=="string"){let e=0,t=HS.exec(r);if(B(!!t,46558,{timestamp:r}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:de(r.seconds),nanos:de(r.nanos)}}function de(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function tn(r){return typeof r=="string"?Te.fromBase64String(r):Te.fromUint8Array(r)}function Zc(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{})[Ov])===null||t===void 0?void 0:t.stringValue)===Dv}function eu(r){let e=r.mapValue.fields[xv];return Zc(e)?eu(e):e}function zs(r){let e=en(r.mapValue.fields[Vv].timestampValue);return new J(e.seconds,e.nanos)}function bn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Zc(r)?4:Mv(r)?9007199254740991:tu(r)?10:11:F(28295,{value:r})}function Nt(r,e){if(r===e)return!0;let t=bn(r);if(t!==bn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return zs(r).isEqual(zs(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=en(i.timestampValue),c=en(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return tn(i.bytesValue).isEqual(tn(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return de(i.geoPointValue.latitude)===de(s.geoPointValue.latitude)&&de(i.geoPointValue.longitude)===de(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return de(i.integerValue)===de(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=de(i.doubleValue),c=de(s.doubleValue);return o===c?Us(o)===Us(c):isNaN(o)&&isNaN(c)}return!1}(r,e);case 9:return ai(r.arrayValue.values||[],e.arrayValue.values||[],Nt);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(dy(o)!==dy(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!Nt(o[u],c[u])))return!1;return!0}(r,e);default:return F(52216,{left:r})}}function Ws(r,e){return(r.values||[]).find(t=>Nt(t,e))!==void 0}function Sn(r,e){if(r===e)return 0;let t=bn(r),n=bn(e);if(t!==n)return W(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(r.booleanValue,e.booleanValue);case 2:return function(s,o){let c=de(s.integerValue||s.doubleValue),u=de(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(r,e);case 3:return fy(r.timestampValue,e.timestampValue);case 4:return fy(zs(r),zs(e));case 5:return Eh(r.stringValue,e.stringValue);case 6:return function(s,o){let c=tn(s),u=tn(o);return c.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(s,o){let c=s.split("/"),u=o.split("/");for(let h=0;h<c.length&&h<u.length;h++){let f=W(c[h],u[h]);if(f!==0)return f}return W(c.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,o){let c=W(de(s.latitude),de(o.latitude));return c!==0?c:W(de(s.longitude),de(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return py(r.arrayValue,e.arrayValue);case 10:return function(s,o){var c,u,h,f;let g=s.fields||{},y=o.fields||{},A=(c=g[mi])===null||c===void 0?void 0:c.arrayValue,N=(u=y[mi])===null||u===void 0?void 0:u.arrayValue,D=W(((h=A==null?void 0:A.values)===null||h===void 0?void 0:h.length)||0,((f=N==null?void 0:N.values)===null||f===void 0?void 0:f.length)||0);return D!==0?D:py(A,N)}(r.mapValue,e.mapValue);case 11:return function(s,o){if(s===An.mapValue&&o===An.mapValue)return 0;if(s===An.mapValue)return 1;if(o===An.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),h=o.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let g=0;g<u.length&&g<f.length;++g){let y=Eh(u[g],f[g]);if(y!==0)return y;let A=Sn(c[u[g]],h[f[g]]);if(A!==0)return A}return W(u.length,f.length)}(r.mapValue,e.mapValue);default:throw F(23264,{Pe:t})}}function fy(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return W(r,e);let t=en(r),n=en(e),i=W(t.seconds,n.seconds);return i!==0?i:W(t.nanos,n.nanos)}function py(r,e){let t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){let s=Sn(t[i],n[i]);if(s)return s}return W(t.length,n.length)}function gi(r){return Dh(r)}function Dh(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){let n=en(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return tn(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return L.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=Dh(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of n)s?s=!1:i+=",",i+=`${o}:${Dh(t.fields[o])}`;return i+"}"}(r.mapValue):F(61005,{value:r})}function Ba(r){switch(bn(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=eu(r);return e?16+Ba(e):16;case 5:return 2*r.stringValue.length;case 6:return tn(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,s)=>i+Ba(s),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return Vn(n.fields,(s,o)=>{i+=s.length+Ba(o)}),i}(r.mapValue);default:throw F(13486,{value:r})}}function dr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Oh(r){return!!r&&"integerValue"in r}function Ks(r){return!!r&&"arrayValue"in r}function my(r){return!!r&&"nullValue"in r}function gy(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function qa(r){return!!r&&"mapValue"in r}function tu(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{})[If])===null||t===void 0?void 0:t.stringValue)===wf}function xs(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return Vn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=xs(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xs(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Mv(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Lv}function QS(r){return"nullValue"in r?Ua:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?dr(pi.empty(),L.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?tu(r)?Fv:{mapValue:{}}:F(35942,{value:r})}function YS(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?dr(pi.empty(),L.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Fv:"mapValue"in r?tu(r)?{mapValue:{}}:An:F(61959,{value:r})}function _y(r,e){let t=Sn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function yy(r,e){let t=Sn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}function Uv(r){let e=[];return Vn(r.fields,(t,n)=>{let i=new Ee([t]);if(qa(n)){let s=Uv(n.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Ze(e)}function vy(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],o=r.position[i];if(s.field.isKeyField()?n=L.comparator(L.fromName(o.referenceValue),t.key):n=Sn(o,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Iy(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Nt(r.position[t],e.position[t]))return!1;return!0}function JS(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}function _i(r){return r.op==="and"}function xh(r){return r.op==="or"}function Ef(r){return Bv(r)&&_i(r)}function Bv(r){for(let e of r.filters)if(e instanceof se)return!1;return!0}function Vh(r){if(r instanceof Z)return r.field.canonicalString()+r.op.toString()+gi(r.value);if(Ef(r))return r.filters.map(e=>Vh(e)).join(",");{let e=r.filters.map(t=>Vh(t)).join(",");return`${r.op}(${e})`}}function qv(r,e){return r instanceof Z?function(n,i){return i instanceof Z&&n.op===i.op&&n.field.isEqual(i.field)&&Nt(n.value,i.value)}(r,e):r instanceof se?function(n,i){return i instanceof se&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,o,c)=>s&&qv(o,i.filters[c]),!0):!1}(r,e):void F(19439)}function $v(r,e){let t=r.filters.concat(e);return se.create(t,r.op)}function jv(r){return r instanceof Z?function(t){return`${t.field.canonicalString()} ${t.op} ${gi(t.value)}`}(r):r instanceof se?function(t){return t.op.toString()+" {"+t.getFilters().map(jv).join(" ,")+"}"}(r):"Filter"}function zv(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>L.fromName(n.referenceValue))}function jh(r,e=null,t=[],n=[],i=null,s=null,o=null){return new $h(r,e,t,n,i,s,o)}function pr(r){let e=H(r);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Vh(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Qc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>gi(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>gi(n)).join(",")),e.Ie=t}return e.Ie}function lo(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!JS(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!qv(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Iy(r.startAt,e.startAt)&&Iy(r.endAt,e.endAt)}function sc(r){return L.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function oc(r,e){return r.filters.filter(t=>t instanceof Z&&t.field.isEqual(e))}function wy(r,e,t){let n=Ua,i=!0;for(let s of oc(r,e)){let o=Ua,c=!0;switch(s.op){case"<":case"<=":o=QS(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=Ua}_y({value:n,inclusive:i},{value:o,inclusive:c})<0&&(n=o,i=c)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];_y({value:n,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}function Ey(r,e,t){let n=An,i=!0;for(let s of oc(r,e)){let o=An,c=!0;switch(s.op){case">=":case">":o=YS(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=An}yy({value:n,inclusive:i},{value:o,inclusive:c})>0&&(n=o,i=c)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];yy({value:n,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}function XS(r,e,t,n,i,s,o,c){return new Ot(r,e,t,n,i,s,o,c)}function ho(r){return new Ot(r)}function Ty(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Tf(r){return r.collectionGroup!==null}function ri(r){let e=H(r);if(e.Ee===null){e.Ee=[];let t=new Set;for(let s of e.explicitOrderBy)e.Ee.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new oe(Ee.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ee.push(new fr(s,n))}),t.has(Ee.keyField().canonicalString())||e.Ee.push(new fr(Ee.keyField(),n))}return e.Ee}function ot(r){let e=H(r);return e.de||(e.de=ZS(e,ri(r))),e.de}function ZS(r,e){if(r.limitType==="F")return jh(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new fr(i.field,s)});let t=r.endAt?new Dt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Dt(r.startAt.position,r.startAt.inclusive):null;return jh(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function zh(r,e){let t=r.filters.concat([e]);return new Ot(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function ac(r,e,t){return new Ot(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function nu(r,e){return lo(ot(r),ot(e))&&r.limitType===e.limitType}function Gv(r){return`${pr(ot(r))}|lt:${r.limitType}`}function Jr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>jv(i)).join(", ")}]`),Qc(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>gi(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>gi(i)).join(",")),`Target(${n})`}(ot(r))}; limitType=${r.limitType})`}function fo(r,e){return e.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):L.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(let s of ri(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(o,c,u){let h=vy(o,c,u);return o.inclusive?h<=0:h<0}(n.startAt,ri(n),i)||n.endAt&&!function(o,c,u){let h=vy(o,c,u);return o.inclusive?h>=0:h>0}(n.endAt,ri(n),i))}(r,e)}function eP(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Wv(r){return(e,t)=>{let n=!1;for(let i of ri(r)){let s=tP(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function tP(r,e,t){let n=r.field.isKeyField()?L.comparator(e.key,t.key):function(s,o,c){let u=o.data.field(s),h=c.data.field(s);return u!==null&&h!==null?Sn(u,h):F(42886)}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return F(19790,{direction:r.dir})}}function et(){return nP}function Ns(...r){let e=Kv;for(let t of r)e=e.insert(t.key,t);return e}function Hv(r){let e=Kv;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Ct(){return Vs()}function Qv(){return Vs()}function Vs(){return new mt(r=>r.toString(),(r,e)=>r.isEqual(e))}function Y(...r){let e=iP;for(let t of r)e=e.add(t);return e}function oP(){return sP}function Af(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Us(e)?"-0":e}}function Yv(r){return{integerValue:""+r}}function aP(r,e){return wS(e)?Yv(e):Af(r,e)}function cP(r,e,t){return r instanceof Pn?function(i,s){let o={fields:{[Ov]:{stringValue:Dv},[Vv]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Zc(s)&&(s=eu(s)),s&&(o.fields[xv]=s),{mapValue:o}}(t,e):r instanceof Cn?Xv(r,e):r instanceof kn?Zv(r,e):function(i,s){let o=Jv(i,s),c=Ay(o)+Ay(i.Re);return Oh(o)&&Oh(i.Re)?Yv(c):Af(i.serializer,c)}(r,e)}function uP(r,e,t){return r instanceof Cn?Xv(r,e):r instanceof kn?Zv(r,e):t}function Jv(r,e){return r instanceof mr?function(n){return Oh(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}function Xv(r,e){let t=eI(e);for(let n of r.elements)t.some(i=>Nt(i,n))||t.push(n);return{arrayValue:{values:t}}}function Zv(r,e){let t=eI(e);for(let n of r.elements)t=t.filter(i=>!Nt(i,n));return{arrayValue:{values:t}}}function Ay(r){return de(r.integerValue||r.doubleValue)}function eI(r){return Ks(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function lP(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof Cn&&i instanceof Cn||n instanceof kn&&i instanceof kn?ai(n.elements,i.elements,Nt):n instanceof mr&&i instanceof mr?Nt(n.Re,i.Re):n instanceof Pn&&i instanceof Pn}(r.transform,e.transform)}function $a(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}function tI(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Ii(r.key,He.none()):new Nn(r.key,r.data,He.none());{let t=r.data,n=Ge.empty(),i=new oe(Ee.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?n.delete(s):n.set(s,o),i=i.add(s)}return new gt(r.key,n,new Ze(i.toArray()),He.none())}}function hP(r,e,t){r instanceof Nn?function(i,s,o){let c=i.value.clone(),u=by(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(r,e,t):r instanceof gt?function(i,s,o){if(!$a(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=by(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(nI(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ls(r,e,t,n){return r instanceof Nn?function(s,o,c,u){if(!$a(s.precondition,o))return c;let h=s.value.clone(),f=Sy(s.fieldTransforms,u,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof gt?function(s,o,c,u){if(!$a(s.precondition,o))return c;let h=Sy(s.fieldTransforms,u,o),f=o.data;return f.setAll(nI(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,e,t,n):function(s,o,c){return $a(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(r,e,t)}function dP(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=Jv(n.transform,i||null);s!=null&&(t===null&&(t=Ge.empty()),t.set(n.field,s))}return t||null}function Ry(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&ai(n,i,(s,o)=>lP(s,o))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}function nI(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function by(r,e,t){let n=new Map;B(r.length===t.length,32656,{Ve:t.length,me:r.length});for(let i=0;i<t.length;i++){let s=r[i],o=s.transform,c=e.data.field(s.field);n.set(s.field,uP(o,c,t[i]))}return n}function Sy(r,e,t){let n=new Map;for(let i of r){let s=i.transform,o=t.data.field(i.field);n.set(i.field,cP(s,o,e))}return n}function fP(r){switch(r){case C.OK:return F(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return F(15467,{code:r})}}function rI(r){if(r===void 0)return ze("GRPC error has no .code"),C.UNKNOWN;switch(r){case ye.OK:return C.OK;case ye.CANCELLED:return C.CANCELLED;case ye.UNKNOWN:return C.UNKNOWN;case ye.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case ye.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case ye.INTERNAL:return C.INTERNAL;case ye.UNAVAILABLE:return C.UNAVAILABLE;case ye.UNAUTHENTICATED:return C.UNAUTHENTICATED;case ye.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case ye.NOT_FOUND:return C.NOT_FOUND;case ye.ALREADY_EXISTS:return C.ALREADY_EXISTS;case ye.PERMISSION_DENIED:return C.PERMISSION_DENIED;case ye.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case ye.ABORTED:return C.ABORTED;case ye.OUT_OF_RANGE:return C.OUT_OF_RANGE;case ye.UNIMPLEMENTED:return C.UNIMPLEMENTED;case ye.DATA_LOSS:return C.DATA_LOSS;default:return F(39323,{code:r})}}function Cy(r){let e=_v().encode(r),t=new ih;return t.update(e),new Uint8Array(t.digest())}function ky(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Jt([t,n],0),new Jt([i,s],0)]}function Da(){return new fe(L.comparator)}function Ny(){return new fe(L.comparator)}function Jh(r,e){return r.useProto3Json||Qc(e)?e:{value:e}}function wi(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function iI(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function yP(r,e){return wi(r,e.toTimestamp())}function We(r){return B(!!r,49232),z.fromTimestamp(function(t){let n=en(t);return new J(n.seconds,n.nanos)}(r))}function Rf(r,e){return Xh(r,e).canonicalString()}function Xh(r,e){let t=function(i){return new ie(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function sI(r){let e=ie.fromString(r);return B(pI(e),10190,{key:e.toString()}),e}function pc(r,e){return Rf(r.databaseId,e.path)}function lr(r,e){let t=sI(e);if(t.get(1)!==r.databaseId.projectId)throw new x(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new x(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new L(cI(t))}function oI(r,e){return Rf(r.databaseId,e)}function aI(r){let e=sI(r);return e.length===4?ie.emptyPath():cI(e)}function Zh(r){return new ie(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function cI(r){return B(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function Dy(r,e,t){return{name:pc(r,e),fields:t.value.mapValue.fields}}function vP(r,e,t){let n=lr(r,e.name),i=We(e.updateTime),s=e.createTime?We(e.createTime):z.min(),o=new Ge({mapValue:{fields:e.fields}}),c=Ne.newFoundDocument(n,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function IP(r,e){let t;if("targetChange"in e){e.targetChange;let n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:F(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(B(f===void 0||typeof f=="string",58123),Te.fromBase64String(f||"")):(B(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Te.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(h){let f=h.code===void 0?C.UNKNOWN:rI(h.code);return new x(f,h.message||"")}(o);t=new dc(n,i,s,c||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=lr(r,n.document.name),s=We(n.document.updateTime),o=n.document.createTime?We(n.document.createTime):z.min(),c=new Ge({mapValue:{fields:n.document.fields}}),u=Ne.newFoundDocument(i,s,o,c),h=n.targetIds||[],f=n.removedTargetIds||[];t=new ii(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=lr(r,n.document),s=n.readTime?We(n.readTime):z.min(),o=Ne.newNoDocument(i,s),c=n.removedTargetIds||[];t=new ii([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=lr(r,n.document),s=n.removedTargetIds||[];t=new ii([],s,i,null)}else{if(!("filter"in e))return F(11601,{Vt:e});{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,o=new Kh(i,s),c=n.targetId;t=new hc(c,o)}}return t}function mc(r,e){let t;if(e instanceof Nn)t={update:Dy(r,e.key,e.value)};else if(e instanceof Ii)t={delete:pc(r,e.key)};else if(e instanceof gt)t={update:Dy(r,e.key,e.data),updateMask:bP(e.fieldMask)};else{if(!(e instanceof uc))return F(16599,{ft:e.type});t={verify:pc(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){let c=o.transform;if(c instanceof Pn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Cn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof kn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof mr)return{fieldPath:o.field.canonicalString(),increment:c.Re};throw F(20930,{transform:o.transform})}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:yP(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:F(27497)}(r,e.precondition)),t}function ed(r,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?He.updateTime(We(s.updateTime)):s.exists!==void 0?He.exists(s.exists):He.none()}(e.currentDocument):He.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(o,c){let u=null;if("setToServerValue"in c)B(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),u=new Pn;else if("appendMissingElements"in c){let f=c.appendMissingElements.values||[];u=new Cn(f)}else if("removeAllFromArray"in c){let f=c.removeAllFromArray.values||[];u=new kn(f)}else"increment"in c?u=new mr(o,c.increment):F(16584,{proto:c});let h=Ee.fromServerFormat(c.fieldPath);return new cc(h,u)}(r,i)):[];if(e.update){e.update.name;let i=lr(r,e.update.name),s=new Ge({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let h=u.fieldPaths||[];return new Ze(h.map(f=>Ee.fromServerFormat(f)))}(e.updateMask);return new gt(i,s,o,t,n)}return new Nn(i,s,t,n)}if(e.delete){let i=lr(r,e.delete);return new Ii(i,t)}if(e.verify){let i=lr(r,e.verify);return new uc(i,t)}return F(1463,{proto:e})}function wP(r,e){return r&&r.length>0?(B(e!==void 0,14353),r.map(t=>function(i,s){let o=i.updateTime?We(i.updateTime):We(s);return o.isEqual(z.min())&&(o=We(s)),new Gh(o,i.transformResults||[])}(t,e))):[]}function uI(r,e){return{documents:[oI(r,e.path)]}}function lI(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=oI(r,i);let s=function(h){if(h.length!==0)return fI(se.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(f=>function(y){return{field:Xr(y.field),direction:TP(y.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=Jh(r,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{gt:t,parent:i}}function hI(r){let e=aI(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){B(n===1,65062);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(g){let y=dI(g);return y instanceof se&&Ef(y)?y.getFilters():[y]}(t.where));let o=[];t.orderBy&&(o=function(g){return g.map(y=>function(N){return new fr(Zr(N.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(y))}(t.orderBy));let c=null;t.limit&&(c=function(g){let y;return y=typeof g=="object"?g.value:g,Qc(y)?null:y}(t.limit));let u=null;t.startAt&&(u=function(g){let y=!!g.before,A=g.values||[];return new Dt(A,y)}(t.startAt));let h=null;return t.endAt&&(h=function(g){let y=!g.before,A=g.values||[];return new Dt(A,y)}(t.endAt)),XS(e,i,o,s,c,"F",u,h)}function EP(r,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function dI(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=Zr(t.unaryFilter.field);return Z.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Zr(t.unaryFilter.field);return Z.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Zr(t.unaryFilter.field);return Z.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Zr(t.unaryFilter.field);return Z.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}}(r):r.fieldFilter!==void 0?function(t){return Z.create(Zr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return se.create(t.compositeFilter.filters.map(n=>dI(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return F(1026)}}(t.compositeFilter.op))}(r):F(30097,{filter:r})}function TP(r){return mP[r]}function AP(r){return gP[r]}function RP(r){return _P[r]}function Xr(r){return{fieldPath:r.canonicalString()}}function Zr(r){return Ee.fromServerFormat(r.fieldPath)}function fI(r){return r instanceof Z?function(t){if(t.op==="=="){if(gy(t.value))return{unaryFilter:{field:Xr(t.field),op:"IS_NAN"}};if(my(t.value))return{unaryFilter:{field:Xr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(gy(t.value))return{unaryFilter:{field:Xr(t.field),op:"IS_NOT_NAN"}};if(my(t.value))return{unaryFilter:{field:Xr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xr(t.field),op:AP(t.op),value:t.value}}}(r):r instanceof se?function(t){let n=t.getFilters().map(i=>fI(i));return n.length===1?n[0]:{compositeFilter:{op:RP(t.op),filters:n}}}(r):F(54877,{filter:r})}function bP(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function pI(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}function SP(r,e){let t;if(e.document)t=vP(r.wt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=L.fromSegments(e.noDocument.path),i=_r(e.noDocument.readTime);t=Ne.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return F(56709);{let n=L.fromSegments(e.unknownDocument.path),i=_r(e.unknownDocument.version);t=Ne.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){let s=new J(i[0],i[1]);return z.fromTimestamp(s)}(e.readTime)),t}function Oy(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:_c(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,o){return{name:pc(s,o.key),fields:o.data.value.mapValue.fields,updateTime:wi(s,o.version.toTimestamp()),createTime:wi(s,o.createTime.toTimestamp())}}(r.wt,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:gr(e.version)};else{if(!e.isUnknownDocument())return F(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:gr(e.version)}}return n}function _c(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function gr(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function _r(r){let e=new J(r.seconds,r.nanoseconds);return z.fromTimestamp(e)}function tr(r,e){let t=(e.baseMutations||[]).map(s=>ed(r.wt,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>ed(r.wt,s)),i=J.fromMillis(e.localWriteTimeMs);return new Hs(e.batchId,i,t,n)}function Ds(r){let e=_r(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?_r(r.lastLimboFreeSnapshotVersion):z.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){let o=s.documents.length;return B(o===1,1966,{count:o}),ot(ho(aI(s.documents[0])))}(r.query):function(s){return ot(hI(s))}(r.query),new Ei(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Te.fromBase64String(r.resumeToken))}function mI(r,e){let t=gr(e.snapshotVersion),n=gr(e.lastLimboFreeSnapshotVersion),i;i=sc(e.target)?uI(r.wt,e.target):lI(r.wt,e.target).gt;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:pr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function gI(r){let e=hI({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?ac(e,e.limit,"L"):e}function lh(r,e){return new Qs(e.largestBatchId,ed(r.wt,e.overlayMutation))}function xy(r,e){let t=e.path.lastSegment();return[r,Be(e.path.popLast()),t]}function Vy(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:gr(n.readTime),documentKey:Be(n.documentKey.path),largestBatchId:n.largestBatchId}}function Ly(r){return Ae(r,Yc)}function My(r){return Ae(r,Jc)}function Ss(r){return Ae(r,Xc)}function PP(r){if(r===0)return 8;let e=0;return r>>4||(e+=4,r<<=4),r>>6||(e+=2,r<<=2),r>>7||(e+=1),e}function Fy(r){let e=64-function(n){let i=0;for(let s=0;s<8;++s){let o=PP(255&n[s]);if(i+=o,o!==8)break}return i}(r);return Math.ceil(e/8)}function In(r,e){let t=r.indexId-e.indexId;return t!==0?t:(t=Uy(r.arrayValue,e.arrayValue),t!==0?t:(t=Uy(r.directionalValue,e.directionalValue),t!==0?t:L.comparator(r.documentKey,e.documentKey)))}function Uy(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}function _I(r){var e,t;if(B(r instanceof Z||r instanceof se,20012),r instanceof Z){if(r instanceof ic){let i=((t=(e=r.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>Z.create(r.field,"==",s)))||[];return se.create(i,"or")}return r}let n=r.filters.map(i=>_I(i));return se.create(n,r.op)}function CP(r){if(r.getFilters().length===0)return[];let e=cd(_I(r));return B(yI(e),7391),od(e)||ad(e)?[e]:e.getFilters()}function od(r){return r instanceof Z}function ad(r){return r instanceof se&&Ef(r)}function yI(r){return od(r)||ad(r)||function(t){if(t instanceof se&&xh(t)){for(let n of t.getFilters())if(!od(n)&&!ad(n))return!1;return!0}return!1}(r)}function cd(r){if(B(r instanceof Z||r instanceof se,34018),r instanceof Z)return r;if(r.filters.length===1)return cd(r.filters[0]);let e=r.filters.map(n=>cd(n)),t=se.create(e,r.op);return t=Ic(t),yI(t)?t:(B(t instanceof se,64498),B(_i(t),40251),B(t.filters.length>1,57927),t.filters.reduce((n,i)=>bf(n,i)))}function bf(r,e){let t;return B(r instanceof Z||r instanceof se,38388),B(e instanceof Z||e instanceof se,25473),t=r instanceof Z?e instanceof Z?function(i,s){return se.create([i,s],"and")}(r,e):By(r,e):e instanceof Z?By(e,r):function(i,s){if(B(i.filters.length>0&&s.filters.length>0,48005),_i(i)&&_i(s))return $v(i,s.getFilters());let o=xh(i)?i:s,c=xh(i)?s:i,u=o.filters.map(h=>bf(h,c));return se.create(u,"or")}(r,e),Ic(t)}function By(r,e){if(_i(e))return $v(e,r.getFilters());{let t=e.filters.map(n=>bf(r,n));return se.create(t,"or")}}function Ic(r){if(B(r instanceof Z||r instanceof se,11850),r instanceof Z)return r;let e=r.getFilters();if(e.length===1)return Ic(e[0]);if(Bv(r))return r;let t=e.map(i=>Ic(i)),n=[];return t.forEach(i=>{i instanceof Z?n.push(i):i instanceof se&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:se.create(n,r.op)}function $y(r){return Ae(r,$s)}function Kr(r){return Ae(r,ec)}function Ps(r){return Ae(r,_f)}function Hr(r){return Ae(r,Za)}function jy(r){B(r.length!==0,28825);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;pf(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new at(e.readTime,e.documentKey,t)}function II(r,e,t){let n=r.store(ft),i=r.store(li),s=[],o=IDBKeyRange.only(t.batchId),c=0,u=n.te({range:o},(f,g,y)=>(c++,y.delete()));s.push(u.next(()=>{B(c===1,47070,{batchId:t.batchId})}));let h=[];for(let f of t.mutations){let g=Ev(e,f.key.path,t.batchId);s.push(i.delete(g)),h.push(f.key)}return S.waitFor(s).next(()=>h)}function wc(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw F(14731);e=r.noDocument}return JSON.stringify(e).length}function wI(r,e,t){let n=Ma(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n),o=!1;return ei(r).te({range:s,ee:!0},(c,u,h)=>{let[f,g,y]=c;f===e&&g===i&&(o=!0),h.done()}).next(()=>o)}function wn(r){return Ae(r,ft)}function ei(r){return Ae(r,li)}function EI(r){return Ae(r,Bs)}function Qr(r){return Ae(r,hi)}function Gy(r){return Ae(r,ur)}function Tn(r){return Ae(r,di)}function Ky([r,e],[t,n]){let i=W(r,t);return i===0?W(e,n):i}function AI(r,e){return new fd(r,e)}function xa(r,e){return Tn(r).put(function(n,i){return{targetId:0,path:Be(n.path),sequenceNumber:i}}(e,r.currentSequenceNumber))}function RI(r){return new md(r)}function Hy(r){return Ae(r,qs)}function Jn(r){return Ae(r,Ja)}function Cs(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Qy(r,e){let t=e.documentKey.path.toArray();return[r,_c(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Yy(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=W(t[s],n[s]),i)return i;return i=W(t.length,n.length),i||(i=W(t[t.length-2],n[n.length-2]),i||W(t[t.length-1],n[n.length-1]))}function Jy(r){r.createObjectStore(di,{keyPath:CS}).createIndex(gf,kS,{unique:!0}),r.createObjectStore(hi,{keyPath:"targetId"}).createIndex(Av,PS,{unique:!0}),r.createObjectStore(ur)}function ks(r){return Ae(r,uo)}function Va(r){return Ae(r,fi)}function NP(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}function bI(r,e,t,n){return new kd(r,e,t,n)}function SI(r,e){return p(this,null,function*(){let t=H(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.Fs(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let o=[],c=[],u=Y();for(let h of i){o.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}for(let h of s){c.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(n,u).next(h=>({Ms:h,removedBatchIds:o,addedBatchIds:c}))})})})}function OP(r,e){let t=H(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.Cs.newChangeBuffer({trackRemovals:!0});return function(c,u,h,f){let g=h.batch,y=g.keys(),A=S.resolve();return y.forEach(N=>{A=A.next(()=>f.getEntry(u,N)).next(D=>{let k=h.docVersions.get(N);B(k!==null,48541),D.version.compareTo(k)<0&&(g.applyToRemoteDocument(D,h),D.isValidDocument()&&(D.setReadTime(h.commitVersion),f.addEntry(D)))})}),A.next(()=>c.mutationQueue.removeMutationBatch(u,g))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let u=Y();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(u=u.add(c.batch.mutations[h].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function PI(r){let e=H(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.ai.getLastRemoteSnapshotVersion(t))}function xP(r,e){let t=H(r),n=e.snapshotVersion,i=t.Ss;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.Cs.newChangeBuffer({trackRemovals:!0});i=t.Ss;let c=[];e.targetChanges.forEach((f,g)=>{let y=i.get(g);if(!y)return;c.push(t.ai.removeMatchingKeys(s,f.removedDocuments,g).next(()=>t.ai.addMatchingKeys(s,f.addedDocuments,g)));let A=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(g)!==null?A=A.withResumeToken(Te.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,n)),i=i.insert(g,A),function(D,k,$){return D.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=DP?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(y,A,f)&&c.push(t.ai.updateTargetData(s,A))});let u=et(),h=Y();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(VP(s,o,e.documentUpdates).next(f=>{u=f.xs,h=f.Os})),!n.isEqual(z.min())){let f=t.ai.getLastRemoteSnapshotVersion(s).next(g=>t.ai.setTargetsMetadata(s,s.currentSequenceNumber,n));c.push(f)}return S.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,h)).next(()=>u)}).then(s=>(t.Ss=i,s))}function VP(r,e,t){let n=Y(),i=Y();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let o=et();return t.forEach((c,u)=>{let h=s.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(z.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):O(Sf,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)}),{xs:o,Os:i}})}function LP(r,e){let t=H(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=cr),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function MP(r,e){let t=H(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.ai.getTargetData(n,e).next(s=>s?(i=s,S.resolve(i)):t.ai.allocateTargetId(n).next(o=>(i=new Ei(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.ai.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.Ss.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ss=t.Ss.insert(n.targetId,n),t.Ds.set(e,n.targetId)),n})}function Nd(r,e,t){return p(this,null,function*(){let n=H(r),i=n.Ss.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,o=>n.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!xn(o))throw o;O(Sf,`Failed to update sequence numbers for target ${e}: ${o}`)}n.Ss=n.Ss.remove(e),n.Ds.delete(i.target)})}function Xy(r,e,t){let n=H(r),i=z.min(),s=Y();return n.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,f){let g=H(u),y=g.Ds.get(f);return y!==void 0?S.resolve(g.Ss.get(y)):g.ai.getTargetData(h,f)}(n,o,ot(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,n.ai.getMatchingKeysForTargetId(o,c.targetId).next(u=>{s=u})}).next(()=>n.bs.getDocumentsMatchingQuery(o,e,t?i:z.min(),t?s:Y())).next(c=>(FP(n,eP(e),c),{documents:c,Ns:s})))}function FP(r,e,t){let n=r.vs.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.vs.set(e,n)}function Od(){return La===null?La=function(){return 268435456+Math.round(2147483648*Math.random())}():La++,"0x"+La.toString(16)}function BP(){return typeof window<"u"?window:null}function ja(){return typeof document<"u"?document:null}function ru(r){return new Yh(r,!0)}function iu(r){return p(this,null,function*(){if(wr(r))for(let e of r.ua)yield e(!0)})}function po(r){return p(this,null,function*(){for(let e of r.ua)yield e(!1)})}function CI(r,e){let t=H(r);t._a.has(e.targetId)||(t._a.set(e.targetId,e),Nf(t)?kf(t):ki(t).b_()&&Cf(t,e))}function Pf(r,e){let t=H(r),n=ki(t);t._a.delete(e),n.b_()&&kI(t,e),t._a.size===0&&(n.b_()?n.v_():wr(t)&&t.la.set("Unknown"))}function Cf(r,e){if(r.ha.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ki(r).U_(e)}function kI(r,e){r.ha.Ke(e),ki(r).K_(e)}function kf(r){r.ha=new Qh({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>r._a.get(e)||null,Pt:()=>r.datastore.serializer.databaseId}),ki(r).start(),r.la.ta()}function Nf(r){return wr(r)&&!ki(r).w_()&&r._a.size>0}function wr(r){return H(r).aa.size===0}function NI(r){r.ha=void 0}function qP(r){return p(this,null,function*(){r.la.set("Online")})}function $P(r){return p(this,null,function*(){r._a.forEach((e,t)=>{Cf(r,e)})})}function jP(r,e){return p(this,null,function*(){NI(r),Nf(r)?(r.la.ia(e),kf(r)):r.la.set("Unknown")})}function zP(r,e,t){return p(this,null,function*(){if(r.la.set("Online"),e instanceof dc&&e.state===2&&e.cause)try{yield function(i,s){return p(this,null,function*(){let o=s.cause;for(let c of s.targetIds)i._a.has(c)&&(yield i.remoteSyncer.rejectListen(c,o),i._a.delete(c),i.ha.removeTarget(c))})}(r,e)}catch(n){O(yr,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield xc(r,n)}else if(e instanceof ii?r.ha.Xe(e):e instanceof hc?r.ha.ot(e):r.ha.nt(e),!t.isEqual(z.min()))try{let n=yield PI(r.localStore);t.compareTo(n)>=0&&(yield function(s,o){let c=s.ha.It(o);return c.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let f=s._a.get(h);f&&s._a.set(h,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,h)=>{let f=s._a.get(u);if(!f)return;s._a.set(u,f.withResumeToken(Te.EMPTY_BYTE_STRING,f.snapshotVersion)),kI(s,u);let g=new Ei(f.target,u,h,f.sequenceNumber);Cf(s,g)}),s.remoteSyncer.applyRemoteEvent(c)}(r,t))}catch(n){O(yr,"Failed to raise snapshot:",n),yield xc(r,n)}})}function xc(r,e,t){return p(this,null,function*(){if(!xn(e))throw e;r.aa.add(1),yield po(r),r.la.set("Offline"),t||(t=()=>PI(r.localStore)),r.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){O(yr,"Retrying IndexedDB access"),yield t(),r.aa.delete(1),yield iu(r)}))})}function DI(r,e){return e().catch(t=>xc(r,t,e))}function mo(r){return p(this,null,function*(){let e=H(r),t=Dn(e),n=e.oa.length>0?e.oa[e.oa.length-1].batchId:cr;for(;GP(e);)try{let i=yield LP(e.localStore,n);if(i===null){e.oa.length===0&&t.v_();break}n=i.batchId,WP(e,i)}catch(i){yield xc(e,i)}OI(e)&&xI(e)})}function GP(r){return wr(r)&&r.oa.length<10}function WP(r,e){r.oa.push(e);let t=Dn(r);t.b_()&&t.W_&&t.G_(e.mutations)}function OI(r){return wr(r)&&!Dn(r).w_()&&r.oa.length>0}function xI(r){Dn(r).start()}function KP(r){return p(this,null,function*(){Dn(r).H_()})}function HP(r){return p(this,null,function*(){let e=Dn(r);for(let t of r.oa)e.G_(t.mutations)})}function QP(r,e,t){return p(this,null,function*(){let n=r.oa.shift(),i=Wh.from(n,e,t);yield DI(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield mo(r)})}function YP(r,e){return p(this,null,function*(){e&&Dn(r).W_&&(yield function(n,i){return p(this,null,function*(){if(function(o){return fP(o)&&o!==C.ABORTED}(i.code)){let s=n.oa.shift();Dn(n).D_(),yield DI(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield mo(n)}})}(r,e)),OI(r)&&xI(r)})}function tv(r,e){return p(this,null,function*(){let t=H(r);t.asyncQueue.verifyOperationInProgress(),O(yr,"RemoteStore received new credentials");let n=wr(t);t.aa.add(3),yield po(t),n&&t.la.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.aa.delete(3),yield iu(t)})}function JP(r,e){return p(this,null,function*(){let t=H(r);e?(t.aa.delete(2),yield iu(t)):e||(t.aa.add(2),yield po(t),t.la.set("Unknown"))})}function ki(r){return r.Pa||(r.Pa=function(t,n,i){let s=H(t);return s.Y_(),new Md(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{jo:qP.bind(null,r),Jo:$P.bind(null,r),Zo:jP.bind(null,r),Q_:zP.bind(null,r)}),r.ua.push(e=>p(this,null,function*(){e?(r.Pa.D_(),Nf(r)?kf(r):r.la.set("Unknown")):(yield r.Pa.stop(),NI(r))}))),r.Pa}function Dn(r){return r.Ta||(r.Ta=function(t,n,i){let s=H(t);return s.Y_(),new Fd(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{jo:()=>Promise.resolve(),Jo:KP.bind(null,r),Zo:YP.bind(null,r),z_:HP.bind(null,r),j_:QP.bind(null,r)}),r.ua.push(e=>p(this,null,function*(){e?(r.Ta.D_(),yield mo(r)):(yield r.Ta.stop(),r.oa.length>0&&(O(yr,`Stopping write stream with ${r.oa.length} pending writes`),r.oa=[]))}))),r.Ta}function Df(r,e){if(ze("AsyncQueue",`${e}: ${r}`),xn(r))return new x(C.UNAVAILABLE,`${e}: ${r}`);throw r}function nv(){return new mt(r=>Gv(r),nu)}function Of(r,e){return p(this,null,function*(){let t=H(r),n=3,i=e.query,s=t.queries.get(i);s?!s.Va()&&e.ma()&&(n=2):(s=new zd,n=e.ma()?0:1);try{switch(n){case 0:s.Aa=yield t.onListen(i,!0);break;case 1:s.Aa=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let c=Df(o,`Initialization of query '${Jr(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.Ra.push(e),e.ga(t.onlineState),s.Aa&&e.pa(s.Aa)&&Vf(t)})}function xf(r,e){return p(this,null,function*(){let t=H(r),n=e.query,i=3,s=t.queries.get(n);if(s){let o=s.Ra.indexOf(e);o>=0&&(s.Ra.splice(o,1),s.Ra.length===0?i=e.ma()?0:1:!s.Va()&&e.ma()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function XP(r,e){let t=H(r),n=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.Ra)c.pa(i)&&(n=!0);o.Aa=i}}n&&Vf(t)}function ZP(r,e,t){let n=H(r),i=n.queries.get(e);if(i)for(let s of i.Ra)s.onError(t);n.queries.delete(e)}function Vf(r){r.fa.forEach(e=>{e.next()})}function e0(r,e,t=!0){return p(this,null,function*(){let n=BI(r),i,s=n.ru.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.eu()):i=yield VI(n,e,t,!0),i})}function t0(r,e){return p(this,null,function*(){let t=BI(r);yield VI(t,e,!0,!1)})}function VI(r,e,t,n){return p(this,null,function*(){let i=yield MP(r.localStore,ot(e)),s=i.targetId,o=r.sharedClientState.addLocalQueryTarget(s,t),c;return n&&(c=yield n0(r,e,s,o==="current",i.resumeToken)),r.isPrimaryClient&&t&&CI(r.remoteStore,i),c})}function n0(r,e,t,n,i){return p(this,null,function*(){r.Pu=(g,y,A)=>function(D,k,$,U){return p(this,null,function*(){let M=k.view.Ga($);M.ys&&(M=yield Xy(D.localStore,k.query,!1).then(({documents:w})=>k.view.Ga(w,M)));let j=U&&U.targetChanges.get(k.targetId),X=U&&U.targetMismatches.get(k.targetId)!=null,G=k.view.applyChanges(M,D.isPrimaryClient,j,X);return sv(D,k.targetId,G.Ya),G.snapshot})}(r,g,y,A);let s=yield Xy(r.localStore,e,!0),o=new Kd(e,s.Ns),c=o.Ga(s.documents),u=Ys.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),h=o.applyChanges(c,r.isPrimaryClient,u);sv(r,t,h.Ya);let f=new Hd(e,t,o);return r.ru.set(e,f),r.iu.has(t)?r.iu.get(t).push(e):r.iu.set(t,[e]),h.snapshot})}function r0(r,e,t){return p(this,null,function*(){let n=H(r),i=n.ru.get(e),s=n.iu.get(i.targetId);if(s.length>1)return n.iu.set(i.targetId,s.filter(o=>!nu(o,e))),void n.ru.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Nd(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Pf(n.remoteStore,i.targetId),Jd(n,i.targetId)}).catch(Ir))):(Jd(n,i.targetId),yield Nd(n.localStore,i.targetId,!0))})}function i0(r,e){return p(this,null,function*(){let t=H(r),n=t.ru.get(e),i=t.iu.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Pf(t.remoteStore,n.targetId))})}function s0(r,e,t){return p(this,null,function*(){let n=qI(r);try{let i=yield function(o,c){let u=H(o),h=J.now(),f=c.reduce((A,N)=>A.add(N.key),Y()),g,y;return u.persistence.runTransaction("Locally write mutations","readwrite",A=>{let N=et(),D=Y();return u.Cs.getEntries(A,f).next(k=>{N=k,N.forEach(($,U)=>{U.isValidDocument()||(D=D.add($))})}).next(()=>u.localDocuments.getOverlayedDocuments(A,N)).next(k=>{g=k;let $=[];for(let U of c){let M=dP(U,g.get(U.key).overlayedDocument);M!=null&&$.push(new gt(U.key,M,Uv(M.value.mapValue),He.exists(!0)))}return u.mutationQueue.addMutationBatch(A,h,$,c)}).next(k=>{y=k;let $=k.applyToLocalDocumentSet(g,D);return u.documentOverlayCache.saveOverlays(A,k.batchId,$)})}).then(()=>({batchId:y.batchId,changes:Hv(g)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,c,u){let h=o.uu[o.currentUser.toKey()];h||(h=new fe(W)),h=h.insert(c,u),o.uu[o.currentUser.toKey()]=h}(n,i.batchId,t),yield go(n,i.changes),yield mo(n.remoteStore)}catch(i){let s=Df(i,"Failed to persist write");t.reject(s)}})}function LI(r,e){return p(this,null,function*(){let t=H(r);try{let n=yield xP(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t._u.get(s);o&&(B(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.tu=!0:i.modifiedDocuments.size>0?B(o.tu,14607):i.removedDocuments.size>0&&(B(o.tu,42227),o.tu=!1))}),yield go(t,n,e)}catch(n){yield Ir(n)}})}function iv(r,e,t){let n=H(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.ru.forEach((s,o)=>{let c=o.view.ga(e);c.snapshot&&i.push(c.snapshot)}),function(o,c){let u=H(o);u.onlineState=c;let h=!1;u.queries.forEach((f,g)=>{for(let y of g.Ra)y.ga(c)&&(h=!0)}),h&&Vf(u)}(n.eventManager,e),i.length&&n.nu.Q_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function o0(r,e,t){return p(this,null,function*(){let n=H(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n._u.get(e),s=i&&i.key;if(s){let o=new fe(L.comparator);o=o.insert(s,Ne.newNoDocument(s,z.min()));let c=Y().add(s),u=new lc(z.min(),new Map,new fe(W),o,c);yield LI(n,u),n.ou=n.ou.remove(s),n._u.delete(e),Mf(n)}else yield Nd(n.localStore,e,!1).then(()=>Jd(n,e,t)).catch(Ir)})}function a0(r,e){return p(this,null,function*(){let t=H(r),n=e.batch.batchId;try{let i=yield OP(t.localStore,e);FI(t,n,null),MI(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield go(t,i)}catch(i){yield Ir(i)}})}function c0(r,e,t){return p(this,null,function*(){let n=H(r);try{let i=yield function(o,c){let u=H(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return u.mutationQueue.lookupMutationBatch(h,c).next(g=>(B(g!==null,37113),f=g.keys(),u.mutationQueue.removeMutationBatch(h,g))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>u.localDocuments.getDocuments(h,f))})}(n.localStore,e);FI(n,e,t),MI(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield go(n,i)}catch(i){yield Ir(i)}})}function MI(r,e){(r.cu.get(e)||[]).forEach(t=>{t.resolve()}),r.cu.delete(e)}function FI(r,e,t){let n=H(r),i=n.uu[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.uu[n.currentUser.toKey()]=i}}function Jd(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.iu.get(e))r.ru.delete(n),t&&r.nu.Tu(n,t);r.iu.delete(e),r.isPrimaryClient&&r.au.Ur(e).forEach(n=>{r.au.containsKey(n)||UI(r,n)})}function UI(r,e){r.su.delete(e.path.canonicalString());let t=r.ou.get(e);t!==null&&(Pf(r.remoteStore,t),r.ou=r.ou.remove(e),r._u.delete(t),Mf(r))}function sv(r,e,t){for(let n of t)n instanceof Mc?(r.au.addReference(n.key,e),u0(r,n)):n instanceof Fc?(O(Lf,"Document no longer in limbo: "+n.key),r.au.removeReference(n.key,e),r.au.containsKey(n.key)||UI(r,n.key)):F(19791,{Iu:n})}function u0(r,e){let t=e.key,n=t.path.canonicalString();r.ou.get(t)||r.su.has(n)||(O(Lf,"New document in limbo: "+t),r.su.add(n),Mf(r))}function Mf(r){for(;r.su.size>0&&r.ou.size<r.maxConcurrentLimboResolutions;){let e=r.su.values().next().value;r.su.delete(e);let t=new L(ie.fromString(e)),n=r.lu.next();r._u.set(n,new Qd(t)),r.ou=r.ou.insert(t,n),CI(r.remoteStore,new Ei(ot(ho(t.path)),n,"TargetPurposeLimboResolution",pt.le))}}function go(r,e,t){return p(this,null,function*(){let n=H(r),i=[],s=[],o=[];n.ru.isEmpty()||(n.ru.forEach((c,u)=>{o.push(n.Pu(u,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){let g=h?!h.fromCache:(f=t==null?void 0:t.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(u.targetId,g?"current":"not-current")}if(h){i.push(h);let g=Pd.Ps(u.targetId,h);s.push(g)}}))}),yield Promise.all(o),n.nu.Q_(i),yield function(u,h){return p(this,null,function*(){let f=H(u);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(h,y=>S.forEach(y.ls,A=>f.persistence.referenceDelegate.addReference(g,y.targetId,A)).next(()=>S.forEach(y.hs,A=>f.persistence.referenceDelegate.removeReference(g,y.targetId,A)))))}catch(g){if(!xn(g))throw g;O(Sf,"Failed to update sequence numbers: "+g)}for(let g of h){let y=g.targetId;if(!g.fromCache){let A=f.Ss.get(y),N=A.snapshotVersion,D=A.withLastLimboFreeSnapshotVersion(N);f.Ss=f.Ss.insert(y,D)}}})}(n.localStore,s))})}function l0(r,e){return p(this,null,function*(){let t=H(r);if(!t.currentUser.isEqual(e)){O(Lf,"User change. New user:",e.toKey());let n=yield SI(t.localStore,e);t.currentUser=e,function(s,o){s.cu.forEach(c=>{c.forEach(u=>{u.reject(new x(C.CANCELLED,o))})}),s.cu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield go(t,n.Ms)}})}function h0(r,e){let t=H(r),n=t._u.get(e);if(n&&n.tu)return Y().add(n.key);{let i=Y(),s=t.iu.get(e);if(!s)return i;for(let o of s){let c=t.ru.get(o);i=i.unionWith(c.view.Wa)}return i}}function BI(r){let e=H(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=LI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=h0.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=o0.bind(null,e),e.nu.Q_=XP.bind(null,e.eventManager),e.nu.Tu=ZP.bind(null,e.eventManager),e}function qI(r){let e=H(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=a0.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=c0.bind(null,e),e}function mh(r,e){return p(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),O(On,"Initializing OfflineComponentProvider");let t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(i=>p(this,null,function*(){n.isEqual(i)||(yield SI(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e})}function ov(r,e){return p(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let t=yield d0(r);O(On,"Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>tv(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>tv(e.remoteStore,i)),r._onlineComponents=e})}function d0(r){return p(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){O(On,"Using user provided OfflineComponentProvider");try{yield mh(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===C.FAILED_PRECONDITION||i.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;oi("Error using user provided cache. Falling back to memory cache: "+t),yield mh(r,new Ff)}}else O(On,"Using default OfflineComponentProvider"),yield mh(r,new Xd(void 0));return r._offlineComponents})}function jI(r){return p(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(O(On,"Using user provided OnlineComponentProvider"),yield ov(r,r._uninitializedComponentsProvider._online)):(O(On,"Using default OnlineComponentProvider"),yield ov(r,new $I))),r._onlineComponents})}function f0(r){return jI(r).then(e=>e.syncEngine)}function Uc(r){return p(this,null,function*(){let e=yield jI(r),t=e.eventManager;return t.onListen=e0.bind(null,e.syncEngine),t.onUnlisten=r0.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=t0.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=i0.bind(null,e.syncEngine),t})}function p0(r,e,t={}){let n=new st;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,c,u,h){let f=new to({next:y=>{f.yu(),o.enqueueAndForget(()=>xf(s,g));let A=y.docs.has(c);!A&&y.fromCache?h.reject(new x(C.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&y.fromCache&&u&&u.source==="server"?h.reject(new x(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new eo(ho(c.path),f,{includeMetadataChanges:!0,Fa:!0});return Of(s,g)}(yield Uc(r),r.asyncQueue,e,t,n)})),n.promise}function m0(r,e,t={}){let n=new st;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,c,u,h){let f=new to({next:y=>{f.yu(),o.enqueueAndForget(()=>xf(s,g)),y.fromCache&&u.source==="server"?h.reject(new x(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new eo(c,f,{includeMetadataChanges:!0,Fa:!0});return Of(s,g)}(yield Uc(r),r.asyncQueue,e,t,n)})),n.promise}function zI(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}function GI(r,e,t){if(!t)throw new x(C.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function g0(r,e,t,n){if(e===!0&&n===!0)throw new x(C.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function cv(r){if(!L.isDocumentKey(r))throw new x(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function uv(r){if(L.isDocumentKey(r))throw new x(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function su(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":F(12329,{type:typeof r})}function Qe(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new x(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=su(r);throw new x(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function _0(r,e){if(e<=0)throw new x(C.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}function KI(r,e,t,n={}){var i;let s=(r=Qe(r,Ri))._getSettings(),o=Object.assign(Object.assign({},s),{emulatorOptions:r._getEmulatorOptions()}),c=`${e}:${t}`;s.host!==WI&&s.host!==c&&oi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u=Object.assign(Object.assign({},s),{host:c,ssl:!1,emulatorOptions:n});if(!$n(u,o)&&(r._setSettings(u),n.mockUserToken)){let h,f;if(typeof n.mockUserToken=="string")h=n.mockUserToken,f=we.MOCK_USER;else{h=Ko(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let g=n.mockUserToken.sub||n.mockUserToken.user_id;if(!g)throw new x(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new we(g)}r._authCredentials=new _h(new za(h,f))}}function HI(r,e,...t){if(r=ne(r),GI("collection","path",e),r instanceof Ri){let n=ie.fromString(e,...t);return uv(n),new Rn(r,null,n)}{if(!(r instanceof qe||r instanceof Rn))throw new x(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(ie.fromString(e,...t));return uv(n),new Rn(r.firestore,null,n)}}function Uf(r,e,...t){if(r=ne(r),arguments.length===1&&(e=Wa.newId()),GI("doc","path",e),r instanceof Ri){let n=ie.fromString(e,...t);return cv(n),new qe(r,null,new L(n))}{if(!(r instanceof qe||r instanceof Rn))throw new x(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(ie.fromString(e,...t));return cv(n),new qe(r.firestore,r instanceof Rn?r.converter:null,new L(n))}}function dv(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}function fv(r){return function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}function QI(r,e,t){t||(t=Gs);let n=$t(r,"firestore");if(n.isInitialized(t)){let i=n.getImmediate({identifier:t}),s=n.getOptions(t);if($n(s,e))return i;throw new x(C.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new x(C.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<TI)throw new x(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:e,instanceIdentifier:t})}function YI(r,e){let t=typeof r=="object"?r:jt(),n=typeof r=="string"?r:e||Gs,i=$t(t,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=Wo("firestore");s&&KI(i,...s)}return i}function ou(r){if(r._terminated)throw new x(C.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||y0(r),r._firestoreClient}function y0(r){var e,t,n;let i=r._freezeSettings(),s=function(c,u,h,f){return new Nh(c,u,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,zI(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new ef(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(c){let u=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(u),_online:u}}(r._componentsProvider))}function JI(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{oc:r})}}function _o(r){let e=r._freezeSettings(),t=ru(r._databaseId);return new rf(r._databaseId,!!e.ignoreUndefinedProperties,t)}function XI(r,e,t,n,i,s={}){let o=r.dc(s.merge||s.mergeFields?2:0,e,t,i);Bf("Data must be an object, but it was:",o,n);let c=ew(n,o),u,h;if(s.merge)u=new Ze(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let y=of(e,g,t);if(!o.contains(y))throw new x(C.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);nw(f,y)||f.push(y)}u=new Ze(f),h=o.fieldTransforms.filter(g=>u.covers(g.field))}else u=null,h=o.fieldTransforms;return new tf(new Ge(c),u,h)}function I0(r,e,t,n){let i=r.dc(1,e,t);Bf("Data must be an object, but it was:",i,n);let s=[],o=Ge.empty();Vn(n,(u,h)=>{let f=qf(e,u,t);h=ne(h);let g=i.hc(f);if(h instanceof jc)s.push(f);else{let y=yo(h,g);y!=null&&(s.push(f),o.set(f,y))}});let c=new Ze(s);return new $c(o,c,i.fieldTransforms)}function w0(r,e,t,n,i,s){let o=r.dc(1,e,t),c=[of(e,n,t)],u=[i];if(s.length%2!=0)throw new x(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<s.length;y+=2)c.push(of(e,s[y])),u.push(s[y+1]);let h=[],f=Ge.empty();for(let y=c.length-1;y>=0;--y)if(!nw(h,c[y])){let A=c[y],N=u[y];N=ne(N);let D=o.hc(A);if(N instanceof jc)h.push(A);else{let k=yo(N,D);k!=null&&(h.push(A),f.set(A,k))}}let g=new Ze(h);return new $c(f,g,o.fieldTransforms)}function ZI(r,e,t,n=!1){return yo(t,r.dc(n?4:3,e))}function yo(r,e){if(tw(r=ne(r)))return Bf("Unsupported field value:",e,r),ew(r,e);if(r instanceof Si)return function(n,i){if(!JI(i.oc))throw i.Tc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Tc(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.cc&&e.oc!==4)throw e.Tc("Nested arrays are not supported");return function(n,i){let s=[],o=0;for(let c of n){let u=yo(c,i.Pc(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=ne(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return aP(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=J.fromDate(n);return{timestampValue:wi(i.serializer,s)}}if(n instanceof J){let s=new J(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:wi(i.serializer,s)}}if(n instanceof ro)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof no)return{bytesValue:iI(i.serializer,n._byteString)};if(n instanceof qe){let s=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw i.Tc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Rf(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof io)return function(o,c){return{mapValue:{fields:{[If]:{stringValue:wf},[mi]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw c.Tc("VectorValues must only contain numeric values.");return Af(c.serializer,h)})}}}}}}(n,i);throw i.Tc(`Unsupported field value: ${su(n)}`)}(r,e)}function ew(r,e){let t={};return Nv(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Vn(r,(n,i)=>{let s=yo(i,e.uc(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function tw(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof J||r instanceof ro||r instanceof no||r instanceof qe||r instanceof Si||r instanceof io)}function Bf(r,e,t){if(!tw(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let n=su(t);throw n==="an object"?e.Tc(r+" a custom object"):e.Tc(r+" "+n)}}function of(r,e,t){if((e=ne(e))instanceof bi)return e._internalPath;if(typeof e=="string")return qf(r,e);throw zc("Field path arguments must be of type string or ",r,!1,void 0,t)}function qf(r,e,t){if(e.search(E0)>=0)throw zc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new bi(...e.split("."))._internalPath}catch{throw zc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function zc(r,e,t,n,i){let s=n&&!n.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${n}`),o&&(u+=` in document ${i}`),u+=")"),new x(C.INVALID_ARGUMENT,c+r+u)}function nw(r,e){return r.some(t=>t.isEqual(e))}function au(r,e){return typeof e=="string"?qf(r,e):e instanceof bi?e._internalPath:e._delegate._internalPath}function rw(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function iw(r,e,...t){let n=[];e instanceof oo&&n.push(e),n=n.concat(t),function(s){let o=s.filter(u=>u instanceof Pi).length,c=s.filter(u=>u instanceof ao).length;if(o>1||o>0&&c>0)throw new x(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}function sw(r,e,t){let n=e,i=au("where",r);return ao._create(i,n,t)}function ow(...r){return r.forEach(e=>gw("or",e)),Pi._create("or",r)}function aw(...r){return r.forEach(e=>gw("and",e)),Pi._create("and",r)}function cw(r,e="asc"){let t=e,n=au("orderBy",r);return cf._create(n,t)}function uw(r){return _0("limit",r),uf._create("limit",r,"F")}function lw(...r){return Gc._create("startAt",r,!0)}function hw(...r){return Gc._create("startAfter",r,!1)}function dw(...r){return Wc._create("endBefore",r,!1)}function fw(...r){return Wc._create("endAt",r,!0)}function pw(r,e,t,n){if(t[0]=ne(t[0]),t[0]instanceof so)return function(s,o,c,u,h){if(!u)throw new x(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let g of ri(s))if(g.field.isKeyField())f.push(dr(o,u.key));else{let y=u.data.field(g.field);if(Zc(y))throw new x(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(y===null){let A=g.field.canonicalString();throw new x(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}f.push(y)}return new Dt(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{let i=_o(r.firestore);return function(o,c,u,h,f,g){let y=o.explicitOrderBy;if(f.length>y.length)throw new x(C.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let A=[];for(let N=0;N<f.length;N++){let D=f[N];if(y[N].field.isKeyField()){if(typeof D!="string")throw new x(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof D}`);if(!Tf(o)&&D.indexOf("/")!==-1)throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${D}' contains a slash.`);let k=o.path.child(ie.fromString(D));if(!L.isDocumentKey(k))throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);let $=new L(k);A.push(dr(c,$))}else{let k=ZI(u,h,D);A.push(k)}}return new Dt(A,g)}(r._query,r.firestore._databaseId,i,e,t,n)}}function pv(r,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new x(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Tf(e)&&t.indexOf("/")!==-1)throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(ie.fromString(t));if(!L.isDocumentKey(n))throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return dr(r,new L(n))}if(t instanceof qe)return dr(r,t._key);throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${su(t)}.`)}function mv(r,e){if(!Array.isArray(r)||r.length===0)throw new x(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mw(r,e){let t=function(i,s){for(let o of i)for(let c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new x(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function gw(r,e){if(!(e instanceof ao||e instanceof Pi))throw new x(C.INVALID_ARGUMENT,`Function ${r}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function _w(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}function T0(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:r})}}function yw(r){r=Qe(r,qe);let e=Qe(r.firestore,yt);return p0(ou(e),r._key).then(t=>Aw(e,r,t))}function vw(r){r=Qe(r,_t);let e=Qe(r.firestore,yt),t=ou(e),n=new co(e);return rw(r._query),m0(t,r._query).then(i=>new Hc(e,n,r,i))}function Iw(r,e,t){r=Qe(r,qe);let n=Qe(r.firestore,yt),i=_w(r.converter,e,t);return cu(n,[XI(_o(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,He.none())])}function ww(r,e,t,...n){r=Qe(r,qe);let i=Qe(r.firestore,yt),s=_o(i),o;return o=typeof(e=ne(e))=="string"||e instanceof bi?w0(s,"updateDoc",r._key,e,t,n):I0(s,"updateDoc",r._key,e),cu(i,[o.toMutation(r._key,He.exists(!0))])}function Ew(r){return cu(Qe(r.firestore,yt),[new Ii(r._key,He.none())])}function Tw(r,e){let t=Qe(r.firestore,yt),n=Uf(r),i=_w(r.converter,e);return cu(t,[XI(_o(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,He.exists(!1))]).then(()=>n)}function $f(r,...e){var t,n,i;r=ne(r);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||fv(e[o])||(s=e[o],o++);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(fv(e[o])){let g=e[o];e[o]=(t=g.next)===null||t===void 0?void 0:t.bind(g),e[o+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),e[o+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let u,h,f;if(r instanceof qe)h=Qe(r.firestore,yt),f=ho(r._key.path),u={next:g=>{e[o]&&e[o](Aw(h,r,g))},error:e[o+1],complete:e[o+2]};else{let g=Qe(r,_t);h=Qe(g.firestore,yt),f=g._query;let y=new co(h);u={next:A=>{e[o]&&e[o](new Hc(h,y,g,A))},error:e[o+1],complete:e[o+2]},rw(r._query)}return function(y,A,N,D){let k=new to(D),$=new eo(A,k,N);return y.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Of(yield Uc(y),$)})),()=>{k.yu(),y.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return xf(yield Uc(y),$)}))}}(ou(h),f,c,u)}function cu(r,e){return function(n,i){let s=new st;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return s0(yield f0(n),i,s)})),s.promise}(ou(r),e)}function Aw(r,e,t){let n=t.docs.get(e._key),i=new co(r);return new Kc(r,i,e._key,n,new or(t.hasPendingWrites,t.fromCache),e.converter)}function Rw(r){return new hf(r)}function A0(r){return new df(r==null?void 0:r.forceOwnership)}function Re(){return new sf("serverTimestamp")}var ny,ry,we,Ci,hr,C,x,st,za,gh,_h,yh,vh,Ih,Ga,wh,Wa,sy,oy,J,z,ay,Ka,ie,vS,Ee,L,Ms,ci,ni,Fs,at,Iv,Ha,S,Xe,Qa,ui,Ah,ar,Rh,cy,Os,bh,Sh,pt,cr,Ya,Zn,uo,zr,Bs,TS,ft,ly,ir,hy,AS,li,Ja,RS,Fa,bS,Tv,SS,qs,Ph,hi,Av,PS,di,CS,gf,kS,Xa,ur,$s,NS,fi,DS,Yc,OS,Jc,xS,_f,VS,Ch,LS,Za,MS,Rv,FS,ec,US,bv,BS,Xc,qS,kh,$S,Sv,jS,yf,zS,Pv,GS,Cv,kv,vf,WS,KS,js,fe,ti,kt,oe,tc,Ze,nc,Te,HS,Dv,Ov,xv,Vv,Nh,Gs,pi,If,Lv,An,wf,mi,Ua,Fv,Ge,Ne,Dt,fr,rc,Z,se,Lh,Mh,Fh,Uh,ic,Bh,qh,$h,Ot,mt,nP,Kv,rP,iP,sP,yi,Pn,Cn,kn,mr,cc,Gh,He,vi,Nn,gt,Ii,uc,Hs,Wh,Qs,Kh,ye,te,Py,pP,Hh,sr,lc,Ys,ii,hc,dc,fc,Qh,mP,gP,_P,Yh,Ei,gc,td,yc,nd,Zt,Wr,rd,id,sd,nr,rr,vc,ud,Js,qy,Oa,ld,zy,vI,Ke,Ec,Ti,hd,Wy,TI,dd,Tc,fd,pd,Ac,md,gd,_d,Rc,yd,vd,Id,Xs,ve,wd,Ed,Td,Ad,Zs,Rd,bc,Sc,bd,En,hh,dh,fh,kP,Sd,Pd,Cd,Pc,Sf,DP,kd,Cc,kc,Dd,Zy,Nc,La,ph,UP,xd,Vd,Ue,Ld,Dc,ev,Oc,Md,Fd,Ud,Bd,qd,yr,$d,jd,Vc,Lc,Ai,zd,Gd,Wd,rv,eo,Mc,Fc,Kd,Lf,Hd,Qd,Yd,Ff,Xd,Zd,$I,to,On,ef,av,WI,lv,Bc,Ri,_t,qe,Rn,hv,qc,yt,no,bi,Si,ro,io,v0,tf,$c,nf,rf,jc,sf,E0,so,af,oo,vr,ao,Pi,cf,uf,Gc,Wc,lf,or,Kc,si,Hc,co,hf,df,bw=Q(()=>{"use strict";jn();ls();Qo();us();ey();ty();ny="@firebase/firestore",ry="4.7.11";we=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};we.UNAUTHENTICATED=new we(null),we.GOOGLE_CREDENTIALS=new we("google-credentials-uid"),we.FIRST_PARTY=new we("first-party-uid"),we.MOCK_USER=new we("mock-user");Ci="11.6.1";hr=new Lr("@firebase/firestore");C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends fn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};st=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};za=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},gh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(we.UNAUTHENTICATED))}shutdown(){}},_h=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},yh=class{constructor(e){this.t=e,this.currentUser=we.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){B(this.o===void 0,42304);let n=this.i,i=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve(),s=new st;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new st,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>p(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},c=u=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new st)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(B(typeof n.accessToken=="string",31837,{l:n}),new za(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return B(e===null||typeof e=="string",2055,{h:e}),new we(e)}},vh=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=we.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Ih=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new vh(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(we.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ga=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},wh=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ke(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){B(this.o===void 0,3512);let n=s=>{s.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,O("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ga(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(B(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ga(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};Wa=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let i=_S(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%62))}return n}};sy=-62135596800,oy=1e6,J=class r{static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*oy);return new r(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<sy)throw new x(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/oy}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-sy;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};z=class r{static fromTimestamp(e){return new r(e)}static min(){return new r(new J(0,0))}static max(){return new r(new J(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};ay="__name__",Ka=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&F(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&F(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=r.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return W(e.length,t.length)}static compareSegments(e,t){let n=r.isNumericId(e),i=r.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?r.extractNumericId(e).compare(r.extractNumericId(t)):Eh(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Jt.fromString(e.substring(4,e.length-2))}},ie=class r extends Ka{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new x(C.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},vS=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ee=class r extends Ka{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return vS.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ay}static keyField(){return new r([ay])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new x(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new x(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new x(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(n+=c,i++):(s(),i++)}if(s(),o)throw new x(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};L=class r{constructor(e){this.path=e}static fromPath(e){return new r(ie.fromString(e))}static fromName(e){return new r(ie.fromString(e).popFirst(5))}static empty(){return new r(ie.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ie.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ie.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new ie(e.slice()))}};Ms=-1,ci=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};ci.UNKNOWN_ID=-1;ni=class{constructor(e,t){this.fieldPath=e,this.kind=t}},Fs=class r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r(0,at.min())}};at=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r(z.min(),L.empty(),Ms)}static max(){return new r(z.max(),L.empty(),Ms)}};Iv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ha=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};S=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},u=>n(u))}),o=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next(f=>{o[h]=f,++c,c===s&&n(o)},f=>i(f))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};Xe="SimpleDb",Qa=class r{static open(e,t,n,i){try{return new r(t,e.transaction(i,n))}catch(s){throw new ar(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new st,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new ar(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{let i=mf(n.target.error);this.S.reject(new ar(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(O(Xe,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Rh(t)}},ui=class r{static delete(e){return O(Xe,"Removing database:",e),er(tl().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Ho())return!1;if(r.F())return!0;let e=Ie(),t=r.M(e),n=0<t&&t<10,i=wv(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,r.M(Ie())===12.2&&ze("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(e){return p(this,null,function*(){return this.db||(O(Xe,"Opening database:",this.name),this.db=yield new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{n(new ar(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?n(new x(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new x(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new ar(e,o))},i.onupgradeneeded=s=>{O(Xe,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${o.version}`);this.B.q(o,i.transaction,s.oldVersion,this.version).next(()=>{O(Xe,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",t=>{let n=t.target;this.L=n.version},{passive:!0})),this.$&&(this.db.onversionchange=t=>this.$(t)),this.db})}U(e){this.$=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return p(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.k(e);let c=Qa.open(this.db,e,s?"readonly":"readwrite",n),u=i(c).next(h=>(c.v(),h)).catch(h=>(c.abort(h),S.reject(h))).toPromise();return u.catch(()=>{}),yield c.D,u}catch(c){let u=c,h=u.name!=="FirebaseError"&&o<3;if(O(Xe,"Transaction failed with error:",u.message,"Retrying:",h),this.close(),!h)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};Ah=class{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return er(this.K.delete())}},ar=class extends x{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};Rh=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(O(Xe,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(O(Xe,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),er(n)}add(e){return O(Xe,"ADD",this.store.name,e,e),er(this.store.add(e))}get(e){return er(this.store.get(e)).next(t=>(t===void 0&&(t=null),O(Xe,"GET",this.store.name,e,t),t))}delete(e){return O(Xe,"DELETE",this.store.name,e),er(this.store.delete(e))}count(){return O(Xe,"COUNT",this.store.name),er(this.store.count())}J(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new S((o,c)=>{s.onerror=u=>{c(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(n),o=[];return this.Y(s,(c,u)=>{o.push(u)}).next(()=>o)}}Z(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new S((i,s)=>{n.onerror=o=>{s(o.target.error)},n.onsuccess=o=>{i(o.target.result)}})}X(e,t){O(Xe,"DELETE ALL",this.store.name);let n=this.options(e,t);n.ee=!1;let i=this.cursor(n);return this.Y(i,(s,o,c)=>c.delete())}te(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.Y(i,t)}ne(e){let t=this.cursor({});return new S((n,i)=>{t.onerror=s=>{let o=mf(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():n()}):n()}})}Y(e,t){let n=[];return new S((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let c=o.target.result;if(!c)return void i();let u=new Ah(c),h=t(c.primaryKey,c.value,u);if(h instanceof S){let f=h.catch(g=>(u.done(),S.reject(g)));n.push(f)}u.isDone?i():u.j===null?c.continue():c.continue(u.j)}}).next(()=>S.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.ee?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};cy=!1;Os="IndexBackfiller",bh=class{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ie(e){O(Os,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>p(this,null,function*(){this.task=null;try{let t=yield this.re.se();O(Os,`Documents written: ${t}`)}catch(t){xn(t)?O(Os,"Ignoring IndexedDB error during index backfill: ",t):yield Ir(t)}yield this.ie(6e4)}))}},Sh=class{constructor(e,t){this.localStore=e,this.persistence=t}se(e=50){return p(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.oe(t,e))})}oe(e,t){let n=new Set,i=t,s=!0;return S.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return O(Os,`Processing collection: ${o}`),this._e(e,o,i).next(c=>{i-=c,n.add(o)});s=!1})).next(()=>t-i)}_e(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ae(i,s)).next(c=>(O(Os,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}ae(e,t){let n=e;return t.changes.forEach((i,s)=>{let o=vv(s);pf(o,n)>0&&(n=o)}),new at(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};pt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ue(i),this.ce=i=>n.writeSequenceNumber(i))}ue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ce&&this.ce(t),t}}r.le=-1;return r})(),cr=-1;Ya="";Zn="remoteDocuments",uo="owner",zr="owner",Bs="mutationQueues",TS="userId",ft="mutations",ly="batchId",ir="userMutationsIndex",hy=["userId","batchId"];AS={},li="documentMutations",Ja="remoteDocumentsV14",RS=["prefixPath","collectionGroup","readTime","documentId"],Fa="documentKeyIndex",bS=["prefixPath","collectionGroup","documentId"],Tv="collectionGroupIndex",SS=["collectionGroup","readTime","prefixPath","documentId"],qs="remoteDocumentGlobal",Ph="remoteDocumentGlobalKey",hi="targets",Av="queryTargetsIndex",PS=["canonicalId","targetId"],di="targetDocuments",CS=["targetId","path"],gf="documentTargetsIndex",kS=["path","targetId"],Xa="targetGlobalKey",ur="targetGlobal",$s="collectionParents",NS=["collectionId","parent"],fi="clientMetadata",DS="clientId",Yc="bundles",OS="bundleId",Jc="namedQueries",xS="name",_f="indexConfiguration",VS="indexId",Ch="collectionGroupIndex",LS="collectionGroup",Za="indexState",MS=["indexId","uid"],Rv="sequenceNumberIndex",FS=["uid","sequenceNumber"],ec="indexEntries",US=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],bv="documentKeyIndex",BS=["indexId","uid","orderedDocumentKey"],Xc="documentOverlays",qS=["userId","collectionPath","documentId"],kh="collectionPathOverlayIndex",$S=["userId","collectionPath","largestBatchId"],Sv="collectionGroupOverlayIndex",jS=["userId","collectionGroup","largestBatchId"],yf="globals",zS="name",Pv=[Bs,ft,li,Zn,hi,uo,ur,di,fi,qs,$s,Yc,Jc],GS=[...Pv,Xc],Cv=[Bs,ft,li,Ja,hi,uo,ur,di,fi,qs,$s,Yc,Jc,Xc],kv=Cv,vf=[...kv,_f,Za,ec],WS=vf,KS=[...vf,yf];js=class extends Ha{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}};fe=class r{constructor(e,t){this.comparator=e,this.root=t||kt.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,kt.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,kt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ti(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ti(this.root,e,this.comparator,!1)}getReverseIterator(){return new ti(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ti(this.root,e,this.comparator,!0)}},ti=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},kt=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n!=null?n:r.RED,this.left=i!=null?i:r.EMPTY,this.right=s!=null?s:r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e!=null?e:this.key,t!=null?t:this.value,n!=null?n:this.color,i!=null?i:this.left,s!=null?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw F(27949);return e+(this.isRed()?0:1)}};kt.EMPTY=null,kt.RED=!0,kt.BLACK=!1;kt.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new kt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};oe=class r{constructor(e){this.comparator=e,this.data=new fe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tc(this.data.getIterator())}getIteratorFrom(e){return new tc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},tc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};Ze=class r{constructor(e){this.fields=e,e.sort(Ee.comparator)}static empty(){return new r([])}unionWith(e){let t=new oe(Ee.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ai(this.fields,e.fields,(t,n)=>t.isEqual(n))}};nc=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};Te=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new nc("Invalid base64 string: "+s):s}}(e);return new r(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Te.EMPTY_BYTE_STRING=new Te("");HS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);Dv="server_timestamp",Ov="__type__",xv="__previous_value__",Vv="__local_write_time__";Nh=class{constructor(e,t,n,i,s,o,c,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h}},Gs="(default)",pi=class r{constructor(e,t){this.projectId=e,this.database=t||Gs}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===Gs}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};If="__type__",Lv="__max__",An={mapValue:{fields:{__type__:{stringValue:Lv}}}},wf="__vector__",mi="value",Ua={nullValue:"NULL_VALUE"};Fv={mapValue:{fields:{[If]:{stringValue:wf},[mi]:{arrayValue:{}}}}};Ge=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!qa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xs(t)}setAll(e){let t=Ee.emptyPath(),n={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,n,i),n={},i=[],t=c.popLast()}o?n[c.lastSegment()]=xs(o):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());qa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Nt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];qa(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Vn(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(xs(this.value))}};Ne=class r{constructor(e,t,n,i,s,o,c){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new r(e,0,z.min(),z.min(),z.min(),Ge.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,z.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,z.min(),z.min(),Ge.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,z.min(),z.min(),Ge.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ge.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ge.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};Dt=class{constructor(e,t){this.position=e,this.inclusive=t}};fr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};rc=class{},Z=class r extends rc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Lh(e,t,n):t==="array-contains"?new Uh(e,n):t==="in"?new ic(e,n):t==="not-in"?new Bh(e,n):t==="array-contains-any"?new qh(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Mh(e,n):new Fh(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Sn(t,this.value)):t!==null&&bn(this.value)===bn(t)&&this.matchesComparison(Sn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},se=class r extends rc{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new r(e,t)}matches(e){return _i(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}};Lh=class extends Z{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},Mh=class extends Z{constructor(e,t){super(e,"in",t),this.keys=zv("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Fh=class extends Z{constructor(e,t){super(e,"not-in",t),this.keys=zv("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};Uh=class extends Z{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ks(t)&&Ws(t.arrayValue,this.value)}},ic=class extends Z{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ws(this.value.arrayValue,t)}},Bh=class extends Z{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ws(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ws(this.value.arrayValue,t)}},qh=class extends Z{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Ks(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Ws(this.value.arrayValue,n))}};$h=class{constructor(e,t=null,n=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.Ie=null}};Ot=class{constructor(e,t=null,n=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}};mt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Vn(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return Nv(this.inner)}size(){return this.innerSize}};nP=new fe(L.comparator);Kv=new fe(L.comparator);rP=new fe(L.comparator),iP=new oe(L.comparator);sP=new oe(W);yi=class{constructor(){this._=void 0}};Pn=class extends yi{},Cn=class extends yi{constructor(e){super(),this.elements=e}};kn=class extends yi{constructor(e){super(),this.elements=e}};mr=class extends yi{constructor(e,t){super(),this.serializer=e,this.Re=t}};cc=class{constructor(e,t){this.field=e,this.transform=t}};Gh=class{constructor(e,t){this.version=e,this.transformResults=t}},He=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};vi=class{};Nn=class extends vi{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},gt=class extends vi{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};Ii=class extends vi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},uc=class extends vi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};Hs=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&hP(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ls(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=Ls(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=Qv();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=tI(o,c);u!==null&&n.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(z.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Y())}isEqual(e){return this.batchId===e.batchId&&ai(this.mutations,e.mutations,(t,n)=>Ry(t,n))&&ai(this.baseMutations,e.baseMutations,(t,n)=>Ry(t,n))}},Wh=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){B(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let i=function(){return rP}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,n[o].version);return new r(e,t,n,i)}};Qs=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};Kh=class{constructor(e,t){this.count=e,this.unchangedNames=t}};(te=ye||(ye={}))[te.OK=0]="OK",te[te.CANCELLED=1]="CANCELLED",te[te.UNKNOWN=2]="UNKNOWN",te[te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",te[te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",te[te.NOT_FOUND=5]="NOT_FOUND",te[te.ALREADY_EXISTS=6]="ALREADY_EXISTS",te[te.PERMISSION_DENIED=7]="PERMISSION_DENIED",te[te.UNAUTHENTICATED=16]="UNAUTHENTICATED",te[te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",te[te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",te[te.ABORTED=10]="ABORTED",te[te.OUT_OF_RANGE=11]="OUT_OF_RANGE",te[te.UNIMPLEMENTED=12]="UNIMPLEMENTED",te[te.INTERNAL=13]="INTERNAL",te[te.UNAVAILABLE=14]="UNAVAILABLE",te[te.DATA_LOSS=15]="DATA_LOSS";Py=null;pP=new Jt([4294967295,4294967295],0);Hh=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new sr(`Invalid padding: ${t}`);if(n<0)throw new sr(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new sr(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new sr(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=Jt.fromNumber(this.pe)}we(e,t,n){let i=e.add(t.multiply(Jt.fromNumber(n)));return i.compare(pP)===1&&(i=new Jt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;let t=Cy(e),[n,i]=ky(t);for(let s=0;s<this.hashCount;s++){let o=this.we(n,i,s);if(!this.be(o))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new r(s,i,t);return n.forEach(c=>o.insert(c)),o}insert(e){if(this.pe===0)return;let t=Cy(e),[n,i]=ky(t);for(let s=0;s<this.hashCount;s++){let o=this.we(n,i,s);this.Se(o)}}Se(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},sr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};lc=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,Ys.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r(z.min(),i,new fe(W),et(),Y())}},Ys=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,Y(),Y(),Y())}};ii=class{constructor(e,t,n,i){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=i}},hc=class{constructor(e,t){this.targetId=e,this.Ce=t}},dc=class{constructor(e,t,n=Te.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},fc=class{constructor(){this.Fe=0,this.Me=Ny(),this.xe=Te.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=Y(),t=Y(),n=Y();return this.Me.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:F(38017,{changeType:s})}}),new Ys(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=Ny()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,B(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}},Qh=class{constructor(e){this.ze=e,this.je=new Map,this.He=et(),this.Je=Da(),this.Ye=Da(),this.Ze=new fe(W)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:F(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((n,i)=>{this.it(i)&&t(i)})}ot(e){let t=e.targetId,n=e.Ce.count,i=this._t(t);if(i){let s=i.target;if(sc(s))if(n===0){let o=new L(s.path);this.tt(t,o,Ne.newNoDocument(o,z.min()))}else B(n===1,20013,{expectedCount:n});else{let o=this.ut(t);if(o!==n){let c=this.ct(e),u=c?this.lt(c,e,o):1;if(u!==0){this.st(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,h)}Py==null||Py.ht(function(f,g,y,A,N){var D,k,$,U,M,j;let X={localCacheCount:f,existenceFilterCount:g.count,databaseId:y.database,projectId:y.projectId},G=g.unchangedNames;return G&&(X.bloomFilter={applied:N===0,hashCount:(D=G==null?void 0:G.hashCount)!==null&&D!==void 0?D:0,bitmapLength:(U=($=(k=G==null?void 0:G.bits)===null||k===void 0?void 0:k.bitmap)===null||$===void 0?void 0:$.length)!==null&&U!==void 0?U:0,padding:(j=(M=G==null?void 0:G.bits)===null||M===void 0?void 0:M.padding)!==null&&j!==void 0?j:0,mightContain:w=>{var _;return(_=A==null?void 0:A.mightContain(w))!==null&&_!==void 0&&_}}),X}(o,e.Ce,this.ze.Pt(),c,u))}}}}ct(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,o,c;try{o=tn(n).toUint8Array()}catch(u){if(u instanceof nc)return oi("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Hh(o,i,s)}catch(u){return oi(u instanceof sr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.pe===0?null:c}lt(e,t,n){return t.Ce.count===n-this.Tt(e,t.targetId)?0:2}Tt(e,t){let n=this.ze.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let o=this.ze.Pt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.tt(t,s,null),i++)}),i}It(e){let t=new Map;this.je.forEach((s,o)=>{let c=this._t(o);if(c){if(s.current&&sc(c.target)){let u=new L(c.target.path);this.Et(u).has(o)||this.dt(o,u)||this.tt(o,u,Ne.newNoDocument(u,e))}s.Le&&(t.set(o,s.qe()),s.Qe())}});let n=Y();this.Ye.forEach((s,o)=>{let c=!0;o.forEachWhile(u=>{let h=this._t(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(s))}),this.He.forEach((s,o)=>o.setReadTime(e));let i=new lc(e,t,this.Ze,this.He,n);return this.He=et(),this.Je=Da(),this.Ye=Da(),this.Ze=new fe(W),i}et(e,t){if(!this.it(e))return;let n=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;let i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new fc,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new oe(W),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new oe(W),this.Je=this.Je.insert(e,t)),t}it(e){let t=this._t(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new fc),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}};mP={asc:"ASCENDING",desc:"DESCENDING"},gP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_P={and:"AND",or:"OR"},Yh=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};Ei=class r{constructor(e,t,n,i,s=z.min(),o=z.min(),c=Te.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};gc=class{constructor(e){this.wt=e}};td=class{getBundleMetadata(e,t){return Ly(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:_r(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return Ly(e).put(function(i){return{bundleId:i.id,createTime:gr(We(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return My(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:gI(s.bundledQuery),readTime:_r(s.readTime)}}(n)})}saveNamedQuery(e,t){return My(e).put(function(i){return{name:i.name,readTime:gr(We(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};yc=class r{constructor(e,t){this.serializer=e,this.userId=t}static bt(e,t){let n=t.uid||"";return new r(e,n)}getOverlay(e,t){return Ss(e).get(xy(this.userId,t)).next(n=>n?lh(this.serializer,n):null)}getOverlays(e,t){let n=Ct();return S.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,o)=>{let c=new Qs(t,o);i.push(this.St(e,c))}),S.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(o=>i.add(Be(o.getCollectionPath())));let s=[];return i.forEach(o=>{let c=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);s.push(Ss(e).X(kh,c))}),S.waitFor(s)}getOverlaysForCollection(e,t,n){let i=Ct(),s=Be(t),o=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ss(e).J(kh,o).next(c=>{for(let u of c){let h=lh(this.serializer,u);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s=Ct(),o,c=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ss(e).te({index:Sv,range:c},(u,h,f)=>{let g=lh(this.serializer,h);s.size()<i||g.largestBatchId===o?(s.set(g.getKey(),g),o=g.largestBatchId):f.done()}).next(()=>s)}St(e,t){return Ss(e).put(function(i,s,o){let[c,u,h]=xy(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:mc(i.wt,o.mutation)}}(this.serializer,this.userId,t))}};nd=class{Dt(e){return Ae(e,yf)}getSessionToken(e){return this.Dt(e).get("sessionToken").next(t=>{let n=t==null?void 0:t.value;return n?Te.fromUint8Array(n):Te.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}};Zt=class{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(de(e.integerValue));else if("doubleValue"in e){let n=de(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),Us(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),typeof n=="string"&&(n=en(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(tn(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?Mv(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):tu(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):F(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let n=e.fields||{};this.Mt(t,55);for(let i of Object.keys(n))this.Nt(i,t),this.Ct(n[i],t)}qt(e,t){var n,i;let s=e.fields||{};this.Mt(t,53);let o=mi,c=((i=(n=s[o].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.Mt(t,15),t.xt(de(c)),this.Nt(o,t),this.Ct(s[o],t)}$t(e,t){let n=e.values||[];this.Mt(t,50);for(let i of n)this.Ct(i,t)}kt(e,t){this.Mt(t,37),L.fromName(e).path.forEach(n=>{this.Mt(t,60),this.Kt(n,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}};Zt.Wt=new Zt;Wr=255;rd=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.zt(n.value),n=t.next();this.jt()}Ht(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Yt()}Zt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.zt(n);else if(n<2048)this.zt(960|n>>>6),this.zt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.zt(480|n>>>12),this.zt(128|63&n>>>6),this.zt(128|63&n);else{let i=t.codePointAt(0);this.zt(240|i>>>18),this.zt(128|63&i>>>12),this.zt(128|63&i>>>6),this.zt(128|63&i)}}this.jt()}Xt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{let i=t.codePointAt(0);this.Jt(240|i>>>18),this.Jt(128|63&i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i)}}this.Yt()}en(e){let t=this.tn(e),n=Fy(t);this.nn(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}rn(e){let t=this.tn(e),n=Fy(t);this.nn(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}sn(){this._n(Wr),this._n(255)}an(){this.un(Wr),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}zt(e){let t=255&e;t===0?(this._n(0),this._n(255)):t===Wr?(this._n(Wr),this._n(0)):this._n(t)}Jt(e){let t=255&e;t===0?(this.un(0),this.un(255)):t===Wr?(this.un(Wr),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},id=class{constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}},sd=class{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}},nr=class{constructor(){this.ln=new rd,this.hn=new id(this.ln),this.Pn=new sd(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return e===0?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}};rr=class r{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}In(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};vc=class{constructor(e){this.En=new oe((t,n)=>Ee.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.An=[];for(let t of e.filters){let n=t;n.isInequality()?this.En=this.En.add(n):this.An.push(n)}}get Rn(){return this.En.size>1}Vn(e){if(B(e.collectionGroup===this.collectionId,49279),this.Rn)return!1;let t=Th(e);if(t!==void 0&&!this.mn(t))return!1;let n=Xn(e),i=new Set,s=0,o=0;for(;s<n.length&&this.mn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.En.size>0){let c=this.En.getIterator().getNext();if(!i.has(c.field.canonicalString())){let u=n[s];if(!this.fn(c,u)||!this.gn(this.dn[o++],u))return!1}++s}for(;s<n.length;++s){let c=n[s];if(o>=this.dn.length||!this.gn(this.dn[o++],c))return!1}return!0}pn(){if(this.Rn)return null;let e=new oe(Ee.comparator),t=[];for(let n of this.An)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new ni(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new ni(n.field,0))}for(let n of this.dn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new ni(n.field,n.dir==="asc"?0:1)));return new ci(ci.UNKNOWN_ID,this.collectionId,t,Fs.empty())}mn(e){for(let t of this.An)if(this.fn(t,e))return!0;return!1}fn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}gn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};ud=class{constructor(){this.yn=new Js}addToCollectionParentIndex(e,t){return this.yn.add(t),S.resolve()}getCollectionParents(e,t){return S.resolve(this.yn.getEntries(t))}addFieldIndex(e,t){return S.resolve()}deleteFieldIndex(e,t){return S.resolve()}deleteAllFieldIndexes(e){return S.resolve()}createTargetIndexes(e,t){return S.resolve()}getDocumentsMatchingTarget(e,t){return S.resolve(null)}getIndexType(e,t){return S.resolve(0)}getFieldIndexes(e,t){return S.resolve([])}getNextCollectionGroupToUpdate(e){return S.resolve(null)}getMinOffset(e,t){return S.resolve(at.min())}getMinOffsetFromCollectionGroup(e,t){return S.resolve(at.min())}updateCollectionGroup(e,t,n){return S.resolve()}updateIndexEntries(e,t){return S.resolve()}},Js=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new oe(ie.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new oe(ie.comparator)).toArray()}};qy="IndexedDbIndexManager",Oa=new Uint8Array(0),ld=class{constructor(e,t){this.databaseId=t,this.wn=new Js,this.bn=new mt(n=>pr(n),(n,i)=>lo(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.wn.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.wn.add(t)});let s={collectionId:n,parent:Be(i)};return $y(e).put(s)}return S.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[yv(t),""],!1,!0);return $y(e).J(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;n.push(Pt(o.parent))}return n})}addFieldIndex(e,t){let n=Ps(e),i=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=n.add(i);if(t.indexState){let o=Hr(e);return s.next(c=>{o.put(Vy(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=Ps(e),i=Hr(e),s=Kr(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Ps(e),n=Kr(e),i=Hr(e);return t.X().next(()=>n.X()).next(()=>i.X())}createTargetIndexes(e,t){return S.forEach(this.Sn(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new vc(n).pn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=Kr(e),i=!0,s=new Map;return S.forEach(this.Sn(t),o=>this.Dn(e,o).next(c=>{i&&(i=!!c),s.set(o,c)})).next(()=>{if(i){let o=Y(),c=[];return S.forEach(s,(u,h)=>{O(qy,`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(u)} to execute ${pr(t)}`);let f=function(M,j){let X=Th(j);if(X===void 0)return null;for(let G of oc(M,X.fieldPath))switch(G.op){case"array-contains-any":return G.value.arrayValue.values||[];case"array-contains":return[G.value]}return null}(h,u),g=function(M,j){let X=new Map;for(let G of Xn(j))for(let w of oc(M,G.fieldPath))switch(w.op){case"==":case"in":X.set(G.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return X.set(G.fieldPath.canonicalString(),w.value),Array.from(X.values())}return null}(h,u),y=function(M,j){let X=[],G=!0;for(let w of Xn(j)){let _=w.kind===0?wy(M,w.fieldPath,M.startAt):Ey(M,w.fieldPath,M.startAt);X.push(_.value),G&&(G=_.inclusive)}return new Dt(X,G)}(h,u),A=function(M,j){let X=[],G=!0;for(let w of Xn(j)){let _=w.kind===0?Ey(M,w.fieldPath,M.endAt):wy(M,w.fieldPath,M.endAt);X.push(_.value),G&&(G=_.inclusive)}return new Dt(X,G)}(h,u),N=this.vn(u,h,y),D=this.vn(u,h,A),k=this.Cn(u,h,g),$=this.Fn(u.indexId,f,N,y.inclusive,D,A.inclusive,k);return S.forEach($,U=>n.Z(U,t.limit).next(M=>{M.forEach(j=>{let X=L.fromSegments(j.documentKey);o.has(X)||(o=o.add(X),c.push(X))})}))}).next(()=>c)}return S.resolve(null)})}Sn(e){let t=this.bn.get(e);return t||(e.filters.length===0?t=[e]:t=CP(se.create(e.filters,"and")).map(n=>jh(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.bn.set(e,t),t)}Fn(e,t,n,i,s,o,c){let u=(t!=null?t.length:1)*Math.max(n.length,s.length),h=u/(t!=null?t.length:1),f=[];for(let g=0;g<u;++g){let y=t?this.Mn(t[g/h]):Oa,A=this.xn(e,y,n[g%h],i),N=this.On(e,y,s[g%h],o),D=c.map(k=>this.xn(e,y,k,!0));f.push(...this.createRange(A,N,D))}return f}xn(e,t,n,i){let s=new rr(e,L.empty(),t,n);return i?s:s.In()}On(e,t,n,i){let s=new rr(e,L.empty(),t,n);return i?s.In():s}Dn(e,t){let n=new vc(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let c of s)n.Vn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let n=2,i=this.Sn(t);return S.forEach(i,s=>this.Dn(e,s).next(o=>{o?n!==0&&o.fields.length<function(u){let h=new oe(Ee.comparator),f=!1;for(let g of u.filters)for(let y of g.getFlattenedFilters())y.field.isKeyField()||(y.op==="array-contains"||y.op==="array-contains-any"?f=!0:h=h.add(y.field));for(let g of u.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&n===2?1:n)}Nn(e,t){let n=new nr;for(let i of Xn(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=n.Tn(i.kind);Zt.Wt.vt(s,o)}return n.cn()}Mn(e){let t=new nr;return Zt.Wt.vt(e,t.Tn(0)),t.cn()}Bn(e,t){let n=new nr;return Zt.Wt.vt(dr(this.databaseId,t),n.Tn(function(s){let o=Xn(s);return o.length===0?0:o[o.length-1].kind}(e))),n.cn()}Cn(e,t,n){if(n===null)return[];let i=[];i.push(new nr);let s=0;for(let o of Xn(e)){let c=n[s++];for(let u of i)if(this.Ln(t,o.fieldPath)&&Ks(c))i=this.kn(i,o,c);else{let h=u.Tn(o.kind);Zt.Wt.vt(c,h)}}return this.qn(i)}vn(e,t,n){return this.Cn(e,t,n.position)}qn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].cn();return t}kn(e,t,n){let i=[...e],s=[];for(let o of n.arrayValue.values||[])for(let c of i){let u=new nr;u.seed(c.cn()),Zt.Wt.vt(o,u.Tn(t.kind)),s.push(u)}return s}Ln(e,t){return!!e.filters.find(n=>n instanceof Z&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=Ps(e),i=Hr(e);return(t?n.J(Ch,IDBKeyRange.bound(t,t)):n.J()).next(s=>{let o=[];return S.forEach(s,c=>i.get([c.indexId,this.uid]).next(u=>{o.push(function(f,g){let y=g?new Fs(g.sequenceNumber,new at(_r(g.readTime),new L(Pt(g.documentKey)),g.largestBatchId)):Fs.empty(),A=f.fields.map(([N,D])=>new ni(Ee.fromServerFormat(N),D));return new ci(f.indexId,f.collectionGroup,A,y)}(c,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:W(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=Ps(e),s=Hr(e);return this.Qn(e).next(o=>i.J(Ch,IDBKeyRange.bound(t,t)).next(c=>S.forEach(c,u=>s.put(Vy(u.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return S.forEach(t,(i,s)=>{let o=n.get(i.collectionGroup);return(o?S.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(c=>(n.set(i.collectionGroup,c),S.forEach(c,u=>this.$n(e,i,u).next(h=>{let f=this.Un(s,u);return h.isEqual(f)?S.resolve():this.Kn(e,s,u,h,f)}))))})}Wn(e,t,n,i){return Kr(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Bn(n,t.key),documentKey:t.key.path.toArray()})}Gn(e,t,n,i){return Kr(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Bn(n,t.key),t.key.path.toArray()])}$n(e,t,n){let i=Kr(e),s=new oe(In);return i.te({index:bv,range:IDBKeyRange.only([n.indexId,this.uid,this.Bn(n,t)])},(o,c)=>{s=s.add(new rr(n.indexId,t,c.arrayValue,c.directionalValue))}).next(()=>s)}Un(e,t){let n=new oe(In),i=this.Nn(t,e);if(i==null)return n;let s=Th(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Ks(o))for(let c of o.arrayValue.values||[])n=n.add(new rr(t.indexId,e.key,this.Mn(c),i))}else n=n.add(new rr(t.indexId,e.key,Oa,i));return n}Kn(e,t,n,i,s){O(qy,"Updating index entries for document '%s'",t.key);let o=[];return function(u,h,f,g,y){let A=u.getIterator(),N=h.getIterator(),D=Gr(A),k=Gr(N);for(;D||k;){let $=!1,U=!1;if(D&&k){let M=f(D,k);M<0?U=!0:M>0&&($=!0)}else D!=null?U=!0:$=!0;$?(g(k),k=Gr(N)):U?(y(D),D=Gr(A)):(D=Gr(A),k=Gr(N))}}(i,s,In,c=>{o.push(this.Wn(e,t,n,c))},c=>{o.push(this.Gn(e,t,n,c))}),S.waitFor(o)}Qn(e){let t=1;return Hr(e).te({index:Rv,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,c)=>In(o,c)).filter((o,c,u)=>!c||In(o,u[c-1])!==0);let i=[];i.push(e);for(let o of n){let c=In(o,e),u=In(o,t);if(c===0)i[0]=e.In();else if(c>0&&u<0)i.push(o),i.push(o.In());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.zn(i[o],i[o+1]))return[];let c=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Oa,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Oa,[]];s.push(IDBKeyRange.bound(c,u))}return s}zn(e,t){return In(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(jy)}getMinOffset(e,t){return S.mapArray(this.Sn(t),n=>this.Dn(e,n).next(i=>i||F(44426))).next(jy)}};zy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},vI=41943040,Ke=class r{static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}};Ke.DEFAULT_COLLECTION_PERCENTILE=10,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ke.DEFAULT=new Ke(vI,Ke.DEFAULT_COLLECTION_PERCENTILE,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ke.DISABLED=new Ke(-1,0,0);Ec=class r{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.jn={}}static bt(e,t,n,i){B(e.uid!=="",64387);let s=e.isAuthenticated()?e.uid:"";return new r(s,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return wn(e).te({index:ir,range:n},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=ei(e),o=wn(e);return o.add({}).next(c=>{B(typeof c=="number",49019);let u=new Hs(c,t,n,i),h=function(A,N,D){let k=D.baseMutations.map(U=>mc(A.wt,U)),$=D.mutations.map(U=>mc(A.wt,U));return{userId:N,batchId:D.batchId,localWriteTimeMs:D.localWriteTime.toMillis(),baseMutations:k,mutations:$}}(this.serializer,this.userId,u),f=[],g=new oe((y,A)=>W(y.canonicalString(),A.canonicalString()));for(let y of i){let A=Ev(this.userId,y.key.path,c);g=g.add(y.key.path.popLast()),f.push(o.put(h)),f.push(s.put(A,AS))}return g.forEach(y=>{f.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.jn[c]=u.keys()}),S.waitFor(f).next(()=>u)})}lookupMutationBatch(e,t){return wn(e).get(t).next(n=>n?(B(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),tr(this.serializer,n)):null)}Hn(e,t){return this.jn[t]?S.resolve(this.jn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.jn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return wn(e).te({index:ir,range:i},(o,c,u)=>{c.userId===this.userId&&(B(c.batchId>=n,47524,{Jn:n}),s=tr(this.serializer,c)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=cr;return wn(e).te({index:ir,range:t,reverse:!0},(i,s,o)=>{n=s.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,cr],[this.userId,Number.POSITIVE_INFINITY]);return wn(e).J(ir,t).next(n=>n.map(i=>tr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=Ma(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return ei(e).te({range:i},(o,c,u)=>{let[h,f,g]=o,y=Pt(f);if(h===this.userId&&t.path.isEqual(y))return wn(e).get(g).next(A=>{if(!A)throw F(61480,{Yn:o,batchId:g});B(A.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:A.userId,batchId:g}),s.push(tr(this.serializer,A))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new oe(W),i=[];return t.forEach(s=>{let o=Ma(this.userId,s.path),c=IDBKeyRange.lowerBound(o),u=ei(e).te({range:c},(h,f,g)=>{let[y,A,N]=h,D=Pt(A);y===this.userId&&s.path.isEqual(D)?n=n.add(N):g.done()});i.push(u)}),S.waitFor(i).next(()=>this.Zn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=Ma(this.userId,n),o=IDBKeyRange.lowerBound(s),c=new oe(W);return ei(e).te({range:o},(u,h,f)=>{let[g,y,A]=u,N=Pt(y);g===this.userId&&n.isPrefixOf(N)?N.length===i&&(c=c.add(A)):f.done()}).next(()=>this.Zn(e,c))}Zn(e,t){let n=[],i=[];return t.forEach(s=>{i.push(wn(e).get(s).next(o=>{if(o===null)throw F(35274,{batchId:s});B(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),n.push(tr(this.serializer,o))}))}),S.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return II(e.he,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Xn(t.batchId)}),S.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Xn(e){delete this.jn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return S.resolve();let n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return ei(e).te({range:n},(s,o,c)=>{if(s[0]===this.userId){let u=Pt(s[1]);i.push(u)}else c.done()}).next(()=>{B(i.length===0,56720,{er:i.map(s=>s.canonicalString())})})})}containsKey(e,t){return wI(e,this.userId,t)}tr(e){return EI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:cr,lastStreamToken:""})}};Ti=class r{constructor(e){this.nr=e}next(){return this.nr+=2,this.nr}static rr(){return new r(0)}static ir(){return new r(-1)}};hd=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.sr(e).next(t=>{let n=new Ti(t.highestTargetId);return t.highestTargetId=n.next(),this._r(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.sr(e).next(t=>z.fromTimestamp(new J(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.sr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.sr(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this._r(e,i)))}addTargetData(e,t){return this.ar(e,t).next(()=>this.sr(e).next(n=>(n.targetCount+=1,this.ur(t,n),this._r(e,n))))}updateTargetData(e,t){return this.ar(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Qr(e).delete(t.targetId)).next(()=>this.sr(e)).next(n=>(B(n.targetCount>0,8065),n.targetCount-=1,this._r(e,n)))}removeTargets(e,t,n){let i=0,s=[];return Qr(e).te((o,c)=>{let u=Ds(c);u.sequenceNumber<=t&&n.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>S.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Qr(e).te((n,i)=>{let s=Ds(i);t(s)})}sr(e){return Gy(e).get(Xa).next(t=>(B(t!==null,2888),t))}_r(e,t){return Gy(e).put(Xa,t)}ar(e,t){return Qr(e).put(mI(this.serializer,t))}ur(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.sr(e).next(t=>t.targetCount)}getTargetData(e,t){let n=pr(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return Qr(e).te({range:i,index:Av},(o,c,u)=>{let h=Ds(c);lo(t,h.target)&&(s=h,u.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=Tn(e);return t.forEach(o=>{let c=Be(o.path);i.push(s.put({targetId:n,path:c})),i.push(this.referenceDelegate.addReference(e,n,o))}),S.waitFor(i)}removeMatchingKeys(e,t,n){let i=Tn(e);return S.forEach(t,s=>{let o=Be(s.path);return S.waitFor([i.delete([n,o]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=Tn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Tn(e),s=Y();return i.te({range:n,ee:!0},(o,c,u)=>{let h=Pt(o[1]),f=new L(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){let n=Be(t.path),i=IDBKeyRange.bound([n],[yv(n)],!1,!0),s=0;return Tn(e).te({index:gf,ee:!0,range:i},([o,c],u,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}Rt(e,t){return Qr(e).get(t).next(n=>n?Ds(n):null)}};Wy="LruGarbageCollector",TI=1048576;dd=class{constructor(e){this.cr=e,this.buffer=new oe(Ky),this.lr=0}hr(){return++this.lr}Pr(e){let t=[e,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();Ky(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},Tc=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Tr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return this.Tr!==null}Ir(e){O(Wy,`Garbage collection scheduled in ${e}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>p(this,null,function*(){this.Tr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){xn(t)?O(Wy,"Ignoring IndexedDB error during garbage collection: ",t):yield Ir(t)}yield this.Ir(3e5)}))}},fd=class{constructor(e,t){this.Er=e,this.params=t}calculateTargetCount(e,t){return this.Er.dr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return S.resolve(pt.le);let n=new dd(t);return this.Er.forEachTarget(e,i=>n.Pr(i.sequenceNumber)).next(()=>this.Er.Ar(e,i=>n.Pr(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Er.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Er.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(zy)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zy):this.Rr(e,t))}getCacheSize(e){return this.Er.getCacheSize(e)}Rr(e,t){let n,i,s,o,c,u,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,o=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(n=g,c=Date.now(),this.removeTargets(e,n,t))).next(g=>(s=g,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(g=>(h=Date.now(),Yr()<=Je.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(c-o)+`ms
	Removed ${s} targets in `+(u-c)+`ms
	Removed ${g} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};pd=class{constructor(e,t){this.db=e,this.garbageCollector=AI(this,t)}dr(e){let t=this.Vr(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Vr(e){let t=0;return this.Ar(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ar(e,t){return this.mr(e,(n,i)=>t(i))}addReference(e,t,n){return xa(e,n)}removeReference(e,t,n){return xa(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return xa(e,t)}gr(e,t){return function(i,s){let o=!1;return EI(i).ne(c=>wI(i,c,s).next(u=>(u&&(o=!0),S.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.mr(e,(o,c)=>{if(c<=t){let u=this.gr(e,o).next(h=>{if(!h)return s++,n.getEntry(e,o).next(()=>(n.removeEntry(o,z.min()),Tn(e).delete(function(g){return[0,Be(g.path)]}(o))))});i.push(u)}}).next(()=>S.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return xa(e,t)}mr(e,t){let n=Tn(e),i,s=pt.le;return n.te({index:gf},([o,c],{path:u,sequenceNumber:h})=>{o===0?(s!==pt.le&&t(new L(Pt(i)),s),s=h,i=u):s=pt.le}).next(()=>{s!==pt.le&&t(new L(Pt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};Ac=class{constructor(){this.changes=new mt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ne.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?S.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};md=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Jn(e).put(n)}removeEntry(e,t,n){return Jn(e).delete(function(s,o){let c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],_c(o),c[c.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.pr(e,n)))}getEntry(e,t){let n=Ne.newInvalidDocument(t);return Jn(e).te({index:Fa,range:IDBKeyRange.only(Cs(t))},(i,s)=>{n=this.yr(t,s)}).next(()=>n)}wr(e,t){let n={size:0,document:Ne.newInvalidDocument(t)};return Jn(e).te({index:Fa,range:IDBKeyRange.only(Cs(t))},(i,s)=>{n={document:this.yr(t,s),size:wc(s)}}).next(()=>n)}getEntries(e,t){let n=et();return this.br(e,t,(i,s)=>{let o=this.yr(i,s);n=n.insert(i,o)}).next(()=>n)}Sr(e,t){let n=et(),i=new fe(L.comparator);return this.br(e,t,(s,o)=>{let c=this.yr(s,o);n=n.insert(s,c),i=i.insert(s,wc(o))}).next(()=>({documents:n,Dr:i}))}br(e,t,n){if(t.isEmpty())return S.resolve();let i=new oe(Yy);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(Cs(i.first()),Cs(i.last())),o=i.getIterator(),c=o.getNext();return Jn(e).te({index:Fa,range:s},(u,h,f)=>{let g=L.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;c&&Yy(c,g)<0;)n(c,null),c=o.getNext();c&&c.isEqual(g)&&(n(c,h),c=o.hasNext()?o.getNext():null),c?f.H(Cs(c)):f.done()}).next(()=>{for(;c;)n(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let o=t.path,c=[o.popLast().toArray(),o.lastSegment(),_c(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Jn(e).J(IDBKeyRange.bound(c,u,!0)).next(h=>{s==null||s.incrementDocumentReadCount(h.length);let f=et();for(let g of h){let y=this.yr(L.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);y.isFoundDocument()&&(fo(t,y)||i.has(y.key))&&(f=f.insert(y.key,y))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=et(),o=Qy(t,n),c=Qy(t,at.max());return Jn(e).te({index:Tv,range:IDBKeyRange.bound(o,c,!0)},(u,h,f)=>{let g=this.yr(L.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new gd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Hy(e).get(Ph).next(t=>(B(!!t,20021),t))}pr(e,t){return Hy(e).put(Ph,t)}yr(e,t){if(t){let n=SP(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(z.min())))return n}return Ne.newInvalidDocument(e)}};gd=class extends Ac{constructor(e,t){super(),this.vr=e,this.trackRemovals=t,this.Cr=new mt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new oe((s,o)=>W(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let c=this.Cr.get(s);if(t.push(this.vr.removeEntry(e,s,c.readTime)),o.isValidDocument()){let u=Oy(this.vr.serializer,o);i=i.add(s.path.popLast());let h=wc(u);n+=h-c.size,t.push(this.vr.addEntry(e,s,u))}else if(n-=c.size,this.trackRemovals){let u=Oy(this.vr.serializer,o.convertToNoDocument(z.min()));t.push(this.vr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.vr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.vr.updateMetadata(e,n)),S.waitFor(t)}getFromCache(e,t){return this.vr.wr(e,t).next(n=>(this.Cr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.vr.Sr(e,t).next(({documents:n,Dr:i})=>(i.forEach((s,o)=>{this.Cr.set(s,{size:o,readTime:n.get(s).readTime})}),n))}};_d=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};Rc=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&Ls(n.mutation,i,Ze.empty(),J.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Y()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Y()){let i=Ct();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let o=Ns();return s.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=Ct();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Y()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,n,i){let s=et(),o=Vs(),c=function(){return Vs()}();return t.forEach((u,h)=>{let f=n.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof gt)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Ls(f.mutation,h,f.mutation.getFieldMask(),J.now())):o.set(h.key,Ze.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var g;return c.set(h,new _d(f,(g=o.get(h))!==null&&g!==void 0?g:null))}),c))}recalculateAndSaveOverlays(e,t){let n=Vs(),i=new fe((o,c)=>o-c),s=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let c of o)c.keys().forEach(u=>{let h=t.get(u);if(h===null)return;let f=n.get(u)||Ze.empty();f=c.applyToLocalView(h,f),n.set(u,f);let g=(i.get(c.batchId)||Y()).add(u);i=i.insert(c.batchId,g)})}).next(()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),h=u.key,f=u.value,g=Qv();f.forEach(y=>{if(!s.has(y)){let A=tI(t.get(y),n.get(y));A!==null&&g.set(y,A),s=s.add(y)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,g))}return S.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(o){return L.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Tf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):S.resolve(Ct()),c=Ms,u=s;return o.next(h=>S.forEach(h,(f,g)=>(c<g.largestBatchId&&(c=g.largestBatchId),s.get(f)?S.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{u=u.insert(f,y)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,u,h,Y())).next(f=>({batchId:c,changes:Hv(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(n=>{let i=Ns();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,o=Ns();return this.indexManager.getCollectionParents(e,s).next(c=>S.forEach(c,u=>{let h=function(g,y){return new Ot(y,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((g,y)=>{o=o.insert(g,y)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(o=>{s.forEach((u,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,Ne.newInvalidDocument(f)))});let c=Ns();return o.forEach((u,h)=>{let f=s.get(u);f!==void 0&&Ls(f.mutation,h,Ze.empty(),J.now()),fo(t,h)&&(c=c.insert(u,h))}),c})}};yd=class{constructor(e){this.serializer=e,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(e,t){return S.resolve(this.Fr.get(t))}saveBundleMetadata(e,t){return this.Fr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:We(i.createTime)}}(t)),S.resolve()}getNamedQuery(e,t){return S.resolve(this.Mr.get(t))}saveNamedQuery(e,t){return this.Mr.set(t.name,function(i){return{name:i.name,query:gI(i.bundledQuery),readTime:We(i.readTime)}}(t)),S.resolve()}};vd=class{constructor(){this.overlays=new fe(L.comparator),this.Or=new Map}getOverlay(e,t){return S.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Ct();return S.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.St(e,t,s)}),S.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Or.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Or.delete(n)),S.resolve()}getOverlaysForCollection(e,t,n){let i=Ct(),s=t.length+1,o=new L(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>n&&i.set(u.getKey(),u)}return S.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new fe((h,f)=>h-f),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);f===null&&(f=Ct(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let c=Ct(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,f)=>c.set(h,f)),!(c.size()>=i)););return S.resolve(c)}St(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let o=this.Or.get(i.largestBatchId).delete(n.key);this.Or.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new Qs(t,n));let s=this.Or.get(t);s===void 0&&(s=Y(),this.Or.set(t,s)),this.Or.set(t,s.add(n.key))}};Id=class{constructor(){this.sessionToken=Te.EMPTY_BYTE_STRING}getSessionToken(e){return S.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,S.resolve()}};Xs=class{constructor(){this.Nr=new oe(ve.Br),this.Lr=new oe(ve.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(e,t){let n=new ve(e,t);this.Nr=this.Nr.add(n),this.Lr=this.Lr.add(n)}qr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Qr(new ve(e,t))}$r(e,t){e.forEach(n=>this.removeReference(n,t))}Ur(e){let t=new L(new ie([])),n=new ve(t,e),i=new ve(t,e+1),s=[];return this.Lr.forEachInRange([n,i],o=>{this.Qr(o),s.push(o.key)}),s}Kr(){this.Nr.forEach(e=>this.Qr(e))}Qr(e){this.Nr=this.Nr.delete(e),this.Lr=this.Lr.delete(e)}Wr(e){let t=new L(new ie([])),n=new ve(t,e),i=new ve(t,e+1),s=Y();return this.Lr.forEachInRange([n,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new ve(e,0),n=this.Nr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},ve=class{constructor(e,t){this.key=e,this.Gr=t}static Br(e,t){return L.comparator(e.key,t.key)||W(e.Gr,t.Gr)}static kr(e,t){return W(e.Gr,t.Gr)||L.comparator(e.key,t.key)}};wd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Jn=1,this.zr=new oe(ve.Br)}checkEmpty(e){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Hs(s,t,n,i);this.mutationQueue.push(o);for(let c of i)this.zr=this.zr.add(new ve(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return S.resolve(o)}lookupMutationBatch(e,t){return S.resolve(this.jr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.Hr(n),s=i<0?0:i;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?cr:this.Jn-1)}getAllMutationBatches(e){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new ve(t,0),i=new ve(t,Number.POSITIVE_INFINITY),s=[];return this.zr.forEachInRange([n,i],o=>{let c=this.jr(o.Gr);s.push(c)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new oe(W);return t.forEach(i=>{let s=new ve(i,0),o=new ve(i,Number.POSITIVE_INFINITY);this.zr.forEachInRange([s,o],c=>{n=n.add(c.Gr)})}),S.resolve(this.Jr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;L.isDocumentKey(s)||(s=s.child(""));let o=new ve(new L(s),0),c=new oe(W);return this.zr.forEachWhile(u=>{let h=u.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(c=c.add(u.Gr)),!0)},o),S.resolve(this.Jr(c))}Jr(e){let t=[];return e.forEach(n=>{let i=this.jr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){B(this.Yr(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.zr;return S.forEach(t.mutations,i=>{let s=new ve(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.zr=n})}Xn(e){}containsKey(e,t){let n=new ve(t,0),i=this.zr.firstAfterOrEqual(n);return S.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,S.resolve()}Yr(e,t){return this.Hr(e)}Hr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}jr(e){let t=this.Hr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};Ed=class{constructor(e){this.Zr=e,this.docs=function(){return new fe(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,o=this.Zr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return S.resolve(n?n.document.mutableCopy():Ne.newInvalidDocument(t))}getEntries(e,t){let n=et();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Ne.newInvalidDocument(i))}),S.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=et(),o=t.path,c=new L(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:h,value:{document:f}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||pf(vv(f),n)<=0||(i.has(f.key)||fo(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(e,t,n,i){F(9500)}Xr(e,t){return S.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Td(this)}getSize(e){return S.resolve(this.size)}},Td=class extends Ac{constructor(e){super(),this.vr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.vr.addEntry(e,i)):this.vr.removeEntry(n)}),S.waitFor(t)}getFromCache(e,t){return this.vr.getEntry(e,t)}getAllFromCache(e,t){return this.vr.getEntries(e,t)}};Ad=class{constructor(e){this.persistence=e,this.ei=new mt(t=>pr(t),lo),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.ti=0,this.ni=new Xs,this.targetCount=0,this.ri=Ti.rr()}forEachTarget(e,t){return this.ei.forEach((n,i)=>t(i)),S.resolve()}getLastRemoteSnapshotVersion(e){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return S.resolve(this.ti)}allocateTargetId(e){return this.highestTargetId=this.ri.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ti&&(this.ti=t),S.resolve()}ar(e){this.ei.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ri=new Ti(t),this.highestTargetId=t),e.sequenceNumber>this.ti&&(this.ti=e.sequenceNumber)}addTargetData(e,t){return this.ar(t),this.targetCount+=1,S.resolve()}updateTargetData(e,t){return this.ar(t),S.resolve()}removeTargetData(e,t){return this.ei.delete(t.target),this.ni.Ur(t.targetId),this.targetCount-=1,S.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.ei.forEach((o,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.ei.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),S.waitFor(s).next(()=>i)}getTargetCount(e){return S.resolve(this.targetCount)}getTargetData(e,t){let n=this.ei.get(t)||null;return S.resolve(n)}addMatchingKeys(e,t,n){return this.ni.qr(t,n),S.resolve()}removeMatchingKeys(e,t,n){this.ni.$r(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),S.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.ni.Ur(t),S.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ni.Wr(t);return S.resolve(n)}containsKey(e,t){return S.resolve(this.ni.containsKey(t))}};Zs=class{constructor(e,t){this.ii={},this.overlays={},this.si=new pt(0),this.oi=!1,this.oi=!0,this._i=new Id,this.referenceDelegate=e(this),this.ai=new Ad(this),this.indexManager=new ud,this.remoteDocumentCache=function(i){return new Ed(i)}(n=>this.referenceDelegate.ui(n)),this.serializer=new gc(t),this.ci=new yd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new vd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ii[e.toKey()];return n||(n=new wd(t,this.referenceDelegate),this.ii[e.toKey()]=n),n}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(e,t,n){O("MemoryPersistence","Starting transaction:",e);let i=new Rd(this.si.next());return this.referenceDelegate.li(),n(i).next(s=>this.referenceDelegate.hi(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Pi(e,t){return S.or(Object.values(this.ii).map(n=>()=>n.containsKey(e,t)))}},Rd=class extends Ha{constructor(e){super(),this.currentSequenceNumber=e}},bc=class r{constructor(e){this.persistence=e,this.Ti=new Xs,this.Ii=null}static Ei(e){return new r(e)}get di(){if(this.Ii)return this.Ii;throw F(60996)}addReference(e,t,n){return this.Ti.addReference(n,t),this.di.delete(n.toString()),S.resolve()}removeReference(e,t,n){return this.Ti.removeReference(n,t),this.di.add(n.toString()),S.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),S.resolve()}removeTarget(e,t){this.Ti.Ur(t.targetId).forEach(i=>this.di.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.di.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}li(){this.Ii=new Set}hi(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.di,n=>{let i=L.fromPath(n);return this.Ai(e,i).next(s=>{s||t.removeEntry(i,z.min())})}).next(()=>(this.Ii=null,t.apply(e)))}updateLimboDocument(e,t){return this.Ai(e,t).next(n=>{n?this.di.delete(t.toString()):this.di.add(t.toString())})}ui(e){return 0}Ai(e,t){return S.or([()=>S.resolve(this.Ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Pi(e,t)])}},Sc=class r{constructor(e,t){this.persistence=e,this.Ri=new mt(n=>Be(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=AI(this,t)}static Ei(e,t){return new r(e,t)}li(){}hi(e){return S.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.Vr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Vr(e){let t=0;return this.Ar(e,n=>{t++}).next(()=>t)}Ar(e,t){return S.forEach(this.Ri,(n,i)=>this.gr(e,n,i).next(s=>s?S.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.Xr(e,o=>this.gr(e,o,t).next(c=>{c||(n++,s.removeEntry(o,z.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.Ri.set(t,e.currentSequenceNumber),S.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),S.resolve()}removeReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),S.resolve()}updateLimboDocument(e,t){return this.Ri.set(t,e.currentSequenceNumber),S.resolve()}ui(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ba(e.data.value)),t}gr(e,t,n){return S.or([()=>this.persistence.Pi(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.Ri.get(t);return S.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};bd=class{constructor(e){this.serializer=e}q(e,t,n,i){let s=new Qa("createOrUpgrade",t);n<1&&i>=1&&(function(u){u.createObjectStore(uo)}(e),function(u){u.createObjectStore(Bs,{keyPath:TS}),u.createObjectStore(ft,{keyPath:ly,autoIncrement:!0}).createIndex(ir,hy,{unique:!0}),u.createObjectStore(li)}(e),Jy(e),function(u){u.createObjectStore(Zn)}(e));let o=S.resolve();return n<3&&i>=3&&(n!==0&&(function(u){u.deleteObjectStore(di),u.deleteObjectStore(hi),u.deleteObjectStore(ur)}(e),Jy(e)),o=o.next(()=>function(u){let h=u.store(ur),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return h.put(Xa,f)}(s))),n<4&&i>=4&&(n!==0&&(o=o.next(()=>function(u,h){return h.store(ft).J().next(g=>{u.deleteObjectStore(ft),u.createObjectStore(ft,{keyPath:ly,autoIncrement:!0}).createIndex(ir,hy,{unique:!0});let y=h.store(ft),A=g.map(N=>y.put(N));return S.waitFor(A)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore(fi,{keyPath:DS})})(e)})),n<5&&i>=5&&(o=o.next(()=>this.Vi(s))),n<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore(qs)}(e),this.mi(s)))),n<7&&i>=7&&(o=o.next(()=>this.fi(s))),n<8&&i>=8&&(o=o.next(()=>this.gi(e,s))),n<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&i>=10&&(o=o.next(()=>this.pi(s))),n<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore(Yc,{keyPath:OS})})(e),function(u){u.createObjectStore(Jc,{keyPath:xS})}(e)})),n<12&&i>=12&&(o=o.next(()=>{(function(u){let h=u.createObjectStore(Xc,{keyPath:qS});h.createIndex(kh,$S,{unique:!1}),h.createIndex(Sv,jS,{unique:!1})})(e)})),n<13&&i>=13&&(o=o.next(()=>function(u){let h=u.createObjectStore(Ja,{keyPath:RS});h.createIndex(Fa,bS),h.createIndex(Tv,SS)}(e)).next(()=>this.yi(e,s)).next(()=>e.deleteObjectStore(Zn))),n<14&&i>=14&&(o=o.next(()=>this.wi(e,s))),n<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore(_f,{keyPath:VS,autoIncrement:!0}).createIndex(Ch,LS,{unique:!1}),u.createObjectStore(Za,{keyPath:MS}).createIndex(Rv,FS,{unique:!1}),u.createObjectStore(ec,{keyPath:US}).createIndex(bv,BS,{unique:!1})}(e))),n<16&&i>=16&&(o=o.next(()=>{t.objectStore(Za).clear()}).next(()=>{t.objectStore(ec).clear()})),n<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore(yf,{keyPath:zS})})(e)})),o}mi(e){let t=0;return e.store(Zn).te((n,i)=>{t+=wc(i)}).next(()=>{let n={byteSize:t};return e.store(qs).put(Ph,n)})}Vi(e){let t=e.store(Bs),n=e.store(ft);return t.J().next(i=>S.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,cr],[s.userId,s.lastAcknowledgedBatchId]);return n.J(ir,o).next(c=>S.forEach(c,u=>{B(u.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});let h=tr(this.serializer,u);return II(e,s.userId,h).next(()=>{})}))}))}fi(e){let t=e.store(di),n=e.store(Zn);return e.store(ur).get(Xa).next(i=>{let s=[];return n.te((o,c)=>{let u=new ie(o),h=function(g){return[0,Be(g)]}(u);s.push(t.get(h).next(f=>f?S.resolve():(g=>t.put({targetId:0,path:Be(g),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>S.waitFor(s))})}gi(e,t){e.createObjectStore($s,{keyPath:NS});let n=t.store($s),i=new Js,s=o=>{if(i.add(o)){let c=o.lastSegment(),u=o.popLast();return n.put({collectionId:c,parent:Be(u)})}};return t.store(Zn).te({ee:!0},(o,c)=>{let u=new ie(o);return s(u.popLast())}).next(()=>t.store(li).te({ee:!0},([o,c,u],h)=>{let f=Pt(c);return s(f.popLast())}))}pi(e){let t=e.store(hi);return t.te((n,i)=>{let s=Ds(i),o=mI(this.serializer,s);return t.put(o)})}yi(e,t){let n=t.store(Zn),i=[];return n.te((s,o)=>{let c=t.store(Ja),u=function(g){return g.document?new L(ie.fromString(g.document.name).popFirst(5)):g.noDocument?L.fromSegments(g.noDocument.path):g.unknownDocument?L.fromSegments(g.unknownDocument.path):F(36783)}(o).path.toArray(),h={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(c.put(h))}).next(()=>S.waitFor(i))}wi(e,t){let n=t.store(ft),i=RI(this.serializer),s=new Zs(bc.Ei,this.serializer.wt);return n.J().next(o=>{let c=new Map;return o.forEach(u=>{var h;let f=(h=c.get(u.userId))!==null&&h!==void 0?h:Y();tr(this.serializer,u).keys().forEach(g=>f=f.add(g)),c.set(u.userId,f)}),S.forEach(c,(u,h)=>{let f=new we(h),g=yc.bt(this.serializer,f),y=s.getIndexManager(f),A=Ec.bt(f,this.serializer,y,s.referenceDelegate);return new Rc(i,A,g,y).recalculateAndSaveOverlaysForDocumentKeys(new js(t,pt.le),u).next()})})}};En="IndexedDbPersistence",hh=18e5,dh=5e3,fh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",kP="main",Sd=class r{constructor(e,t,n,i,s,o,c,u,h,f,g=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.bi=s,this.window=o,this.document=c,this.Si=h,this.Di=f,this.Ci=g,this.si=null,this.oi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fi=null,this.inForeground=!1,this.Mi=null,this.xi=null,this.Oi=Number.NEGATIVE_INFINITY,this.Ni=y=>Promise.resolve(),!r.C())throw new x(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new pd(this,i),this.Bi=t+kP,this.serializer=new gc(u),this.Li=new ui(this.Bi,this.Ci,new bd(this.serializer)),this._i=new nd,this.ai=new hd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=RI(this.serializer),this.ci=new td,this.window&&this.window.localStorage?this.ki=this.window.localStorage:(this.ki=null,f===!1&&ze(En,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.qi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(C.FAILED_PRECONDITION,fh);return this.Qi(),this.$i(),this.Ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ai.getHighestSequenceNumber(e))}).then(e=>{this.si=new pt(e,this.Si)}).then(()=>{this.oi=!0}).catch(e=>(this.Li&&this.Li.close(),Promise.reject(e)))}Ki(e){return this.Ni=t=>p(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Li.U(t=>p(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.bi.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.qi())})))}qi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Va(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Wi(e).next(t=>{t||(this.isPrimary=!1,this.bi.enqueueRetryable(()=>this.Ni(!1)))})}).next(()=>this.Gi(e)).next(t=>this.isPrimary&&!t?this.zi(e).next(()=>!1):!!t&&this.ji(e).next(()=>!0))).catch(e=>{if(xn(e))return O(En,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return O(En,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.bi.enqueueRetryable(()=>this.Ni(e)),this.isPrimary=e})}Wi(e){return ks(e).get(zr).next(t=>S.resolve(this.Hi(t)))}Ji(e){return Va(e).delete(this.clientId)}Yi(){return p(this,null,function*(){if(this.isPrimary&&!this.Zi(this.Oi,hh)){this.Oi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=Ae(t,fi);return n.J().next(i=>{let s=this.Xi(i,hh),o=i.filter(c=>s.indexOf(c)===-1);return S.forEach(o,c=>n.delete(c.clientId)).next(()=>o)})}).catch(()=>[]);if(this.ki)for(let t of e)this.ki.removeItem(this.es(t.clientId))}})}Ui(){this.xi=this.bi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.qi().then(()=>this.Yi()).then(()=>this.Ui()))}Hi(e){return!!e&&e.ownerId===this.clientId}Gi(e){return this.Di?S.resolve(!0):ks(e).get(zr).next(t=>{if(t!==null&&this.Zi(t.leaseTimestampMs,dh)&&!this.ts(t.ownerId)){if(this.Hi(t)&&this.networkEnabled)return!0;if(!this.Hi(t)){if(!t.allowTabSynchronization)throw new x(C.FAILED_PRECONDITION,fh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Va(e).J().next(n=>this.Xi(n,dh).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,c=this.networkEnabled===i.networkEnabled;if(s||o&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&O(En,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return p(this,null,function*(){this.oi=!1,this.ns(),this.xi&&(this.xi.cancel(),this.xi=null),this.rs(),this.ss(),yield this.Li.runTransaction("shutdown","readwrite",[uo,fi],e=>{let t=new js(e,pt.le);return this.zi(t).next(()=>this.Ji(t))}),this.Li.close(),this._s()})}Xi(e,t){return e.filter(n=>this.Zi(n.updateTimeMs,t)&&!this.ts(n.clientId))}us(){return this.runTransaction("getActiveClients","readonly",e=>Va(e).J().next(t=>this.Xi(t,hh).map(n=>n.clientId)))}get started(){return this.oi}getGlobalsCache(){return this._i}getMutationQueue(e,t){return Ec.bt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ld(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return yc.bt(this.serializer,e)}getBundleCache(){return this.ci}runTransaction(e,t,n){O(En,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===17?KS:u===16?WS:u===15?vf:u===14?kv:u===13?Cv:u===12?GS:u===11?Pv:void F(60245)}(this.Ci),o;return this.Li.runTransaction(e,i,s,c=>(o=new js(c,this.si?this.si.next():pt.le),t==="readwrite-primary"?this.Wi(o).next(u=>!!u||this.Gi(o)).next(u=>{if(!u)throw ze(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.bi.enqueueRetryable(()=>this.Ni(!1)),new x(C.FAILED_PRECONDITION,Iv);return n(o)}).next(u=>this.ji(o).next(()=>u)):this.cs(o).next(()=>n(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}cs(e){return ks(e).get(zr).next(t=>{if(t!==null&&this.Zi(t.leaseTimestampMs,dh)&&!this.ts(t.ownerId)&&!this.Hi(t)&&!(this.Di||this.allowTabSynchronization&&t.allowTabSynchronization))throw new x(C.FAILED_PRECONDITION,fh)})}ji(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ks(e).put(zr,t)}static C(){return ui.C()}zi(e){let t=ks(e);return t.get(zr).next(n=>this.Hi(n)?(O(En,"Releasing primary lease."),t.delete(zr)):S.resolve())}Zi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(ze(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Qi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Mi=()=>{this.bi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.qi()))},this.document.addEventListener("visibilitychange",this.Mi),this.inForeground=this.document.visibilityState==="visible")}rs(){this.Mi&&(this.document.removeEventListener("visibilitychange",this.Mi),this.Mi=null)}$i(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Fi=()=>{this.ns();let t=/(?:Version|Mobile)\/1[456]/;il()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.bi.enterRestrictedMode(!0),this.bi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Fi))}ss(){this.Fi&&(this.window.removeEventListener("pagehide",this.Fi),this.Fi=null)}ts(e){var t;try{let n=((t=this.ki)===null||t===void 0?void 0:t.getItem(this.es(e)))!==null;return O(En,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ze(En,"Failed to get zombied client id.",n),!1}}ns(){if(this.ki)try{this.ki.setItem(this.es(this.clientId),String(Date.now()))}catch(e){ze("Failed to set zombie client id.",e)}}_s(){if(this.ki)try{this.ki.removeItem(this.es(this.clientId))}catch{}}es(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};Pd=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.ls=n,this.hs=i}static Ps(e,t){let n=Y(),i=Y();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};Cd=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};Pc=class{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=function(){return il()?8:wv(Ie())>0?6:4}()}initialize(e,t){this.As=e,this.indexManager=t,this.Ts=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.Rs(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Vs(e,t,i,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Cd;return this.fs(e,t,o).next(c=>{if(s.result=c,this.Is)return this.gs(e,t,o,c.size)})}).next(()=>s.result)}gs(e,t,n,i){return n.documentReadCount<this.Es?(Yr()<=Je.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",Jr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),S.resolve()):(Yr()<=Je.DEBUG&&O("QueryEngine","Query:",Jr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ds*i?(Yr()<=Je.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",Jr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ot(t))):S.resolve())}Rs(e,t){if(Ty(t))return S.resolve(null);let n=ot(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ac(t,null,"F"),n=ot(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let o=Y(...s);return this.As.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,n).next(u=>{let h=this.ps(t,c);return this.ys(t,h,o,u.readTime)?this.Rs(e,ac(t,null,"F")):this.ws(e,h,t,u)}))})))}Vs(e,t,n,i){return Ty(t)||i.isEqual(z.min())?S.resolve(null):this.As.getDocuments(e,n).next(s=>{let o=this.ps(t,s);return this.ys(t,o,n,i)?S.resolve(null):(Yr()<=Je.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Jr(t)),this.ws(e,o,t,IS(i,Ms)).next(c=>c))})}ps(e,t){let n=new oe(Wv(e));return t.forEach((i,s)=>{fo(e,s)&&(n=n.add(s))}),n}ys(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}fs(e,t,n){return Yr()<=Je.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",Jr(t)),this.As.getDocumentsMatchingQuery(e,t,at.min(),n)}ws(e,t,n,i){return this.As.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};Sf="LocalStore",DP=3e8,kd=class{constructor(e,t,n,i){this.persistence=e,this.bs=t,this.serializer=i,this.Ss=new fe(W),this.Ds=new mt(s=>pr(s),lo),this.vs=new Map,this.Cs=e.getRemoteDocumentCache(),this.ai=e.getTargetCache(),this.ci=e.getBundleCache(),this.Fs(n)}Fs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Rc(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ss))}};Cc=class{constructor(){this.activeTargetIds=oP()}$s(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Qs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},kc=class{constructor(){this.So=new Cc,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.So.$s(e),this.Do[e]||"not-current"}updateQueryState(e,t,n){this.Do[e]=t}removeLocalQueryTarget(e){this.So.Us(e)}isLocalQueryTarget(e){return this.So.activeTargetIds.has(e)}clearQueryState(e){delete this.Do[e]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(e){return this.So.activeTargetIds.has(e)}start(){return this.So=new Cc,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};Dd=class{vo(e){}shutdown(){}};Zy="ConnectivityMonitor",Nc=class{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(e){this.Oo.push(e)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){O(Zy,"Network connectivity changed: AVAILABLE");for(let e of this.Oo)e(0)}xo(){O(Zy,"Network connectivity changed: UNAVAILABLE");for(let e of this.Oo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};La=null;ph="RestConnection",UP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},xd=class{get Bo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Lo=t+"://"+e.host,this.ko=`projects/${n}/databases/${i}`,this.qo=this.databaseId.database===Gs?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Qo(e,t,n,i,s){let o=Od(),c=this.$o(e,t.toUriEncodedString());O(ph,`Sending RPC '${e}' ${o}:`,c,n);let u={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};return this.Uo(u,i,s),this.Ko(e,c,u,n).then(h=>(O(ph,`Received RPC '${e}' ${o}: `,h),h),h=>{throw oi(ph,`RPC '${e}' ${o} failed with error: `,h,"url: ",c,"request:",n),h})}Wo(e,t,n,i,s,o){return this.Qo(e,t,n,i,s)}Uo(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ci}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),n&&n.headers.forEach((i,s)=>e[s]=i)}$o(e,t){let n=UP[e];return`${this.Lo}/v1/${t}:${n}`}terminate(){}};Vd=class{constructor(e){this.Go=e.Go,this.zo=e.zo}jo(e){this.Ho=e}Jo(e){this.Yo=e}Zo(e){this.Xo=e}onMessage(e){this.e_=e}close(){this.zo()}send(e){this.Go(e)}t_(){this.Ho()}n_(){this.Yo()}r_(e){this.Xo(e)}i_(e){this.e_(e)}};Ue="WebChannelConnection",Ld=class extends xd{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ko(e,t,n,i){let s=Od();return new Promise((o,c)=>{let u=new sh;u.setWithCredentials(!0),u.listenOnce(oh.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case bs.NO_ERROR:let f=u.getResponseJson();O(Ue,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),o(f);break;case bs.TIMEOUT:O(Ue,`RPC '${e}' ${s} timed out`),c(new x(C.DEADLINE_EXCEEDED,"Request time out"));break;case bs.HTTP_ERROR:let g=u.getStatus();if(O(Ue,`RPC '${e}' ${s} failed with status:`,g,"response text:",u.getResponseText()),g>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);let A=y==null?void 0:y.error;if(A&&A.status&&A.message){let N=function(k){let $=k.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf($)>=0?$:C.UNKNOWN}(A.status);c(new x(N,A.message))}else c(new x(C.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new x(C.UNAVAILABLE,"Connection failed."));break;default:F(9055,{s_:e,streamId:s,o_:u.getLastErrorCode(),__:u.getLastError()})}}finally{O(Ue,`RPC '${e}' ${s} completed.`)}});let h=JSON.stringify(i);O(Ue,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",h,n,15)})}a_(e,t,n){let i=Od(),s=[this.Lo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=uh(),c=ch(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Uo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;let f=s.join("");O(Ue,`Creating RPC '${e}' stream ${i}: ${f}`,u);let g=o.createWebChannel(f,u),y=!1,A=!1,N=new Vd({Go:k=>{A?O(Ue,`Not sending because RPC '${e}' stream ${i} is closed:`,k):(y||(O(Ue,`Opening RPC '${e}' stream ${i} transport.`),g.open(),y=!0),O(Ue,`RPC '${e}' stream ${i} sending:`,k),g.send(k))},zo:()=>g.close()}),D=(k,$,U)=>{k.listen($,M=>{try{U(M)}catch(j){setTimeout(()=>{throw j},0)}})};return D(g,jr.EventType.OPEN,()=>{A||(O(Ue,`RPC '${e}' stream ${i} transport opened.`),N.t_())}),D(g,jr.EventType.CLOSE,()=>{A||(A=!0,O(Ue,`RPC '${e}' stream ${i} transport closed`),N.r_())}),D(g,jr.EventType.ERROR,k=>{A||(A=!0,oi(Ue,`RPC '${e}' stream ${i} transport errored. Name:`,k.name,"Message:",k.message),N.r_(new x(C.UNAVAILABLE,"The operation could not be completed")))}),D(g,jr.EventType.MESSAGE,k=>{var $;if(!A){let U=k.data[0];B(!!U,16349);let M=U,j=(M==null?void 0:M.error)||(($=M[0])===null||$===void 0?void 0:$.error);if(j){O(Ue,`RPC '${e}' stream ${i} received error:`,j);let X=j.status,G=function(I){let E=ye[I];if(E!==void 0)return rI(E)}(X),w=j.message;G===void 0&&(G=C.INTERNAL,w="Unknown error status: "+X+" with message "+j.message),A=!0,N.r_(new x(G,w)),g.close()}else O(Ue,`RPC '${e}' stream ${i} received:`,U),N.i_(U)}}),D(c,ah.STAT_EVENT,k=>{k.stat===Na.PROXY?O(Ue,`RPC '${e}' stream ${i} detected buffering proxy`):k.stat===Na.NOPROXY&&O(Ue,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.n_()},0),N}};Dc=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.bi=e,this.timerId=t,this.u_=n,this.c_=i,this.l_=s,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(e){this.cancel();let t=Math.floor(this.h_+this.d_()),n=Math.max(0,Date.now()-this.T_),i=Math.max(0,t-n);i>0&&O("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.h_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,i,()=>(this.T_=Date.now(),e())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){this.P_!==null&&(this.P_.skipDelay(),this.P_=null)}cancel(){this.P_!==null&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}};ev="PersistentStream",Oc=class{constructor(e,t,n,i,s,o,c,u){this.bi=e,this.R_=n,this.V_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new Dc(e,t)}w_(){return this.state===1||this.state===5||this.b_()}b_(){return this.state===2||this.state===3}start(){this.p_=0,this.state!==4?this.auth():this.S_()}stop(){return p(this,null,function*(){this.w_()&&(yield this.close(0))})}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&this.f_===null&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(e){this.M_(),this.stream.send(e)}C_(){return p(this,null,function*(){if(this.b_())return this.close(0)})}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}close(e,t){return p(this,null,function*(){this.M_(),this.x_(),this.y_.cancel(),this.m_++,e!==4?this.y_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(ze(t.toString()),ze("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.O_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Zo(t)})}O_(){}auth(){this.state=1;let e=this.N_(this.m_),t=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.m_===t&&this.B_(n,i)},n=>{e(()=>{let i=new x(C.UNKNOWN,"Fetching auth token failed: "+n.message);return this.L_(i)})})}B_(e,t){let n=this.N_(this.m_);this.stream=this.k_(e,t),this.stream.jo(()=>{n(()=>this.listener.jo())}),this.stream.Jo(()=>{n(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(i=>{n(()=>this.L_(i))}),this.stream.onMessage(i=>{n(()=>++this.p_==1?this.q_(i):this.onNext(i))})}S_(){this.state=5,this.y_.E_(()=>p(this,null,function*(){this.state=0,this.start()}))}L_(e){return O(ev,`close with error: ${e}`),this.stream=null,this.close(4,e)}N_(e){return t=>{this.bi.enqueueAndForget(()=>this.m_===e?t():(O(ev,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Md=class extends Oc{constructor(e,t,n,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}k_(e,t){return this.connection.a_("Listen",e,t)}q_(e){return this.onNext(e)}onNext(e){this.y_.reset();let t=IP(this.serializer,e),n=function(s){if(!("targetChange"in s))return z.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?z.min():o.readTime?We(o.readTime):z.min()}(e);return this.listener.Q_(t,n)}U_(e){let t={};t.database=Zh(this.serializer),t.addTarget=function(s,o){let c,u=o.target;if(c=sc(u)?{documents:uI(s,u)}:{query:lI(s,u).gt},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=iI(s,o.resumeToken);let h=Jh(s,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(z.min())>0){c.readTime=wi(s,o.snapshotVersion.toTimestamp());let h=Jh(s,o.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);let n=EP(this.serializer,e);n&&(t.labels=n),this.F_(t)}K_(e){let t={};t.database=Zh(this.serializer),t.removeTarget=e,this.F_(t)}},Fd=class extends Oc{constructor(e,t,n,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(e,t){return this.connection.a_("Write",e,t)}q_(e){return B(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,B(!e.writeResults||e.writeResults.length===0,55816),this.listener.z_()}onNext(e){B(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.y_.reset();let t=wP(e.writeResults,e.commitTime),n=We(e.commitTime);return this.listener.j_(n,t)}H_(){let e={};e.database=Zh(this.serializer),this.F_(e)}G_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>mc(this.serializer,n))};this.F_(t)}};Ud=class{},Bd=class extends Ud{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.J_=!1}Y_(){if(this.J_)throw new x(C.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(e,t,n,i){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Qo(e,Xh(t,n),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(C.UNKNOWN,s.toString())})}Wo(e,t,n,i,s){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Wo(e,Xh(t,n),i,o,c,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new x(C.UNKNOWN,o.toString())})}terminate(){this.J_=!0,this.connection.terminate()}},qd=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){this.Z_===0&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(e){this.state==="Online"?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.na("Offline")))}set(e){this.sa(),this.Z_=0,e==="Online"&&(this.ea=!1),this.na(e)}na(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ra(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(ze(t),this.ea=!1):O("OnlineStateTracker",t)}sa(){this.X_!==null&&(this.X_.cancel(),this.X_=null)}};yr="RemoteStore",$d=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=s,this.ca.vo(o=>{n.enqueueAndForget(()=>p(this,null,function*(){wr(this)&&(O(yr,"Restarting streams for network reachability change."),yield function(u){return p(this,null,function*(){let h=H(u);h.aa.add(4),yield po(h),h.la.set("Unknown"),h.aa.delete(4),yield iu(h)})}(this))}))}),this.la=new qd(n,i)}};jd=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new st,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let o=Date.now()+n,c=new r(e,t,o,i,s);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};Vc=class r{static emptySet(e){return new r(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||L.comparator(t.key,n.key):(t,n)=>L.comparator(t.key,n.key),this.keyedMap=Ns(),this.sortedSet=new fe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};Lc=class{constructor(){this.Ia=new fe(L.comparator)}track(e){let t=e.doc.key,n=this.Ia.get(t);n?e.type!==0&&n.type===3?this.Ia=this.Ia.insert(t,e):e.type===3&&n.type!==1?this.Ia=this.Ia.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.Ia=this.Ia.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.Ia=this.Ia.remove(t):e.type===1&&n.type===2?this.Ia=this.Ia.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):F(63341,{Vt:e,Ea:n}):this.Ia=this.Ia.insert(t,e)}da(){let e=[];return this.Ia.inorderTraversal((t,n)=>{e.push(n)}),e}},Ai=class r{constructor(e,t,n,i,s,o,c,u,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){let o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new r(e,t,Vc.emptySet(t),o,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};zd=class{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(e=>e.ma())}},Gd=class{constructor(){this.queries=nv(),this.onlineState="Unknown",this.fa=new Set}terminate(){(function(t,n){let i=H(t),s=i.queries;i.queries=nv(),s.forEach((o,c)=>{for(let u of c.Ra)u.onError(n)})})(this,new x(C.ABORTED,"Firestore shutting down"))}};(rv=Wd||(Wd={})).ya="default",rv.Cache="cache";eo=class{constructor(e,t,n){this.query=e,this.wa=t,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=n||{}}pa(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new Ai(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ba?this.Da(e)&&(this.wa.next(e),t=!0):this.va(e,this.onlineState)&&(this.Ca(e),t=!0),this.Sa=e,t}onError(e){this.wa.error(e)}ga(e){this.onlineState=e;let t=!1;return this.Sa&&!this.ba&&this.va(this.Sa,e)&&(this.Ca(this.Sa),t=!0),t}va(e,t){if(!e.fromCache||!this.ma())return!0;let n=t!=="Offline";return(!this.options.Fa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Da(e){if(e.docChanges.length>0)return!0;let t=this.Sa&&this.Sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Ca(e){e=Ai.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ba=!0,this.wa.next(e)}ma(){return this.options.source!==Wd.Cache}};Mc=class{constructor(e){this.key=e}},Fc=class{constructor(e){this.key=e}},Kd=class{constructor(e,t){this.query=e,this.qa=t,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=Y(),this.mutatedKeys=Y(),this.Ua=Wv(e),this.Ka=new Vc(this.Ua)}get Wa(){return this.qa}Ga(e,t){let n=t?t.za:new Lc,i=t?t.Ka:this.Ka,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,g)=>{let y=i.get(f),A=fo(this.query,g)?g:null,N=!!y&&this.mutatedKeys.has(y.key),D=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations),k=!1;y&&A?y.data.isEqual(A.data)?N!==D&&(n.track({type:3,doc:A}),k=!0):this.ja(y,A)||(n.track({type:2,doc:A}),k=!0,(u&&this.Ua(A,u)>0||h&&this.Ua(A,h)<0)&&(c=!0)):!y&&A?(n.track({type:0,doc:A}),k=!0):y&&!A&&(n.track({type:1,doc:y}),k=!0,(u||h)&&(c=!0)),k&&(A?(o=o.add(A),s=D?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ka:o,za:n,ys:c,mutatedKeys:s}}ja(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.Ka;this.Ka=e.Ka,this.mutatedKeys=e.mutatedKeys;let o=e.za.da();o.sort((f,g)=>function(A,N){let D=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Vt:k})}};return D(A)-D(N)}(f.type,g.type)||this.Ua(f.doc,g.doc)),this.Ha(n),i=i!=null&&i;let c=t&&!i?this.Ja():[],u=this.$a.size===0&&this.current&&!i?1:0,h=u!==this.Qa;return this.Qa=u,o.length!==0||h?{snapshot:new Ai(this.query,e.Ka,s,o,e.mutatedKeys,u===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ya:c}:{Ya:c}}ga(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new Lc,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(e){return!this.qa.has(e)&&!!this.Ka.has(e)&&!this.Ka.get(e).hasLocalMutations}Ha(e){e&&(e.addedDocuments.forEach(t=>this.qa=this.qa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qa=this.qa.delete(t)),this.current=e.current)}Ja(){if(!this.current)return[];let e=this.$a;this.$a=Y(),this.Ka.forEach(n=>{this.Za(n.key)&&(this.$a=this.$a.add(n.key))});let t=[];return e.forEach(n=>{this.$a.has(n)||t.push(new Fc(n))}),this.$a.forEach(n=>{e.has(n)||t.push(new Mc(n))}),t}Xa(e){this.qa=e.Ns,this.$a=Y();let t=this.Ga(e.documents);return this.applyChanges(t,!0)}eu(){return Ai.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,this.Qa===0,this.hasCachedResults)}},Lf="SyncEngine",Hd=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Qd=class{constructor(e){this.key=e,this.tu=!1}},Yd=class{constructor(e,t,n,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.nu={},this.ru=new mt(c=>Gv(c),nu),this.iu=new Map,this.su=new Set,this.ou=new fe(L.comparator),this._u=new Map,this.au=new Xs,this.uu={},this.cu=new Map,this.lu=Ti.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return this.hu===!0}};Ff=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=ru(t.databaseInfo.databaseId),this.sharedClientState=this.Au(t),this.persistence=this.Ru(t),yield this.persistence.start(),this.localStore=this.Vu(t),this.gcScheduler=this.mu(t,this.localStore),this.indexBackfillerScheduler=this.fu(t,this.localStore)})}mu(t,n){return null}fu(t,n){return null}Vu(t){return bI(this.persistence,new Pc,t.initialUser,this.serializer)}Ru(t){return new Zs(bc.Ei,this.serializer)}Au(t){return new kc}terminate(){return p(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),Xd=class extends Ff{constructor(e){super(),this.cacheSizeBytes=e}mu(e,t){B(this.persistence.referenceDelegate instanceof Sc,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new Tc(n,e.asyncQueue,t)}Ru(e){let t=this.cacheSizeBytes!==void 0?Ke.withCacheSize(this.cacheSizeBytes):Ke.DEFAULT;return new Zs(n=>Sc.Ei(n,t),this.serializer)}},Zd=class r extends Ff{constructor(e,t,n){super(),this.gu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return p(this,null,function*(){yield Bt(r.prototype,this,"initialize").call(this,e),yield this.gu.initialize(this,e),yield qI(this.gu.syncEngine),yield mo(this.gu.remoteStore),yield this.persistence.Ki(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}Vu(e){return bI(this.persistence,new Pc,e.initialUser,this.serializer)}mu(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new Tc(n,e.asyncQueue,t)}fu(e,t){let n=new Sh(t,this.persistence);return new bh(e.asyncQueue,n)}Ru(e){let t=NP(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Ke.withCacheSize(this.cacheSizeBytes):Ke.DEFAULT;return new Sd(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,BP(),ja(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Au(e){return new kc}},$I=(()=>{class r{initialize(t,n){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>iv(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=l0.bind(null,this.syncEngine),yield JP(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Gd}()}createDatastore(t){let n=ru(t.databaseInfo.databaseId),i=function(o){return new Ld(o)}(t.databaseInfo);return function(o,c,u,h){return new Bd(o,c,u,h)}(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return function(i,s,o,c,u){return new $d(i,s,o,c,u)}(this.localStore,this.datastore,t.asyncQueue,n=>iv(this.syncEngine,n,0),function(){return Nc.C()?new Nc:new Dd}())}createSyncEngine(t,n){return function(s,o,c,u,h,f,g){let y=new Yd(s,o,c,u,h,f);return g&&(y.hu=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return p(this,null,function*(){var t,n;yield function(s){return p(this,null,function*(){let o=H(s);O(yr,"RemoteStore shutting down."),o.aa.add(5),yield po(o),o.ca.shutdown(),o.la.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();to=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.pu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.pu(this.observer.error,e):ze("Uncaught Error in snapshot listener:",e.toString()))}yu(){this.muted=!0}pu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};On="FirestoreClient",ef=class{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=we.UNAUTHENTICATED,this.clientId=Wa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,o=>p(this,null,function*(){O(On,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,o=>(O(On,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new st;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=Df(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};av=new Map;WI="firestore.googleapis.com",lv=!0,Bc=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new x(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=WI,this.ssl=lv}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:lv;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=vI;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<TI)throw new x(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}g0("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=zI((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Ri=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Bc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Bc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new gh;switch(n.type){case"firstParty":return new Ih(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return p(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=av.get(t);n&&(O("ComponentProvider","Removing Datastore"),av.delete(t),n.terminate())}(this),Promise.resolve()}};_t=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},qe=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}},Rn=class r extends _t{constructor(e,t,n){super(e,t,ho(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new qe(this.firestore,null,new L(e))}withConverter(e){return new r(this.firestore,e,this._path)}};hv="AsyncQueue",qc=class{constructor(e=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new Dc(this,"async_queue_retry"),this.ju=()=>{let n=ja();n&&O(hv,"Visibility state changed to "+n.visibilityState),this.y_.A_()},this.Hu=e;let t=ja();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ju(),this.Yu(e)}enterRestrictedMode(e){if(!this.$u){this.$u=!0,this.Gu=e||!1;let t=ja();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.ju)}}enqueue(e){if(this.Ju(),this.$u)return new Promise(()=>{});let t=new st;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qu.push(e),this.Zu()))}Zu(){return p(this,null,function*(){if(this.Qu.length!==0){try{yield this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(e){if(!xn(e))throw e;O(hv,"Operation failed with retryable error: "+e)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}})}Yu(e){let t=this.Hu.then(()=>(this.Wu=!0,e().catch(n=>{throw this.Ku=n,this.Wu=!1,ze("INTERNAL UNHANDLED ERROR: ",dv(n)),n}).then(n=>(this.Wu=!1,n))));return this.Hu=t,t}enqueueAfterDelay(e,t,n){this.Ju(),this.zu.indexOf(e)>-1&&(t=0);let i=jd.createAndSchedule(this,e,t,n,s=>this.Xu(s));return this.Uu.push(i),i}Ju(){this.Ku&&F(47125,{ec:dv(this.Ku)})}verifyOperationInProgress(){}tc(){return p(this,null,function*(){let e;do e=this.Hu,yield e;while(e!==this.Hu)})}nc(e){for(let t of this.Uu)if(t.timerId===e)return!0;return!1}rc(e){return this.tc().then(()=>{this.Uu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.Uu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.tc()})}sc(e){this.zu.push(e)}Xu(e){let t=this.Uu.indexOf(e);this.Uu.splice(t,1)}};yt=class extends Ri{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new qc,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}_terminate(){return p(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new qc(e),this._firestoreClient=void 0,yield e}})}};no=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(Te.fromBase64String(e))}catch(t){throw new x(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(Te.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};bi=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ee(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};Si=class{constructor(e){this._methodName=e}};ro=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}};io=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}};v0=/^__.*__$/,tf=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new gt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Nn(e,this.data,t,this.fieldTransforms)}},$c=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new gt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};nf=class r{constructor(e,t,n,i,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this._c(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(e){return new r(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ac({path:n,cc:!1});return i.lc(e),i}hc(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ac({path:n,cc:!1});return i._c(),i}Pc(e){return this.ac({path:void 0,cc:!0})}Tc(e){return zc(e,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}_c(){if(this.path)for(let e=0;e<this.path.length;e++)this.lc(this.path.get(e))}lc(e){if(e.length===0)throw this.Tc("Document fields must not be empty");if(JI(this.oc)&&v0.test(e))throw this.Tc('Document fields cannot begin and end with "__"')}},rf=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ru(e)}dc(e,t,n,i=!1){return new nf({oc:e,methodName:t,Ec:n,path:Ee.emptyPath(),cc:!1,Ic:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};jc=class r extends Si{_toFieldTransform(e){if(e.oc!==2)throw e.oc===1?e.Tc(`${this._methodName}() can only appear at the top level of your update data`):e.Tc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}},sf=class r extends Si{_toFieldTransform(e){return new cc(e.path,new Pn)}isEqual(e){return e instanceof r}};E0=new RegExp("[~\\*/\\[\\]]");so=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new qe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new af(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(au("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},af=class extends so{data(){return super.data()}};oo=class{},vr=class extends oo{};ao=class r extends vr{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=this._parse(e);return mw(e._query,t),new _t(e.firestore,e.converter,zh(e._query,t))}_parse(e){let t=_o(e.firestore);return function(s,o,c,u,h,f,g){let y;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new x(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){mv(g,f);let N=[];for(let D of g)N.push(pv(u,s,D));y={arrayValue:{values:N}}}else y=pv(u,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||mv(g,f),y=ZI(c,o,g,f==="in"||f==="not-in");return Z.create(h,f,y)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};Pi=class r extends oo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new r(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:se.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,c=s.getFlattenedFilters();for(let u of c)mw(o,u),o=zh(o,u)}(e._query,t),new _t(e.firestore,e.converter,zh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};cf=class r extends vr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new r(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new x(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new x(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new fr(s,o)}(e._query,this._field,this._direction);return new _t(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Ot(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};uf=class r extends vr{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){return new _t(e.firestore,e.converter,ac(e._query,this._limit,this._limitType))}};Gc=class r extends vr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=pw(e,this.type,this._docOrFields,this._inclusive);return new _t(e.firestore,e.converter,function(i,s){return new Ot(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};Wc=class r extends vr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=pw(e,this.type,this._docOrFields,this._inclusive);return new _t(e.firestore,e.converter,function(i,s){return new Ot(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};lf=class{convertValue(e,t="none"){switch(bn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return de(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(tn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw F(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return Vn(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;let s=(i=(n=(t=e.fields)===null||t===void 0?void 0:t[mi].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(o=>de(o.doubleValue));return new io(s)}convertGeoPoint(e){return new ro(de(e.latitude),de(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=eu(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(zs(e));default:return null}}convertTimestamp(e){let t=en(e);return new J(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=ie.fromString(e);B(pI(n),9688,{name:e});let i=new pi(n.get(1),n.get(3)),s=new L(n.popFirst(5));return i.isEqual(t)||ze(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};or=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Kc=class extends so{constructor(e,t,n,i,s,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new si(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(au("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},si=class extends Kc{data(e={}){return super.data(e)}},Hc=class{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new or(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new si(this._firestore,this._userDataWriter,n.key,n,new or(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>{let u=new si(i._firestore,i._userDataWriter,c.doc.key,c.doc,new or(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let u=new si(i._firestore,i._userDataWriter,c.doc.key,c.doc,new or(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:T0(c.type),doc:u,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};co=class extends lf{constructor(e){super(),this.firestore=e}convertBytes(e){return new no(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new qe(this.firestore,null,t)}};hf=class{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=A0(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}};df=class{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=$I.provider,this._offlineComponentProvider={build:t=>new Zd(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}};(function(e,t=!0){(function(i){Ci=i})(Et),wt(new It("firestore",(n,{instanceIdentifier:i,options:s})=>{let o=n.getProvider("app").getImmediate(),c=new yt(new yh(n.getProvider("auth-internal")),new wh(o,n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new x(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pi(h.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),he(ny,ry,e),he(ny,ry,"esm2017")})()});var Er=Q(()=>{"use strict";bw()});function jf(r,e){return e===void 0&&(e=S0),new as(function(t){var n=$f(r,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:n}})}function Sw(r){return jf(r,{includeMetadataChanges:!0})}function Pw(r,e){return e===void 0&&(e={}),Sw(r).pipe(be(function(t){return zf(t,e)}))}function zf(r,e){var t;e===void 0&&(e={});var n=r.data(e);return!r.exists()||typeof n!="object"||n===null||!e.idField?n:uu(uu({},n),(t={},t[e.idField]=r.id,t))}function Cw(r){return jf(r,{includeMetadataChanges:!0}).pipe(be(function(e){return e.docs}))}function kw(r,e){return e===void 0&&(e={}),Cw(r).pipe(be(function(t){return t.map(function(n){return zf(n,e)})}))}var uu,S0,Nw=Q(()=>{"use strict";Er();cs();Cm();uu=function(){return uu=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},uu.apply(this,arguments)};S0={includeMetadataChanges:!1};});function P0(r,e){let t=Gn(Dw,r,e);return t&&new Tr(t)}function C0(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new Tr(n)}}function Ow(r,...e){return he("angularfire",Rt.full,"fst"),hn([N0,k0,{provide:Wf,useFactory:C0(r),multi:!0,deps:[rt,dn,bt,zt,[new Ce,Yn],[new Ce,_n],...e]}])}var Tr,Dw,Gf,Wf,k0,N0,lu,xw,Kf,Vw,nn,Lw,rn,Hf,Qf,Ar,hu,Mw,Fw,Yf,Uw,Jf,vo,Xf,Zf,ep,tp,du,Io=Q(()=>{"use strict";Fr();ce();ds();aa();Rs();pn();Nw();Er();Er();Tr=class{constructor(e){return e}},Dw="firestore",Gf=class{constructor(){return mn(Dw)}},Wf=new ln("angularfire2.firestore-instances");k0={provide:Gf,deps:[[new Ce,Wf]]},N0={provide:Tr,useFactory:P0,deps:[[new Ce,Wf],ut]};lu=K(kw,!0),xw=K(Pw,!0),Kf=K(Tw,!0,2),Vw=K(aw,!0,2),nn=K(HI,!0,2),Lw=K(Ew,!0,2),rn=K(Uf,!0,2),Hf=K(fw,!0,2),Qf=K(dw,!0,2),Ar=K(yw,!0),hu=K(vw,!0),Mw=K(YI,!0),Fw=K(QI,!0),Yf=K(uw,!0,2),Uw=K(ow,!0,2),Jf=K(cw,!0,2),vo=K(iw,!0,2),Xf=K(Iw,!0,2),Zf=K(hw,!0,2),ep=K(lw,!0,2),tp=K(ww,!0,2),du=K(sw,!0,2)});function np(r){return"storage/"+r}function up(){let r="An unknown error occurred, please check the error payload for server response.";return new me(ge.UNKNOWN,r)}function x0(r){return new me(ge.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function V0(r){return new me(ge.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function L0(){let r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new me(ge.UNAUTHENTICATED,r)}function M0(){return new me(ge.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function F0(r){return new me(ge.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function U0(){return new me(ge.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function B0(){return new me(ge.CANCELED,"User canceled the upload/download.")}function q0(r){return new me(ge.INVALID_URL,"Invalid URL '"+r+"'.")}function $0(r){return new me(ge.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function j0(){return new me(ge.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Hw+"' property when initializing the app?")}function z0(){return new me(ge.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function G0(){return new me(ge.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function W0(r){return new me(ge.UNSUPPORTED_ENVIRONMENT,`${r} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function rp(r){return new me(ge.INVALID_ARGUMENT,r)}function Qw(){return new me(ge.APP_DELETED,"The Firebase app was deleted.")}function K0(r){return new me(ge.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Eo(r,e){return new me(ge.INVALID_FORMAT,"String does not match format '"+r+"': "+e)}function wo(r){throw new me(ge.INTERNAL_ERROR,"Internal error: "+r)}function H0(r,e,t){let n=1,i=null,s=null,o=!1,c=0;function u(){return c===2}let h=!1;function f(...k){h||(h=!0,e.apply(null,k))}function g(k){i=setTimeout(()=>{i=null,r(A,u())},k)}function y(){s&&clearTimeout(s)}function A(k,...$){if(h){y();return}if(k){y(),f.call(null,k,...$);return}if(u()||o){y(),f.call(null,k,...$);return}n<64&&(n*=2);let M;c===1?(c=2,M=0):M=(n+Math.random())*1e3,g(M)}let N=!1;function D(k){N||(N=!0,y(),!h&&(i!==null?(k||(c=2),clearTimeout(i),g(0)):k||(c=1)))}return g(0),s=setTimeout(()=>{o=!0,D(!0)},t),D}function Q0(r){r(!1)}function Y0(r){return r!==void 0}function J0(r){return typeof r=="object"&&!Array.isArray(r)}function lp(r){return typeof r=="string"||r instanceof String}function Bw(r){return hp()&&r instanceof Blob}function hp(){return typeof Blob<"u"}function sp(r,e,t,n){if(n<e)throw rp(`Invalid value for '${r}'. Expected ${e} or greater.`);if(n>t)throw rp(`Invalid value for '${r}'. Expected ${t} or less.`)}function xi(r,e,t){let n=e;return t==null&&(n=`https://${e}`),`${t}://${n}/v0${r}`}function Yw(r){let e=encodeURIComponent,t="?";for(let n in r)if(r.hasOwnProperty(n)){let i=e(n)+"="+e(r[n]);t=t+i+"&"}return t=t.slice(0,-1),t}function X0(r,e){let t=r>=500&&r<600,i=[408,429].indexOf(r)!==-1,s=e.indexOf(r)!==-1;return t||i||s}function Z0(r,e){e!==null&&e.length>0&&(r.Authorization="Firebase "+e)}function eC(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e!=null?e:"AppManager")}function tC(r,e){e&&(r["X-Firebase-GMPID"]=e)}function nC(r,e){e!==null&&(r["X-Firebase-AppCheck"]=e)}function rC(r,e,t,n,i,s,o=!0){let c=Yw(r.urlParams),u=r.url+c,h=Object.assign({},r.headers);return tC(h,e),Z0(h,t),eC(h,s),nC(h,n),new op(u,r.method,h,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,i,o)}function iC(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function sC(...r){let e=iC();if(e!==void 0){let t=new e;for(let n=0;n<r.length;n++)t.append(r[n]);return t.getBlob()}else{if(hp())return new Blob(r);throw new me(ge.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function oC(r,e,t){return r.webkitSlice?r.webkitSlice(e,t):r.mozSlice?r.mozSlice(e,t):r.slice?r.slice(e,t):null}function aC(r){if(typeof atob>"u")throw W0("base-64");return atob(r)}function cC(r,e){switch(r){case xt.RAW:return new To(Jw(e));case xt.BASE64:case xt.BASE64URL:return new To(Xw(r,e));case xt.DATA_URL:return new To(lC(e),hC(e))}throw up()}function Jw(r){let e=[];for(let t=0;t<r.length;t++){let n=r.charCodeAt(t);if(n<=127)e.push(n);else if(n<=2047)e.push(192|n>>6,128|n&63);else if((n&64512)===55296)if(!(t<r.length-1&&(r.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{let s=n,o=r.charCodeAt(++t);n=65536|(s&1023)<<10|o&1023,e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63)}else(n&64512)===56320?e.push(239,191,189):e.push(224|n>>12,128|n>>6&63,128|n&63)}return new Uint8Array(e)}function uC(r){let e;try{e=decodeURIComponent(r)}catch{throw Eo(xt.DATA_URL,"Malformed data URL.")}return Jw(e)}function Xw(r,e){switch(r){case xt.BASE64:{let i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw Eo(r,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case xt.BASE64URL:{let i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw Eo(r,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=aC(e)}catch(i){throw i.message.includes("polyfill")?i:Eo(r,"Invalid character found")}let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}function lC(r){let e=new pu(r);return e.base64?Xw(xt.BASE64,e.rest):uC(e.rest)}function hC(r){return new pu(r).contentType}function dC(r,e){return r.length>=e.length?r.substring(r.length-e.length)===e:!1}function dp(r){let e;try{e=JSON.parse(r)}catch{return null}return J0(e)?e:null}function fC(r){if(r.length===0)return null;let e=r.lastIndexOf("/");return e===-1?"":r.slice(0,e)}function pC(r,e){let t=e.split("/").filter(n=>n.length>0).join("/");return r.length===0?t:r+"/"+t}function Zw(r){let e=r.lastIndexOf("/",r.length-2);return e===-1?r:r.slice(e+1)}function mC(r,e){return e}function gC(r){return!lp(r)||r.length<2?r:Zw(r)}function fp(){if(fu)return fu;let r=[];r.push(new De("bucket")),r.push(new De("generation")),r.push(new De("metageneration")),r.push(new De("name","fullPath",!0));function e(s,o){return gC(o)}let t=new De("name");t.xform=e,r.push(t);function n(s,o){return o!==void 0?Number(o):o}let i=new De("size");return i.xform=n,r.push(i),r.push(new De("timeCreated")),r.push(new De("updated")),r.push(new De("md5Hash",null,!0)),r.push(new De("cacheControl",null,!0)),r.push(new De("contentDisposition",null,!0)),r.push(new De("contentEncoding",null,!0)),r.push(new De("contentLanguage",null,!0)),r.push(new De("contentType",null,!0)),r.push(new De("metadata","customMetadata",!0)),fu=r,fu}function _C(r,e){function t(){let n=r.bucket,i=r.fullPath,s=new tt(n,i);return e._makeStorageReference(s)}Object.defineProperty(r,"ref",{get:t})}function yC(r,e,t){let n={};n.type="file";let i=t.length;for(let s=0;s<i;s++){let o=t[s];n[o.local]=o.xform(n,e[o.server])}return _C(n,r),n}function eE(r,e,t){let n=dp(e);return n===null?null:yC(r,n,t)}function vC(r,e,t,n){let i=dp(e);if(i===null||!lp(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(h=>{let f=r.bucket,g=r.fullPath,y="/b/"+o(f)+"/o/"+o(g),A=xi(y,t,n),N=Yw({alt:"media",token:h});return A+N})[0]}function IC(r,e){let t={},n=e.length;for(let i=0;i<n;i++){let s=e[i];s.writable&&(t[s.server]=r[s.local])}return JSON.stringify(t)}function wC(r,e,t){let n={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[qw])for(let i of t[qw]){let s=i.replace(/\/$/,""),o=r._makeStorageReference(new tt(e,s));n.prefixes.push(o)}if(t[$w])for(let i of t[$w]){let s=r._makeStorageReference(new tt(e,i.name));n.items.push(s)}return n}function EC(r,e,t){let n=dp(t);return n===null?null:wC(r,e,n)}function pp(r){if(!r)throw up()}function tE(r,e){function t(n,i){let s=eE(r,i,e);return pp(s!==null),s}return t}function TC(r,e){function t(n,i){let s=EC(r,e,i);return pp(s!==null),s}return t}function AC(r,e){function t(n,i){let s=eE(r,i,e);return pp(s!==null),vC(s,i,r.host,r._protocol)}return t}function mp(r){function e(t,n){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=M0():i=L0():t.getStatus()===402?i=V0(r.bucket):t.getStatus()===403?i=F0(r.path):i=n,i.status=t.getStatus(),i.serverResponse=n.serverResponse,i}return e}function gp(r){let e=mp(r);function t(n,i){let s=e(n,i);return n.getStatus()===404&&(s=x0(r.path)),s.serverResponse=i.serverResponse,s}return t}function RC(r,e,t){let n=e.fullServerUrl(),i=xi(n,r.host,r._protocol),s="GET",o=r.maxOperationRetryTime,c=new Rr(i,s,tE(r,t),o);return c.errorHandler=gp(e),c}function bC(r,e,t,n,i){let s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",t&&t.length>0&&(s.delimiter=t),n&&(s.pageToken=n),i&&(s.maxResults=i);let o=e.bucketOnlyServerUrl(),c=xi(o,r.host,r._protocol),u="GET",h=r.maxOperationRetryTime,f=new Rr(c,u,TC(r,e.bucket),h);return f.urlParams=s,f.errorHandler=mp(e),f}function SC(r,e,t){let n=e.fullServerUrl(),i=xi(n,r.host,r._protocol),s="GET",o=r.maxOperationRetryTime,c=new Rr(i,s,AC(r,t),o);return c.errorHandler=gp(e),c}function PC(r,e){let t=e.fullServerUrl(),n=xi(t,r.host,r._protocol),i="DELETE",s=r.maxOperationRetryTime;function o(u,h){}let c=new Rr(n,i,o,s);return c.successCodes=[200,204],c.errorHandler=gp(e),c}function CC(r,e){return r&&r.contentType||e&&e.type()||"application/octet-stream"}function kC(r,e,t){let n=Object.assign({},t);return n.fullPath=r.path,n.size=e.size(),n.contentType||(n.contentType=CC(null,e)),n}function NC(r,e,t,n,i){let s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function c(){let M="";for(let j=0;j<2;j++)M=M+Math.random().toString().slice(2);return M}let u=c();o["Content-Type"]="multipart/related; boundary="+u;let h=kC(e,n,i),f=IC(h,t),g="--"+u+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+f+`\r
--`+u+`\r
Content-Type: `+h.contentType+`\r
\r
`,y=`\r
--`+u+"--",A=mu.getBlob(g,n,y);if(A===null)throw z0();let N={name:h.fullPath},D=xi(s,r.host,r._protocol),k="POST",$=r.maxUploadRetryTime,U=new Rr(D,k,tE(r,t),$);return U.urlParams=N,U.headers=o,U.body=A.uploadData(),U.errorHandler=mp(e),U}function Ro(){return jw?jw():new cp}function DC(r,e,t){r._throwIfRoot("uploadBytes");let n=NC(r.storage,r._location,fp(),new mu(e,!0),t);return r.storage.makeRequestWithTokens(n,Ro).then(i=>({metadata:i,ref:r}))}function OC(r){let e={prefixes:[],items:[]};return nE(r,e).then(()=>e)}function nE(r,e,t){return p(this,null,function*(){let i=yield xC(r,{pageToken:t});e.prefixes.push(...i.prefixes),e.items.push(...i.items),i.nextPageToken!=null&&(yield nE(r,e,i.nextPageToken))})}function xC(r,e){e!=null&&typeof e.maxResults=="number"&&sp("options.maxResults",1,1e3,e.maxResults);let t=e||{},n=bC(r.storage,r._location,"/",t.pageToken,t.maxResults);return r.storage.makeRequestWithTokens(n,Ro)}function VC(r){r._throwIfRoot("getMetadata");let e=RC(r.storage,r._location,fp());return r.storage.makeRequestWithTokens(e,Ro)}function LC(r){r._throwIfRoot("getDownloadURL");let e=SC(r.storage,r._location,fp());return r.storage.makeRequestWithTokens(e,Ro).then(t=>{if(t===null)throw G0();return t})}function MC(r){r._throwIfRoot("deleteObject");let e=PC(r.storage,r._location);return r.storage.makeRequestWithTokens(e,Ro)}function FC(r,e){let t=pC(r._location.path,e),n=new tt(r._location.bucket,t);return new Oi(r.storage,n)}function UC(r){return/^[A-Za-z]+:\/\//.test(r)}function BC(r,e){return new Oi(r,e)}function rE(r,e){if(r instanceof Ao){let t=r;if(t._bucket==null)throw j0();let n=new Oi(t,t._bucket);return e!=null?rE(n,e):n}else return e!==void 0?FC(r,e):r}function qC(r,e){if(e&&UC(e)){if(r instanceof Ao)return BC(r,e);throw rp("To use ref(service, url), the first argument must be a Storage instance.")}else return rE(r,e)}function zw(r,e){let t=e==null?void 0:e[Hw];return t==null?null:tt.makeFromBucketSpec(t,r)}function $C(r,e,t,n={}){r.host=`${e}:${t}`,r._protocol="http";let{mockUserToken:i}=n;i&&(r._overrideAuthToken=typeof i=="string"?i:Ko(i,r.app.options.projectId))}function sE(r,e,t){return r=ne(r),DC(r,e,t)}function oE(r){return r=ne(r),VC(r)}function aE(r){return r=ne(r),OC(r)}function cE(r){return r=ne(r),LC(r)}function uE(r){return r=ne(r),MC(r)}function lE(r,e){return r=ne(r),qC(r,e)}function hE(r=jt(),e){r=ne(r);let n=$t(r,iE).getImmediate({identifier:e}),i=Wo("storage");return i&&dE(n,...i),n}function dE(r,e,t,n={}){$C(r,e,t,n)}function jC(r,{instanceIdentifier:e}){let t=r.getProvider("app").getImmediate(),n=r.getProvider("auth-internal"),i=r.getProvider("app-check-internal");return new Ao(t,n,i,e,Et)}function zC(){wt(new It(iE,jC,"PUBLIC").setMultipleInstances(!0)),he(Gw,Ww,""),he(Gw,Ww,"esm2017")}var Kw,Hw,D0,O0,me,ge,tt,ip,Di,op,Ni,xt,To,pu,mu,De,fu,qw,$w,Rr,aO,jw,ap,cp,Oi,Ao,Gw,Ww,iE,fE=Q(()=>{"use strict";jn();us();ls();Kw="firebasestorage.googleapis.com",Hw="storageBucket",D0=2*60*1e3,O0=10*60*1e3;me=class r extends fn{constructor(e,t,n=0){super(np(e),`Firebase Storage: ${t} (${np(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,r.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return np(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},ge=function(r){return r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment",r}(ge||{});tt=class r{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=r.makeFromUrl(e,t)}catch{return new r(e,"")}if(n.path==="")return n;throw $0(e)}static makeFromUrl(e,t){let n=null,i="([A-Za-z0-9.\\-_]+)";function s(j){j.path.charAt(j.path.length-1)==="/"&&(j.path_=j.path_.slice(0,-1))}let o="(/(.*))?$",c=new RegExp("^gs://"+i+o,"i"),u={bucket:1,path:3};function h(j){j.path_=decodeURIComponent(j.path)}let f="v[A-Za-z0-9_]+",g=t.replace(/[.]/g,"\\."),y="(/([^?#]*).*)?$",A=new RegExp(`^https?://${g}/${f}/b/${i}/o${y}`,"i"),N={bucket:1,path:3},D=t===Kw?"(?:storage.googleapis.com|storage.cloud.google.com)":t,k="([^?#]*)",$=new RegExp(`^https?://${D}/${i}/${k}`,"i"),M=[{regex:c,indices:u,postModify:s},{regex:A,indices:N,postModify:h},{regex:$,indices:{bucket:1,path:2},postModify:h}];for(let j=0;j<M.length;j++){let X=M[j],G=X.regex.exec(e);if(G){let w=G[X.indices.bucket],_=G[X.indices.path];_||(_=""),n=new r(w,_),X.postModify(n);break}}if(n==null)throw q0(e);return n}},ip=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};Di=function(r){return r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT",r}(Di||{});op=class{constructor(e,t,n,i,s,o,c,u,h,f,g,y=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=u,this.timeout_=h,this.progressCallback_=f,this.connectionFactory_=g,this.retry=y,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((A,N)=>{this.resolve_=A,this.reject_=N,this.start_()})}start_(){let e=(n,i)=>{if(i){n(!1,new Ni(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=c=>{let u=c.loaded,h=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,h)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let c=s.getErrorCode()===Di.NO_ERROR,u=s.getStatus();if(!c||X0(u,this.additionalRetryCodes_)&&this.retry){let f=s.getErrorCode()===Di.ABORT;n(!1,new Ni(!1,null,f));return}let h=this.successCodes_.indexOf(u)!==-1;n(!0,new Ni(h,s))})},t=(n,i)=>{let s=this.resolve_,o=this.reject_,c=i.connection;if(i.wasSuccessCode)try{let u=this.callback_(c,c.getResponse());Y0(u)?s(u):s()}catch(u){o(u)}else if(c!==null){let u=up();u.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,u)):o(u)}else if(i.canceled){let u=this.appDelete_?Qw():B0();o(u)}else{let u=U0();o(u)}};this.canceled_?t(!1,new Ni(!1,null,!0)):this.backoffId_=H0(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Q0(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},Ni=class{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}};xt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},To=class{constructor(e,t){this.data=e,this.contentType=t||null}};pu=class{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(t===null)throw Eo(xt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let n=t[1]||null;n!=null&&(this.base64=dC(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}};mu=class r{constructor(e,t){let n=0,i="";Bw(e)?(this.data_=e,n=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(Bw(this.data_)){let n=this.data_,i=oC(n,e,t);return i===null?null:new r(i)}else{let n=new Uint8Array(this.data_.buffer,e,t-e);return new r(n,!0)}}static getBlob(...e){if(hp()){let t=e.map(n=>n instanceof r?n.data_:n);return new r(sC.apply(null,t))}else{let t=e.map(o=>lp(o)?cC(xt.RAW,o).data:o.data_),n=0;t.forEach(o=>{n+=o.byteLength});let i=new Uint8Array(n),s=0;return t.forEach(o=>{for(let c=0;c<o.length;c++)i[s++]=o[c]}),new r(i,!0)}}uploadData(){return this.data_}};De=class{constructor(e,t,n,i){this.server=e,this.local=t||e,this.writable=!!n,this.xform=i||mC}},fu=null;qw="prefixes",$w="items";Rr=class{constructor(e,t,n,i){this.url=e,this.method=t,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};aO=256*1024;jw=null,ap=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Di.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Di.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Di.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,i){if(this.sent_)throw wo("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return n!==void 0?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw wo("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw wo("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw wo("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw wo("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},cp=class extends ap{initXhr(){this.xhr_.responseType="text"}};Oi=class r{constructor(e,t){this._service=e,t instanceof tt?this._location=t:this._location=tt.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new r(e,t)}get root(){let e=new tt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Zw(this._location.path)}get storage(){return this._service}get parent(){let e=fC(this._location.path);if(e===null)return null;let t=new tt(this._location.bucket,e);return new r(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw K0(e)}};Ao=class{constructor(e,t,n,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=Kw,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=D0,this._maxUploadRetryTime=O0,this._requests=new Set,i!=null?this._bucket=tt.makeFromBucketSpec(i,this._host):this._bucket=zw(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=tt.makeFromBucketSpec(this._url,e):this._bucket=zw(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){sp("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){sp("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return p(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return p(this,null,function*(){if(ke(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Oi(this,e)}_makeRequest(e,t,n,i,s=!0){if(this._deleted)return new ip(Qw());{let o=rC(e,this._appId,n,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return p(this,null,function*(){let[n,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()})}},Gw="@firebase/storage",Ww="0.13.7";iE="storage";zC()});var _p=Q(()=>{"use strict";fE()});function GC(r,e){let t=Gn(pE,r,e);return t&&new br(t)}function WC(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new br(n)}}function mE(r,...e){return he("angularfire",Rt.full,"gcs"),hn([HC,KC,{provide:vp,useFactory:WC(r),multi:!0,deps:[rt,dn,bt,zt,[new Ce,Yn],[new Ce,_n],...e]}])}var br,pE,yp,vp,KC,HC,gE,Ip,_E,yE,vE,Vi,IE,gu=Q(()=>{"use strict";Fr();ce();ds();aa();Rs();pn();_p();_p();br=class{constructor(e){return e}},pE="storage",yp=class{constructor(){return mn(pE)}},vp=new ln("angularfire2.storage-instances");KC={provide:yp,deps:[[new Ce,vp]]},HC={provide:br,useFactory:GC,deps:[[new Ce,vp],ut]};gE=K(uE,!0,2),Ip=K(cE,!0),_E=K(oE,!0),yE=K(hE,!0),vE=K(aE,!0),Vi=K(lE,!0,2),IE=K(sE,!0)});var wE,EE=Q(()=>{"use strict";$T();wE=[{path:"auth",loadChildren:()=>import("./chunk-U3C5KTZ5.js").then(r=>r.AuthRoutes),canMatch:[hs],data:{authStateMustBe:!1}},{path:"",loadChildren:()=>import("./chunk-EKF23PXS.js").then(r=>r.TabsRoutes),canMatch:[hs],data:{authStateMustBe:!0}},{path:"cart",loadComponent:()=>import("./chunk-3IAKHXTF.js").then(r=>r.CartPage),canMatch:[hs],data:{authStateMustBe:!0}},{path:"checkout",loadChildren:()=>import("./chunk-UO77WU5I.js").then(r=>r.CheckoutRoutes),canMatch:[hs],data:{authStateMustBe:!0}},{path:"search",loadComponent:()=>import("./chunk-CYEBMPME.js").then(r=>r.SearchPage)},{path:"conversation/:conversationId",loadComponent:()=>import("./chunk-NQJDUQXK.js").then(r=>r.ConversationPage)}]});var TE=Q(()=>{"use strict"});var AE,RE=Q(()=>{"use strict";ta();TE();AE=ea("App",{web:()=>import("./chunk-EMOGJPQH.js").then(r=>new r.AppWeb)})});var bE,SE=Q(()=>{"use strict";ce();Zm();zT();RE();el();ce();bE=(()=>{let e=class e{constructor(){this.platform=ee(Hm),this.router=ee(Go),this.platform.ready().then(()=>{AE.addListener("appUrlOpen",n=>{let i=new URL(n.url);i.pathname==="/stripe-onboarding-complete"&&this.router.navigateByUrl("/tabs/sell/publish"),i.pathname==="/stripe-onboarding-canceled"&&this.router.navigateByUrl("/tabs/sell/stripe-setup")})})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Vm({type:e,selectors:[["app-root"]],decls:2,vars:0,template:function(i,s){i&1&&(Mm(0,"ion-app"),Um(1,"ion-router-outlet"),Fm())},dependencies:[Jm,Ym],encapsulation:2});let r=e;return r})()});var Vt,PE,_u,Lt,Li=Q(()=>{"use strict";ce();Io();ce();Vt=(r,e)=>p(void 0,null,function*(){return yield vt(r,()=>new Promise((t,n)=>{e().then(t).catch(n)}))}),PE=r=>["where","or","and"].includes(r.type),_u=r=>{let e=[];return Array.from(r).forEach(t=>{if("or"in t){let i=_u(t.or).filter(PE);e.push(Uw(...i))}else if("and"in t){let i=_u(t.and).filter(PE);e.push(Vw(...i))}else e.push(du(t.field,t.operator,t.value))}),e},Lt=(()=>{let e=class e{constructor(){this.firestore=ee(Tr),this.injector=ee(zo)}getById(n,i){return p(this,null,function*(){return yield Vt(this.injector,()=>p(this,null,function*(){if(i&&!i.collection)throw new Error("You must specify the collection");try{let s=rn(this.firestore,`${i==null?void 0:i.collection}/${n}`);s=i!=null&&i.converter?s.withConverter(i.converter):s;let o=yield Ar(s);return o.exists()?Fe(ue({},o.data()),{_id:o.id}):null}catch(s){throw this.getErrorMessage(s)}}))})}getById$(n,i){return vt(this.injector,()=>{if(!(i!=null&&i.collection))throw new Error("You must specify the collection");try{let s=rn(this.firestore,`${i==null?void 0:i.collection}/${n}`);return s=i!=null&&i.converter?s.withConverter(i.converter):s,xw(s)}catch(s){throw this.getErrorMessage(s)}})}getByField(n,i,s){return p(this,null,function*(){return yield Vt(this.injector,()=>p(this,null,function*(){if(!(s!=null&&s.collection))throw new Error("You must specify the collection");try{let o=nn(this.firestore,s==null?void 0:s.collection);o=s!=null&&s.converter?o.withConverter(s.converter):o;let c=vo(o,du(n,"==",i)),u=yield hu(c);return u.empty?null:u.docs.map(h=>Fe(ue({},h.data()),{_id:h.id}))}catch(o){throw this.getErrorMessage(o)}}))})}getByField$(n,i,s){return vt(this.injector,()=>{if(!(s!=null&&s.collection))throw new Error("You must specify the collection");try{let o=nn(this.firestore,s==null?void 0:s.collection);o=s!=null&&s.converter?o.withConverter(s.converter):o;let c=vo(o,du(n,"==",i));return lu(c,{idField:"_id"})}catch(o){throw this.getErrorMessage(o)}})}getCollection(n){return p(this,null,function*(){return yield Vt(this.injector,()=>p(this,null,function*(){if(!(n!=null&&n.collection))throw new Error("You must provide the collection.");try{let i=nn(this.firestore,n.collection);return i=n!=null&&n.converter?i.withConverter(n.converter):i,(yield hu(i)).docs.map(s=>Fe(ue({},s.data()),{_id:s.id}))}catch(i){throw this.getErrorMessage(i)}}))})}getCollection$(n){return vt(this.injector,()=>{if(!(n!=null&&n.collection))throw new Error("You must provide the collection.");try{let i=nn(this.firestore,n.collection);return i=n!=null&&n.converter?i.withConverter(n.converter):i,lu(i,{idField:"_id"})}catch(i){throw this.getErrorMessage(i)}})}create(n,i){return p(this,null,function*(){return yield Vt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let s=Re(),o=Fe(ue({},n),{createdAt:s,updatedAt:s}),c;if(n._id)c=rn(this.firestore,`${i.collection}/${n._id}`),c=i!=null&&i.converter?c.withConverter(i.converter):c,yield Xf(c,o);else{let h=nn(this.firestore,i.collection);h=i!=null&&i.converter?h.withConverter(i.converter):h,c=yield Kf(h,n)}let u=(yield Ar(c)).data();return Fe(ue({},u),{_id:c.id})}catch(s){throw this.getErrorMessage(s)}}))})}createInSubcollection(n,i){return p(this,null,function*(){return yield Vt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let s;if(n._id)s=rn(this.firestore,`${i.collection}/${n._id}`),s=i!=null&&i.converter?s.withConverter(i.converter):s,yield Xf(s,n);else{let c=nn(this.firestore,i.collection);c=i!=null&&i.converter?c.withConverter(i.converter):c,s=yield Kf(c,n)}let o=(yield Ar(s)).data();return Fe(ue({},o),{_id:s.id})}catch(s){throw this.getErrorMessage(s)}}))})}updateInSubcollection(n,i){return p(this,null,function*(){return yield Vt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let s=rn(this.firestore,`${i.collection}`);s=i!=null&&i.converter?s.withConverter(i.converter):s,yield tp(s,n);let o=(yield Ar(s)).data();return Fe(ue({},o),{_id:s.id})}catch(s){throw this.getErrorMessage(s)}}))})}update(n,i){return p(this,null,function*(){return yield Vt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let o=rn(this.firestore,i.collection,n._id);o=i!=null&&i.converter?o.withConverter(i.converter):o;let s=n,{_id:c}=s,u=bm(s,["_id"]);return yield tp(o,Fe(ue({},u),{updatedAt:Re()})),this.getById(n._id,i)}catch(o){throw this.getErrorMessage(o)}}))})}remove(n,i){return p(this,null,function*(){return yield Vt(this.injector,()=>p(this,null,function*(){if(i&&!i.collection)throw new Error("You must provide the collection.");try{let s=rn(this.firestore,`${i==null?void 0:i.collection}/${n}`);return(yield Ar(s)).exists()?(yield Lw(s),!0):(console.error(`Document with uid ${n} does not exist.`),!1)}catch(s){throw this.getErrorMessage(s)}}))})}exists(n,i){return p(this,null,function*(){return yield Vt(this.injector,()=>p(this,null,function*(){if(i&&!i.collection)throw new Error("You must provide the collection.");try{let s=rn(this.firestore,`${i==null?void 0:i.collection}/${n}`);return(yield Ar(s)).exists()}catch(s){throw this.getErrorMessage(s)}}))})}query(n){return p(this,null,function*(){return yield Vt(this.injector,()=>p(this,null,function*(){if(!n.collection)throw new Error("You must provide the collection.");if(!n.queryConstraints)throw new Error("You must provide the query constraints.");try{let i=nn(this.firestore,n.collection);i=n!=null&&n.converter?i.withConverter(n.converter):i;let s=[],{filters:o,orderBy:c,limit:u,startAt:h,startAfter:f,endAt:g,endBefore:y}=n.queryConstraints;o!=null&&o.length&&s.push(..._u(o)),c&&s.push(Jf(c.field,c.direction||"asc")),u!==void 0&&s.push(Yf(u)),h!==void 0&&s.push(ep(h)),f!==void 0&&s.push(Zf(f)),g!==void 0&&s.push(Hf(g)),y!==void 0&&s.push(Qf(y));let A=vo(i,...s);return(yield hu(A)).docs.map(D=>Fe(ue({},D.data()),{_id:D.id}))}catch(i){throw this.getErrorMessage(i)}}))})}query$(n){return vt(this.injector,()=>{if(!n.collection)throw new Error("You must provide the collection.");if(!n.queryConstraints)throw new Error("You must provide the query constraints.");try{let i=nn(this.firestore,n.collection);i=n!=null&&n.converter?i.withConverter(n.converter):i;let s=[],{filters:o,orderBy:c,limit:u,startAt:h,startAfter:f,endAt:g,endBefore:y}=n.queryConstraints;o!=null&&o.length&&s.push(..._u(o)),c&&s.push(Jf(c.field,c.direction||"asc")),u!==void 0&&s.push(Yf(u)),h!==void 0&&s.push(ep(h)),f!==void 0&&s.push(Zf(f)),g!==void 0&&s.push(Hf(g)),y!==void 0&&s.push(Qf(y));let A=vo(i,...s);return lu(A,{idField:"_id"})}catch(i){throw this.getErrorMessage(i)}})}getErrorMessage(n){return console.error(n),"Database error"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=_e({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var Mi,wp=Q(()=>{"use strict";ia();Mi=class r{constructor(e={}){this._id="",this.title="",this.description="",this.mainImageURL="",this.imagesURLs=[],this.user={userId:"",username:"",profilePictureURL:""},this.price=0,this.isActive=!0,this.finishedAt=null,this.article={category:Tt.None,condition:ra.None,characteristics:{category:Tt.None}},Object.assign(this,ue({},e))}static Build(e={}){return new r(e)}toJSON(){let e=Object.assign(this);delete e._id;try{return JSON.stringify(e)}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});function Oe(r){return typeof r=="string"||typeof r=="number"||r instanceof Date}function Se(r){return typeof r=="object"&&r!==null&&"_methodName"in r}function nt(r){return typeof r=="object"&&r!==null&&"toDate"in r&&typeof r.toDate=="function"}var Fi=Q(()=>{"use strict"});var yu,CE=Q(()=>{"use strict";Er();ia();wp();KT();Fi();yu=class{toFirestore(e){var s;let t=e.article,n=Tt.None,i={category:Tt.None};if(wg(t)){n=t.category;let o=t.characteristics;Tg(o,n)?i={type:o.type,brand:o.brand,model:o.model,color:o.color,fabricationYear:o.fabricationYear,serialNumber:o.serialNumber,instrumentLevel:o.instrumentLevel}:Ag(o,n)?i={author:o.author,theme:o.theme,edition:o.edition,publisher:o.publisher,year:o.year,pages:o.pages,language:o.language,isbn:o.isbn,series:o.series,volume:o.volume}:Rg(o,n)?i={format:o.format,recordingTitle:o.recordingTitle,artist:o.artist,genre:o.genre,year:o.year,duration:o.duration,label:o.label,catalogNumber:o.catalogNumber,isrc:o.isrc,barcode:o.barcode,releaseDate:o.releaseDate,releaseCountry:o.releaseCountry,releaseFormat:o.releaseFormat,trackCount:o.trackCount}:bg(o,n)?i={type:o.type,name:o.name,brand:o.brand,associatedInstrument:o.associatedInstrument}:Sg(o,n)?i={type:o.type,name:o.name,brand:o.brand,model:o.model,color:o.color,fabricationYear:o.fabricationYear,serialNumber:o.serialNumber,accessories:o.accessories,warranty:o.warranty,warrantyDuration:o.warrantyDuration,warrantyType:o.warrantyType}:Pg(o,n)&&(i={description:o.description})}return{title:e.title,description:e.description,mainImageURL:e.mainImageURL,imagesURLs:e.imagesURLs,user:e.user,price:e.price,isActive:e.isActive,finishedAt:Oe(e.finishedAt)?J.fromDate(new Date(e.finishedAt)):Se(e.finishedAt)?e.finishedAt:null,article:{category:n,condition:(s=e.article.condition)!=null?s:"",characteristics:ue({},i)},createdAt:Oe(e.createdAt)?J.fromDate(new Date(e.createdAt)):Se(e.createdAt)?e.createdAt:Re(),updatedAt:Oe(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Se(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){let n=e.data(t);return Mi.Build({_id:e.id,title:n.title,description:n.description,mainImageURL:n.mainImageURL,imagesURLs:n.imagesURLs,user:n.user,price:n.price,isActive:n.isActive,finishedAt:nt(n.finishedAt)?n.finishedAt.toDate():null,article:{category:n.article.category,condition:n.article.condition,characteristics:n.article.characteristics},createdAt:nt(n.createdAt)?n.createdAt.toDate():null,updatedAt:nt(n.updatedAt)?n.updatedAt.toDate():null})}}});var kE,NE=Q(()=>{"use strict";ce();Li();wp();CE();ce();kE=(()=>{let e=class e{constructor(){this.firestore=ee(Lt),this.postConverter=new yu}getPostById(n){return p(this,null,function*(){try{return yield this.firestore.getById(n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}})}getPostById$(n){try{return this.firestore.getById$(n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}}getPostsByUserId(n){return p(this,null,function*(){try{return yield this.firestore.getByField("userId",n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}})}getPostsByUserId$(n){try{return this.firestore.getByField$("userId",n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}}getPostsByUsername(n){return p(this,null,function*(){try{return yield this.firestore.getByField("username",n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}})}getPostsByUsername$(n){try{return this.firestore.getByField$("username",n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}}getAllPosts(){return p(this,null,function*(){try{return this.firestore.getCollection({collection:"posts",converter:this.postConverter})}catch(n){throw console.error(n),n}})}getAllPosts$(){try{return this.firestore.getCollection$({collection:"posts",converter:this.postConverter})}catch(n){throw console.error(n),n}}queryPosts(n){return p(this,null,function*(){try{return this.firestore.query({collection:"posts",converter:this.postConverter,queryConstraints:n})}catch(i){throw console.error(i),i}})}queryPosts$(n){try{return this.firestore.query$({collection:"posts",converter:this.postConverter,queryConstraints:n})}catch(i){throw console.error(i),i}}savePost(n){return p(this,null,function*(){try{let i=Mi.Build(n),s;return(s=yield this.firestore.create(i,{collection:"posts",converter:this.postConverter}))?s:null}catch(i){throw i}})}updatePost(n){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(n,{collection:"posts",converter:this.postConverter}))?i:null}catch(i){throw i}})}deletePost(n){return p(this,null,function*(){try{return yield this.firestore.remove(n)}catch(i){throw i}})}postExists(n){return p(this,null,function*(){try{return yield this.firestore.exists(n)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=_e({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var Ui,Ep=Q(()=>{"use strict";Ui=class r{constructor(e={}){this._id="",this.userId="",this.items=[],Object.assign(this,ue({},e))}static Build(e={}){return new r(e)}toJSON(){let e=Object.assign(this);delete e._id;try{return JSON.stringify(e)}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});var vu,DE=Q(()=>{"use strict";Er();Ep();Fi();vu=class{toFirestore(e){return{userId:e.userId,items:e.items,createdAt:Oe(e.createdAt)?J.fromDate(new Date(e.createdAt)):Se(e.createdAt)?e.createdAt:Re(),updatedAt:Oe(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Se(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){var i,s;let n=e.data(t);return Ui.Build({_id:e.id,userId:(i=n.userId)!=null?i:"",items:(s=n.items)!=null?s:[],createdAt:nt(n.createdAt)?n.createdAt.toDate():null,updatedAt:nt(n.updatedAt)?n.updatedAt.toDate():null})}}});var OE,xE=Q(()=>{"use strict";ce();cs();Li();Ep();DE();ce();OE=(()=>{let e=class e{constructor(){this.firestore=ee(Lt),this.cartConverter=new vu}getCartById(n){return p(this,null,function*(){try{return yield this.firestore.getById(n,{collection:"carts",converter:this.cartConverter})}catch(i){throw console.error(i),i}})}getCartById$(n){try{return this.firestore.getById$(n,{collection:"carts",converter:this.cartConverter})}catch(i){throw console.error(i),i}}getCartByUserId(n){return p(this,null,function*(){try{let i=yield this.firestore.getByField("userId",n,{collection:"carts",converter:this.cartConverter});return i&&i.length>0?i[0]:null}catch(i){throw console.error(i),i}})}getCartByUserId$(n){try{return this.firestore.getByField$("userId",n,{collection:"carts",converter:this.cartConverter}).pipe(be(i=>i&&i.length>0?i[0]:null))}catch(i){throw console.error(i),i}}getAllCarts(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"carts",converter:this.cartConverter})}catch(n){throw console.error(n),n}})}getAllCarts$(){try{return this.firestore.getCollection$({collection:"carts",converter:this.cartConverter})}catch(n){throw console.error(n),n}}saveCart(n){return p(this,null,function*(){try{let i=Ui.Build(n),s;return(s=yield this.firestore.create(i,{collection:"carts",converter:this.cartConverter}))?s:null}catch(i){throw i}})}updateCart(n){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(n,{collection:"carts",converter:this.cartConverter}))?i:null}catch(i){console.error(i)}return null})}deleteCart(n){return p(this,null,function*(){try{return yield this.firestore.remove(n)}catch(i){throw i}})}cartExists(n){return p(this,null,function*(){try{return yield this.firestore.exists(n)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=_e({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var Iu,wu,VE=Q(()=>{"use strict";Io();pg();ia();Fi();Iu=class{toFirestore(e){return{email:e.email,username:e.username,profilePictureURL:e.profilePictureURL,name:e.name,address:e.address,roles:Array.isArray(e.roles)?e.roles.map(t=>t.toString()):e.roles,bio:e.bio,fcmToken:e.fcmToken,stripeAccountId:e.stripeAccountId,createdAt:Oe(e.createdAt)?J.fromDate(new Date(e.createdAt)):Se(e.createdAt)?e.createdAt:Re(),updatedAt:Oe(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Se(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){var i,s,o,c,u,h,f;let n=e.data(t);return Xo.Build({_id:e.id,email:(i=n.email)!=null?i:"",username:(s=n.username)!=null?s:"",profilePictureURL:(o=n.profilePictureURL)!=null?o:"",name:(c=n.name)!=null?c:{first:"",last:""},address:(u=n.address)!=null?u:{line1:"",city:"",country:"",countryCode:"",zipcode:""},roles:((h=n.roles)!=null?h:[]).map(g=>g),bio:(f=n.bio)!=null?f:"",fcmToken:n.fcmToken,stripeAccountId:n.stripeAccountId,createdAt:nt(n.createdAt)?n.createdAt.toDate():null,updatedAt:nt(n.updatedAt)?n.updatedAt.toDate():null})}},wu=class{toFirestore(e){var t,n,i;return{title:typeof e.title=="string"?e.title:"",category:(n=(t=e==null?void 0:e.category)==null?void 0:t.toString())!=null?n:Tt.None,price:typeof e.price=="number"?e.price:0,mainImageURL:(i=e==null?void 0:e.mainImageURL)!=null?i:""}}fromFirestore(e,t){var o,c,u,h;let n=e.data(t),i=(o=n==null?void 0:n.category)!=null?o:"",s=Object.values(Tt).includes(i)?i:Tt.None;return{_id:e.id,title:(c=n==null?void 0:n.title)!=null?c:"",category:s,price:(u=n==null?void 0:n.price)!=null?u:0,mainImageURL:(h=n==null?void 0:n.mainImageURL)!=null?h:""}}}});var LE,ME=Q(()=>{"use strict";ce();cs();Li();pg();VE();ce();LE=(()=>{let e=class e{constructor(){this.firestore=ee(Lt),this.userConverter=new Iu,this.activePostConverter=new wu}getUserById(n,i=!0){return p(this,null,function*(){try{let s=yield this.firestore.getById(n,{collection:"users",converter:this.userConverter});if(!s)return null;if(!i||!this.firestore.getCollection)return s;let o=yield this.firestore.getCollection({collection:`users/${n}/activePosts`,converter:this.activePostConverter});return s.activePosts=o!=null?o:[],s}catch(s){throw console.error(s),s}})}getUserById$(n,i=!0){try{let s=this.firestore.getById$(n,{collection:"users",converter:this.userConverter});if(!i||!this.firestore.getCollection$)return s;let o=this.firestore.getCollection$({collection:`users/${n}/activePosts`,converter:this.activePostConverter});return qt([s,o]).pipe(be(([c,u])=>c?(c.activePosts=u!=null?u:[],c):null))}catch(s){throw console.error(s),s}}getUserByEmail(n,i=!0){return p(this,null,function*(){try{let s=null,o=yield this.firestore.getByField("email",n,{collection:"users",converter:this.userConverter});if(o&&o.length>0&&(s=o[0]),!i||!this.firestore.getCollection)return s;let c=yield this.firestore.getCollection({collection:`users/${s==null?void 0:s._id}/activePosts`,converter:this.activePostConverter});return s&&(s.activePosts=c!=null?c:[]),s}catch(s){throw console.error(s),s}})}getUserByEmail$(n,i=!0){try{let s=this.firestore.getByField$("email",n,{collection:"users",converter:this.userConverter}).pipe(be(o=>o&&o.length>0?o[0]:null));return!i||!this.firestore.getCollection$?s:s.pipe(qn(o=>!o||!this.firestore.getCollection$?Bn(null):this.firestore.getCollection$({collection:`users/${o._id}/activePosts`,converter:this.activePostConverter}).pipe(be(c=>(o.activePosts=c!=null?c:[],o)))))}catch(s){throw console.error(s),s}}getUserByUsername(n){return p(this,null,function*(){try{let i=yield this.firestore.getByField("username",n,{collection:"users",converter:this.userConverter});return i&&i.length>0?i[0]:null}catch(i){throw console.error(i),i}})}getUserByUsername$(n){try{return this.firestore.getByField$("username",n,{collection:"users"}).pipe(be(i=>i&&i.length>0?i[0]:null))}catch(i){throw console.error(i),i}}getAllUsers(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"users",converter:this.userConverter})}catch(n){throw console.error(n),n}})}getAllUsers$(){try{return this.firestore.getCollection$({collection:"users",converter:this.userConverter})}catch(n){throw console.error(n),n}}saveUser(n){return p(this,null,function*(){try{let i=Xo.Build(n),s;return(s=yield this.firestore.create(i,{collection:"users",converter:this.userConverter}))?s:null}catch(i){throw i}})}updateUser(n){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(n,{collection:"users",converter:this.userConverter}))?i:null}catch(i){throw i}})}saveActivePost(s){return p(this,arguments,function*({userId:n,activePostData:i}){try{let o;return(o=yield this.firestore.createInSubcollection(i,{collection:`users/${n}/activePosts`,converter:this.activePostConverter}))?o:null}catch(o){throw o}})}userExists(n){return p(this,null,function*(){return yield this.firestore.exists(n)})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=_e({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var Bi,Tp=Q(()=>{"use strict";ia();Bi=class r{constructor(e={}){this._id="",this.postData={postId:"",title:"",articleCondition:ra.None,price:0,mainImageURL:""},this.buyerData={userId:"",username:"",profilePictureURL:""},this.sellerData={userId:"",username:"",profilePictureURL:""},this.stripePaymentId="",Object.assign(this,ue({},e))}static Build(e={}){return new r(e)}toJSON(){let e=Object.assign(this);delete e._id;try{return JSON.stringify(e)}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});var Eu,FE=Q(()=>{"use strict";Er();Tp();Fi();Eu=class{toFirestore(e){return{postData:e.postData,buyerData:e.buyerData,sellerData:e.sellerData,stripePaymentId:e.stripePaymentId,createdAt:Oe(e.createdAt)?J.fromDate(new Date(e.createdAt)):Se(e.createdAt)?e.createdAt:Re(),updatedAt:Oe(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Se(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){let n=e.data(t);return Bi.Build({_id:e.id,postData:{postId:n.postData.postId,title:n.postData.title,articleCondition:n.postData.articleCondition,price:n.postData.price,mainImageURL:n.postData.mainImageURL},buyerData:{userId:n.buyerData.userId,username:n.buyerData.username,profilePictureURL:n.buyerData.profilePictureURL},sellerData:{userId:n.sellerData.userId,username:n.sellerData.username,profilePictureURL:n.sellerData.profilePictureURL},stripePaymentId:n.stripePaymentId,createdAt:n.createdAt.toDate(),updatedAt:n.updatedAt.toDate()})}}});var UE,BE=Q(()=>{"use strict";ce();Li();Tp();FE();ce();UE=(()=>{let e=class e{constructor(){this.firestore=ee(Lt),this.saleConverter=new Eu}getSaleById(n){return p(this,null,function*(){try{return yield this.firestore.getById(n,{collection:"sales"})}catch(i){throw console.error(i),i}})}getSaleById$(n){try{return this.firestore.getById$(n,{collection:"sales"})}catch(i){throw console.error(i),i}}getSalesByBuyerId(n){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.userId",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesByBuyerId$(n){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.userId",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getSalesByBuyerUsername(n){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.username",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesByBuyerUsername$(n){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.username",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getSalesBySellerId(n){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.userId",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesBySellerId$(n){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.userId",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getSalesBySellerUsername(n){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.username",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesBySellerUsername$(n){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.username",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getAllSales(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"sales",converter:this.saleConverter})}catch(n){throw console.error(n),n}})}getAllSales$(){try{return this.firestore.getCollection$({collection:"sales",converter:this.saleConverter})}catch(n){throw console.error(n),n}}saveSale(n){return p(this,null,function*(){try{let i=Bi.Build(n),s;return(s=yield this.firestore.create(i,{collection:"sales",converter:this.saleConverter}))?s:null}catch(i){throw i}})}updateSale(n){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(n,{collection:"sales",converter:this.saleConverter}))?i:null}catch(i){throw i}})}deleteSale(n){return p(this,null,function*(){try{return yield this.firestore.remove(n)}catch(i){throw i}})}saleExists(n){return p(this,null,function*(){try{return yield this.firestore.exists(n)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=_e({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var qi,Ap=Q(()=>{"use strict";qi=class r{constructor(e={}){this._id="",this.relatedPost={postId:"",title:"",price:0,isActive:!0,mainImageURL:""},this.participants={buyer:{userId:"",username:"",profilePictureURL:""},seller:{userId:"",username:"",profilePictureURL:""}},this.messages=[],Object.assign(this,ue({},e))}static Build(e={}){return new r(e)}toJSON(){let e=Object.assign(this);delete e._id;try{let t=JSON.stringify(e);return console.log({jsonStr:t}),t}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});var Tu,Au,qE=Q(()=>{"use strict";Io();Ap();Fi();Tu=class{toFirestore(e){return{relatedPost:e.relatedPost,participants:Se(e.participants)?e.participants:{buyer:{userId:e.participants.buyer.userId,username:e.participants.buyer.username,profilePictureURL:e.participants.buyer.profilePictureURL},seller:{userId:e.participants.seller.userId,username:e.participants.seller.username,profilePictureURL:e.participants.seller.profilePictureURL}},createdAt:Oe(e.createdAt)?J.fromDate(new Date(e.createdAt)):Se(e.createdAt)?e.createdAt:Re(),updatedAt:Oe(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Se(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){let n=e.data(t);return qi.Build({_id:e.id,relatedPost:n.relatedPost,participants:{buyer:{userId:n.participants.buyer.userId,username:n.participants.buyer.username,profilePictureURL:n.participants.buyer.profilePictureURL},seller:{userId:n.participants.seller.userId,username:n.participants.seller.username,profilePictureURL:n.participants.seller.profilePictureURL}},createdAt:nt(n.createdAt)?n.createdAt.toDate():null,updatedAt:nt(n.updatedAt)?n.updatedAt.toDate():null})}},Au=class{toFirestore(e){return{text:e.text,timestamp:Oe(e.timestamp)?J.fromDate(new Date(e.timestamp)):Se(e.timestamp)?e.timestamp:Re(),senderId:e.senderId,recipientId:e.recipientId}}fromFirestore(e,t){let n=e.data(t);return{_id:e.id,text:n.text,timestamp:n.timestamp.toDate(),senderId:n.senderId,recipientId:n.recipientId}}}});var $E,jE=Q(()=>{"use strict";ce();Li();Ap();qE();cs();ce();$E=(()=>{let e=class e{constructor(){this.firestore=ee(Lt),this.conversationConverter=new Tu,this.messageConverter=new Au}getConversationById(n){return p(this,null,function*(){try{let i=yield this.firestore.getById(n,{collection:"conversations",converter:this.conversationConverter});if(!i)return null;let s=yield this.firestore.getCollection({collection:`conversations/${n}/messages`,converter:this.messageConverter});return i.messages=s!=null?s:[],i}catch(i){throw console.error(i),i}})}getConversationById$(n){try{let i=this.firestore.getById$(n,{collection:"conversations",converter:this.conversationConverter}),s=this.firestore.query$({collection:`conversations/${n}/messages`,converter:this.messageConverter,queryConstraints:{orderBy:{field:"timestamp",direction:"desc"}}});return qt([i,s]).pipe(be(([o,c])=>o?Fe(ue({},o),{messages:c!=null?c:[]}):null),Xu((o,c)=>(o==null?void 0:o.messages.length)===(c==null?void 0:c.messages.length)))}catch(i){throw console.error(i),i}}getConversationsByBuyerId(n){return p(this,null,function*(){try{let i=yield this.firestore.getByField("participants.buyer.userId",n,{collection:"conversations",converter:this.conversationConverter});if(!this.firestore.getCollection||i===null)return i;for(let s of i)s.messages=yield this.firestore.getCollection({collection:`conversations/${s._id}/messages`,converter:this.messageConverter});return i}catch(i){throw console.error(i),i}})}getConversationsByBuyerId$(n){try{return this.firestore.getByField$("participants.buyer.userId",n,{collection:"conversations",converter:this.conversationConverter}).pipe(qn(s=>{if(!s||s.length===0)return Bn(null);let o=s.map(c=>this.firestore.getCollection$({collection:`conversations/${c._id}/messages`,converter:this.messageConverter}).pipe(be(u=>Fe(ue({},c),{messages:u!=null?u:[]}))));return qt(o)}))}catch(i){throw console.error(i),i}}getConversationsBySellerId(n){return p(this,null,function*(){try{let i=yield this.firestore.getByField("participants.seller.userId",n,{collection:"conversations",converter:this.conversationConverter});if(i===null)return i;for(let s of i)s.messages=yield this.firestore.getCollection({collection:`conversations/${s._id}/messages`,converter:this.messageConverter});return i}catch(i){throw console.error(i),i}})}getConversationsBySellerId$(n){try{return this.firestore.getByField$("participants.seller.userId",n,{collection:"conversations",converter:this.conversationConverter}).pipe(qn(s=>{if(!s||s.length===0)return Bn(null);let o=s.map(c=>this.firestore.getCollection$({collection:`conversations/${c._id}/messages`,converter:this.messageConverter}).pipe(be(h=>Fe(ue({},c),{messages:h!=null?h:[]}))));return qt(o)}))}catch(i){throw console.error(i),i}}getConversationsByParticipantId(n){return p(this,null,function*(){var i,s;try{let o=(i=yield this.firestore.getByField("participants.buyer.userId",n,{collection:"conversations",converter:this.conversationConverter}))!=null?i:[],c=(s=yield this.firestore.getByField("participants.seller.userId",n,{collection:"conversations",converter:this.conversationConverter}))!=null?s:[];for(let u of o)u.messages=yield this.firestore.getCollection({collection:`conversations/${u._id}/messages`,converter:this.messageConverter});for(let u of c)u.messages=yield this.firestore.getCollection({collection:`conversations/${u._id}/messages`,converter:this.messageConverter});return o.concat(c)}catch(o){throw console.error(o),o}})}getConversationsByParticipantId$(n){try{let i=this.firestore.getByField$("participants.buyer.userId",n,{collection:"conversations",converter:this.conversationConverter}),s=this.firestore.getByField$("participants.seller.userId",n,{collection:"conversations",converter:this.conversationConverter});return qt([i,s]).pipe(be(([o,c])=>(o!=null?o:[]).concat(c!=null?c:[])),qn(o=>{if(!o||o.length===0)return Bn(null);let c=o.map(u=>this.firestore.getCollection$({collection:`conversations/${u._id}/messages`,converter:this.messageConverter}).pipe(be(h=>Fe(ue({},u),{messages:h!=null?h:[]}))));return qt(c)}))}catch(i){throw console.error(i),i}}getConversationsByPostId(n){return p(this,null,function*(){var i;try{let s=(i=yield this.firestore.getByField("relatedPost.postId",n,{collection:"conversations",converter:this.conversationConverter}))!=null?i:[];for(let o of s)o.messages=yield this.firestore.getCollection({collection:`conversations/${o._id}/messages`,converter:this.messageConverter});return s}catch(s){throw console.error(s),s}})}getConversationsByPostId$(n){try{return this.firestore.getByField$("relatedPost.postId",n,{collection:"conversations",converter:this.conversationConverter}).pipe(qn(s=>{if(!s||s.length===0)return Bn(null);let o=s.map(c=>this.firestore.getCollection$({collection:`conversations/${c._id}/messages`,converter:this.messageConverter}).pipe(be(u=>Fe(ue({},c),{messages:u!=null?u:[]}))));return qt(o)}))}catch(i){throw console.error(i),i}}getAllConversations(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"conversations",converter:this.conversationConverter})}catch(n){throw console.error(n),n}})}getAllConversations$(){try{return this.firestore.getCollection$({collection:"conversations",converter:this.conversationConverter})}catch(n){throw console.error(n),n}}queryConversations(n){return p(this,null,function*(){try{return this.firestore.query({collection:"conversations",converter:this.conversationConverter,queryConstraints:n})}catch(i){throw console.error(i),i}})}queryConversations$(n){try{return this.firestore.query$({collection:"conversations",converter:this.conversationConverter,queryConstraints:n})}catch(i){throw console.error(i),i}}saveConversation(n){return p(this,null,function*(){try{let i=qi.Build(n),s;return(s=yield this.firestore.create(i,{collection:"conversations",converter:this.conversationConverter}))?s:null}catch(i){throw i}})}updateConversation(n){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(n,{collection:"conversations",converter:this.conversationConverter}))?i:null}catch(i){throw i}})}saveMessage(s){return p(this,arguments,function*({conversationId:n,messageData:i}){try{let o;return(o=yield this.firestore.createInSubcollection(i,{collection:`conversations/${n}/messages`,converter:this.messageConverter}))?o:null}catch(o){throw o}})}deleteConversation(n){return p(this,null,function*(){try{return yield this.firestore.remove(n)}catch(i){throw i}})}conversationExists(n){return p(this,null,function*(){try{return yield this.firestore.exists(n)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=_e({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var zE,GE=Q(()=>{"use strict";ce();Rs();ce();zE=(()=>{let e=class e{get firebaseUser(){return this._firebaseUser.asReadonly()}constructor(){this.firebaseAuth=ee(Qn),this._firebaseUser=Om(null),G_(this.firebaseAuth,n=>p(this,null,function*(){this._firebaseUser.set(n)}))}registerWithEmail(n){return p(this,null,function*(){try{let i=yield $_(this.firebaseAuth,n.email,n.password).then(s=>s.user);return yield J_(i,{displayName:n.username}),{uid:i.uid}}catch(i){throw this.getErrorMessage(i.code||i.message)}})}registerWithProvider(n){return p(this,null,function*(){return yield this.loginWithProvider(n)})}loginWithEmail(n,i){return p(this,null,function*(){try{return{uid:(yield K_(this.firebaseAuth,n,i)).user.uid}}catch(s){throw this.getErrorMessage(s.code||s.message)}})}loginWithProvider(n){return p(this,null,function*(){try{let i=n==="google"?new ql:new Es("apple.com");return{uid:(yield H_(this.firebaseAuth,i)).user.uid}}catch(i){throw this.getErrorMessage(i.code||i.message)}})}logout(){return p(this,null,function*(){try{yield Q_(this.firebaseAuth)}catch(n){throw n}})}resetPassword(n){return p(this,null,function*(){try{console.log("resetting password"),yield W_(this.firebaseAuth,n)}catch(i){throw i}})}updatePassword(n){return p(this,null,function*(){try{let i=this._firebaseUser();if(!i)return;yield Y_(i,n)}catch(i){throw i}})}getErrorMessage(n){return console.error(n),n}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=_e({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var WE,KE=Q(()=>{"use strict";gu();ce();gu();WE=(()=>{let e=class e{constructor(n){this.storage=n}upload(o,c){return p(this,arguments,function*(n,i,s={}){try{let u=Vi(this.storage,n);return yield IE(u,i,s),yield Ip(u)}catch(u){throw u}})}delete(n){return p(this,null,function*(){try{let i=Vi(this.storage,n);yield gE(i)}catch(i){throw i}})}getDownloadURL(n){return p(this,null,function*(){try{let i=Vi(this.storage,n);return yield Ip(i)}catch(i){throw i}})}getMetadata(n){return p(this,null,function*(){try{let i=Vi(this.storage,n);return yield _E(i)}catch(i){throw i}})}list(n){return p(this,null,function*(){try{let i=Vi(this.storage,n);return(yield vE(i)).items.map(o=>o.name)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)(km(br))},e.\u0275prov=_e({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var HE=Q(()=>{"use strict"});var Sr,QE=Q(()=>{"use strict";ta();HE();Sr=ea("PushNotifications",{})});var YE,JE=Q(()=>{"use strict";ce();QE();ta();yg();fg();el();BT();QT();ce();YE=(()=>{let e=class e{constructor(){this.authService=ee(na),this.conversationService=ee(kg),this.userRepository=ee(Jo),this.cache=ee(gg),this.router=ee(Go)}initPushNotifications(){Zo.isNativePlatform()&&(Sr.requestPermissions().then(n=>p(this,null,function*(){n.receive==="granted"?(console.log("Push notifications permissions granted!"),Sr.register()):console.warn(`Error in permissions request: ${n}`)})),Sr.addListener("registration",n=>p(this,null,function*(){if((yield this.cache.get("fcmToken"))!==n.value){console.log(`Push registration success, token: ${n.value}`),this.cache.set("fcmToken",n.value);let s=this.authService.currentUser();s&&(yield this.userRepository.updateUser({_id:s._id,fcmToken:n.value}))}})),Sr.addListener("registrationError",n=>{console.error("Error on push notifications registration: "+JSON.stringify(n))}),Sr.addListener("pushNotificationReceived",n=>{console.log("Push received: "+JSON.stringify(n))}),Sr.addListener("pushNotificationActionPerformed",n=>{var s,o,c;console.log("Push action performed: "+JSON.stringify(n));let i=(s=n.notification.data)==null?void 0:s.type;switch(i){case"sale":let u=(o=n.notification.data)==null?void 0:o.postId;u&&this.router.navigate([`/tabs/post-detail/${u}`]);break;case"message":let h=(c=n.notification.data)==null?void 0:c.conversationId;h&&(this.conversationService.setConversationId(h),this.conversationService.reloadConversationResource(),this.router.navigate([`/conversation/${h}`]));break;default:console.warn(`Unhandled push notification type: ${i}`);break}}))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=_e({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var YC=OT(XE=>{ce();LT();el();Zm();ds();Rs();Io();gu();EE();SE();GT();ce();UT();ta();yg();WT();NE();jT();xE();fg();ME();YT();BE();HT();jE();GE();FT();KE();qT();JE();VT();$m(bE,{providers:[{provide:zm,useClass:Qm},Xm({mode:"md"}),Wm(wE,Km(Gm)),jm(),xg(()=>{let r=Vg(Ig.firebase);return Zo.isNativePlatform()&&(Fw(r,{localCache:Rw()}),z_(r,{persistence:Ca})),r}),q_(()=>j_()),Ow(()=>Mw()),mE(()=>yE()),Nm(mg.forRoot()),{provide:dg,useClass:zE},{provide:Jo,useClass:LE},{provide:Eg,useClass:kE},{provide:vg,useClass:OE},{provide:Ng,useClass:UE},{provide:Cg,useClass:$E},{provide:_g,useClass:WE},Lm(()=>p(XE,null,function*(){let r=ee(na),e=ee(YE);yield r.init(),e.initPushNotifications()}))]})});export default YC();
