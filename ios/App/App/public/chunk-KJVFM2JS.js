import{a as oe,b as he}from"./chunk-PVNJ44BD.js";import{c as _,d as ge}from"./chunk-I27DK3TE.js";import"./chunk-FBV753BW.js";import{a as d,d as fe}from"./chunk-CC7RULIL.js";import{a as ae,b as ve}from"./chunk-EJ3JXVBZ.js";import"./chunk-6NUGH5FF.js";import{h as C,k as pe,t as ie,u as ue}from"./chunk-VQCHUAXV.js";import"./chunk-K5TY53DO.js";import"./chunk-4XKNA7IF.js";import"./chunk-4FRKXPG4.js";import"./chunk-E4HNE3PW.js";import"./chunk-P2UHFIXP.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-GTZXGHKK.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import{Ca as re,U as J,V as K,W,X,Y,_ as Z,aa as ee,la as te,oa as ne}from"./chunk-BQ2OOKCX.js";import{$ as s,$a as V,D as v,Ea as k,Ib as $,Lb as N,Ma as F,Na as H,Pa as L,Pb as G,Qa as f,Ra as I,Sa as U,W as z,Y as T,Za as B,_a as Q,ea as j,fa as P,hb as u,ka as O,kb as R,nb as y,qa as w,sa as S,ua as q,va as D,wa as o,xa as i,ya as p,z as A}from"./chunk-DHHGUDQP.js";import"./chunk-OHMQXWFK.js";import"./chunk-S6VCIYOJ.js";import"./chunk-25CU3KXX.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{f as x,o as b}from"./chunk-FIPIWZQS.js";function Ce(r,t){if(r&1&&(o(0,"ion-card",1),p(1,"div",2),o(2,"div",3)(3,"ion-card-header")(4,"ion-card-title",4),f(5),i(),o(6,"ion-card-subtitle",5),f(7),i()(),o(8,"ion-card-content",6),f(9),Q(10,"formatCurrency"),i()()()),r&2){let g,n,e=t.$implicit;w("routerLink",B(9,we,"/tabs/post-detail/"+e._id)),s(),L("background-image: url('",e.mainImageURL,"')"),s(4),I(e.article==null?null:e.article.category),s(2),I((g=e.title)!==null&&g!==void 0?g:""),s(2),U(" ",V(10,7,(n=e.price)!==null&&n!==void 0?n:0)," ")}}var we,ye,ce,le=x(()=>{"use strict";y();re();he();G();y();we=r=>[r],ye=(r,t)=>t._id;ce=(()=>{let t=class t{constructor(){this.posts=z([])}ngOnInit(){}};t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=P({type:t,selectors:[["app-post-cards-row"]],inputs:{posts:[1,"posts"]},decls:3,vars:0,consts:[[1,"cards-row"],[1,"card",3,"routerLink"],[1,"card-image"],[1,"card-content-wrapper"],[1,"card-title"],[1,"card-subtitle"],[1,"card-price"]],template:function(e,a){e&1&&(o(0,"div",0),q(1,Ce,11,11,"ion-card",1,ye),i()),e&2&&(s(),D(a.posts()))},dependencies:[N,K,X,Y,W,J,oe],styles:[".cards-row[_ngcontent-%COMP%]{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;justify-content:flex-start}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:0 0 auto;width:50dvw;height:35dvh;min-height:fit-content;margin-right:1rem;scroll-snap-align:start;cursor:pointer}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]{background-position:center;background-size:cover;background-repeat:no-repeat;height:50%}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]{height:50%;display:flex;flex:1 1 auto;flex-direction:column;justify-content:space-between}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{color:var(--ion-color-medium-tint);text-transform:uppercase;font-size:var(--label-large-size, .875rem);font-style:normal;font-weight:var(--label-large-weight-prominent, 600);line-height:var(--label-large-line-height, 1.25rem);letter-spacing:var(--label-large-letter-spacing, .00625rem)}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]   .card-subtitle[_ngcontent-%COMP%]{color:var(--ion-color-light);font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem);display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]   .card-price[_ngcontent-%COMP%]{color:var(--ion-color-light);font-size:var(--body-large-size, 1rem);font-style:normal;font-weight:var(--body-large-weight-prominent, 600);line-height:var(--body-large-line-height, 1.5rem);letter-spacing:var(--body-large-tracking, .03125rem)}.cards-row[_ngcontent-%COMP%]::-webkit-scrollbar, .cards-row[_ngcontent-%COMP%]::-webkit-scrollbar-button, .cards-row[_ngcontent-%COMP%]::-webkit-scrollbar-track{display:none}"]});let r=t;return r})()});var de,me=x(()=>{"use strict";y();fe();pe();ve();ue();y();de=(()=>{let t=class t{constructor(){this.authService=v(ie),this.postRepository=v(ae),this.userRoles=u(()=>{var n,e;return(e=(n=this.authService.currentUser())==null?void 0:n.roles)!=null?e:[]}),this.latestPosts=R({request:()=>{var n,e;return(e=(n=this.authService.currentUser())==null?void 0:n._id)!=null?e:""},loader:e=>b(this,[e],function*({request:n}){var a;if(!n)return[];try{let l=yield this.postRepository.queryPosts({filters:[{field:"user.userId",operator:"!=",value:n},{field:"isActive",operator:"==",value:!0}],orderBy:{field:"createdAt",direction:"desc"},limit:10});return l!=null?l:[]}catch(l){return this.errorMessage.set((a=l==null?void 0:l.message)!=null?a:"Unknown error"),[]}})}),this.recommendedPosts=R({request:()=>{var n,e;return(e=(n=this.authService.currentUser())==null?void 0:n._id)!=null?e:""},loader:e=>b(this,[e],function*({request:n}){var a,l;if(!n)return[];try{let h={},m=new Set,E=Object.values(d).filter(c=>c!==d.None);this.userRoles().includes(C.Amateur)&&[...E.filter(c=>c!==d.Professional)].forEach(c=>m.add(c)),this.userRoles().includes(C.Professional)&&[...E.filter(c=>c!==d.Recordings)].forEach(c=>m.add(c)),this.userRoles().includes(C.Collector)&&(m.add(d.Recordings),m.add(d.Other)),this.userRoles().includes(C.Student)&&(m.add(d.Instruments),m.add(d.Accessories),m.add(d.Books)),m.size>0&&(h.filters=[{and:[{field:"user.userId",operator:"!=",value:(a=this.authService.currentUser())==null?void 0:a._id},{or:Array.from(m).map(c=>({field:"article.category",operator:"==",value:c}))}]}]),h.limit=10;let M=yield this.postRepository.queryPosts(h);return M!=null?M:[]}catch(h){return this.errorMessage.set((l=h==null?void 0:h.message)!=null?l:"Unknown error"),[]}})}),this.errorMessage=T(""),this.homeState=u(()=>{var n,e;return{latestPosts:(n=this.latestPosts.value())!=null?n:[],recommendedPosts:(e=this.recommendedPosts.value())!=null?e:[],loading:this.latestPosts.isLoading()||this.recommendedPosts.isLoading(),errorMessage:this.errorMessage()}})}reloadResources(){this.latestPosts.reload(),this.recommendedPosts.reload()}};t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=A({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})()});function Pe(r,t){r&1&&(o(0,"div",5),p(1,"ion-spinner",7),i())}function _e(r,t){if(r&1&&(o(0,"div",6),p(1,"app-post-cards-row",8),i()),r&2){let g=k();s(),w("posts",g.latestPosts())}}function Me(r,t){r&1&&(o(0,"div",5),p(1,"ion-spinner",7),i())}function xe(r,t){if(r&1&&(o(0,"div",6),p(1,"app-post-cards-row",8),i()),r&2){let g=k();s(),w("posts",g.recommendedPosts())}}var Ge,be=x(()=>{y();re();G();ge();le();me();y();Ge=(()=>{let t=class t{constructor(){this.route=v($),this.homeService=v(de),this.latestPosts=u(()=>this.homeService.homeState().latestPosts),this.recommendedPosts=u(()=>this.homeService.homeState().recommendedPosts),this.loading=u(()=>this.homeService.homeState().loading),this.errorMessage=u(()=>this.homeService.homeState().errorMessage),this.toolbar=j(_)}ionViewDidEnter(){this.homeService.reloadResources()}ionViewDidLeave(){var n;(n=this.toolbar())==null||n.searchActive.set(!1)}};t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=P({type:t,selectors:[["app-home"]],viewQuery:function(e,a){e&1&&F(a.toolbar,_,5),e&2&&H()},decls:14,vars:3,consts:[["type","menu","title","Inicio"],[3,"fullscreen"],[1,"container"],[1,"title-cards-row-container"],[1,"title-cards-row"],[1,"loading-spinner-container"],[1,"cards-row-wrapper"],["name","crescent"],[3,"posts"]],template:function(e,a){e&1&&(o(0,"ion-header"),p(1,"app-toolbar",0),i(),o(2,"ion-content",1)(3,"div",2)(4,"div",3)(5,"ion-text",4),f(6,"\xDAltimos anuncios"),i(),O(7,Pe,2,0,"div",5)(8,_e,2,1,"div",6),i(),o(9,"div",3)(10,"ion-text",4),f(11,"Anuncios destacados"),i(),O(12,Me,2,0,"div",5)(13,xe,2,1,"div",6),i()()()),e&2&&(s(2),w("fullscreen",!0),s(5),S(a.loading()?7:8),s(5),S(a.loading()?12:13))},dependencies:[te,ne,ce,_,ee,Z],styles:[".container[_ngcontent-%COMP%]{margin-top:2rem;display:flex;flex-direction:column;justify-content:flex-start;gap:3rem}.container[_ngcontent-%COMP%]   .loading-spinner-container[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:flex-start;align-items:center;padding-left:1rem;min-height:15.25rem}.container[_ngcontent-%COMP%]   .title-cards-row-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.container[_ngcontent-%COMP%]   .title-cards-row-container[_ngcontent-%COMP%]   .cards-row-wrapper[_ngcontent-%COMP%]{margin-inline-end:calc(var(--horizontal-margin, 24px) * -1)}.container[_ngcontent-%COMP%]   .title-cards-row[_ngcontent-%COMP%]{font-size:var(--headline-small-size, 1.5rem);font-style:normal;font-weight:var(--headline-small-weight, 400);line-height:var(--headline-small-line-height, 2rem);letter-spacing:var(--headline-small-tracking, 0rem)}"]});let r=t;return r})()});be();export{Ge as HomePage};
