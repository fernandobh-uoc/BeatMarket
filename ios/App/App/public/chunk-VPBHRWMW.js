import{a as de,b as we}from"./chunk-K4X2YLKW.js";import{a as x,b as Ce}from"./chunk-SZG4CGCH.js";import"./chunk-SWFIUNRV.js";import"./chunk-D4UN2WVJ.js";import{a as d,d as _e}from"./chunk-CC7RULIL.js";import{a as me,b as xe}from"./chunk-ATV22YZD.js";import"./chunk-26KUR5UJ.js";import{c as C,f as ye,v as le,w as Pe}from"./chunk-GIZGGZ62.js";import{$ as re,Ba as ce,T as Y,U as Z,V as W,W as ee,X as te,Z as ne,ka as ie,na as oe,pa as ae,qa as se}from"./chunk-XVXSUTZI.js";import{$a as $,Aa as p,B as z,F as y,Ga as I,Gb as J,Jb as K,Nb as X,Oa as U,Pa as B,Ra as Q,Sa as u,Ta as k,Ua as V,Y as j,_ as L,ab as R,ba as l,bb as N,cb as G,ga as q,ha as _,jb as g,ka as F,ma as O,mb as E,pb as v,sa as P,ua as S,wa as D,xa as H,ya as o,za as i}from"./chunk-LBGYGD76.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{f as w,o as b}from"./chunk-FIPIWZQS.js";var pe,ue=w(()=>{"use strict";v();pe=(()=>{let t=class t{transform(n,e=100){return n?n.split(" ").length>e?n.split(" ").splice(0,e).join(" ")+"...":n:""}};t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=F({name:"truncateTextLines",type:t,pure:!0});let r=t;return r})()});function Oe(r,t){if(r&1&&(o(0,"ion-card",1),p(1,"div",2),o(2,"div",3)(3,"ion-card-header")(4,"ion-card-title",4),u(5),i(),o(6,"ion-card-subtitle",5),u(7),R(8,"truncateTextLines"),i()(),o(9,"ion-card-content",6),u(10),R(11,"formatCurrency"),i()()()),r&2){let f,n,e=t.$implicit;P("routerLink",$(12,Me,"/tabs/post-detail/"+e._id)),l(),Q("background-image: url('",e.mainImageURL,"')"),l(4),k(e.article==null?null:e.article.category),l(2),k(G(8,7,(f=e.title)!==null&&f!==void 0?f:"",2)),l(3),V(" ",N(11,10,(n=e.price)!==null&&n!==void 0?n:0)," ")}}var Me,be,ge,fe=w(()=>{"use strict";v();ce();ue();we();X();v();Me=r=>[r],be=(r,t)=>t._id;ge=(()=>{let t=class t{constructor(){this.posts=j([])}ngOnInit(){}};t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=_({type:t,selectors:[["app-post-cards-row"]],inputs:{posts:[1,"posts"]},decls:3,vars:0,consts:[[1,"cards-row"],[1,"card",3,"routerLink"],[1,"card-image"],[1,"card-content-wrapper"],[1,"card-title"],[1,"card-subtitle"],[1,"card-price"]],template:function(e,a){e&1&&(o(0,"div",0),D(1,Oe,12,14,"ion-card",1,be),i()),e&2&&(l(),H(a.posts()))},dependencies:[K,Z,ee,te,W,Y,pe,de],styles:[".cards-row[_ngcontent-%COMP%]{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;justify-content:flex-start}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:0 0 auto;width:40dvw;height:35dvh;min-height:fit-content;margin-right:1rem;scroll-snap-align:start;cursor:pointer}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]{background-position:center;background-size:cover;background-repeat:no-repeat;height:40%}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]{height:60%;display:flex;flex:1 1 auto;flex-direction:column;justify-content:space-between}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{color:var(--ion-color-medium-tint);text-transform:uppercase;font-size:var(--label-large-size, .875rem);font-style:normal;font-weight:var(--label-large-weight-prominent, 600);line-height:var(--label-large-line-height, 1.25rem);letter-spacing:var(--label-large-letter-spacing, .00625rem)}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]   .card-subtitle[_ngcontent-%COMP%]{color:var(--ion-color-light);font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]   .card-price[_ngcontent-%COMP%]{color:var(--ion-color-light);font-size:var(--body-large-size, 1rem);font-style:normal;font-weight:var(--body-large-weight-prominent, 600);line-height:var(--body-large-line-height, 1.5rem);letter-spacing:var(--body-large-tracking, .03125rem)}.cards-row[_ngcontent-%COMP%]::-webkit-scrollbar, .cards-row[_ngcontent-%COMP%]::-webkit-scrollbar-button, .cards-row[_ngcontent-%COMP%]::-webkit-scrollbar-track{display:none}"]});let r=t;return r})()});var he,ve=w(()=>{"use strict";v();_e();ye();xe();Pe();v();he=(()=>{let t=class t{constructor(){this.authService=y(le),this.postRepository=y(me),this.userRoles=g(()=>{var n,e;return(e=(n=this.authService.currentUser())==null?void 0:n.roles)!=null?e:[]}),this.latestPosts=E({request:()=>{var n,e;return(e=(n=this.authService.currentUser())==null?void 0:n._id)!=null?e:""},loader:e=>b(this,[e],function*({request:n}){var a;if(!n)return[];try{let c=yield this.postRepository.queryPosts({filters:[{field:"user.userId",operator:"!=",value:n},{field:"isActive",operator:"==",value:!0}],orderBy:{field:"createdAt",direction:"desc"},limit:10});return c!=null?c:[]}catch(c){return this.errorMessage.set((a=c==null?void 0:c.message)!=null?a:"Unknown error"),[]}})}),this.recommendedPosts=E({request:()=>{var n,e;return(e=(n=this.authService.currentUser())==null?void 0:n._id)!=null?e:""},loader:e=>b(this,[e],function*({request:n}){var a,c;if(!n)return[];try{let h={},m=new Set,A=Object.values(d).filter(s=>s!==d.None);this.userRoles().includes(C.Amateur)&&[...A.filter(s=>s!==d.Professional)].forEach(s=>m.add(s)),this.userRoles().includes(C.Professional)&&[...A.filter(s=>s!==d.Recordings)].forEach(s=>m.add(s)),this.userRoles().includes(C.Collector)&&(m.add(d.Recordings),m.add(d.Other)),this.userRoles().includes(C.Student)&&(m.add(d.Instruments),m.add(d.Accessories),m.add(d.Books)),m.size>0&&(h.filters=[{and:[{field:"user.userId",operator:"!=",value:(a=this.authService.currentUser())==null?void 0:a._id},{or:Array.from(m).map(s=>({field:"article.category",operator:"==",value:s}))}]}]),h.limit=10;let M=yield this.postRepository.queryPosts(h);return M!=null?M:[]}catch(h){return this.errorMessage.set((c=h==null?void 0:h.message)!=null?c:"Unknown error"),[]}})}),this.errorMessage=L(""),this.homeState=g(()=>{var n,e;return{latestPosts:(n=this.latestPosts.value())!=null?n:[],recommendedPosts:(e=this.recommendedPosts.value())!=null?e:[],loading:this.latestPosts.isLoading()||this.recommendedPosts.isLoading(),errorMessage:this.errorMessage()}})}reloadResources(){this.latestPosts.reload(),this.recommendedPosts.reload()}};t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})()});function Se(r,t){r&1&&(o(0,"div",7),p(1,"ion-spinner",9),i())}function Ie(r,t){if(r&1&&p(0,"app-post-cards-row",8),r&2){let f=I();P("posts",f.latestPosts())}}function ke(r,t){r&1&&(o(0,"div",7),p(1,"ion-spinner",9),i())}function Re(r,t){if(r&1&&p(0,"app-post-cards-row",8),r&2){let f=I();P("posts",f.recommendedPosts())}}var tt,Ee=w(()=>{v();ce();X();Ce();fe();ve();v();tt=(()=>{let t=class t{constructor(){this.route=y(J),this.homeService=y(he),this.latestPosts=g(()=>this.homeService.homeState().latestPosts),this.recommendedPosts=g(()=>this.homeService.homeState().recommendedPosts),this.loading=g(()=>this.homeService.homeState().loading),this.errorMessage=g(()=>this.homeService.homeState().errorMessage),this.toolbar=q(x)}ionViewDidEnter(){this.homeService.reloadResources()}ionViewDidLeave(){var n;(n=this.toolbar())==null||n.searchActive.set(!1)}};t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=_({type:t,selectors:[["app-home"]],viewQuery:function(e,a){e&1&&U(a.toolbar,x,5),e&2&&B()},decls:18,vars:3,consts:[["type","menu","title","Inicio"],[3,"fullscreen"],["collapse","condense"],["size","large"],[1,"container"],[1,"title-cards-row-container"],[1,"title-cards-row"],[1,"loading-spinner-container"],[3,"posts"],["name","crescent"]],template:function(e,a){e&1&&(o(0,"ion-header"),p(1,"app-toolbar",0),i(),o(2,"ion-content",1)(3,"ion-header",2)(4,"ion-toolbar")(5,"ion-title",3),u(6,"Inicio"),i()()(),o(7,"div",4)(8,"div",5)(9,"ion-text",6),u(10,"\xDAltimos anuncios"),i(),O(11,Se,2,0,"div",7)(12,Ie,1,1,"app-post-cards-row",8),i(),o(13,"div",5)(14,"ion-text",6),u(15,"Anuncios destacados"),i(),O(16,ke,2,0,"div",7)(17,Re,1,1,"app-post-cards-row",8),i()()()),e&2&&(l(2),P("fullscreen",!0),l(9),S(a.loading()?11:12),l(5),S(a.loading()?16:17))},dependencies:[ie,oe,ge,x,re,se,ae,ne],styles:[".container[_ngcontent-%COMP%]{margin-top:2rem;display:flex;flex-direction:column;justify-content:flex-start;gap:3rem}.container[_ngcontent-%COMP%]   .loading-spinner-container[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:flex-start;align-items:center;padding-left:1rem;min-height:15.25rem}.container[_ngcontent-%COMP%]   .title-cards-row-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.container[_ngcontent-%COMP%]   .title-cards-row[_ngcontent-%COMP%]{font-size:var(--headline-small-size, 1.5rem);font-style:normal;font-weight:var(--headline-small-weight, 400);line-height:var(--headline-small-line-height, 2rem);letter-spacing:var(--headline-small-tracking, 0rem)}"]});let r=t;return r})()});Ee();export{tt as HomePage};
