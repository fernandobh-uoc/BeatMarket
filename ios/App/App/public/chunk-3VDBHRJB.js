import{a as it,b as vt}from"./chunk-UIHM3IIJ.js";import{a as nt,b as ot,c as at,d as bt}from"./chunk-3LZDXMQH.js";import{a as et,b as Ct,e as tt,f as ht}from"./chunk-2GV3WWDM.js";import{F as Xe,a as z,b as Ze,d as He,f as Ye,k as Je,m as Ke,q as We}from"./chunk-QZLDCAKT.js";import"./chunk-7QGFDW3N.js";import"./chunk-CVZVN4BI.js";import"./chunk-6RPMLJXL.js";import"./chunk-ZDSPE5PQ.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-ZSFULLTW.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import"./chunk-5WOL6UCU.js";import"./chunk-UCDHUJSY.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-7JRGKQWZ.js";import{f as q,g as qe,h as k,j as ze,k as Ge,m as je,p as ft,s as $e,t as gt,y as Qe,z as xt}from"./chunk-WI56WTX3.js";import{Aa as Ue,Ba as Le,Ca as Be,Q as Ee,S as Re,_ as Fe,aa as Ve,ba as Te,c as w,d as ge,da as Pe,e as xe,i as Ce,j as he,k as ve,ka as Ae,l as be,la as Ne,oa as ke,q as Se,s as we,u as De,v as ye,va as Me,wa as Ie,xa as Oe}from"./chunk-IBFAPW3Z.js";import{$ as c,Ca as D,D as S,Da as h,Ea as u,Gb as de,Hb as _e,L as f,Lb as fe,M as g,Ma as K,Na as ce,Qa as m,Ra as W,Sa as ue,V,W as T,Y as x,Ya as X,_ as se,ea as H,fa as B,hb as P,jb as pe,ka as d,m as U,n as dt,nb as R,qa as v,s as L,sa as p,ta as me,ua as Y,va as J,w as _t,wa as r,xa as a,ya as E,z as le}from"./chunk-S4NGLO4I.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as A,f as N,j as O,k as F,m as re,o as b}from"./chunk-FIPIWZQS.js";var j,G,rt=N(()=>{"use strict";R();qe();G=class{constructor(){F(this,j,S(q))}validate(){return o=>b(this,null,function*(){return(yield O(this,j).getUserByEmail(o.value.toLowerCase(),!1))?{emailExists:!0}:null})}};j=new WeakMap});var Q,$,lt=N(()=>{"use strict";R();qe();$=class{constructor(){F(this,Q,S(q))}validate(){return o=>b(this,null,function*(){return(yield O(this,Q).getUserByUsername(o.value))?{usernameExists:!0}:null})}};Q=new WeakMap});function yt(t,o){t&1&&E(0,"ion-icon",11)}function Et(t,o){if(t&1&&d(0,yt,1,0,"ion-icon",11),t&2){let n,e=u(2);p(!((n=e.registerForm.get("emailData.email"))!=null&&n.pending)&&((n=e.registerForm.get("emailData.email"))!=null&&n.invalid)?0:-1)}}function Rt(t,o){t&1&&(r(0,"ion-text",12),m(1,"El email es obligatorio"),a())}function Ft(t,o){t&1&&(r(0,"ion-text",12),m(1,"El email es inv\xE1lido"),a())}function Vt(t,o){t&1&&(r(0,"ion-text",12),m(1,"El email ya est\xE1 en uso"),a())}function Tt(t,o){if(t&1&&d(0,Rt,2,0,"ion-text",12)(1,Ft,2,0,"ion-text",12)(2,Vt,2,0,"ion-text",12),t&2){let n,e,i,l=u(2);p(!((n=l.registerForm.get("emailData.email"))==null||n.errors==null)&&n.errors.required?0:-1),c(),p(!((e=l.registerForm.get("emailData.email"))==null||e.errors==null)&&e.errors.email?1:-1),c(),p(!((i=l.registerForm.get("emailData.email"))==null||i.errors==null)&&i.errors.emailExists?2:-1)}}function Pt(t,o){if(t&1){let n=D();r(0,"div",1)(1,"div",8)(2,"ion-label",9),m(3,"Email"),a(),r(4,"ion-input",10),h("ionFocus",function(){f(n);let i=u();return g(i.controlFocus.emit("email"))})("ionBlur",function(){f(n);let i=u();return g(i.controlBlur.emit("email"))}),d(5,Et,1,1),a(),d(6,Tt,3,3),a()()}if(t&2){let n,e=u();c(5),p(e.submitAttempts().email()?5:-1),c(),p(e.submitAttempts().email()&&((n=e.registerForm.get("emailData.email"))!=null&&n.errors)?6:-1)}}function At(t,o){t&1&&(r(0,"ion-text",12),m(1,"El nombre de usuario es obligatorio"),a())}function Nt(t,o){t&1&&(r(0,"ion-text",12),m(1,"El nombre de usuario es demasiado corto"),a())}function kt(t,o){t&1&&(r(0,"ion-text",12),m(1,"Ese nombre de usuario ya est\xE1 en uso"),a())}function Mt(t,o){if(t&1&&d(0,At,2,0,"ion-text",12)(1,Nt,2,0,"ion-text",12)(2,kt,2,0,"ion-text",12),t&2){let n,e,i,l=u(2);p(!((n=l.registerForm.get("userData.username"))==null||n.errors==null)&&n.errors.required?0:-1),c(),p(!((e=l.registerForm.get("userData.username"))==null||e.errors==null)&&e.errors.minlength?1:-1),c(),p(!((i=l.registerForm.get("userData.username"))==null||i.errors==null)&&i.errors.usernameExists?2:-1)}}function It(t,o){t&1&&(r(0,"ion-text",12),m(1,"La contrase\xF1a es obligatoria"),a())}function Ot(t,o){t&1&&(r(0,"ion-text",12),m(1,"La contrase\xF1a debe tener al menos 6 caracteres, una letra y un n\xFAmero"),a())}function Ut(t,o){if(t&1&&d(0,It,2,0,"ion-text",12)(1,Ot,2,0,"ion-text",12),t&2){let n,e,i=u(2);p(!((n=i.registerForm.get("userData.password"))==null||n.errors==null)&&n.errors.required?0:-1),c(),p(!((e=i.registerForm.get("userData.password"))==null||e.errors==null)&&e.errors.pattern?1:-1)}}function Lt(t,o){if(t&1){let n=D();r(0,"div",2)(1,"div",8)(2,"ion-label",9),m(3,"Nombre de usuario"),a(),r(4,"ion-input",13),h("ionFocus",function(){f(n);let i=u();return g(i.controlFocus.emit("userData"))}),a(),d(5,Mt,3,3),a(),r(6,"div",8)(7,"ion-label",9),m(8,"Contrase\xF1a"),a(),r(9,"ion-input",14),h("ionFocus",function(){f(n);let i=u();return g(i.controlFocus.emit("userData"))}),E(10,"ion-input-password-toggle",15),a(),d(11,Ut,2,2),a(),r(12,"div",16)(13,"ion-label",9),m(14,"Avatar (opcional)"),a(),r(15,"ion-avatar",17),h("click",function(){f(n);let i=u();return g(i.uploadAvatar.emit())}),E(16,"img",18),a()()()}if(t&2){let n,e,i=u();c(5),p(i.submitAttempts().userData()&&((n=i.registerForm.get("userData.username"))!=null&&n.errors)?5:-1),c(4),v("clearOnEdit",!1),c(2),p(i.submitAttempts().userData()&&((e=i.registerForm.get("userData.password"))!=null&&e.errors)?11:-1),c(5),v("src",i.avatarDataURL()||"../../../../../../assets/user-avatar-default-shade.svg",se)}}function Bt(t,o){t&1&&(r(0,"ion-text",12),m(1,"El nombre es obligatorio"),a())}function qt(t,o){if(t&1&&d(0,Bt,2,0,"ion-text",12),t&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.firstName"))==null||n.errors==null)&&n.errors.required?0:-1)}}function zt(t,o){t&1&&(r(0,"ion-text",12),m(1,"Los apellidos son obligatorios"),a())}function Gt(t,o){if(t&1&&d(0,zt,2,0,"ion-text",12),t&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.lastName"))==null||n.errors==null)&&n.errors.required?0:-1)}}function jt(t,o){t&1&&(r(0,"ion-text",12),m(1,"La direcci\xF3n es obligatoria"),a())}function $t(t,o){if(t&1&&d(0,jt,2,0,"ion-text",12),t&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.address"))==null||n.errors==null)&&n.errors.required?0:-1)}}function Qt(t,o){t&1&&(r(0,"ion-text",12),m(1,"El c\xF3digo postal es obligatorio"),a())}function Zt(t,o){t&1&&(r(0,"ion-text",12),m(1,"El c\xF3digo postal es demasiado corto"),a())}function Ht(t,o){if(t&1&&d(0,Qt,2,0,"ion-text",12)(1,Zt,2,0,"ion-text",12),t&2){let n,e,i=u(2);p(!((n=i.registerForm.get("personalData.zipcode"))==null||n.errors==null)&&n.errors.required?0:-1),c(),p(!((e=i.registerForm.get("personalData.zipcode"))==null||e.errors==null)&&e.errors.minlength?1:-1)}}function Yt(t,o){if(t&1&&(r(0,"ion-select-option",29),m(1),a()),t&2){let n=o.$implicit;v("value",n.nameES),c(),W(n.nameES)}}function Jt(t,o){if(t&1){let n=D();r(0,"div",3)(1,"div",8)(2,"ion-label",19),m(3,"Nombre"),a(),r(4,"ion-input",20),h("ionFocus",function(){f(n);let i=u();return g(i.controlFocus.emit("personalData"))}),a(),d(5,qt,1,1),a(),r(6,"div",8)(7,"ion-label",9),m(8,"Apellidos"),a(),r(9,"ion-input",21),h("ionFocus",function(){f(n);let i=u();return g(i.controlFocus.emit("personalData"))}),a(),d(10,Gt,1,1),a(),r(11,"div",8)(12,"ion-label",9),m(13,"Direcci\xF3n"),a(),r(14,"ion-input",22),h("ionFocus",function(){f(n);let i=u();return g(i.controlFocus.emit("personalData"))}),a(),d(15,$t,1,1),a(),r(16,"div",23)(17,"div",24)(18,"ion-label",9),m(19,"C\xF3digo postal"),a(),r(20,"ion-input",25),h("ionFocus",function(){f(n);let i=u();return g(i.controlFocus.emit("personalData"))}),a(),d(21,Ht,2,2),a(),r(22,"div",26)(23,"ion-label",9),m(24,"Pa\xEDs"),a(),r(25,"ion-select",27),E(26,"ion-icon",28),Y(27,Yt,2,2,"ion-select-option",29,Dt),a()()()()}if(t&2){let n,e,i,l,s=u();c(5),p(s.submitAttempts().personalData()&&((n=s.registerForm.get("personalData.firstName"))!=null&&n.errors)?5:-1),c(5),p(s.submitAttempts().personalData()&&((e=s.registerForm.get("personalData.lastName"))!=null&&e.errors)?10:-1),c(5),p(s.submitAttempts().personalData()&&((i=s.registerForm.get("personalData.address"))!=null&&i.errors)?15:-1),c(6),p(s.submitAttempts().personalData()&&((l=s.registerForm.get("personalData.zipcode"))!=null&&l.errors)?21:-1),c(4),v("interfaceOptions",X(5,St)),c(2),J(s.countries)}}function Kt(t,o){if(t&1){let n=D();r(0,"div",32)(1,"ion-checkbox",35),h("ionChange",function(i){f(n);let l=u(2);return g(l.onRoleChange(i))}),m(2),a()()}if(t&2){let n=o.$implicit;c(),v("value",n),c(),ue(" ",n," ")}}function Wt(t,o){if(t&1){let n=D();r(0,"div",4)(1,"div",8)(2,"ion-label",9),m(3,"Roles (opcional)"),a(),r(4,"ion-text",30),m(5,"Elige los roles que m\xE1s se identifiquen con tu actividad musical"),a(),r(6,"div",31),Y(7,Kt,3,2,"div",32,me),a()(),r(9,"div",33)(10,"ion-label",9),m(11,"Biograf\xEDa (opcional)"),a(),r(12,"ion-textarea",34),h("ionFocus",function(){f(n);let i=u();return g(i.controlFocus.emit("otherData"))}),a()()()}if(t&2){let n=u();c(7),J(n.roles)}}function Xt(t,o){t&1&&E(0,"ion-spinner",37)}function ei(t,o){if(t&1){let n=D();r(0,"div",6)(1,"ion-button",36),h("click",function(){f(n);let i=u();return g(i.nextStep.emit())}),m(2," Continuar "),d(3,Xt,1,0,"ion-spinner",37),a(),r(4,"ion-text"),m(5,"\xBFYa tienes cuenta? "),r(6,"a",38),m(7,"Ingresar"),a()()()}if(t&2){let n=u();c(),v("disabled",n.loadingStates().email()),c(2),p(n.loadingStates().email()?3:-1),c(3),v("routerLink",X(3,wt))}}function ti(t,o){t&1&&E(0,"ion-spinner",37)}function ii(t,o){if(t&1){let n=D();r(0,"ion-button",39),h("click",function(){f(n);let i=u();return g(i.nextStep.emit())}),m(1," Continuar "),d(2,ti,1,0,"ion-spinner",37),a()}if(t&2){let n=u();v("disabled",n.loadingStates().userData()),c(2),p(n.loadingStates().userData()?2:-1)}}function ni(t,o){t&1&&E(0,"ion-spinner",37)}function oi(t,o){if(t&1){let n=D();r(0,"ion-button",39),h("click",function(){f(n);let i=u();return g(i.nextStep.emit())}),m(1," Continuar "),d(2,ni,1,0,"ion-spinner",37),a()}if(t&2){let n=u();v("disabled",n.loadingStates().personalData()),c(2),p(n.loadingStates().personalData()?2:-1)}}function ai(t,o){if(t&1&&(r(0,"ion-text",12),m(1),a()),t&2){let n=u(2);c(),W(n.authProviderErrorMessage())}}function ri(t,o){t&1&&E(0,"ion-spinner",37)}function li(t,o){if(t&1){let n=D();d(0,ai,2,1,"ion-text",12),r(1,"ion-button",39),h("click",function(){f(n);let i=u();return g(i.formSubmit.emit())}),m(2," Finalizar "),d(3,ri,1,0,"ion-spinner",37),a()}if(t&2){let n=u();p(n.submitAttempts().register()&&n.authProviderErrorMessage()?0:-1),c(),v("disabled",n.loadingStates().register()),c(2),p(n.loadingStates().register()?3:-1)}}var St,wt,Dt,Z,ct=N(()=>{"use strict";R();fe();ye();Be();rt();lt();Ze();Xe();vt();Ge();R();ye();St=()=>({cssClass:"custom-action-sheet"}),wt=()=>["/auth/login"],Dt=(t,o)=>o.iso2;Z=(()=>{var o,mt;let e=class e{constructor(){F(this,o);this.fb=S(we),this.emailValidator=new G,this.usernameValidator=new $,this.step=T(1),this.nextStep=V(),this.formSubmit=V(),this.submitAttempts=T({email:x(!1),userData:x(!1),personalData:x(!1),register:x(!1)}),this.loadingStates=T({email:x(!1),userData:x(!1),personalData:x(!1),register:x(!1)}),this.controlFocus=V(),this.controlBlur=V(),this.uploadAvatar=V(),this.authProviderErrorMessage=T(""),this.formattedDate=x(new Date().toLocaleDateString("es-ES")),this.avatarDataURL=T(""),this.countries=it,this.roles=[k.Amateur,k.Professional,k.Collector,k.Student],z({checkmarkCircleOutline:Je,closeCircleOutline:Ke,calendarOutline:Ye,globeOutline:We})}ngOnInit(){re(this,o,mt).call(this)}onRoleChange(l){let s=this.registerForm.get("otherData.roles");if(l.detail.checked)s.push(this.fb.control(l.detail.value));else{let _=s.controls.findIndex(C=>C.value===l.detail.value);_>=0&&s.removeAt(_)}}};o=new WeakSet,mt=function(){this.registerForm=this.fb.group({emailData:this.fb.group({email:this.fb.control("",{validators:[w.required,w.email],asyncValidators:[this.emailValidator.validate()],updateOn:"blur"})}),userData:this.fb.group({username:this.fb.control("",{validators:[w.required,w.minLength(4)],asyncValidators:[this.usernameValidator.validate()],updateOn:"blur"}),password:this.fb.control("",{validators:[w.required,w.pattern(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/)],updateOn:"blur"})}),personalData:this.fb.group({firstName:this.fb.control("",{validators:[w.required],updateOn:"blur"}),lastName:this.fb.control("",{validators:[w.required],updateOn:"blur"}),address:this.fb.control("",{validators:[w.required],updateOn:"blur"}),zipcode:this.fb.control("",{validators:[w.required,w.minLength(4)],updateOn:"blur"}),country:this.fb.control("",{validators:[w.required],updateOn:"blur"})}),otherData:this.fb.group({roles:this.fb.array([]),bio:this.fb.control("")})})},e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=B({type:e,selectors:[["app-register-form"]],inputs:{step:[1,"step"],submitAttempts:[1,"submitAttempts"],loadingStates:[1,"loadingStates"],authProviderErrorMessage:[1,"authProviderErrorMessage"],avatarDataURL:[1,"avatarDataURL"]},outputs:{nextStep:"nextStep",formSubmit:"formSubmit",controlFocus:"controlFocus",controlBlur:"controlBlur",uploadAvatar:"uploadAvatar"},decls:10,vars:3,consts:[[3,"formGroup"],["formGroupName","emailData",1,"inputs-container"],["formGroupName","userData",1,"inputs-container"],["formGroupName","personalData",1,"inputs-container"],["formGroupName","otherData",1,"inputs-container"],[1,"buttons-container"],[1,"button-subtitle-container"],["type","button",3,"disabled"],[1,"input-wrapper"],["color","light",1,"custom"],["formControlName","email","type","email",1,"custom",3,"ionFocus","ionBlur"],["slot","end","color","danger","name","close-circle-outline"],["color","danger",1,"error-text"],["formControlName","username","type","text",1,"custom",3,"ionFocus"],["formControlName","password","type","password",1,"custom",3,"ionFocus","clearOnEdit"],["slot","end","color","light"],[1,"input-wrapper-row"],["slot","start",3,"click"],["alt","Avatar de usuario por defecto",3,"src"],[1,"custom"],["formControlName","firstName","type","text",1,"custom",3,"ionFocus"],["formControlName","lastName","type","text",1,"custom",3,"ionFocus"],["formControlName","address","type","text",1,"custom",3,"ionFocus"],[1,"country-zipcode-container"],[1,"input-wrapper","zipcode-input"],["formControlName","zipcode","type","text","maxlength","5","inputmode","numeric",1,"custom",3,"ionFocus"],[1,"input-wrapper","country-input-wrapper"],["formControlName","country","aria-label","Country","interface","action-sheet",1,"custom","select-input",3,"interfaceOptions"],["slot","start","name","globe-outline"],["color","light",3,"value"],[1,"roles-subtitle"],[1,"checkboxes-container"],[1,"checkbox-wrapper"],[1,"input-wrapper","bio-wrapper"],["formControlName","bio",1,"custom",3,"ionFocus"],["labelPlacement","end","color","light",3,"ionChange","value"],[3,"click","disabled"],["name","crescent"],[1,"inline-link",3,"routerLink"],["type","button",3,"click","disabled"]],template:function(s,_){if(s&1&&(r(0,"form",0),d(1,Pt,7,2,"div",1)(2,Lt,17,4,"div",2)(3,Jt,29,6,"div",3)(4,Wt,13,0,"div",4),a(),r(5,"div",5),d(6,ei,8,4,"div",6)(7,ii,3,2,"ion-button",7)(8,oi,3,2,"ion-button",7)(9,li,4,3),a()),s&2){let C,y;v("formGroup",_.registerForm),c(),p((C=_.step())===1?1:C===2?2:C===3?3:C===4?4:-1),c(5),p((y=_.step())===1?6:y===2?7:y===3?8:y===4?9:-1)}},dependencies:[Ne,_e,Le,Me,Re,Ie,ke,Ee,Oe,Te,Pe,Ue,Ae,De,Ce,ge,xe,Se,he,be,ve],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1 0 0;justify-content:space-between;gap:2rem}ion-datetime-button.custom[_ngcontent-%COMP%]{min-height:3rem}ion-datetime-button[_ngcontent-%COMP%]::part(native){background-color:var(--ion-color-dark-tint);display:flex;flex-direction:row;align-items:center;align-self:stretch;gap:.5rem}.country-zipcode-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.zipcode-input[_ngcontent-%COMP%]{width:35%}.country-input-wrapper[_ngcontent-%COMP%]{width:70%;max-width:calc(70% - 3rem)}.roles-subtitle[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--ion-color-light-shade);font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.checkboxes-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem}.checkbox-wrapper[_ngcontent-%COMP%]{display:flex;width:8rem}.bio-wrapper[_ngcontent-%COMP%]{margin-top:1rem}.buttons-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.buttons-container[_ngcontent-%COMP%]:has(ion-button.ios){margin-bottom:24px}.buttons-container[_ngcontent-%COMP%]   .button-subtitle-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}.custom-action-sheet[_ngcontent-%COMP%]{--button-color: var(--ion-color-light);--button-background-hover: var(--ion-color-light-tint);--button-color-activated: var(--ion-color-light-shade)}"]});let t=e;return t})()});var ut,pt=N(()=>{"use strict";R();bt();Ge();xt();gt();Ct();R();ut=(()=>{let o=class o{constructor(){this.authService=S(Qe),this.cartService=S(et),this.cache=S($e),this.profilePictureDataURL=x(null),this.loading=x(!1),this.errorMessage=x(""),this.registerState=P(()=>{var e;return{profilePictureDataURL:(e=this.profilePictureDataURL())!=null?e:"",loading:this.loading(),errorMessage:this.errorMessage()}}),this.getAvatarData=()=>b(this,null,function*(){try{let e=yield at.getPhoto({quality:80,allowEditing:!1,resultType:ot.DataUrl,source:nt.Prompt});this.profilePictureDataURL.set(e.dataUrl)}catch(e){console.error(`Error al seleccionar avatar: ${e}`)}}),this.setAvatarDataNotNative=e=>{var _;let i=e.target;if(!((_=i.files)!=null&&_.length))return;let l=i.files[0],s=new FileReader;s.onload=()=>{let C=s.result;this.profilePictureDataURL.set(C)},s.readAsDataURL(l)},this.removeProfilePicture=()=>b(this,null,function*(){this.profilePictureDataURL.set(null)}),this.registerUser=e=>b(this,null,function*(){var i,l,s,_,C,y,M,ee,te,ie,ne,oe;this.loading.set(!0);try{let I=yield this.cache.get("fcmToken"),ae=yield this.authService.register({method:"email",userData:{email:(i=e.email)!=null?i:"",username:(l=e.username)!=null?l:"",password:(s=e.password)!=null?s:"",name:{first:(_=e.firstName)!=null?_:"",last:(C=e.lastName)!=null?C:""},address:{line1:(y=e.address)!=null?y:"",city:(M=e.city)!=null?M:"",country:(ee=e.country)!=null?ee:"",zipcode:(te=e.zipcode)!=null?te:""},roles:(ie=e.roles)!=null?ie:[],bio:(ne=e.bio)!=null?ne:"",fcmToken:I,profilePictureDataURL:(oe=this.profilePictureDataURL())!=null?oe:""}});ze(ae)&&(yield this.cartService.createCart(ae._id)),this.loading.set(!1),this.errorMessage.set("")}catch(I){console.error(I),this.loading.set(!1),this.errorMessage.set(I)}})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=le({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})()});function mi(t,o){t&1&&(r(0,"h1"),m(1,"\xBFCu\xE1l es tu email?"),a(),r(2,"h4"),m(3,"Introduce el email con el que quieres iniciar sesi\xF3n en BeatMarket"),a())}function ci(t,o){t&1&&(r(0,"h1"),m(1,"Rellena tus datos de usuario"),a())}function ui(t,o){t&1&&(r(0,"h1"),m(1,"Rellena tus datos personales"),a())}function pi(t,o){t&1&&(r(0,"h1"),m(1,"Cu\xE9ntanos sobre ti"),a())}var si,on,di=N(()=>{R();dt();_t();Be();Ze();Xe();ct();pt();ft();fe();ht();R();si=["fileInput"];on=(()=>{let o=class o{constructor(){this.router=S(de),this.registerService=S(ut),this.registerFormComponent=H(Z),this.step=x(1),this.totalSteps=4,this.progressBarValue=P(()=>this.step()/this.totalSteps),this.errorMessage=P(()=>this.registerService.registerState().errorMessage),this.profilePictureDataURL=P(()=>this.registerService.registerState().profilePictureDataURL),this.submitAttempts={email:x(!1),userData:x(!1),personalData:x(!1),register:x(!1)},this.loadingStates={email:x(!1),userData:x(!1),personalData:x(!1),register:pe(()=>this.registerService.registerState().loading)},this.nextStep=()=>{var e,i,l;if(this.step()===1){this.submitAttempts.email.set(!0),this.handleNextStepEmail((e=this.registerFormComponent())==null?void 0:e.registerForm);return}if(this.step()===2){this.submitAttempts.userData.set(!0),this.handleNextStepUserData((i=this.registerFormComponent())==null?void 0:i.registerForm);return}if(this.step()===3){this.submitAttempts.personalData.set(!0),this.handleNextStepPersonalData((l=this.registerFormComponent())==null?void 0:l.registerForm);return}},this.prevStep=()=>{this.step.set(this.step()-1)},this.fileInput=H("fileInput"),this.onAvatarUpload=()=>b(this,null,function*(){var e;je.isNativePlatform()?yield this.registerService.getAvatarData():(e=this.fileInput())==null||e.nativeElement.click()}),this.handleFileInput=e=>{this.registerService.setAvatarDataNotNative(e)},this.handleNextStepEmail=e=>b(this,null,function*(){var l;let i=e==null?void 0:e.get("emailData.email");if(i&&(i==null||i.updateValueAndValidity(),i.pending&&(this.loadingStates.email.set(!0),yield U(i.statusChanges.pipe(L(s=>s!=="PENDING"))),this.loadingStates.email.set(!1)),(l=e==null?void 0:e.get("emailData"))!=null&&l.valid)){this.step.set(this.step()+1);return}}),this.handleNextStepUserData=e=>b(this,null,function*(){var s;let i=e==null?void 0:e.get("userData.username"),l=e==null?void 0:e.get("userData.password");!i||!l||(i==null||i.updateValueAndValidity(),l==null||l.updateValueAndValidity(),i.pending&&(this.loadingStates.userData.set(!0),yield U(i.statusChanges.pipe(L(_=>_!=="PENDING"))),this.loadingStates.userData.set(!1)),(s=e==null?void 0:e.get("userData"))!=null&&s.valid&&this.step.set(this.step()+1))}),this.handleNextStepPersonalData=e=>b(this,null,function*(){var y;let i=e==null?void 0:e.get("personalData.firstName"),l=e==null?void 0:e.get("personalData.lastName"),s=e==null?void 0:e.get("personalData.address"),_=e==null?void 0:e.get("personalData.zipcode"),C=e==null?void 0:e.get("personalData.country");!i||!l||!s||!_||!C||(i==null||i.updateValueAndValidity(),l==null||l.updateValueAndValidity(),s==null||s.updateValueAndValidity(),_==null||_.updateValueAndValidity(),C==null||C.updateValueAndValidity(),i.pending&&(this.loadingStates.personalData.set(!0),yield U(i.statusChanges.pipe(L(M=>M!=="PENDING"))),this.loadingStates.personalData.set(!1)),(y=e==null?void 0:e.get("personalData"))!=null&&y.valid&&this.step.set(this.step()+1))}),z({arrowBackOutline:He})}ionViewDidLeave(){this.registerService.removeProfilePicture()}onControlFocus(e){this.submitAttempts.email.set(!1),this.submitAttempts.userData.set(!1),this.submitAttempts.personalData.set(!1),this.submitAttempts.register.set(!1)}handleRegister(){return b(this,null,function*(){var i;let e=(i=this.registerFormComponent())==null?void 0:i.registerForm;yield this.registerService.registerUser(A(A(A(A({},e==null?void 0:e.value.emailData),e==null?void 0:e.value.userData),e==null?void 0:e.value.personalData),e==null?void 0:e.value.otherData)),this.errorMessage()||this.router.navigate(["/auth/welcome"])})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=B({type:o,selectors:[["app-register"]],viewQuery:function(i,l){i&1&&(K(l.registerFormComponent,Z,5),K(l.fileInput,si,5)),i&2&&ce(2)},decls:13,vars:12,consts:[["fileInput",""],["type","arrow-back","title","Registro",3,"backPressed","showSearch","showCart","showProgressBar","progressBarValue","backActionType"],[3,"fullscreen"],[1,"container"],[1,"title-form-container"],[1,"title-container"],[3,"controlFocus","uploadAvatar","nextStep","formSubmit","step","submitAttempts","loadingStates","avatarDataURL","authProviderErrorMessage"],["type","file","accept","image/*","hidden","",3,"change"]],template:function(i,l){if(i&1){let s=D();r(0,"ion-header")(1,"app-toolbar",1),h("backPressed",function(){return f(s),g(l.prevStep())}),a()(),r(2,"ion-content",2)(3,"div",3)(4,"div",4)(5,"div",5),d(6,mi,4,0)(7,ci,2,0,"h1")(8,ui,2,0,"h1")(9,pi,2,0,"h1"),a(),r(10,"app-register-form",6),h("controlFocus",function(C){return f(s),g(l.onControlFocus(C))})("uploadAvatar",function(){return f(s),g(l.onAvatarUpload())})("nextStep",function(){return f(s),g(l.nextStep())})("formSubmit",function(){return f(s),g(l.handleRegister())}),a(),r(11,"input",7,0),h("change",function(C){return f(s),g(l.handleFileInput(C))}),a()()()()}if(i&2){let s;c(),v("showSearch",!1)("showCart",!1)("showProgressBar",!0)("progressBarValue",l.progressBarValue())("backActionType",l.step()===1?"default":"emit"),c(),v("fullscreen",!0),c(4),p((s=l.step())===1?6:s===2?7:s===3?8:s===4?9:-1),c(4),v("step",l.step())("submitAttempts",l.submitAttempts)("loadingStates",l.loadingStates)("avatarDataURL",l.profilePictureDataURL())("authProviderErrorMessage",l.errorMessage())}},dependencies:[tt,Fe,Ve,Z],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;min-height:100%;gap:1rem}.title-form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;gap:1.5rem}.title-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-light)}"]});let t=o;return t})()});di();export{on as RegisterPage};
