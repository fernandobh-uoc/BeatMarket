import{a as lt,b as Dt}from"./chunk-UIHM3IIJ.js";import{a as st,b as mt,c as ct,d as Et}from"./chunk-OWPIXBBY.js";import{a as rt,b as wt}from"./chunk-SWFIUNRV.js";import{D as at,a as Z,b as Xe,c as et,d as tt,i as it,k as nt,o as ot}from"./chunk-D4UN2WVJ.js";import"./chunk-26KUR5UJ.js";import{a as H,b as He,c as L,e as Ze,f as Ye,j as Je,m as vt,p as Ke,q as bt,v as We,w as St}from"./chunk-GIZGGZ62.js";import{$ as ke,Aa as $e,Ba as Qe,N as Ve,P as Te,R as $,S as Pe,Z as Ae,aa as Ie,c as R,ca as Ne,d as he,e as ve,ga as Me,i as be,j as Se,ja as Ue,k as we,ka as Le,l as De,na as Oe,pa as Be,q as Ee,qa as qe,s as ye,u as Re,ua as ze,v as Fe,va as Q,wa as Ge,za as je}from"./chunk-XVXSUTZI.js";import{Aa as E,B as me,Ea as y,F as D,Fa as v,Ga as p,Ib as ge,Jb as xe,N as x,Nb as Ce,O as C,Oa as ne,Pa as pe,Sa as c,Ta as oe,Ua as de,X as A,Y as k,_ as h,_a as _e,aa as ce,ba as u,ga as ee,ha as j,jb as I,lb as fe,ma as f,n as z,o as Ct,pb as P,sa as S,t as G,ua as d,va as ue,wa as te,xa as ie,y as ht,ya as l,za as r}from"./chunk-LBGYGD76.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as M,f as U,j as T,k as V,l as q,m as se,o as w}from"./chunk-FIPIWZQS.js";var J,Y,ut=U(()=>{"use strict";P();He();Y=class{constructor(){V(this,J,D(H))}validate(){return o=>w(this,null,function*(){return(yield T(this,J).getUserByEmail(o.value.toLowerCase(),!1))?{emailExists:!0}:null})}};J=new WeakMap});var W,K,pt=U(()=>{"use strict";P();He();K=class{constructor(){V(this,W,D(H))}validate(){return o=>w(this,null,function*(){return(yield T(this,W).getUserByUsername(o.value))?{usernameExists:!0}:null})}};W=new WeakMap});function Ft(e,o){e&1&&E(0,"ion-icon",11)}function Vt(e,o){if(e&1&&f(0,Ft,1,0,"ion-icon",11),e&2){let t,n=p(2);d(!((t=n.registerForm.get("emailData.email"))!=null&&t.pending)&&((t=n.registerForm.get("emailData.email"))!=null&&t.invalid)?0:-1)}}function Tt(e,o){e&1&&(l(0,"ion-text",12),c(1,"El email es obligatorio"),r())}function Pt(e,o){e&1&&(l(0,"ion-text",12),c(1,"El email es inv\xE1lido"),r())}function At(e,o){e&1&&(l(0,"ion-text",12),c(1,"El email ya est\xE1 en uso"),r())}function kt(e,o){if(e&1&&f(0,Tt,2,0,"ion-text",12)(1,Pt,2,0,"ion-text",12)(2,At,2,0,"ion-text",12),e&2){let t,n,a,g=p(2);d(!((t=g.registerForm.get("emailData.email"))==null||t.errors==null)&&t.errors.required?0:-1),u(),d(!((n=g.registerForm.get("emailData.email"))==null||n.errors==null)&&n.errors.email?1:-1),u(),d(!((a=g.registerForm.get("emailData.email"))==null||a.errors==null)&&a.errors.emailExists?2:-1)}}function It(e,o){if(e&1){let t=y();l(0,"div",1)(1,"div",8)(2,"ion-label",9),c(3,"Email"),r(),l(4,"ion-input",10),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("email"))})("ionBlur",function(){x(t);let a=p();return C(a.controlBlur.emit("email"))}),f(5,Vt,1,1),r(),f(6,kt,3,3),r()()}if(e&2){let t,n=p();u(5),d(n.submitAttempts().email()?5:-1),u(),d(n.submitAttempts().email()&&((t=n.registerForm.get("emailData.email"))!=null&&t.errors)?6:-1)}}function Nt(e,o){e&1&&(l(0,"ion-text",12),c(1,"El nombre de usuario es obligatorio"),r())}function Mt(e,o){e&1&&(l(0,"ion-text",12),c(1,"El nombre de usuario es demasiado corto"),r())}function Ut(e,o){e&1&&(l(0,"ion-text",12),c(1,"Ese nombre de usuario ya est\xE1 en uso"),r())}function Lt(e,o){if(e&1&&f(0,Nt,2,0,"ion-text",12)(1,Mt,2,0,"ion-text",12)(2,Ut,2,0,"ion-text",12),e&2){let t,n,a,g=p(2);d(!((t=g.registerForm.get("userData.username"))==null||t.errors==null)&&t.errors.required?0:-1),u(),d(!((n=g.registerForm.get("userData.username"))==null||n.errors==null)&&n.errors.minlength?1:-1),u(),d(!((a=g.registerForm.get("userData.username"))==null||a.errors==null)&&a.errors.usernameExists?2:-1)}}function Ot(e,o){e&1&&(l(0,"ion-text",12),c(1,"La contrase\xF1a es obligatoria"),r())}function Bt(e,o){e&1&&(l(0,"ion-text",12),c(1,"La contrase\xF1a debe tener al menos 6 caracteres, una letra y un n\xFAmero"),r())}function qt(e,o){if(e&1&&f(0,Ot,2,0,"ion-text",12)(1,Bt,2,0,"ion-text",12),e&2){let t,n,a=p(2);d(!((t=a.registerForm.get("userData.password"))==null||t.errors==null)&&t.errors.required?0:-1),u(),d(!((n=a.registerForm.get("userData.password"))==null||n.errors==null)&&n.errors.pattern?1:-1)}}function zt(e,o){if(e&1){let t=y();l(0,"div",2)(1,"div",8)(2,"ion-label",9),c(3,"Nombre de usuario"),r(),l(4,"ion-input",13),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("userData"))}),r(),f(5,Lt,3,3),r(),l(6,"div",8)(7,"ion-label",9),c(8,"Contrase\xF1a"),r(),l(9,"ion-input",14),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("userData"))}),E(10,"ion-input-password-toggle",15),r(),f(11,qt,2,2),r(),l(12,"div",16)(13,"ion-label",9),c(14,"Avatar (opcional)"),r(),l(15,"ion-avatar",17),v("click",function(){x(t);let a=p();return C(a.uploadAvatar.emit())}),E(16,"img",18),r()()()}if(e&2){let t,n,a=p();u(5),d(a.submitAttempts().userData()&&((t=a.registerForm.get("userData.username"))!=null&&t.errors)?5:-1),u(6),d(a.submitAttempts().userData()&&((n=a.registerForm.get("userData.password"))!=null&&n.errors)?11:-1),u(5),S("src",a.avatarDataURL()||"../../../../../../assets/user-avatar-default-shade.svg",ce)}}function Gt(e,o){e&1&&(l(0,"ion-text",12),c(1,"El nombre es obligatorio"),r())}function jt(e,o){if(e&1&&f(0,Gt,2,0,"ion-text",12),e&2){let t,n=p(2);d(!((t=n.registerForm.get("personalData.firstName"))==null||t.errors==null)&&t.errors.required?0:-1)}}function $t(e,o){e&1&&(l(0,"ion-text",12),c(1,"Los apellidos son obligatorios"),r())}function Qt(e,o){if(e&1&&f(0,$t,2,0,"ion-text",12),e&2){let t,n=p(2);d(!((t=n.registerForm.get("personalData.lastName"))==null||t.errors==null)&&t.errors.required?0:-1)}}function Ht(e,o){e&1&&(l(0,"ion-text",12),c(1,"La direcci\xF3n es obligatoria"),r())}function Zt(e,o){if(e&1&&f(0,Ht,2,0,"ion-text",12),e&2){let t,n=p(2);d(!((t=n.registerForm.get("personalData.address"))==null||t.errors==null)&&t.errors.required?0:-1)}}function Yt(e,o){e&1&&(l(0,"ion-text",12),c(1,"El c\xF3digo postal es obligatorio"),r())}function Jt(e,o){e&1&&(l(0,"ion-text",12),c(1,"El c\xF3digo postal es demasiado corto"),r())}function Kt(e,o){if(e&1&&f(0,Yt,2,0,"ion-text",12)(1,Jt,2,0,"ion-text",12),e&2){let t,n,a=p(2);d(!((t=a.registerForm.get("personalData.zipcode"))==null||t.errors==null)&&t.errors.required?0:-1),u(),d(!((n=a.registerForm.get("personalData.zipcode"))==null||n.errors==null)&&n.errors.minlength?1:-1)}}function Wt(e,o){if(e&1&&(l(0,"ion-select-option",29),c(1),r()),e&2){let t=o.$implicit;S("value",t.nameES),u(),oe(t.nameES)}}function Xt(e,o){if(e&1){let t=y();l(0,"div",3)(1,"div",8)(2,"ion-label",19),c(3,"Nombre"),r(),l(4,"ion-input",20),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("personalData"))}),r(),f(5,jt,1,1),r(),l(6,"div",8)(7,"ion-label",9),c(8,"Apellidos"),r(),l(9,"ion-input",21),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("personalData"))}),r(),f(10,Qt,1,1),r(),l(11,"div",8)(12,"ion-label",9),c(13,"Direcci\xF3n"),r(),l(14,"ion-input",22),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("personalData"))}),r(),f(15,Zt,1,1),r(),l(16,"div",23)(17,"div",24)(18,"ion-label",9),c(19,"C\xF3digo postal"),r(),l(20,"ion-input",25),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("personalData"))}),r(),f(21,Kt,2,2),r(),l(22,"div",26)(23,"ion-label",9),c(24,"Pa\xEDs"),r(),l(25,"ion-select",27),E(26,"ion-icon",28),te(27,Wt,2,2,"ion-select-option",29,Rt),r()()()()}if(e&2){let t,n,a,g,i=p();u(5),d(i.submitAttempts().personalData()&&((t=i.registerForm.get("personalData.firstName"))!=null&&t.errors)?5:-1),u(5),d(i.submitAttempts().personalData()&&((n=i.registerForm.get("personalData.lastName"))!=null&&n.errors)?10:-1),u(5),d(i.submitAttempts().personalData()&&((a=i.registerForm.get("personalData.address"))!=null&&a.errors)?15:-1),u(6),d(i.submitAttempts().personalData()&&((g=i.registerForm.get("personalData.zipcode"))!=null&&g.errors)?21:-1),u(6),ie(i.countries)}}function ei(e,o){if(e&1){let t=y();l(0,"div",32)(1,"ion-checkbox",35),v("ionChange",function(a){x(t);let g=p(2);return C(g.onRoleChange(a))}),c(2),r()()}if(e&2){let t=o.$implicit;u(),S("value",t),u(),de(" ",t," ")}}function ti(e,o){if(e&1){let t=y();l(0,"div",4)(1,"div",8)(2,"ion-label",9),c(3,"Roles (opcional)"),r(),l(4,"ion-text",30),c(5,"Elige los roles que m\xE1s se identifiquen con tu actividad musical"),r(),l(6,"div",31),te(7,ei,3,2,"div",32,ue),r()(),l(9,"div",33)(10,"ion-label",9),c(11,"Biograf\xEDa (opcional)"),r(),l(12,"ion-textarea",34),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("otherData"))}),r()()()}if(e&2){let t=p();u(7),ie(t.roles)}}function ii(e,o){e&1&&E(0,"ion-spinner",37)}function ni(e,o){if(e&1){let t=y();l(0,"div",6)(1,"ion-button",36),v("click",function(){x(t);let a=p();return C(a.nextStep.emit())}),c(2," Continuar "),f(3,ii,1,0,"ion-spinner",37),r(),l(4,"ion-text"),c(5,"\xBFYa tienes cuenta? "),l(6,"a",38),c(7,"Ingresar"),r()()()}if(e&2){let t=p();u(),S("disabled",t.loadingStates().email()),u(2),d(t.loadingStates().email()?3:-1),u(3),S("routerLink",_e(3,yt))}}function oi(e,o){e&1&&E(0,"ion-spinner",37)}function ai(e,o){if(e&1){let t=y();l(0,"ion-button",39),v("click",function(){x(t);let a=p();return C(a.nextStep.emit())}),c(1," Continuar "),f(2,oi,1,0,"ion-spinner",37),r()}if(e&2){let t=p();S("disabled",t.loadingStates().userData()),u(2),d(t.loadingStates().userData()?2:-1)}}function ri(e,o){e&1&&E(0,"ion-spinner",37)}function li(e,o){if(e&1){let t=y();l(0,"ion-button",39),v("click",function(){x(t);let a=p();return C(a.nextStep.emit())}),c(1," Continuar "),f(2,ri,1,0,"ion-spinner",37),r()}if(e&2){let t=p();S("disabled",t.loadingStates().personalData()),u(2),d(t.loadingStates().personalData()?2:-1)}}function si(e,o){if(e&1&&(l(0,"ion-text",12),c(1),r()),e&2){let t=p(2);u(),oe(t.authProviderErrorMessage())}}function mi(e,o){e&1&&E(0,"ion-spinner",37)}function ci(e,o){if(e&1){let t=y();f(0,si,2,1,"ion-text",12),l(1,"ion-button",39),v("click",function(){x(t);let a=p();return C(a.formSubmit.emit())}),c(2," Finalizar "),f(3,mi,1,0,"ion-spinner",37),r()}if(e&2){let t=p();d(t.submitAttempts().register()&&t.authProviderErrorMessage()?0:-1),u(),S("disabled",t.loadingStates().register()),u(2),d(t.loadingStates().register()?3:-1)}}var yt,Rt,X,ft=U(()=>{"use strict";P();Ce();Fe();Qe();ut();pt();Xe();at();Dt();Ye();P();Fe();yt=()=>["/auth/login"],Rt=(e,o)=>o.iso2;X=(()=>{var o,_t;let n=class n{constructor(){V(this,o);this.fb=D(ye),this.emailValidator=new Y,this.usernameValidator=new K,this.step=k(1),this.nextStep=A(),this.formSubmit=A(),this.submitAttempts=k({email:h(!1),userData:h(!1),personalData:h(!1),register:h(!1)}),this.loadingStates=k({email:h(!1),userData:h(!1),personalData:h(!1),register:h(!1)}),this.controlFocus=A(),this.controlBlur=A(),this.uploadAvatar=A(),this.authProviderErrorMessage=k(""),this.formattedDate=h(new Date().toLocaleDateString("es-ES")),this.avatarDataURL=k(""),this.countries=lt,this.roles=[L.Amateur,L.Professional,L.Collector,L.Student],Z({checkmarkCircleOutline:it,closeCircleOutline:nt,calendarOutline:tt,globeOutline:ot})}ngOnInit(){se(this,o,_t).call(this)}onRoleChange(g){let i=this.registerForm.get("otherData.roles");if(g.detail.checked)i.push(this.fb.control(g.detail.value));else{let s=i.controls.findIndex(m=>m.value===g.detail.value);s>=0&&i.removeAt(s)}}};o=new WeakSet,_t=function(){this.registerForm=this.fb.group({emailData:this.fb.group({email:this.fb.control("",{validators:[R.required,R.email],asyncValidators:[this.emailValidator.validate()],updateOn:"blur"})}),userData:this.fb.group({username:this.fb.control("",{validators:[R.required,R.minLength(4)],asyncValidators:[this.usernameValidator.validate()],updateOn:"blur"}),password:this.fb.control("",{validators:[R.required,R.pattern(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/)],updateOn:"blur"})}),personalData:this.fb.group({firstName:this.fb.control("",{validators:[R.required],updateOn:"blur"}),lastName:this.fb.control("",{validators:[R.required],updateOn:"blur"}),address:this.fb.control("",{validators:[R.required],updateOn:"blur"}),zipcode:this.fb.control("",{validators:[R.required,R.minLength(4)],updateOn:"blur"}),country:this.fb.control("",{validators:[R.required],updateOn:"blur"})}),otherData:this.fb.group({roles:this.fb.array([]),bio:this.fb.control("")})})},n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=j({type:n,selectors:[["app-register-form"]],inputs:{step:[1,"step"],submitAttempts:[1,"submitAttempts"],loadingStates:[1,"loadingStates"],authProviderErrorMessage:[1,"authProviderErrorMessage"],avatarDataURL:[1,"avatarDataURL"]},outputs:{nextStep:"nextStep",formSubmit:"formSubmit",controlFocus:"controlFocus",controlBlur:"controlBlur",uploadAvatar:"uploadAvatar"},decls:10,vars:3,consts:[[3,"formGroup"],["formGroupName","emailData",1,"inputs-container"],["formGroupName","userData",1,"inputs-container"],["formGroupName","personalData",1,"inputs-container"],["formGroupName","otherData",1,"inputs-container"],[1,"buttons-container"],[1,"button-subtitle-container"],["type","button",3,"disabled"],[1,"input-wrapper"],["color","light",1,"custom"],["formControlName","email","type","email",1,"custom",3,"ionFocus","ionBlur"],["slot","end","color","danger","name","close-circle-outline"],["color","danger",1,"error-text"],["formControlName","username","type","text",1,"custom",3,"ionFocus"],["formControlName","password","type","password",1,"custom",3,"ionFocus"],["slot","end","color","light"],[1,"input-wrapper-row"],["slot","start",3,"click"],["alt","Avatar de usuario por defecto",3,"src"],[1,"custom"],["formControlName","firstName","type","text",1,"custom",3,"ionFocus"],["formControlName","lastName","type","text",1,"custom",3,"ionFocus"],["formControlName","address","type","text",1,"custom",3,"ionFocus"],[1,"country-zipcode-container"],[1,"input-wrapper","zipcode-input"],["formControlName","zipcode","type","text","maxlength","5","inputmode","numeric",1,"custom",3,"ionFocus"],[1,"input-wrapper","country-input-wrapper"],["formControlName","country","aria-label","Country","interface","action-sheet","color","light",1,"custom","select-input"],["slot","start","name","globe-outline"],[3,"value"],[1,"roles-subtitle"],[1,"checkboxes-container"],[1,"checkbox-wrapper"],[1,"input-wrapper","bio-wrapper"],["formControlName","bio",1,"custom",3,"ionFocus"],["labelPlacement","end","color","light",3,"ionChange","value"],[3,"click","disabled"],["name","crescent"],[1,"inline-link",3,"routerLink"],["type","button",3,"click","disabled"]],template:function(i,s){if(i&1&&(l(0,"form",0),f(1,It,7,2,"div",1)(2,zt,17,3,"div",2)(3,Xt,29,4,"div",3)(4,ti,13,0,"div",4),r(),l(5,"div",5),f(6,ni,8,4,"div",6)(7,ai,3,2,"ion-button",7)(8,li,3,2,"ion-button",7)(9,ci,4,3),r()),i&2){let m,_;S("formGroup",s.registerForm),u(),d((m=s.step())===1?1:m===2?2:m===3?3:m===4?4:-1),u(5),d((_=s.step())===1?6:_===2?7:_===3?8:_===4?9:-1)}},dependencies:[Le,xe,$e,ze,$,Q,Oe,Te,Ge,Ie,Ne,je,Ue,Re,be,he,ve,Ee,Se,De,we],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1 0 0;justify-content:space-between}ion-datetime-button.custom[_ngcontent-%COMP%]{min-height:3rem}ion-datetime-button[_ngcontent-%COMP%]::part(native){background-color:var(--ion-color-dark-tint);display:flex;flex-direction:row;align-items:center;align-self:stretch;gap:.5rem}.country-zipcode-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.zipcode-input[_ngcontent-%COMP%]{width:35%}.country-input-wrapper[_ngcontent-%COMP%]{width:70%;max-width:calc(70% - 3rem)}.roles-subtitle[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--ion-color-light-shade);font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.checkboxes-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem}.checkbox-wrapper[_ngcontent-%COMP%]{display:flex;width:8rem}.bio-wrapper[_ngcontent-%COMP%]{margin-top:1rem}.buttons-container[_ngcontent-%COMP%]{margin-top:1rem;display:flex;flex-direction:column;align-items:flex-start}.button-subtitle-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}"]});let e=n;return e})()});var gt,xt=U(()=>{"use strict";P();Et();Ye();St();bt();wt();P();gt=(()=>{let o=class o{constructor(){this.authService=D(We),this.cartService=D(rt),this.cache=D(Ke),this.profilePictureDataURL=h(null),this.loading=h(!1),this.errorMessage=h(""),this.registerState=I(()=>{var n;return{profilePictureDataURL:(n=this.profilePictureDataURL())!=null?n:"",loading:this.loading(),errorMessage:this.errorMessage()}}),this.getAvatarData=()=>w(this,null,function*(){try{let n=yield ct.getPhoto({quality:80,allowEditing:!1,resultType:mt.DataUrl,source:st.Prompt});this.profilePictureDataURL.set(n.dataUrl)}catch(n){console.error(`Error al seleccionar avatar: ${n}`)}}),this.setAvatarDataNotNative=n=>{var s;let a=n.target;if(!((s=a.files)!=null&&s.length))return;let g=a.files[0],i=new FileReader;i.onload=()=>{let m=i.result;this.profilePictureDataURL.set(m)},i.readAsDataURL(g)},this.registerUser=n=>w(this,null,function*(){var a,g,i,s,m,_,b,F,N,O,ae,re;this.loading.set(!0);try{let B=yield this.cache.get("fcmToken"),le=yield this.authService.register({method:"email",userData:{email:(a=n.email)!=null?a:"",username:(g=n.username)!=null?g:"",password:(i=n.password)!=null?i:"",name:{first:(s=n.firstName)!=null?s:"",last:(m=n.lastName)!=null?m:""},address:{line1:(_=n.address)!=null?_:"",city:(b=n.city)!=null?b:"",country:(F=n.country)!=null?F:"",zipcode:(N=n.zipcode)!=null?N:""},roles:(O=n.roles)!=null?O:[],bio:(ae=n.bio)!=null?ae:"",fcmToken:B,profilePictureDataURL:(re=this.profilePictureDataURL())!=null?re:""}});Ze(le)&&(yield this.cartService.createCart(le._id)),this.loading.set(!1),this.errorMessage.set("")}catch(B){console.error(B),this.loading.set(!1),this.errorMessage.set(B)}})}};o.\u0275fac=function(a){return new(a||o)},o.\u0275prov=me({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})()});function pi(e,o){if(e&1){let t=y();l(0,"ion-button",12),v("click",function(){x(t);let a=p();return C(a.prevStep())}),E(1,"ion-icon",13),r()}}function di(e,o){e&1&&E(0,"ion-back-button",3)}function _i(e,o){e&1&&(l(0,"h1"),c(1,"\xBFCu\xE1l es tu email?"),r(),l(2,"h4"),c(3,"Introduce el email con el que quieres iniciar sesi\xF3n en BeatMarket"),r())}function fi(e,o){e&1&&(l(0,"h1"),c(1,"Rellena tus datos de usuario"),r())}function gi(e,o){e&1&&(l(0,"h1"),c(1,"Rellena tus datos personales"),r())}function xi(e,o){e&1&&(l(0,"h1"),c(1,"Cu\xE9ntanos sobre ti"),r())}var ui,sn,Ci=U(()=>{P();Ct();ht();Qe();Xe();at();ft();xt();vt();Ce();P();ui=["fileInput"];sn=(()=>{var o,t,n;let a=class a{constructor(){V(this,o);V(this,t);V(this,n);this.router=D(ge),this.registerService=D(gt),this.registerFormComponent=ee(X),this.step=h(1),this.totalSteps=4,this.progress=I(()=>this.step()/this.totalSteps),this.errorMessage=I(()=>this.registerService.registerState().errorMessage),this.profilePictureDataURL=I(()=>this.registerService.registerState().profilePictureDataURL),this.submitAttempts={email:h(!1),userData:h(!1),personalData:h(!1),register:h(!1)},this.loadingStates={email:h(!1),userData:h(!1),personalData:h(!1),register:fe(()=>this.registerService.registerState().loading)},this.nextStep=()=>{var i,s,m;if(this.step()===1){this.submitAttempts.email.set(!0),T(this,o).call(this,(i=this.registerFormComponent())==null?void 0:i.registerForm);return}if(this.step()===2){this.submitAttempts.userData.set(!0),T(this,t).call(this,(s=this.registerFormComponent())==null?void 0:s.registerForm);return}if(this.step()===3){this.submitAttempts.personalData.set(!0),T(this,n).call(this,(m=this.registerFormComponent())==null?void 0:m.registerForm);return}},this.prevStep=()=>{this.step.set(this.step()-1)},this.fileInput=ee("fileInput"),this.onAvatarUpload=()=>w(this,null,function*(){var i;Je.isNativePlatform()?yield this.registerService.getAvatarData():(i=this.fileInput())==null||i.nativeElement.click()}),this.handleFileInput=i=>{this.registerService.setAvatarDataNotNative(i)},q(this,o,i=>w(this,null,function*(){var m;let s=i==null?void 0:i.get("emailData.email");if(s&&(s==null||s.updateValueAndValidity(),s.pending&&(this.loadingStates.email.set(!0),yield z(s.statusChanges.pipe(G(_=>_!=="PENDING"))),this.loadingStates.email.set(!1)),(m=i==null?void 0:i.get("emailData"))!=null&&m.valid)){this.step.set(this.step()+1);return}})),q(this,t,i=>w(this,null,function*(){var _;let s=i==null?void 0:i.get("userData.username"),m=i==null?void 0:i.get("userData.password");!s||!m||(s==null||s.updateValueAndValidity(),m==null||m.updateValueAndValidity(),s.pending&&(this.loadingStates.userData.set(!0),yield z(s.statusChanges.pipe(G(b=>b!=="PENDING"))),this.loadingStates.userData.set(!1)),(_=i==null?void 0:i.get("userData"))!=null&&_.valid&&this.step.set(this.step()+1))})),q(this,n,i=>w(this,null,function*(){var N;let s=i==null?void 0:i.get("personalData.firstName"),m=i==null?void 0:i.get("personalData.lastName"),_=i==null?void 0:i.get("personalData.address"),b=i==null?void 0:i.get("personalData.zipcode"),F=i==null?void 0:i.get("personalData.country");!s||!m||!_||!b||!F||(s==null||s.updateValueAndValidity(),m==null||m.updateValueAndValidity(),_==null||_.updateValueAndValidity(),b==null||b.updateValueAndValidity(),F==null||F.updateValueAndValidity(),s.pending&&(this.loadingStates.personalData.set(!0),yield z(s.statusChanges.pipe(G(O=>O!=="PENDING"))),this.loadingStates.personalData.set(!1)),(N=i==null?void 0:i.get("personalData"))!=null&&N.valid&&this.step.set(this.step()+1))})),Z({arrowBackOutline:et})}onControlFocus(i){this.submitAttempts.email.set(!1),this.submitAttempts.userData.set(!1),this.submitAttempts.personalData.set(!1),this.submitAttempts.register.set(!1)}handleRegister(){return w(this,null,function*(){var s;let i=(s=this.registerFormComponent())==null?void 0:s.registerForm;yield this.registerService.registerUser(M(M(M(M({},i==null?void 0:i.value.emailData),i==null?void 0:i.value.userData),i==null?void 0:i.value.personalData),i==null?void 0:i.value.otherData)),this.errorMessage()||this.router.navigate(["/auth/welcome"])})}};o=new WeakMap,t=new WeakMap,n=new WeakMap,a.\u0275fac=function(s){return new(s||a)},a.\u0275cmp=j({type:a,selectors:[["app-register"]],viewQuery:function(s,m){s&1&&(ne(m.registerFormComponent,X,5),ne(m.fileInput,ui,5)),s&2&&pe(2)},decls:19,vars:10,consts:[["fileInput",""],["color","dark"],["slot","start"],["defaultHref","/auth/welcome","icon","arrow-back-outline","color","light"],["size","large"],[3,"value"],[3,"fullscreen"],[1,"container"],[1,"title-form-container"],[1,"title-container"],[3,"controlFocus","uploadAvatar","nextStep","formSubmit","step","submitAttempts","loadingStates","avatarDataURL","authProviderErrorMessage"],["type","file","accept","image/*","hidden","",3,"change"],[3,"click"],["slot","icon-only","name","arrow-back-outline","color","light"]],template:function(s,m){if(s&1){let _=y();l(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),f(3,pi,2,0,"ion-button")(4,di,1,0,"ion-back-button",3),r(),l(5,"ion-title",4),c(6,"Registro"),r(),E(7,"ion-progress-bar",5),r()(),l(8,"ion-content",6)(9,"div",7)(10,"div",8)(11,"div",9),f(12,_i,4,0)(13,fi,2,0,"h1")(14,gi,2,0,"h1")(15,xi,2,0,"h1"),r(),l(16,"app-register-form",10),v("controlFocus",function(F){return x(_),C(m.onControlFocus(F))})("uploadAvatar",function(){return x(_),C(m.onAvatarUpload())})("nextStep",function(){return x(_),C(m.nextStep())})("formSubmit",function(){return x(_),C(m.handleRegister())}),r(),l(17,"input",11,0),v("change",function(F){return x(_),C(m.handleFileInput(F))}),r()()()()}if(s&2){let _;u(3),d(m.step()>1?3:-1),u(),d(m.step()<=1?4:-1),u(3),S("value",m.progress()),u(),S("fullscreen",!0),u(4),d((_=m.step())===1?12:_===2?13:_===3?14:_===4?15:-1),u(4),S("step",m.step())("submitAttempts",m.submitAttempts)("loadingStates",m.loadingStates)("avatarDataURL",m.profilePictureDataURL())("authProviderErrorMessage",m.errorMessage())}},dependencies:[Ae,ke,Me,Q,Pe,Ve,Be,qe,$,X],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;min-height:100%;gap:1rem}.title-form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;gap:1.5rem}.title-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-light)}"]});let e=a;return e})()});Ci();export{sn as RegisterPage};
