import{a as Ve,b as rt}from"./chunk-ESNBI2AA.js";import{a as Fe,b as nt}from"./chunk-K4X2YLKW.js";import{a as ze,b as tt}from"./chunk-SZG4CGCH.js";import{a as H,b as Ue}from"./chunk-SWFIUNRV.js";import{D as et,a as Ee,b as Ze,h as Le}from"./chunk-D4UN2WVJ.js";import"./chunk-XZOZKGXX.js";import{a as Ae,b as it}from"./chunk-ATV22YZD.js";import{b as Re,c as Xe}from"./chunk-26KUR5UJ.js";import{v as G,w as Te}from"./chunk-GIZGGZ62.js";import{$ as Oe,Ba as We,P as ye,R as Me,Z as be,ka as we,na as Ie,pa as Se,qa as De,t as xe,v as Qe,va as ke}from"./chunk-XVXSUTZI.js";import{$a as _e,Aa as v,B as ce,Ea as E,F as h,Fa as L,Ga as f,Gb as fe,Ib as Ce,Ja as ge,Jb as ve,N as R,Nb as Pe,O as T,Ra as J,Sa as p,Ta as K,Ua as P,Y as me,_ as M,_a as U,aa as de,ab as z,ba as s,bb as F,ha as j,jb as I,ka as B,kb as q,l as V,ma as b,pb as x,sa as O,ta as pe,ua as w,va as ue,wa as N,x as Je,xa as $,xb as he,ya as a,za as o,zb as Ke}from"./chunk-LBGYGD76.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{f as D,o as k}from"./chunk-FIPIWZQS.js";var je,Be=D(()=>{"use strict";x();Je();it();Te();Ue();Xe();Pe();rt();x();je=(()=>{let n=class n{constructor(){this.postRepository=h(Ae),this.cartService=h(H),this.authService=h(G),this.conversationService=h(Ve),this.router=h(Ce),this.postId=M(void 0),this.errorMessage=M(""),this.postResource=Re({request:()=>this.postId(),loader:({request:e})=>{var i;if(!e)return V(null);try{let r=this.postRepository.getPostById$(e);return r!=null?r:V(null)}catch(r){return this.errorMessage.set((i=r==null?void 0:r.message)!=null?i:"Unknown error"),V(null)}}}),this.postDetailState=I(()=>{var e;return{postData:(e=this.postResource.value())!=null?e:null,loading:this.postResource.isLoading(),errorMessage:this.errorMessage()}})}setPostId(e){this.postId.set(e)}addToCart(e){return k(this,null,function*(){try{yield this.cartService.addItemToCart({postId:e.postId,title:e.title,price:e.price,shipping:e.shipping,mainImageURL:e.mainImageURL})}catch(i){throw console.error(i),this.errorMessage.set(i),i}})}loadConversation(){return k(this,null,function*(){var e,i,r,m,d,g,u,_,C,c,S,Q,W,X,Z,ee,te,ne,ie,re,oe,ae,le,se;try{let y=this.postId();if(!y)return;let A=yield this.conversationService.getConversationId({postId:y});if(A||(A=yield this.conversationService.createConversation({relatedPostData:{postId:y,title:(i=(e=this.postResource.value())==null?void 0:e.title)!=null?i:"",price:(m=(r=this.postResource.value())==null?void 0:r.price)!=null?m:0,isActive:(g=(d=this.postResource.value())==null?void 0:d.isActive)!=null?g:!1,mainImageURL:(_=(u=this.postResource.value())==null?void 0:u.mainImageURL)!=null?_:""},buyerData:{userId:(c=(C=this.authService.currentUser())==null?void 0:C._id)!=null?c:"",username:(Q=(S=this.authService.currentUser())==null?void 0:S.username)!=null?Q:"",profilePictureURL:(X=(W=this.authService.currentUser())==null?void 0:W.profilePictureURL)!=null?X:""},sellerData:{userId:(te=(ee=(Z=this.postResource.value())==null?void 0:Z.user)==null?void 0:ee.userId)!=null?te:"",username:(re=(ie=(ne=this.postResource.value())==null?void 0:ne.user)==null?void 0:ie.username)!=null?re:"",profilePictureURL:(le=(ae=(oe=this.postResource.value())==null?void 0:oe.user)==null?void 0:ae.profilePictureURL)!=null?le:""}})),!A)return;this.router.navigate([`/conversation/${A}`])}catch(y){this.errorMessage.set((se=y==null?void 0:y.message)!=null?se:"Unknown error")}})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})()});function ot(t,n){if(t&1){let l=E();a(0,"div",3),L("click",function(){let i=R(l).$implicit,r=f();return T(r.selectedImageURL.set(i))}),o()}if(t&2){let l=n.$implicit,e=f();J("background-image: url('",l,"')"),pe("selected",e.selectedImageURL()===l)}}var Ne,$e=D(()=>{"use strict";x();x();Ne=(()=>{let n=class n{constructor(){this.imagesURLs=me([]),this.selectedImageURL=M(""),q(()=>{let e=this.imagesURLs();e&&e.length>0&&this.selectedImageURL.set(e[0])})}ngOnInit(){}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=j({type:n,selectors:[["app-post-images-slider"]],inputs:{imagesURLs:[1,"imagesURLs"]},decls:4,vars:3,consts:[[1,"big-image-container"],[1,"images-row"],[1,"image-container",3,"style","selected"],[1,"image-container",3,"click"]],template:function(i,r){i&1&&(v(0,"div",0),a(1,"div",1),N(2,ot,1,5,"div",2,ue),o()),i&2&&(J("background-image: url('",r.selectedImageURL(),"')"),s(2),$(r.imagesURLs()))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto}.big-image-container[_ngcontent-%COMP%]{margin-bottom:1rem;margin:0rem 0rem 1rem calc(var(--horizontal-margin) * -1);min-width:100dvw;min-height:40dvh;background-size:cover;background-position:center;background-repeat:no-repeat;background-color:var(--ion-color-dark-tint)}.images-row[_ngcontent-%COMP%]{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;justify-content:flex-start}.images-row[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:0 0 auto;width:80px;height:80px;margin-right:1rem;scroll-snap-align:start;border-radius:.5rem;background-size:cover;background-position:center;background-repeat:no-repeat;cursor:pointer}.images-row[_ngcontent-%COMP%]   .image-container.selected[_ngcontent-%COMP%]{border:1px solid var(--ion-color-light-shade)}"]});let t=n;return t})()});var qe,Ge=D(()=>{"use strict";x();qe=(()=>{let n=class n{transform(e){return!e||typeof e!="object"?[]:Object.entries(e).filter(([i,r])=>r!=null).map(([i,r])=>({key:i,value:r}))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275pipe=B({name:"keyValuePairs",type:n,pure:!0});let t=n;return t})()});var He,Ye=D(()=>{"use strict";x();He=(()=>{let n=class n{transform(e,...i){let r={category:"Categor\xEDa",type:"Tipo",brand:"Marca",model:"Modelo",color:"Color",fabricationYear:"A\xF1o de fabricaci\xF3n",serialNumber:"N\xFAmero de serie",instrumentLevel:"Nivel de instrumento",format:"Formato",artist:"Artista",genre:"G\xE9nero",recordingTitle:"T\xEDtulo de la grabaci\xF3n",year:"A\xF1o",duration:"Duraci\xF3n",label:"Etiqueta",catalogNumber:"N\xFAmero de cat\xE1logo",isrc:"ISRC",barcode:"C\xF3digo de barras",releaseDate:"Fecha de publicaci\xF3n",releaseCountry:"Pa\xEDs de publicaci\xF3n",releaseFormat:"Formato de publicaci\xF3n",trackCount:"N\xFAmero de pistas",name:"Nombre",accessories:"Accesorios",warranty:"Garant\xEDa",warrantyDuration:"Duraci\xF3n de la garant\xEDa",warrantyType:"Tipo de garant\xEDa",title:"T\xEDtulo",author:"Autor",theme:"Tema",edition:"Edici\xF3n",publisher:"Editorial",pages:"P\xE1ginas",language:"Idioma",isbn:"ISBN",series:"Serie",volume:"Volumen",description:"Descripci\xF3n"};return r[e]?r[e]:""}};n.\u0275fac=function(i){return new(i||n)},n.\u0275pipe=B({name:"articleCharacteristicsTranslate",type:n,pure:!0});let t=n;return t})()});function pt(t,n){t&1&&(a(0,"div",5),v(1,"ion-spinner",6),o())}function ut(t,n){if(t&1){let l=E();a(0,"div",29),L("click",function(){R(l);let i=f(2);return T(i.goToConversation())}),v(1,"ion-icon",30),o()}}function gt(t,n){t&1&&(a(0,"ion-button",33),p(1,"Ir al carrito"),o()),t&2&&O("routerLink",U(1,mt))}function _t(t,n){if(t&1){let l=E();a(0,"ion-button",35),L("click",function(){R(l);let i=f(4);return T(i.addToCart())}),p(1,"A\xF1adir al carrito"),o()}}function ht(t,n){if(t&1&&b(0,gt,2,2,"ion-button",33)(1,_t,2,0,"ion-button",34),t&2){let l=f(3);w(l.itemIsAdded()?0:1)}}function ft(t,n){t&1&&(a(0,"div",31)(1,"ion-text",36),p(2," Este anuncio ha finalizado "),o()())}function Ct(t,n){if(t&1&&(b(0,ht,2,1)(1,ft,3,0,"div",31),a(2,"ion-button",32),p(3,"Seguir comprando"),o()),t&2){let l,e=f(2);w((l=e.postData())!=null&&l.isActive?0:1),s(2),O("routerLink",U(2,ct))}}function vt(t,n){if(t&1&&(a(0,"ion-text",37)(1,"span",38),p(2),z(3,"articleCharacteristicsTranslate"),o(),p(4),o()),t&2){let l=f().$implicit;s(2),K(F(3,2,l.key)),s(2),P(": ",l.value," ")}}function Pt(t,n){if(t&1&&b(0,vt,5,4,"ion-text",37),t&2){let l=n.$implicit;w(l.value!==""?0:-1)}}function xt(t,n){if(t&1&&(v(0,"app-post-images-slider",7),a(1,"div",8)(2,"ion-text",9),p(3),o(),a(4,"div",10)(5,"div",11)(6,"ion-avatar",12),v(7,"img",13),o(),a(8,"ion-text",14),p(9),o()(),b(10,ut,2,0,"div",15),o()(),a(11,"div",16)(12,"ion-text",17),p(13),z(14,"formatCurrency"),o(),a(15,"ion-text",18),p(16),z(17,"formatCurrency"),o()(),a(18,"div",19),b(19,Ct,4,3),o(),a(20,"div",20)(21,"ion-text",21),p(22,"Estado"),o(),a(23,"ion-text",22),p(24),o()(),a(25,"div",23)(26,"ion-text",24),p(27,"Descripci\xF3n"),o(),a(28,"ion-text",25),p(29),o()(),a(30,"div",26)(31,"ion-text",27),p(32,"Caracter\xEDsticas"),o(),a(33,"div",28),N(34,Pt,1,1,null,null,dt),z(36,"keyValuePairs"),o()()),t&2){let l,e,i,r,m,d,g,u,_,C,c=f();O("imagesURLs",(l=(l=c.postData())==null?null:l.imagesURLs)!==null&&l!==void 0?l:U(17,at)),s(3),P(" ",(e=(e=c.postData())==null?null:e.title)!==null&&e!==void 0?e:""," "),s(2),O("routerLink",_e(18,lt,"/tabs/user-detail/"+((i=c.postData())==null||i.user==null?null:i.user.userId))),s(2),ge("src",(r=(r=c.postData())==null||r.user==null?null:r.user.profilePictureURL)!==null&&r!==void 0?r:"",de),s(2),P(" ",(m=(m=c.postData())==null||m.user==null?null:m.user.username)!==null&&m!==void 0?m:""," "),s(),w(c.isOwnPost()?-1:10),s(3),P(" ",F(14,11,(d=(d=c.postData())==null?null:d.price)!==null&&d!==void 0?d:0)," "),s(3),P(" + env\xEDo ",F(17,13,c.Math.max(((g=(g=c.postData())==null?null:g.price)!==null&&g!==void 0?g:0)/100,5))," "),s(3),w(c.isOwnPost()?-1:19),s(5),P(" ",(u=(u=c.postData())==null||u.article==null?null:u.article.condition)!==null&&u!==void 0?u:""," "),s(5),P(" ",(_=(_=c.postData())==null?null:_.description)!==null&&_!==void 0?_:""," "),s(5),$(F(36,15,((C=c.postData())==null||C.article==null?null:C.article.characteristics)||U(20,st)))}}var at,lt,st,ct,mt,dt,tn,yt=D(()=>{x();Ke();Qe();We();Be();Pe();tt();$e();Ze();et();nt();Ge();Ye();Te();Ue();x();at=()=>[],lt=t=>[t],st=()=>({}),ct=()=>["/tabs/home"],mt=()=>["/cart"],dt=(t,n)=>n.key;tn=(()=>{let n=class n{get Math(){return Math}constructor(){this.route=h(fe),this.postDetailService=h(je),this.authService=h(G),this.cartService=h(H),this.postData=I(()=>this.postDetailService.postDetailState().postData),this.loading=I(()=>this.postDetailService.postDetailState().loading),this.errorMessage=I(()=>this.postDetailService.postDetailState().errorMessage),this.itemIsAdded=I(()=>{var e;return(e=this.cartService.cartState().cartItems.some(i=>{var r;return i.postId===((r=this.postData())==null?void 0:r._id)}))!=null?e:!1}),this.isOwnPost=M(!0),Ee({chatbubbleEllipses:Le}),q(()=>{var e,i,r;this.isOwnPost.set(((i=(e=this.postData())==null?void 0:e.user)==null?void 0:i.userId)===((r=this.authService.currentUser())==null?void 0:r._id))})}ngOnInit(){return k(this,null,function*(){var e;this.postDetailService.setPostId((e=this.route.snapshot.paramMap.get("postId"))!=null?e:"")})}addToCart(){var i,r,m,d,g,u,_,C,c,S;let e=Math.max(((r=(i=this.postData())==null?void 0:i.price)!=null?r:0)/100,5);this.postDetailService.addToCart({postId:(d=(m=this.postData())==null?void 0:m._id)!=null?d:"",title:(u=(g=this.postData())==null?void 0:g.title)!=null?u:"",price:(C=(_=this.postData())==null?void 0:_.price)!=null?C:0,shipping:e,mainImageURL:(S=(c=this.postData())==null?void 0:c.mainImageURL)!=null?S:""})}goToConversation(){this.postDetailService.loadConversation()}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=j({type:n,selectors:[["app-post-detail"]],decls:10,vars:4,consts:[["type","arrow-back",3,"title"],[3,"fullscreen"],["collapse","condense"],["size","large"],[1,"container"],[1,"loading-spinner-container"],["name","crescent"],[1,"images-slider",3,"imagesURLs"],[1,"title-user-container"],[1,"title"],[1,"user-data-row"],[1,"user-data-container",3,"routerLink"],[1,"user-avatar"],["alt","Avatar del usuario",3,"src"],[1,"user-username"],[1,"message-icon-container"],[1,"price-container"],[1,"price-text"],[1,"shipping-text"],[1,"buttons-container"],[1,"condition-container"],[1,"condition-label"],[1,"condition-text"],[1,"description-container"],[1,"description-label"],[1,"description-text"],[1,"characteristics-container"],[1,"characteristics-label"],[1,"characteristics-list"],[1,"message-icon-container",3,"click"],["name","chatbubble-ellipses","color","light","size","large"],[1,"finished-post-warning-wrapper"],["fill","clear",1,"custom",3,"routerLink"],[1,"custom",3,"routerLink"],[1,"custom"],[1,"custom",3,"click"],[1,"finished-post-warning"],[1,"characteristic-text"],[1,"characteristics-key"]],template:function(i,r){if(i&1&&(a(0,"ion-header"),v(1,"app-toolbar",0),o(),a(2,"ion-content",1)(3,"ion-header",2)(4,"ion-toolbar")(5,"ion-title",3),p(6),o()()(),a(7,"div",4),b(8,pt,2,0,"div",5)(9,xt,37,21),o()()),i&2){let m,d;s(),O("title",(m=(m=r.postData())==null?null:m.title)!==null&&m!==void 0?m:""),s(),O("fullscreen",!0),s(4),K((d=(d=r.postData())==null?null:d.title)!==null&&d!==void 0?d:""),s(2),w(r.loading()?8:9)}},dependencies:[we,ve,qe,He,Me,ke,ye,Ie,ze,Ne,be,Oe,Se,De,he,xe,Fe],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.container[_ngcontent-%COMP%]   .loading-spinner-container[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;align-items:center;padding:1rem 0}.container[_ngcontent-%COMP%]   .images-slider[_ngcontent-%COMP%]{margin:calc(var(--top-content-padding) * -1) 0 1rem 0}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-family:Montserrat;font-size:1.125rem;font-style:normal;font-weight:500;line-height:1.5rem;letter-spacing:.03125rem}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]   .user-data-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:2.5rem}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]   .user-data-row[_ngcontent-%COMP%]   .user-data-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:1rem;cursor:pointer}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]   .user-data-row[_ngcontent-%COMP%]   .user-data-container[_ngcontent-%COMP%]   .user-username[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]   .user-data-row[_ngcontent-%COMP%]   .message-icon-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:40px;height:40px;cursor:pointer}.container[_ngcontent-%COMP%]   .price-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.container[_ngcontent-%COMP%]   .price-container[_ngcontent-%COMP%]   .price-text[_ngcontent-%COMP%]{font-size:var(--label-huge-size, 1.5rem);font-style:normal;font-weight:var(--label-huge-weight-prominent, 600);line-height:var(--label-huge-line-height, 2rem);letter-spacing:var(--label-huge-tracking, 0rem)}.container[_ngcontent-%COMP%]   .price-container[_ngcontent-%COMP%]   .shipping-text[_ngcontent-%COMP%]{font-size:var(--label-large-size, .875rem);font-style:normal;font-weight:var(--label-large-weight-prominent, 600);line-height:var(--label-large-line-height, 1.25rem);letter-spacing:var(--label-large-tracking, .00625rem)}.container[_ngcontent-%COMP%]   .buttons-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.container[_ngcontent-%COMP%]   .buttons-container[_ngcontent-%COMP%]   .finished-post-warning-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;min-height:2.5rem;margin:.5rem 0;color:var(--ion-color-warning);border:1px solid var(--ion-color-warning-shade)}.container[_ngcontent-%COMP%]   .buttons-container[_ngcontent-%COMP%]   .finished-post-warning-wrapper[_ngcontent-%COMP%]   .finished-post-warning[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.container[_ngcontent-%COMP%]   .condition-container[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .description-container[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .characteristics-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.container[_ngcontent-%COMP%]   .condition-label[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .description-label[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .characteristics-label[_ngcontent-%COMP%]{font-size:var(--label-larger-size, 1.25rem);font-style:normal;font-weight:var(--label-larger-weight-prominent, 600);line-height:var(--label-larger-line-height, 1.25rem);letter-spacing:var(--label-larger-tracking, .00625rem)}.container[_ngcontent-%COMP%]   .condition-text[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .description-text[_ngcontent-%COMP%]{font-size:var(--body-large-size, 1rem);font-style:normal;font-weight:var(--body-large-weight, 400);line-height:var(--body-large-line-height, 1.5rem);letter-spacing:var(--body-large-tracking, .03125rem)}.container[_ngcontent-%COMP%]   .characteristics-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.container[_ngcontent-%COMP%]   .characteristics-list[_ngcontent-%COMP%]   .characteristic-text[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.container[_ngcontent-%COMP%]   .characteristics-list[_ngcontent-%COMP%]   .characteristic-text[_ngcontent-%COMP%]   .characteristics-key[_ngcontent-%COMP%]{font-weight:var(--body-medium-weight-prominent, 600)}"]});let t=n;return t})()});yt();export{tn as PostDetailPage};
