import{a as nt,b as bt}from"./chunk-UIHM3IIJ.js";import{a as ot,b as at,c as rt,d as St}from"./chunk-3LZDXMQH.js";import{a as tt,b as ht,e as it,f as vt}from"./chunk-2GV3WWDM.js";import{F as et,a as Q,b as He,d as Ye,f as Je,k as Ke,m as We,q as Xe}from"./chunk-QZLDCAKT.js";import"./chunk-7QGFDW3N.js";import"./chunk-CVZVN4BI.js";import"./chunk-6RPMLJXL.js";import"./chunk-ZDSPE5PQ.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-ZSFULLTW.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import"./chunk-5WOL6UCU.js";import"./chunk-UCDHUJSY.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-7JRGKQWZ.js";import{f as $,g as ze,h as U,j as Ge,k as je,m as $e,p as gt,s as Qe,t as xt,y as Ze,z as Ct}from"./chunk-WI56WTX3.js";import{Aa as Le,Ba as Be,Ca as qe,Q as Re,S as Fe,_ as Ve,aa as Te,ba as Pe,c as y,d as xe,da as Ae,e as Ce,i as he,j as ve,k as be,ka as ke,l as Se,la as Ne,oa as Me,q as we,s as De,u as ye,v as Ee,va as Ie,wa as Oe,xa as Ue}from"./chunk-IBFAPW3Z.js";import{$ as u,Ca as E,D,Da as v,Ea as p,Gb as _e,Hb as fe,L as x,Lb as ge,M as C,Ma as te,Na as ue,Qa as c,Ra as ie,Sa as pe,V as A,W as k,Y as h,Ya as ne,_ as me,ea as W,fa as j,hb as N,jb as de,ka as f,m as z,n as _t,nb as P,qa as S,s as G,sa as d,ta as ce,ua as X,va as ee,w as ft,wa as s,xa as r,ya as V,z as le}from"./chunk-S4NGLO4I.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as I,f as O,j as T,k as F,l as q,m as se,o as w}from"./chunk-FIPIWZQS.js";var H,Z,st=O(()=>{"use strict";P();ze();Z=class{constructor(){F(this,H,D($))}validate(){return o=>w(this,null,function*(){return(yield T(this,H).getUserByEmail(o.value.toLowerCase(),!1))?{emailExists:!0}:null})}};H=new WeakMap});var J,Y,lt=O(()=>{"use strict";P();ze();Y=class{constructor(){F(this,J,D($))}validate(){return o=>w(this,null,function*(){return(yield T(this,J).getUserByUsername(o.value))?{usernameExists:!0}:null})}};J=new WeakMap});function Et(e,o){e&1&&V(0,"ion-icon",11)}function Rt(e,o){if(e&1&&f(0,Et,1,0,"ion-icon",11),e&2){let t,n=p(2);d(!((t=n.registerForm.get("emailData.email"))!=null&&t.pending)&&((t=n.registerForm.get("emailData.email"))!=null&&t.invalid)?0:-1)}}function Ft(e,o){e&1&&(s(0,"ion-text",12),c(1,"El email es obligatorio"),r())}function Vt(e,o){e&1&&(s(0,"ion-text",12),c(1,"El email es inv\xE1lido"),r())}function Tt(e,o){e&1&&(s(0,"ion-text",12),c(1,"El email ya est\xE1 en uso"),r())}function Pt(e,o){if(e&1&&f(0,Ft,2,0,"ion-text",12)(1,Vt,2,0,"ion-text",12)(2,Tt,2,0,"ion-text",12),e&2){let t,n,a,g=p(2);d(!((t=g.registerForm.get("emailData.email"))==null||t.errors==null)&&t.errors.required?0:-1),u(),d(!((n=g.registerForm.get("emailData.email"))==null||n.errors==null)&&n.errors.email?1:-1),u(),d(!((a=g.registerForm.get("emailData.email"))==null||a.errors==null)&&a.errors.emailExists?2:-1)}}function At(e,o){if(e&1){let t=E();s(0,"div",1)(1,"div",8)(2,"ion-label",9),c(3,"Email"),r(),s(4,"ion-input",10),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("email"))})("ionBlur",function(){x(t);let a=p();return C(a.controlBlur.emit("email"))}),f(5,Rt,1,1),r(),f(6,Pt,3,3),r()()}if(e&2){let t,n=p();u(5),d(n.submitAttempts().email()?5:-1),u(),d(n.submitAttempts().email()&&((t=n.registerForm.get("emailData.email"))!=null&&t.errors)?6:-1)}}function kt(e,o){e&1&&(s(0,"ion-text",12),c(1,"El nombre de usuario es obligatorio"),r())}function Nt(e,o){e&1&&(s(0,"ion-text",12),c(1,"El nombre de usuario es demasiado corto"),r())}function Mt(e,o){e&1&&(s(0,"ion-text",12),c(1,"Ese nombre de usuario ya est\xE1 en uso"),r())}function It(e,o){if(e&1&&f(0,kt,2,0,"ion-text",12)(1,Nt,2,0,"ion-text",12)(2,Mt,2,0,"ion-text",12),e&2){let t,n,a,g=p(2);d(!((t=g.registerForm.get("userData.username"))==null||t.errors==null)&&t.errors.required?0:-1),u(),d(!((n=g.registerForm.get("userData.username"))==null||n.errors==null)&&n.errors.minlength?1:-1),u(),d(!((a=g.registerForm.get("userData.username"))==null||a.errors==null)&&a.errors.usernameExists?2:-1)}}function Ot(e,o){e&1&&(s(0,"ion-text",12),c(1,"La contrase\xF1a es obligatoria"),r())}function Ut(e,o){e&1&&(s(0,"ion-text",12),c(1,"La contrase\xF1a debe tener al menos 6 caracteres, una letra y un n\xFAmero"),r())}function Lt(e,o){if(e&1&&f(0,Ot,2,0,"ion-text",12)(1,Ut,2,0,"ion-text",12),e&2){let t,n,a=p(2);d(!((t=a.registerForm.get("userData.password"))==null||t.errors==null)&&t.errors.required?0:-1),u(),d(!((n=a.registerForm.get("userData.password"))==null||n.errors==null)&&n.errors.pattern?1:-1)}}function Bt(e,o){if(e&1){let t=E();s(0,"div",2)(1,"div",8)(2,"ion-label",9),c(3,"Nombre de usuario"),r(),s(4,"ion-input",13),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("userData"))}),r(),f(5,It,3,3),r(),s(6,"div",8)(7,"ion-label",9),c(8,"Contrase\xF1a"),r(),s(9,"ion-input",14),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("userData"))}),V(10,"ion-input-password-toggle",15),r(),f(11,Lt,2,2),r(),s(12,"div",16)(13,"ion-label",9),c(14,"Avatar (opcional)"),r(),s(15,"ion-avatar",17),v("click",function(){x(t);let a=p();return C(a.uploadAvatar.emit())}),V(16,"img",18),r()()()}if(e&2){let t,n,a=p();u(5),d(a.submitAttempts().userData()&&((t=a.registerForm.get("userData.username"))!=null&&t.errors)?5:-1),u(6),d(a.submitAttempts().userData()&&((n=a.registerForm.get("userData.password"))!=null&&n.errors)?11:-1),u(5),S("src",a.avatarDataURL()||"../../../../../../assets/user-avatar-default-shade.svg",me)}}function qt(e,o){e&1&&(s(0,"ion-text",12),c(1,"El nombre es obligatorio"),r())}function zt(e,o){if(e&1&&f(0,qt,2,0,"ion-text",12),e&2){let t,n=p(2);d(!((t=n.registerForm.get("personalData.firstName"))==null||t.errors==null)&&t.errors.required?0:-1)}}function Gt(e,o){e&1&&(s(0,"ion-text",12),c(1,"Los apellidos son obligatorios"),r())}function jt(e,o){if(e&1&&f(0,Gt,2,0,"ion-text",12),e&2){let t,n=p(2);d(!((t=n.registerForm.get("personalData.lastName"))==null||t.errors==null)&&t.errors.required?0:-1)}}function $t(e,o){e&1&&(s(0,"ion-text",12),c(1,"La direcci\xF3n es obligatoria"),r())}function Qt(e,o){if(e&1&&f(0,$t,2,0,"ion-text",12),e&2){let t,n=p(2);d(!((t=n.registerForm.get("personalData.address"))==null||t.errors==null)&&t.errors.required?0:-1)}}function Zt(e,o){e&1&&(s(0,"ion-text",12),c(1,"El c\xF3digo postal es obligatorio"),r())}function Ht(e,o){e&1&&(s(0,"ion-text",12),c(1,"El c\xF3digo postal es demasiado corto"),r())}function Yt(e,o){if(e&1&&f(0,Zt,2,0,"ion-text",12)(1,Ht,2,0,"ion-text",12),e&2){let t,n,a=p(2);d(!((t=a.registerForm.get("personalData.zipcode"))==null||t.errors==null)&&t.errors.required?0:-1),u(),d(!((n=a.registerForm.get("personalData.zipcode"))==null||n.errors==null)&&n.errors.minlength?1:-1)}}function Jt(e,o){if(e&1&&(s(0,"ion-select-option",29),c(1),r()),e&2){let t=o.$implicit;S("value",t.nameES),u(),ie(t.nameES)}}function Kt(e,o){if(e&1){let t=E();s(0,"div",3)(1,"div",8)(2,"ion-label",19),c(3,"Nombre"),r(),s(4,"ion-input",20),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("personalData"))}),r(),f(5,zt,1,1),r(),s(6,"div",8)(7,"ion-label",9),c(8,"Apellidos"),r(),s(9,"ion-input",21),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("personalData"))}),r(),f(10,jt,1,1),r(),s(11,"div",8)(12,"ion-label",9),c(13,"Direcci\xF3n"),r(),s(14,"ion-input",22),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("personalData"))}),r(),f(15,Qt,1,1),r(),s(16,"div",23)(17,"div",24)(18,"ion-label",9),c(19,"C\xF3digo postal"),r(),s(20,"ion-input",25),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("personalData"))}),r(),f(21,Yt,2,2),r(),s(22,"div",26)(23,"ion-label",9),c(24,"Pa\xEDs"),r(),s(25,"ion-select",27),V(26,"ion-icon",28),X(27,Jt,2,2,"ion-select-option",29,yt),r()()()()}if(e&2){let t,n,a,g,i=p();u(5),d(i.submitAttempts().personalData()&&((t=i.registerForm.get("personalData.firstName"))!=null&&t.errors)?5:-1),u(5),d(i.submitAttempts().personalData()&&((n=i.registerForm.get("personalData.lastName"))!=null&&n.errors)?10:-1),u(5),d(i.submitAttempts().personalData()&&((a=i.registerForm.get("personalData.address"))!=null&&a.errors)?15:-1),u(6),d(i.submitAttempts().personalData()&&((g=i.registerForm.get("personalData.zipcode"))!=null&&g.errors)?21:-1),u(4),S("interfaceOptions",ne(5,wt)),u(2),ee(i.countries)}}function Wt(e,o){if(e&1){let t=E();s(0,"div",32)(1,"ion-checkbox",35),v("ionChange",function(a){x(t);let g=p(2);return C(g.onRoleChange(a))}),c(2),r()()}if(e&2){let t=o.$implicit;u(),S("value",t),u(),pe(" ",t," ")}}function Xt(e,o){if(e&1){let t=E();s(0,"div",4)(1,"div",8)(2,"ion-label",9),c(3,"Roles (opcional)"),r(),s(4,"ion-text",30),c(5,"Elige los roles que m\xE1s se identifiquen con tu actividad musical"),r(),s(6,"div",31),X(7,Wt,3,2,"div",32,ce),r()(),s(9,"div",33)(10,"ion-label",9),c(11,"Biograf\xEDa (opcional)"),r(),s(12,"ion-textarea",34),v("ionFocus",function(){x(t);let a=p();return C(a.controlFocus.emit("otherData"))}),r()()()}if(e&2){let t=p();u(7),ee(t.roles)}}function ei(e,o){e&1&&V(0,"ion-spinner",37)}function ti(e,o){if(e&1){let t=E();s(0,"div",6)(1,"ion-button",36),v("click",function(){x(t);let a=p();return C(a.nextStep.emit())}),c(2," Continuar "),f(3,ei,1,0,"ion-spinner",37),r(),s(4,"ion-text"),c(5,"\xBFYa tienes cuenta? "),s(6,"a",38),c(7,"Ingresar"),r()()()}if(e&2){let t=p();u(),S("disabled",t.loadingStates().email()),u(2),d(t.loadingStates().email()?3:-1),u(3),S("routerLink",ne(3,Dt))}}function ii(e,o){e&1&&V(0,"ion-spinner",37)}function ni(e,o){if(e&1){let t=E();s(0,"ion-button",39),v("click",function(){x(t);let a=p();return C(a.nextStep.emit())}),c(1," Continuar "),f(2,ii,1,0,"ion-spinner",37),r()}if(e&2){let t=p();S("disabled",t.loadingStates().userData()),u(2),d(t.loadingStates().userData()?2:-1)}}function oi(e,o){e&1&&V(0,"ion-spinner",37)}function ai(e,o){if(e&1){let t=E();s(0,"ion-button",39),v("click",function(){x(t);let a=p();return C(a.nextStep.emit())}),c(1," Continuar "),f(2,oi,1,0,"ion-spinner",37),r()}if(e&2){let t=p();S("disabled",t.loadingStates().personalData()),u(2),d(t.loadingStates().personalData()?2:-1)}}function ri(e,o){if(e&1&&(s(0,"ion-text",12),c(1),r()),e&2){let t=p(2);u(),ie(t.authProviderErrorMessage())}}function si(e,o){e&1&&V(0,"ion-spinner",37)}function li(e,o){if(e&1){let t=E();f(0,ri,2,1,"ion-text",12),s(1,"ion-button",39),v("click",function(){x(t);let a=p();return C(a.formSubmit.emit())}),c(2," Finalizar "),f(3,si,1,0,"ion-spinner",37),r()}if(e&2){let t=p();d(t.submitAttempts().register()&&t.authProviderErrorMessage()?0:-1),u(),S("disabled",t.loadingStates().register()),u(2),d(t.loadingStates().register()?3:-1)}}var wt,Dt,yt,K,ut=O(()=>{"use strict";P();ge();Ee();qe();st();lt();He();et();bt();je();P();Ee();wt=()=>({cssClass:"custom-action-sheet"}),Dt=()=>["/auth/login"],yt=(e,o)=>o.iso2;K=(()=>{var o,ct;let n=class n{constructor(){F(this,o);this.fb=D(De),this.emailValidator=new Z,this.usernameValidator=new Y,this.step=k(1),this.nextStep=A(),this.formSubmit=A(),this.submitAttempts=k({email:h(!1),userData:h(!1),personalData:h(!1),register:h(!1)}),this.loadingStates=k({email:h(!1),userData:h(!1),personalData:h(!1),register:h(!1)}),this.controlFocus=A(),this.controlBlur=A(),this.uploadAvatar=A(),this.authProviderErrorMessage=k(""),this.formattedDate=h(new Date().toLocaleDateString("es-ES")),this.avatarDataURL=k(""),this.countries=nt,this.roles=[U.Amateur,U.Professional,U.Collector,U.Student],Q({checkmarkCircleOutline:Ke,closeCircleOutline:We,calendarOutline:Je,globeOutline:Xe})}ngOnInit(){se(this,o,ct).call(this)}onRoleChange(g){let i=this.registerForm.get("otherData.roles");if(g.detail.checked)i.push(this.fb.control(g.detail.value));else{let l=i.controls.findIndex(m=>m.value===g.detail.value);l>=0&&i.removeAt(l)}}};o=new WeakSet,ct=function(){this.registerForm=this.fb.group({emailData:this.fb.group({email:this.fb.control("",{validators:[y.required,y.email],asyncValidators:[this.emailValidator.validate()],updateOn:"blur"})}),userData:this.fb.group({username:this.fb.control("",{validators:[y.required,y.minLength(4)],asyncValidators:[this.usernameValidator.validate()],updateOn:"blur"}),password:this.fb.control("",{validators:[y.required,y.pattern(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/)],updateOn:"blur"})}),personalData:this.fb.group({firstName:this.fb.control("",{validators:[y.required],updateOn:"blur"}),lastName:this.fb.control("",{validators:[y.required],updateOn:"blur"}),address:this.fb.control("",{validators:[y.required],updateOn:"blur"}),zipcode:this.fb.control("",{validators:[y.required,y.minLength(4)],updateOn:"blur"}),country:this.fb.control("",{validators:[y.required],updateOn:"blur"})}),otherData:this.fb.group({roles:this.fb.array([]),bio:this.fb.control("")})})},n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=j({type:n,selectors:[["app-register-form"]],inputs:{step:[1,"step"],submitAttempts:[1,"submitAttempts"],loadingStates:[1,"loadingStates"],authProviderErrorMessage:[1,"authProviderErrorMessage"],avatarDataURL:[1,"avatarDataURL"]},outputs:{nextStep:"nextStep",formSubmit:"formSubmit",controlFocus:"controlFocus",controlBlur:"controlBlur",uploadAvatar:"uploadAvatar"},decls:10,vars:3,consts:[[3,"formGroup"],["formGroupName","emailData",1,"inputs-container"],["formGroupName","userData",1,"inputs-container"],["formGroupName","personalData",1,"inputs-container"],["formGroupName","otherData",1,"inputs-container"],[1,"buttons-container"],[1,"button-subtitle-container"],["type","button",3,"disabled"],[1,"input-wrapper"],["color","light",1,"custom"],["formControlName","email","type","email",1,"custom",3,"ionFocus","ionBlur"],["slot","end","color","danger","name","close-circle-outline"],["color","danger",1,"error-text"],["formControlName","username","type","text",1,"custom",3,"ionFocus"],["formControlName","password","type","password",1,"custom",3,"ionFocus"],["slot","end","color","light"],[1,"input-wrapper-row"],["slot","start",3,"click"],["alt","Avatar de usuario por defecto",3,"src"],[1,"custom"],["formControlName","firstName","type","text",1,"custom",3,"ionFocus"],["formControlName","lastName","type","text",1,"custom",3,"ionFocus"],["formControlName","address","type","text",1,"custom",3,"ionFocus"],[1,"country-zipcode-container"],[1,"input-wrapper","zipcode-input"],["formControlName","zipcode","type","text","maxlength","5","inputmode","numeric",1,"custom",3,"ionFocus"],[1,"input-wrapper","country-input-wrapper"],["formControlName","country","aria-label","Country","interface","action-sheet",1,"custom","select-input",3,"interfaceOptions"],["slot","start","name","globe-outline"],["color","light",3,"value"],[1,"roles-subtitle"],[1,"checkboxes-container"],[1,"checkbox-wrapper"],[1,"input-wrapper","bio-wrapper"],["formControlName","bio",1,"custom",3,"ionFocus"],["labelPlacement","end","color","light",3,"ionChange","value"],[3,"click","disabled"],["name","crescent"],[1,"inline-link",3,"routerLink"],["type","button",3,"click","disabled"]],template:function(i,l){if(i&1&&(s(0,"form",0),f(1,At,7,2,"div",1)(2,Bt,17,3,"div",2)(3,Kt,29,6,"div",3)(4,Xt,13,0,"div",4),r(),s(5,"div",5),f(6,ti,8,4,"div",6)(7,ni,3,2,"ion-button",7)(8,ai,3,2,"ion-button",7)(9,li,4,3),r()),i&2){let m,_;S("formGroup",l.registerForm),u(),d((m=l.step())===1?1:m===2?2:m===3?3:m===4?4:-1),u(5),d((_=l.step())===1?6:_===2?7:_===3?8:_===4?9:-1)}},dependencies:[Ne,fe,Be,Ie,Fe,Oe,Me,Re,Ue,Pe,Ae,Le,ke,ye,he,xe,Ce,we,ve,Se,be],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1 0 0;justify-content:space-between;gap:2rem}ion-datetime-button.custom[_ngcontent-%COMP%]{min-height:3rem}ion-datetime-button[_ngcontent-%COMP%]::part(native){background-color:var(--ion-color-dark-tint);display:flex;flex-direction:row;align-items:center;align-self:stretch;gap:.5rem}.country-zipcode-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.zipcode-input[_ngcontent-%COMP%]{width:35%}.country-input-wrapper[_ngcontent-%COMP%]{width:70%;max-width:calc(70% - 3rem)}.roles-subtitle[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--ion-color-light-shade);font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.checkboxes-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem}.checkbox-wrapper[_ngcontent-%COMP%]{display:flex;width:8rem}.bio-wrapper[_ngcontent-%COMP%]{margin-top:1rem}.buttons-container[_ngcontent-%COMP%]{margin-top:1rem;display:flex;flex-direction:column;align-items:flex-start}.buttons-container[_ngcontent-%COMP%]:has(ion-button.ios){margin-bottom:24px}.button-subtitle-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}.custom-action-sheet[_ngcontent-%COMP%]{--button-color: var(--ion-color-light);--button-background-hover: var(--ion-color-light-tint);--button-color-activated: var(--ion-color-light-shade)}"]});let e=n;return e})()});var pt,dt=O(()=>{"use strict";P();St();je();Ct();xt();ht();P();pt=(()=>{let o=class o{constructor(){this.authService=D(Ze),this.cartService=D(tt),this.cache=D(Qe),this.profilePictureDataURL=h(null),this.loading=h(!1),this.errorMessage=h(""),this.registerState=N(()=>{var n;return{profilePictureDataURL:(n=this.profilePictureDataURL())!=null?n:"",loading:this.loading(),errorMessage:this.errorMessage()}}),this.getAvatarData=()=>w(this,null,function*(){try{let n=yield rt.getPhoto({quality:80,allowEditing:!1,resultType:at.DataUrl,source:ot.Prompt});this.profilePictureDataURL.set(n.dataUrl)}catch(n){console.error(`Error al seleccionar avatar: ${n}`)}}),this.setAvatarDataNotNative=n=>{var l;let a=n.target;if(!((l=a.files)!=null&&l.length))return;let g=a.files[0],i=new FileReader;i.onload=()=>{let m=i.result;this.profilePictureDataURL.set(m)},i.readAsDataURL(g)},this.registerUser=n=>w(this,null,function*(){var a,g,i,l,m,_,b,R,M,L,oe,ae;this.loading.set(!0);try{let B=yield this.cache.get("fcmToken"),re=yield this.authService.register({method:"email",userData:{email:(a=n.email)!=null?a:"",username:(g=n.username)!=null?g:"",password:(i=n.password)!=null?i:"",name:{first:(l=n.firstName)!=null?l:"",last:(m=n.lastName)!=null?m:""},address:{line1:(_=n.address)!=null?_:"",city:(b=n.city)!=null?b:"",country:(R=n.country)!=null?R:"",zipcode:(M=n.zipcode)!=null?M:""},roles:(L=n.roles)!=null?L:[],bio:(oe=n.bio)!=null?oe:"",fcmToken:B,profilePictureDataURL:(ae=this.profilePictureDataURL())!=null?ae:""}});Ge(re)&&(yield this.cartService.createCart(re._id)),this.loading.set(!1),this.errorMessage.set("")}catch(B){console.error(B),this.loading.set(!1),this.errorMessage.set(B)}})}};o.\u0275fac=function(a){return new(a||o)},o.\u0275prov=le({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})()});function ci(e,o){e&1&&(s(0,"h1"),c(1,"\xBFCu\xE1l es tu email?"),r(),s(2,"h4"),c(3,"Introduce el email con el que quieres iniciar sesi\xF3n en BeatMarket"),r())}function ui(e,o){e&1&&(s(0,"h1"),c(1,"Rellena tus datos de usuario"),r())}function pi(e,o){e&1&&(s(0,"h1"),c(1,"Rellena tus datos personales"),r())}function di(e,o){e&1&&(s(0,"h1"),c(1,"Cu\xE9ntanos sobre ti"),r())}var mi,an,_i=O(()=>{P();_t();ft();qe();He();et();ut();dt();gt();ge();vt();P();mi=["fileInput"];an=(()=>{var o,t,n;let a=class a{constructor(){F(this,o);F(this,t);F(this,n);this.router=D(_e),this.registerService=D(pt),this.registerFormComponent=W(K),this.step=h(3),this.totalSteps=4,this.progressBarValue=N(()=>this.step()/this.totalSteps),this.errorMessage=N(()=>this.registerService.registerState().errorMessage),this.profilePictureDataURL=N(()=>this.registerService.registerState().profilePictureDataURL),this.submitAttempts={email:h(!1),userData:h(!1),personalData:h(!1),register:h(!1)},this.loadingStates={email:h(!1),userData:h(!1),personalData:h(!1),register:de(()=>this.registerService.registerState().loading)},this.nextStep=()=>{var i,l,m;if(this.step()===1){this.submitAttempts.email.set(!0),T(this,o).call(this,(i=this.registerFormComponent())==null?void 0:i.registerForm);return}if(this.step()===2){this.submitAttempts.userData.set(!0),T(this,t).call(this,(l=this.registerFormComponent())==null?void 0:l.registerForm);return}if(this.step()===3){this.submitAttempts.personalData.set(!0),T(this,n).call(this,(m=this.registerFormComponent())==null?void 0:m.registerForm);return}},this.prevStep=()=>{this.step.set(this.step()-1)},this.fileInput=W("fileInput"),this.onAvatarUpload=()=>w(this,null,function*(){var i;$e.isNativePlatform()?yield this.registerService.getAvatarData():(i=this.fileInput())==null||i.nativeElement.click()}),this.handleFileInput=i=>{this.registerService.setAvatarDataNotNative(i)},q(this,o,i=>w(this,null,function*(){var m;let l=i==null?void 0:i.get("emailData.email");if(l&&(l==null||l.updateValueAndValidity(),l.pending&&(this.loadingStates.email.set(!0),yield z(l.statusChanges.pipe(G(_=>_!=="PENDING"))),this.loadingStates.email.set(!1)),(m=i==null?void 0:i.get("emailData"))!=null&&m.valid)){this.step.set(this.step()+1);return}})),q(this,t,i=>w(this,null,function*(){var _;let l=i==null?void 0:i.get("userData.username"),m=i==null?void 0:i.get("userData.password");!l||!m||(l==null||l.updateValueAndValidity(),m==null||m.updateValueAndValidity(),l.pending&&(this.loadingStates.userData.set(!0),yield z(l.statusChanges.pipe(G(b=>b!=="PENDING"))),this.loadingStates.userData.set(!1)),(_=i==null?void 0:i.get("userData"))!=null&&_.valid&&this.step.set(this.step()+1))})),q(this,n,i=>w(this,null,function*(){var M;let l=i==null?void 0:i.get("personalData.firstName"),m=i==null?void 0:i.get("personalData.lastName"),_=i==null?void 0:i.get("personalData.address"),b=i==null?void 0:i.get("personalData.zipcode"),R=i==null?void 0:i.get("personalData.country");!l||!m||!_||!b||!R||(l==null||l.updateValueAndValidity(),m==null||m.updateValueAndValidity(),_==null||_.updateValueAndValidity(),b==null||b.updateValueAndValidity(),R==null||R.updateValueAndValidity(),l.pending&&(this.loadingStates.personalData.set(!0),yield z(l.statusChanges.pipe(G(L=>L!=="PENDING"))),this.loadingStates.personalData.set(!1)),(M=i==null?void 0:i.get("personalData"))!=null&&M.valid&&this.step.set(this.step()+1))})),Q({arrowBackOutline:Ye})}onControlFocus(i){this.submitAttempts.email.set(!1),this.submitAttempts.userData.set(!1),this.submitAttempts.personalData.set(!1),this.submitAttempts.register.set(!1)}handleRegister(){return w(this,null,function*(){var l;let i=(l=this.registerFormComponent())==null?void 0:l.registerForm;yield this.registerService.registerUser(I(I(I(I({},i==null?void 0:i.value.emailData),i==null?void 0:i.value.userData),i==null?void 0:i.value.personalData),i==null?void 0:i.value.otherData)),this.errorMessage()||this.router.navigate(["/auth/welcome"])})}};o=new WeakMap,t=new WeakMap,n=new WeakMap,a.\u0275fac=function(l){return new(l||a)},a.\u0275cmp=j({type:a,selectors:[["app-register"]],viewQuery:function(l,m){l&1&&(te(m.registerFormComponent,K,5),te(m.fileInput,mi,5)),l&2&&ue(2)},decls:13,vars:12,consts:[["fileInput",""],["type","arrow-back","title","Registro",3,"backPressed","showSearch","showCart","showProgressBar","progressBarValue","backActionType"],[3,"fullscreen"],[1,"container"],[1,"title-form-container"],[1,"title-container"],[3,"controlFocus","uploadAvatar","nextStep","formSubmit","step","submitAttempts","loadingStates","avatarDataURL","authProviderErrorMessage"],["type","file","accept","image/*","hidden","",3,"change"]],template:function(l,m){if(l&1){let _=E();s(0,"ion-header")(1,"app-toolbar",1),v("backPressed",function(){return x(_),C(m.prevStep())}),r()(),s(2,"ion-content",2)(3,"div",3)(4,"div",4)(5,"div",5),f(6,ci,4,0)(7,ui,2,0,"h1")(8,pi,2,0,"h1")(9,di,2,0,"h1"),r(),s(10,"app-register-form",6),v("controlFocus",function(R){return x(_),C(m.onControlFocus(R))})("uploadAvatar",function(){return x(_),C(m.onAvatarUpload())})("nextStep",function(){return x(_),C(m.nextStep())})("formSubmit",function(){return x(_),C(m.handleRegister())}),r(),s(11,"input",7,0),v("change",function(R){return x(_),C(m.handleFileInput(R))}),r()()()()}if(l&2){let _;u(),S("showSearch",!1)("showCart",!1)("showProgressBar",!0)("progressBarValue",m.progressBarValue())("backActionType",m.step()===1?"default":"emit"),u(),S("fullscreen",!0),u(4),d((_=m.step())===1?6:_===2?7:_===3?8:_===4?9:-1),u(4),S("step",m.step())("submitAttempts",m.submitAttempts)("loadingStates",m.loadingStates)("avatarDataURL",m.profilePictureDataURL())("authProviderErrorMessage",m.errorMessage())}},dependencies:[it,Ve,Te,K],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;min-height:100%;gap:1rem}.title-form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;gap:1.5rem}.title-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-light)}"]});let e=a;return e})()});_i();export{an as RegisterPage};
