import{a as Me,b as ze}from"./chunk-ESNBI2AA.js";import{a as _e,b as De}from"./chunk-K4X2YLKW.js";import{a as he,b as Te}from"./chunk-SZG4CGCH.js";import"./chunk-SWFIUNRV.js";import{D as Ie,a as ue,b as ke,v as ve}from"./chunk-D4UN2WVJ.js";import"./chunk-XZOZKGXX.js";import"./chunk-26KUR5UJ.js";import{v as pe,w as Se}from"./chunk-GIZGGZ62.js";import{$ as ae,Ba as be,P as oe,Z as ie,_ as re,d as Z,h as ee,na as se,oa as ce,pa as le,qa as ge,t as te,v as ne,va as me,wa as de}from"./chunk-XVXSUTZI.js";import{$a as G,Aa as C,Ea as B,F as P,Fa as V,Ga as H,Gb as K,Jb as X,N as y,Nb as we,O as x,Oa as Q,Pa as W,Sa as p,Ta as u,Wa as N,Xa as Y,Ya as q,_ as z,aa as w,ab as b,ba as r,bb as S,ga as U,ha as E,jb as v,ka as F,kb as f,ma as A,pb as k,sa as d,ta as L,ua as j,wa as $,xa as R,xb as J,ya as a,za as s,zb as xe}from"./chunk-LBGYGD76.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as I,b as T,f as D,o as M}from"./chunk-FIPIWZQS.js";var Ce,Pe=D(()=>{"use strict";k();Ce=(()=>{let n=class n{transform(o){let t=new Date(o),e=new Date,c=t.toDateString()===e.toDateString(),g=new Date;g.setDate(e.getDate()-1);let l=t.toDateString()===g.toDateString(),h=t.getHours().toString().padStart(2,"0"),_=t.getMinutes().toString().padStart(2,"0"),O=`${h}:${_}`;if(c)return`Hoy, ${O}`;if(l)return`Ayer, ${O}`;let fe=t.getDate().toString().padStart(2,"0"),Oe=(t.getMonth()+1).toString().padStart(2,"0"),ye=t.getFullYear().toString().slice(-2);return`${fe}/${Oe}/${ye}, ${O}`}};n.\u0275fac=function(t){return new(t||n)},n.\u0275pipe=F({name:"formatTimestamp",type:n,pure:!0});let i=n;return i})()});function Le(i,n){if(i&1&&(a(0,"ion-avatar",22),C(1,"img",27),s()),i&2){let m=H(2);r(),d("src",m.displayedUserData().profilePictureURL,w)}}function je(i,n){if(i&1&&(a(0,"div",21),A(1,Le,2,1,"ion-avatar",22),a(2,"div",23)(3,"ion-text",24),p(4),s()(),a(5,"div",25)(6,"ion-text",26),p(7),b(8,"formatTimestamp"),s()()()),i&2){let m=n.$implicit;L("sent",m.type==="sent")("received",m.type==="received"),r(),j(m.type==="received"?1:-1),r(3),u(m.text),r(3),u(S(8,7,m.timestamp))}}var Ee,Fe,Ae,tt,$e=D(()=>{k();xe();ne();be();we();ze();Te();Se();De();ke();Ie();Pe();k();ne();Ee=["scrollContainer"],Fe=i=>[i],Ae=(i,n)=>n._id;tt=(()=>{let n=class n{constructor(){this.route=P(K),this.conversationService=P(Me),this.authService=P(pe),this.conversation=v(()=>this.conversationService.conversationState().conversation),this.conversationMessages=v(()=>{var o,t;return(t=(o=this.conversation())==null?void 0:o.messages.slice().reverse().map(e=>T(I({},e),{type:e.senderId===this.authService.authStatus().userId?"sent":"received"})))!=null?t:[]}),this.role=v(()=>this.conversationService.conversationState().role),this.loading=v(()=>this.conversationService.conversationState().loading),this.errorMessage=v(()=>this.conversationService.conversationState().errorMessage),this.inputMessage=z(""),this.displayedUserData=v(()=>{var o,t,e,c;return{username:(t=(o=this.conversation())==null?void 0:o.participants[this.role()==="buyer"?"seller":"buyer"].username)!=null?t:"",profilePictureURL:(c=(e=this.conversation())==null?void 0:e.participants[this.role()==="buyer"?"seller":"buyer"].profilePictureURL)!=null?c:""}}),this.scrollContainer=U("scrollContainer"),ue({navigateOutline:ve}),f(()=>M(this,null,function*(){this.conversationMessages(),setTimeout(()=>this.scrollToBottom(),10)})),f(()=>console.log(this.conversationService.conversationState())),f(()=>console.log(this.conversationMessages()))}ngOnInit(){return M(this,null,function*(){var o;this.conversationService.setConversationId((o=this.route.snapshot.paramMap.get("conversationId"))!=null?o:"")})}sendMessage(){return M(this,null,function*(){this.inputMessage()&&(yield this.conversationService.sendMessage(this.inputMessage()),this.inputMessage.set(""))})}scrollToBottom(){return M(this,null,function*(){var o;yield(o=this.scrollContainer())==null?void 0:o.scrollToBottom()})}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=E({type:n,selectors:[["app-conversation"]],viewQuery:function(t,e){t&1&&Q(e.scrollContainer,Ee,5),t&2&&W()},decls:28,vars:16,consts:[["scrollContainer",""],[3,"translucent"],["type","arrow-back",3,"title","showAvatar","avatarUrl"],[3,"fullscreen"],["collapse","condense"],["size","large"],[1,"container"],[1,"post-data-container",3,"routerLink"],[1,"post-thumbnail"],["alt","Imagen principal del post relacionado",3,"src"],[1,"post-data"],[1,"post-status"],[1,"post-title"],[1,"post-price"],[1,"conversation-container"],[1,"message-item",3,"sent","received"],[1,"footer","ion-no-border"],[1,"message-input-container"],["placeholder","Mensaje...",1,"custom","message-input",3,"ngModelChange","ngModel"],[1,"send-icon-container",3,"click"],["name","navigate-outline",1,"send-icon"],[1,"message-item"],[1,"message-sender-avatar"],[1,"message-text-wrapper"],[1,"message-text"],[1,"message-timestamp-wrapper"],[1,"message-timestamp"],["alt","Avatar del usuario",3,"src"]],template:function(t,e){if(t&1){let c=B();a(0,"ion-header",1),C(1,"app-toolbar",2),s(),a(2,"ion-content",3,0)(4,"ion-header",4)(5,"ion-toolbar")(6,"ion-title",5),p(7),s()()(),a(8,"div",6)(9,"div",7)(10,"ion-thumbnail",8),C(11,"img",9),s(),a(12,"div",10)(13,"ion-text",11),p(14),s(),a(15,"ion-text",12),p(16),s(),a(17,"ion-text",13),p(18),b(19,"formatCurrency"),s()()(),a(20,"div",14),$(21,je,9,9,"div",15,Ae),s()()(),a(23,"ion-footer",16)(24,"div",17)(25,"ion-input",18),q("ngModelChange",function(l){return y(c),Y(e.inputMessage,l)||(e.inputMessage=l),x(l)}),s(),a(26,"div",19),V("click",function(){return y(c),x(e.sendMessage())}),C(27,"ion-icon",20),s()()()}if(t&2){let c,g,l,h,_;d("translucent",!0),r(),d("title",e.displayedUserData().username)("showAvatar",!0)("avatarUrl",e.displayedUserData().profilePictureURL),r(),d("fullscreen",!0),r(5),u(e.displayedUserData().username),r(2),d("routerLink",G(14,Fe,"/tabs/post-detail/"+((c=e.conversation())==null||c.relatedPost==null?null:c.relatedPost.postId))),r(2),d("src",(g=e.conversation())==null||g.relatedPost==null?null:g.relatedPost.mainImageURL,w),r(3),u(!((l=e.conversation())==null||l.relatedPost==null)&&l.relatedPost.isActive?"En curso":"Finalizado"),r(2),u((h=e.conversation())==null||h.relatedPost==null?null:h.relatedPost.title),r(2),u(S(19,12,(_=e.conversation())==null||_.relatedPost==null?null:_.relatedPost.price)),r(3),R(e.conversationMessages()),r(4),N("ngModel",e.inputMessage)}},dependencies:[Ce,re,oe,X,me,de,se,he,ce,ie,ae,le,ge,J,te,Z,ee,_e],styles:["ion-content[_ngcontent-%COMP%]{--padding-top: 0px}.container[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;min-height:100%}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]{padding-top:var(--top-content-padding, 16px);position:sticky;top:0;z-index:999;background-color:var(--ion-background-color);display:flex;flex-direction:row;align-items:flex-start;gap:1rem;padding-bottom:.5rem;border-bottom:1px solid var(--ion-color-dark-tint);cursor:pointer}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]   .post-thumbnail[_ngcontent-%COMP%]{padding-top:.25rem;--border-radius: 4px;overflow:hidden}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]   .post-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.1rem}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]   .post-data[_ngcontent-%COMP%]   .post-status[_ngcontent-%COMP%]{color:var(--ion-color-medium-tint);font-size:var(--body-medium-size, .875rem);font-style:normal;text-transform:uppercase;font-weight:var(--body-medium-weight-normal, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]   .post-data[_ngcontent-%COMP%]   .post-title[_ngcontent-%COMP%]{font-size:var(--label-large-size, .875rem);font-style:normal;font-weight:var(--label-large-weight-normal, 400);line-height:var(--label-large-line-height, 1.25rem);letter-spacing:var(--label-large-tracking, .00625rem)}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]   .post-data[_ngcontent-%COMP%]   .post-price[_ngcontent-%COMP%]{color:var(--ion-color-light-tint);font-size:var(--label-larger-size, 1.25rem);font-style:normal;font-weight:var(--label-larger-weight-prominent, 600);line-height:var(--label-larger-line-height, 1.625rem);letter-spacing:var(--label-larger-tracking, 0rem)}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]{position:relative;min-height:100%;width:100%;padding-top:1rem;display:flex;flex-direction:column;gap:1rem;overflow-y:auto}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;grid-template-rows:auto auto;gap:.25rem .5rem}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight-normal, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.sent[_ngcontent-%COMP%]{justify-items:end}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.sent[_ngcontent-%COMP%]   .message-sender-avatar[_ngcontent-%COMP%]{display:none}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.sent[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background-color:var(--ion-color-light-shade);color:var(--ion-color-dark);border:1px solid var(--ion-color-medium-tint)}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.sent[_ngcontent-%COMP%]   .message-timestamp-wrapper[_ngcontent-%COMP%]{justify-self:end}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.received[_ngcontent-%COMP%]{justify-items:start}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.received[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background-color:var(--ion-color-dark-shade);color:var(--ion-color-light);border:1px solid var(--ion-color-dark-tint)}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.received[_ngcontent-%COMP%]   .message-timestamp-wrapper[_ngcontent-%COMP%]{justify-self:start}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-sender-avatar[_ngcontent-%COMP%]{grid-column:1;grid-row:1;align-self:end;justify-self:center;width:40px;height:40px}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-text-wrapper[_ngcontent-%COMP%]{grid-column:2;grid-row:1;max-width:80%;display:flex;align-items:center}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-text-wrapper[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{padding:8px 12px;border-radius:12px;display:inline-block;word-break:break-word}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-timestamp-wrapper[_ngcontent-%COMP%]{grid-column:2;grid-row:2;font-size:.75rem;color:#888;margin-top:2px}.footer[_ngcontent-%COMP%]{background-color:var(--ion-background-color);padding:var(--top-content-padding, 16px) 0 24px var(--horizontal-margin, 24px)}.footer[_ngcontent-%COMP%]   .message-input-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.footer[_ngcontent-%COMP%]   .message-input-container[_ngcontent-%COMP%]   .message-input[_ngcontent-%COMP%]{padding-bottom:1rem;display:flex;flex-direction:row;flex:1 0 0;--background: var(--ion-color-dark-tint);--color: var(--ion-color-light);--placeholder-opacity: .8;min-height:2.5rem;--border-radius: 8px;--highlight-color-focused: none;--highlight-color-valid: none;--highlight-color-invalid: none;--highlight-height: 0px;--padding-start: 1rem;--padding-end: .5rem;max-width:100%;overflow:hidden}.footer[_ngcontent-%COMP%]   .message-input-container[_ngcontent-%COMP%]   .send-icon-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:4rem;height:2.5rem}.footer[_ngcontent-%COMP%]   .message-input-container[_ngcontent-%COMP%]   .send-icon-container[_ngcontent-%COMP%]   .send-icon[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--ion-color-light)}"]});let i=n;return i})()});$e();export{tt as ConversationPage};
