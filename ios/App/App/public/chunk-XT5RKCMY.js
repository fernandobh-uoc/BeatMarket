import{a as he,b as De}from"./chunk-5H4YHFF5.js";import{a as ve,b as Ie}from"./chunk-7HX7VADE.js";import{e as ue,f as ke}from"./chunk-2GV3WWDM.js";import{F as Se,a as de,b as be,x as pe}from"./chunk-QZLDCAKT.js";import"./chunk-7QGFDW3N.js";import"./chunk-CVZVN4BI.js";import"./chunk-6RPMLJXL.js";import"./chunk-ZDSPE5PQ.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-ZSFULLTW.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import"./chunk-5WOL6UCU.js";import"./chunk-UCDHUJSY.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-YHSX2JBD.js";import"./chunk-7JRGKQWZ.js";import{y as me,z as we}from"./chunk-WI56WTX3.js";import{$ as re,Ca as xe,Q as oe,_ as ie,aa as ae,d as Z,h as ee,oa as se,pa as ce,t as te,v as ne,wa as le,xa as ge}from"./chunk-IBFAPW3Z.js";import{$ as r,$a as S,Ca as B,D as P,Da as V,Ea as H,Eb as K,Hb as X,L as y,Lb as ye,M as x,Ma as Q,Na as W,Qa as u,Ra as v,Ua as N,Va as Y,Wa as q,Y as z,Za as G,_ as w,_a as b,ea as U,fa as E,hb as p,ia as F,ib as f,ka as A,nb as k,qa as d,ra as L,sa as j,ua as $,va as R,vb as J,wa as a,xa as s,xb as Oe,ya as C}from"./chunk-S4NGLO4I.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as I,b as D,f as T,o as M}from"./chunk-FIPIWZQS.js";var _e,Me=T(()=>{"use strict";k();_e=(()=>{let n=class n{transform(o){let e=new Date(o),t=new Date,c=e.toDateString()===t.toDateString(),g=new Date;g.setDate(t.getDate()-1);let l=e.toDateString()===g.toDateString(),h=e.getHours().toString().padStart(2,"0"),_=e.getMinutes().toString().padStart(2,"0"),O=`${h}:${_}`;if(c)return`Hoy, ${O}`;if(l)return`Ayer, ${O}`;let Ce=e.getDate().toString().padStart(2,"0"),Pe=(e.getMonth()+1).toString().padStart(2,"0"),fe=e.getFullYear().toString().slice(-2);return`${Ce}/${Pe}/${fe}, ${O}`}};n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=F({name:"formatTimestamp",type:n,pure:!0});let i=n;return i})()});function Fe(i,n){if(i&1&&(a(0,"ion-avatar",20),C(1,"img",25),s()),i&2){let m=H(2);r(),d("src",m.displayedUserData().profilePictureURL,w)}}function Ae(i,n){if(i&1&&(a(0,"div",19),A(1,Fe,2,1,"ion-avatar",20),a(2,"div",21)(3,"ion-text",22),u(4),s()(),a(5,"div",23)(6,"ion-text",24),u(7),b(8,"formatTimestamp"),s()()()),i&2){let m=n.$implicit;L("sent",m.type==="sent")("received",m.type==="received"),r(),j(m.type==="received"?1:-1),r(3),v(m.text),r(3),v(S(8,7,m.timestamp))}}var ze,Ue,Ee,Ze,Le=T(()=>{k();Oe();ne();xe();ye();De();ke();we();Ie();be();Se();Me();k();ne();ze=["scrollContainer"],Ue=i=>[i],Ee=(i,n)=>n._id;Ze=(()=>{let n=class n{constructor(){this.route=P(K),this.conversationService=P(he),this.authService=P(me),this.conversation=p(()=>this.conversationService.conversationState().conversation),this.conversationMessages=p(()=>{var o,e;return(e=(o=this.conversation())==null?void 0:o.messages.slice().reverse().map(t=>D(I({},t),{type:t.senderId===this.authService.authState().userId?"sent":"received"})))!=null?e:[]}),this.role=p(()=>this.conversationService.conversationState().role),this.loading=p(()=>this.conversationService.conversationState().loading),this.errorMessage=p(()=>this.conversationService.conversationState().errorMessage),this.inputMessage=z(""),this.displayedUserData=p(()=>{var o,e,t,c;return{username:(e=(o=this.conversation())==null?void 0:o.participants[this.role()==="buyer"?"seller":"buyer"].username)!=null?e:"",profilePictureURL:(c=(t=this.conversation())==null?void 0:t.participants[this.role()==="buyer"?"seller":"buyer"].profilePictureURL)!=null?c:""}}),this.scrollContainer=U("scrollContainer"),de({navigateOutline:pe}),f(()=>M(this,null,function*(){this.conversationMessages(),setTimeout(()=>this.scrollToBottom(),10)})),f(()=>console.log(this.conversationService.conversationState())),f(()=>console.log(this.conversationMessages()))}ngOnInit(){return M(this,null,function*(){var o;this.conversationService.setConversationId((o=this.route.snapshot.paramMap.get("conversationId"))!=null?o:"")})}sendMessage(){return M(this,null,function*(){this.inputMessage()&&(yield this.conversationService.sendMessage(this.inputMessage()),this.inputMessage.set(""))})}scrollToBottom(){return M(this,null,function*(){var o;yield(o=this.scrollContainer())==null?void 0:o.scrollToBottom()})}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=E({type:n,selectors:[["app-conversation"]],viewQuery:function(e,t){e&1&&Q(t.scrollContainer,ze,5),e&2&&W()},decls:24,vars:15,consts:[["scrollContainer",""],[3,"translucent"],["type","arrow-back",3,"title","showAvatar","avatarUrl"],[3,"fullscreen"],[1,"container"],[1,"post-data-container",3,"routerLink"],[1,"post-thumbnail"],["alt","Imagen principal del post relacionado",3,"src"],[1,"post-data"],[1,"post-status"],[1,"post-title"],[1,"post-price"],[1,"conversation-container"],[1,"message-item",3,"sent","received"],[1,"footer","ion-no-border"],[1,"message-input-container"],["placeholder","Mensaje...",1,"custom","message-input",3,"ngModelChange","ngModel"],[1,"send-icon-container",3,"click"],["name","navigate-outline",1,"send-icon"],[1,"message-item"],[1,"message-sender-avatar"],[1,"message-text-wrapper"],[1,"message-text"],[1,"message-timestamp-wrapper"],[1,"message-timestamp"],["alt","Avatar del usuario",3,"src"]],template:function(e,t){if(e&1){let c=B();a(0,"ion-header",1),C(1,"app-toolbar",2),s(),a(2,"ion-content",3,0)(4,"div",4)(5,"div",5)(6,"ion-thumbnail",6),C(7,"img",7),s(),a(8,"div",8)(9,"ion-text",9),u(10),s(),a(11,"ion-text",10),u(12),s(),a(13,"ion-text",11),u(14),b(15,"formatCurrency"),s()()(),a(16,"div",12),$(17,Ae,9,9,"div",13,Ee),s()()(),a(19,"ion-footer",14)(20,"div",15)(21,"ion-input",16),q("ngModelChange",function(l){return y(c),Y(t.inputMessage,l)||(t.inputMessage=l),x(l)}),s(),a(22,"div",17),V("click",function(){return y(c),x(t.sendMessage())}),C(23,"ion-icon",18),s()()()}if(e&2){let c,g,l,h,_;d("translucent",!0),r(),d("title",t.displayedUserData().username)("showAvatar",!0)("avatarUrl",t.displayedUserData().profilePictureURL),r(),d("fullscreen",!0),r(3),d("routerLink",G(13,Ue,"/tabs/post-detail/"+((c=t.conversation())==null||c.relatedPost==null?null:c.relatedPost.postId))),r(2),d("src",(g=t.conversation())==null||g.relatedPost==null?null:g.relatedPost.mainImageURL,w),r(3),v(!((l=t.conversation())==null||l.relatedPost==null)&&l.relatedPost.isActive?"En curso":"Finalizado"),r(2),v((h=t.conversation())==null||h.relatedPost==null?null:h.relatedPost.title),r(2),v(S(15,11,(_=t.conversation())==null||_.relatedPost==null?null:_.relatedPost.price)),r(3),R(t.conversationMessages()),r(4),N("ngModel",t.inputMessage)}},dependencies:[_e,re,oe,X,le,ge,se,ue,ce,ie,ae,J,te,Z,ee,ve],styles:["ion-content[_ngcontent-%COMP%]{--padding-top: 0px}.container[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;min-height:100%}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]{padding-top:var(--top-content-padding, 16px);position:sticky;top:0;z-index:999;background-color:var(--ion-background-color);display:flex;flex-direction:row;align-items:flex-start;gap:1rem;padding-bottom:.5rem;border-bottom:1px solid var(--ion-color-dark-tint);cursor:pointer}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]   .post-thumbnail[_ngcontent-%COMP%]{padding-top:.25rem;--border-radius: 4px;overflow:hidden}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]   .post-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.1rem}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]   .post-data[_ngcontent-%COMP%]   .post-status[_ngcontent-%COMP%]{color:var(--ion-color-medium-tint);font-size:var(--body-medium-size, .875rem);font-style:normal;text-transform:uppercase;font-weight:var(--body-medium-weight-normal, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]   .post-data[_ngcontent-%COMP%]   .post-title[_ngcontent-%COMP%]{font-size:var(--label-large-size, .875rem);font-style:normal;font-weight:var(--label-large-weight-normal, 400);line-height:var(--label-large-line-height, 1.25rem);letter-spacing:var(--label-large-tracking, .00625rem)}.container[_ngcontent-%COMP%]   .post-data-container[_ngcontent-%COMP%]   .post-data[_ngcontent-%COMP%]   .post-price[_ngcontent-%COMP%]{color:var(--ion-color-light-tint);font-size:var(--label-larger-size, 1.25rem);font-style:normal;font-weight:var(--label-larger-weight-prominent, 600);line-height:var(--label-larger-line-height, 1.625rem);letter-spacing:var(--label-larger-tracking, 0rem)}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]{position:relative;min-height:100%;width:100%;padding-top:1rem;display:flex;flex-direction:column;gap:1rem;overflow-y:auto}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;grid-template-rows:auto auto;gap:.25rem .5rem}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight-normal, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.sent[_ngcontent-%COMP%]{justify-items:end}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.sent[_ngcontent-%COMP%]   .message-sender-avatar[_ngcontent-%COMP%]{display:none}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.sent[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background-color:var(--ion-color-light-shade);color:var(--ion-color-dark);border:1px solid var(--ion-color-medium-tint)}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.sent[_ngcontent-%COMP%]   .message-timestamp-wrapper[_ngcontent-%COMP%]{justify-self:end}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.received[_ngcontent-%COMP%]{justify-items:start}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.received[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background-color:var(--ion-color-dark-shade);color:var(--ion-color-light);border:1px solid var(--ion-color-dark-tint)}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item.received[_ngcontent-%COMP%]   .message-timestamp-wrapper[_ngcontent-%COMP%]{justify-self:start}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-sender-avatar[_ngcontent-%COMP%]{grid-column:1;grid-row:1;align-self:end;justify-self:center;width:40px;height:40px}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-text-wrapper[_ngcontent-%COMP%]{grid-column:2;grid-row:1;max-width:80%;display:flex;align-items:center}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-text-wrapper[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{padding:8px 12px;border-radius:12px;display:inline-block;word-break:break-word}.container[_ngcontent-%COMP%]   .conversation-container[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-timestamp-wrapper[_ngcontent-%COMP%]{grid-column:2;grid-row:2;font-size:.75rem;color:#888;margin-top:2px}.footer[_ngcontent-%COMP%]{background-color:var(--ion-background-color);padding:var(--top-content-padding, 16px) 0 24px var(--horizontal-margin, 24px)}.footer[_ngcontent-%COMP%]   .message-input-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.footer[_ngcontent-%COMP%]   .message-input-container[_ngcontent-%COMP%]   .message-input[_ngcontent-%COMP%]{padding-bottom:1rem;display:flex;flex-direction:row;flex:1 0 0;--background: var(--ion-color-dark-tint);--color: var(--ion-color-light);--placeholder-opacity: .8;min-height:2.5rem;--border-radius: 8px;--highlight-color-focused: none;--highlight-color-valid: none;--highlight-color-invalid: none;--highlight-height: 0px;--padding-start: 1rem;--padding-end: .5rem;max-width:100%;overflow:hidden}.footer[_ngcontent-%COMP%]   .message-input-container[_ngcontent-%COMP%]   .send-icon-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:4rem;height:2.5rem}.footer[_ngcontent-%COMP%]   .message-input-container[_ngcontent-%COMP%]   .send-icon-container[_ngcontent-%COMP%]   .send-icon[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--ion-color-light)}"]});let i=n;return i})()});Le();export{Ze as ConversationPage};
