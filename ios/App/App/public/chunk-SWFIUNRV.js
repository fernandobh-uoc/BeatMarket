import{b as l,c as R,d as f,e as v}from"./chunk-26KUR5UJ.js";import{v as d,w as g}from"./chunk-GIZGGZ62.js";import{B as h,F as n,_ as m,jb as u,l as o,pb as p,x as I}from"./chunk-LBGYGD76.js";import{f as y,o as a}from"./chunk-FIPIWZQS.js";var k,C=y(()=>{"use strict";p();I();R();g();v();p();k=(()=>{let s=class s{constructor(){this.cartRepository=n(f),this.authService=n(d),this.errorMessage=m(""),this.cartResource=l({request:()=>this.authService.currentUser(),loader:({request:t})=>{var r;if(!this.cartRepository.getCartByUserId$)return o(null);if(!(t!=null&&t._id))return o(null);try{let e=this.cartRepository.getCartByUserId$(t._id);return e!=null?e:o(null)}catch(e){return this.errorMessage.set((r=e==null?void 0:e.message)!=null?r:"Unknown error"),o(null)}}}),this.cartItemsAmount=u(()=>{var t,r;return(r=(t=this.cartResource.value())==null?void 0:t.items.length)!=null?r:0}),this.cartState=u(()=>{var t,r;return{cartItems:(r=(t=this.cartResource.value())==null?void 0:t.items)!=null?r:[],cartItemsAmount:this.cartItemsAmount(),loading:this.cartResource.isLoading(),errorMessage:this.errorMessage()}})}createCart(t){return a(this,null,function*(){yield this.cartRepository.saveCart({userId:t})})}addItemToCart(t){return a(this,null,function*(){let r=this.cartResource.value();if(console.log({cart:r}),!r)return;if(r.items.find(c=>c.postId===t.postId)){console.warn(`Item with postId ${t.postId} already in cart`);return}r.items.push(t),yield this.cartRepository.updateCart(r)})}removeItemFromCart(t){return a(this,null,function*(){let r=this.cartResource.value();if(!r)return;let e=r.items.findIndex(c=>c.postId===t);e!==-1&&(r.items.splice(e,1),yield this.cartRepository.updateCart(r))})}clearCart(){return a(this,null,function*(){let t=this.cartResource.value();t&&(t.items=[],yield this.cartRepository.updateCart(t))})}};s.\u0275fac=function(r){return new(r||s)},s.\u0275prov=h({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})()});export{k as a,C as b};
