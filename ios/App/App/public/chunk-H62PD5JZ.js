import{a as ze,b as nt}from"./chunk-5H4YHFF5.js";import{a as Ue,b as et}from"./chunk-7HX7VADE.js";import{a as H,b as Le,e as Ee,f as Ze}from"./chunk-2GV3WWDM.js";import{F as Xe,a as Re,b as We,j as Te}from"./chunk-QZLDCAKT.js";import"./chunk-7QGFDW3N.js";import"./chunk-CVZVN4BI.js";import"./chunk-6RPMLJXL.js";import"./chunk-ZDSPE5PQ.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-ZSFULLTW.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import"./chunk-5WOL6UCU.js";import"./chunk-UCDHUJSY.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-YHSX2JBD.js";import{a as Fe,b as tt}from"./chunk-67M6C2S2.js";import"./chunk-7JRGKQWZ.js";import{b as De,c as Qe,y as G,z as ke}from"./chunk-WI56WTX3.js";import{Ca as Ke,Q as ye,S as Me,_ as be,aa as Oe,la as we,oa as Ie,t as xe,v as Je,wa as Se}from"./chunk-IBFAPW3Z.js";import{$ as c,$a as z,Ca as L,D as h,Da as E,Ea as f,Eb as fe,Gb as Ce,Ha as ue,Hb as ve,L as R,Lb as Pe,M as T,Pa as J,Qa as d,Ra as ge,Sa as P,W as le,Y as M,Ya as U,Za as _e,_ as me,_a as F,fa as j,hb as I,ia as B,ib as q,ka as b,l as V,nb as x,qa as O,ra as de,sa as w,ta as pe,ua as N,v as He,va as $,vb as he,wa as a,xa as o,xb as Ye,ya as v,z as ce}from"./chunk-S4NGLO4I.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{f as D,o as k}from"./chunk-FIPIWZQS.js";var Ae,Ve=D(()=>{"use strict";x();He();tt();ke();Le();Qe();Pe();nt();x();Ae=(()=>{let n=class n{constructor(){this.postRepository=h(Fe),this.cartService=h(H),this.authService=h(G),this.conversationService=h(ze),this.router=h(Ce),this.errorMessage=M(""),this.postId=M(void 0),this.postResource=De({request:()=>this.postId(),loader:({request:e})=>{var i;if(!e)return V(null);try{let r=this.postRepository.getPostById$(e);return r!=null?r:V(null)}catch(r){return this.errorMessage.set((i=r==null?void 0:r.message)!=null?i:"Unknown error"),V(null)}}}),this.postDetailState=I(()=>{var e;return{postData:(e=this.postResource.value())!=null?e:null,loading:this.postResource.isLoading(),errorMessage:this.errorMessage()}})}setPostId(e){this.postId.set(e)}addToCart(e){return k(this,null,function*(){try{yield this.cartService.addItemToCart({postId:e.postId,title:e.title,price:e.price,shipping:e.shipping,mainImageURL:e.mainImageURL})}catch(i){throw console.error(i),this.errorMessage.set(i),i}})}loadConversation(){return k(this,null,function*(){var e,i,r,m,u,g,p,_,C,l,S,K,Q,W,X,Z,ee,te,ne,ie,re,oe,ae,se;try{let y=this.postId();if(!y)return;let A=yield this.conversationService.getConversationId({postId:y});if(A||(A=yield this.conversationService.createConversation({relatedPostData:{postId:y,title:(i=(e=this.postResource.value())==null?void 0:e.title)!=null?i:"",price:(m=(r=this.postResource.value())==null?void 0:r.price)!=null?m:0,isActive:(g=(u=this.postResource.value())==null?void 0:u.isActive)!=null?g:!1,mainImageURL:(_=(p=this.postResource.value())==null?void 0:p.mainImageURL)!=null?_:""},buyerData:{userId:(l=(C=this.authService.currentUser())==null?void 0:C._id)!=null?l:"",username:(K=(S=this.authService.currentUser())==null?void 0:S.username)!=null?K:"",profilePictureURL:(W=(Q=this.authService.currentUser())==null?void 0:Q.profilePictureURL)!=null?W:""},sellerData:{userId:(ee=(Z=(X=this.postResource.value())==null?void 0:X.user)==null?void 0:Z.userId)!=null?ee:"",username:(ie=(ne=(te=this.postResource.value())==null?void 0:te.user)==null?void 0:ne.username)!=null?ie:"",profilePictureURL:(ae=(oe=(re=this.postResource.value())==null?void 0:re.user)==null?void 0:oe.profilePictureURL)!=null?ae:""}})),!A)return;this.router.navigate([`/conversation/${A}`])}catch(y){this.errorMessage.set((se=y==null?void 0:y.message)!=null?se:"Unknown error")}})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})()});function it(t,n){if(t&1){let s=L();a(0,"div",3),E("click",function(){let i=R(s).$implicit,r=f();return T(r.selectedImageURL.set(i))}),o()}if(t&2){let s=n.$implicit,e=f();J("background-image: url('",s,"')"),de("selected",e.selectedImageURL()===s)}}var je,Be=D(()=>{"use strict";x();x();je=(()=>{let n=class n{constructor(){this.imagesURLs=le([]),this.selectedImageURL=M(""),q(()=>{let e=this.imagesURLs();e&&e.length>0&&this.selectedImageURL.set(e[0])})}ngOnInit(){}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=j({type:n,selectors:[["app-post-images-slider"]],inputs:{imagesURLs:[1,"imagesURLs"]},decls:4,vars:3,consts:[[1,"big-image-container"],[1,"images-row"],[1,"image-container",3,"style","selected"],[1,"image-container",3,"click"]],template:function(i,r){i&1&&(v(0,"div",0),a(1,"div",1),N(2,it,1,5,"div",2,pe),o()),i&2&&(J("background-image: url('",r.selectedImageURL(),"')"),c(2),$(r.imagesURLs()))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto}.big-image-container[_ngcontent-%COMP%]{margin-bottom:1rem;margin:0rem 0rem 1rem calc(var(--horizontal-margin) * -1);min-width:100dvw;min-height:40dvh;background-size:cover;background-position:center;background-repeat:no-repeat;background-color:var(--ion-color-dark-tint)}.images-row[_ngcontent-%COMP%]{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;justify-content:flex-start}.images-row[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:0 0 auto;width:80px;height:80px;margin-right:1rem;scroll-snap-align:start;border-radius:.5rem;background-size:cover;background-position:center;background-repeat:no-repeat;cursor:pointer}.images-row[_ngcontent-%COMP%]   .image-container.selected[_ngcontent-%COMP%]{border:1px solid var(--ion-color-light-shade)}"]});let t=n;return t})()});var Ne,$e=D(()=>{"use strict";x();Ne=(()=>{let n=class n{transform(e){return!e||typeof e!="object"?[]:Object.entries(e).filter(([i,r])=>r!=null).map(([i,r])=>({key:i,value:r}))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275pipe=B({name:"keyValuePairs",type:n,pure:!0});let t=n;return t})()});var qe,Ge=D(()=>{"use strict";x();qe=(()=>{let n=class n{transform(e,...i){let r={category:"Categor\xEDa",type:"Tipo",brand:"Marca",model:"Modelo",color:"Color",fabricationYear:"A\xF1o de fabricaci\xF3n",serialNumber:"N\xFAmero de serie",instrumentLevel:"Nivel de instrumento",format:"Formato",artist:"Artista",genre:"G\xE9nero",recordingTitle:"T\xEDtulo de la grabaci\xF3n",year:"A\xF1o",duration:"Duraci\xF3n",label:"Etiqueta",catalogNumber:"N\xFAmero de cat\xE1logo",isrc:"ISRC",barcode:"C\xF3digo de barras",releaseDate:"Fecha de publicaci\xF3n",releaseCountry:"Pa\xEDs de publicaci\xF3n",releaseFormat:"Formato de publicaci\xF3n",trackCount:"N\xFAmero de pistas",name:"Nombre",accessories:"Accesorios",warranty:"Garant\xEDa",warrantyDuration:"Duraci\xF3n de la garant\xEDa",warrantyType:"Tipo de garant\xEDa",title:"T\xEDtulo",author:"Autor",theme:"Tema",edition:"Edici\xF3n",publisher:"Editorial",pages:"P\xE1ginas",language:"Idioma",isbn:"ISBN",series:"Serie",volume:"Volumen",description:"Descripci\xF3n"};return r[e]?r[e]:""}};n.\u0275fac=function(i){return new(i||n)},n.\u0275pipe=B({name:"articleCharacteristicsTranslate",type:n,pure:!0});let t=n;return t})()});function mt(t,n){t&1&&(a(0,"div",3),v(1,"ion-spinner",4),o())}function dt(t,n){if(t&1){let s=L();a(0,"div",27),E("click",function(){R(s);let i=f(2);return T(i.goToConversation())}),v(1,"ion-icon",28),o()}}function pt(t,n){t&1&&(a(0,"ion-button",31),d(1,"Ir al carrito"),o()),t&2&&O("routerLink",U(1,ct))}function ut(t,n){if(t&1){let s=L();a(0,"ion-button",33),E("click",function(){R(s);let i=f(4);return T(i.addToCart())}),d(1,"A\xF1adir al carrito"),o()}}function gt(t,n){if(t&1&&b(0,pt,2,2,"ion-button",31)(1,ut,2,0,"ion-button",32),t&2){let s=f(3);w(s.itemIsAdded()?0:1)}}function _t(t,n){t&1&&(a(0,"div",29)(1,"ion-text",34),d(2," Este anuncio ha finalizado "),o()())}function ht(t,n){if(t&1&&(b(0,gt,2,1)(1,_t,3,0,"div",29),a(2,"ion-button",30),d(3,"Seguir comprando"),o()),t&2){let s,e=f(2);w((s=e.postData())!=null&&s.isActive?0:1),c(2),O("routerLink",U(2,st))}}function ft(t,n){if(t&1&&(a(0,"ion-text",35)(1,"span",36),d(2),F(3,"articleCharacteristicsTranslate"),o(),d(4),o()),t&2){let s=f().$implicit;c(2),ge(z(3,2,s.key)),c(2),P(": ",s.value," ")}}function Ct(t,n){if(t&1&&b(0,ft,5,4,"ion-text",35),t&2){let s=n.$implicit;w(s.value!==""?0:-1)}}function vt(t,n){if(t&1&&(v(0,"app-post-images-slider",5),a(1,"div",6)(2,"ion-text",7),d(3),o(),a(4,"div",8)(5,"div",9)(6,"ion-avatar",10),v(7,"img",11),o(),a(8,"ion-text",12),d(9),o()(),b(10,dt,2,0,"div",13),o()(),a(11,"div",14)(12,"ion-text",15),d(13),F(14,"formatCurrency"),o(),a(15,"ion-text",16),d(16),F(17,"formatCurrency"),o()(),a(18,"div",17),b(19,ht,4,3),o(),a(20,"div",18)(21,"ion-text",19),d(22,"Estado"),o(),a(23,"ion-text",20),d(24),o()(),a(25,"div",21)(26,"ion-text",22),d(27,"Descripci\xF3n"),o(),a(28,"ion-text",23),d(29),o()(),a(30,"div",24)(31,"ion-text",25),d(32,"Caracter\xEDsticas"),o(),a(33,"div",26),N(34,Ct,1,1,null,null,lt),F(36,"keyValuePairs"),o()()),t&2){let s,e,i,r,m,u,g,p,_,C,l=f();O("imagesURLs",(s=(s=l.postData())==null?null:s.imagesURLs)!==null&&s!==void 0?s:U(17,rt)),c(3),P(" ",(e=(e=l.postData())==null?null:e.title)!==null&&e!==void 0?e:""," "),c(2),O("routerLink",_e(18,ot,"/tabs/user-detail/"+((i=l.postData())==null||i.user==null?null:i.user.userId))),c(2),ue("src",(r=(r=l.postData())==null||r.user==null?null:r.user.profilePictureURL)!==null&&r!==void 0?r:"",me),c(2),P(" ",(m=(m=l.postData())==null||m.user==null?null:m.user.username)!==null&&m!==void 0?m:""," "),c(),w(l.isOwnPost()?-1:10),c(3),P(" ",z(14,11,(u=(u=l.postData())==null?null:u.price)!==null&&u!==void 0?u:0)," "),c(3),P(" + env\xEDo ",z(17,13,l.Math.max(((g=(g=l.postData())==null?null:g.price)!==null&&g!==void 0?g:0)/100,5))," "),c(3),w(l.isOwnPost()?-1:19),c(5),P(" ",(p=(p=l.postData())==null||p.article==null?null:p.article.condition)!==null&&p!==void 0?p:""," "),c(5),P(" ",(_=(_=l.postData())==null?null:_.description)!==null&&_!==void 0?_:""," "),c(5),$(z(36,15,((C=l.postData())==null||C.article==null?null:C.article.characteristics)||U(20,at)))}}var rt,ot,at,st,ct,lt,tn,Pt=D(()=>{x();Ye();Je();Ke();Ve();Pe();Ze();Be();We();Xe();et();$e();Ge();ke();Le();x();rt=()=>[],ot=t=>[t],at=()=>({}),st=()=>["/tabs/home"],ct=()=>["/cart"],lt=(t,n)=>n.key;tn=(()=>{let n=class n{get Math(){return Math}constructor(){this.route=h(fe),this.postDetailService=h(Ae),this.authService=h(G),this.cartService=h(H),this.postData=I(()=>this.postDetailService.postDetailState().postData),this.loading=I(()=>this.postDetailService.postDetailState().loading),this.errorMessage=I(()=>this.postDetailService.postDetailState().errorMessage),this.itemIsAdded=I(()=>{var e;return(e=this.cartService.cartState().cartItems.some(i=>{var r;return i.postId===((r=this.postData())==null?void 0:r._id)}))!=null?e:!1}),this.isOwnPost=M(!0),Re({chatbubbleEllipses:Te}),q(()=>{var e,i,r;this.isOwnPost.set(((i=(e=this.postData())==null?void 0:e.user)==null?void 0:i.userId)===((r=this.authService.currentUser())==null?void 0:r._id))})}ngOnInit(){return k(this,null,function*(){var e;this.postDetailService.setPostId((e=this.route.snapshot.paramMap.get("postId"))!=null?e:"")})}addToCart(){var i,r,m,u,g,p,_,C,l,S;let e=Math.max(((r=(i=this.postData())==null?void 0:i.price)!=null?r:0)/100,5);this.postDetailService.addToCart({postId:(u=(m=this.postData())==null?void 0:m._id)!=null?u:"",title:(p=(g=this.postData())==null?void 0:g.title)!=null?p:"",price:(C=(_=this.postData())==null?void 0:_.price)!=null?C:0,shipping:e,mainImageURL:(S=(l=this.postData())==null?void 0:l.mainImageURL)!=null?S:""})}goToConversation(){this.postDetailService.loadConversation()}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=j({type:n,selectors:[["app-post-detail"]],decls:6,vars:3,consts:[["type","arrow-back",3,"title"],[3,"fullscreen"],[1,"container"],[1,"loading-spinner-container"],["name","crescent"],[1,"images-slider",3,"imagesURLs"],[1,"title-user-container"],[1,"title"],[1,"user-data-row"],[1,"user-data-container",3,"routerLink"],[1,"user-avatar"],["alt","Avatar del usuario",3,"src"],[1,"user-username"],[1,"message-icon-container"],[1,"price-container"],[1,"price-text"],[1,"shipping-text"],[1,"buttons-container"],[1,"condition-container"],[1,"condition-label"],[1,"condition-text"],[1,"description-container"],[1,"description-label"],[1,"description-text"],[1,"characteristics-container"],[1,"characteristics-label"],[1,"characteristics-list"],[1,"message-icon-container",3,"click"],["name","chatbubble-ellipses","color","light","size","large"],[1,"finished-post-warning-wrapper"],["fill","clear",1,"custom",3,"routerLink"],[1,"custom",3,"routerLink"],[1,"custom"],[1,"custom",3,"click"],[1,"finished-post-warning"],[1,"characteristic-text"],[1,"characteristics-key"]],template:function(i,r){if(i&1&&(a(0,"ion-header"),v(1,"app-toolbar",0),o(),a(2,"ion-content",1)(3,"div",2),b(4,mt,2,0,"div",3)(5,vt,37,21),o()()),i&2){let m;c(),O("title",(m=(m=r.postData())==null?null:m.title)!==null&&m!==void 0?m:""),c(),O("fullscreen",!0),c(2),w(r.loading()?4:5)}},dependencies:[we,ve,Ne,qe,Me,Se,ye,Ie,Ee,je,be,Oe,he,xe,Ue],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.container[_ngcontent-%COMP%]   .loading-spinner-container[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;align-items:center;padding:1rem 0}.container[_ngcontent-%COMP%]   .images-slider[_ngcontent-%COMP%]{margin:calc(var(--top-content-padding) * -1) 0 1rem 0}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-family:Montserrat;font-size:1.125rem;font-style:normal;font-weight:500;line-height:1.5rem;letter-spacing:.03125rem}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]   .user-data-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:2.5rem}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]   .user-data-row[_ngcontent-%COMP%]   .user-data-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:1rem;cursor:pointer}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]   .user-data-row[_ngcontent-%COMP%]   .user-data-container[_ngcontent-%COMP%]   .user-username[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.container[_ngcontent-%COMP%]   .title-user-container[_ngcontent-%COMP%]   .user-data-row[_ngcontent-%COMP%]   .message-icon-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:40px;height:40px;cursor:pointer}.container[_ngcontent-%COMP%]   .price-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.container[_ngcontent-%COMP%]   .price-container[_ngcontent-%COMP%]   .price-text[_ngcontent-%COMP%]{font-size:var(--label-huge-size, 1.5rem);font-style:normal;font-weight:var(--label-huge-weight-prominent, 600);line-height:var(--label-huge-line-height, 2rem);letter-spacing:var(--label-huge-tracking, 0rem)}.container[_ngcontent-%COMP%]   .price-container[_ngcontent-%COMP%]   .shipping-text[_ngcontent-%COMP%]{font-size:var(--label-large-size, .875rem);font-style:normal;font-weight:var(--label-large-weight-prominent, 600);line-height:var(--label-large-line-height, 1.25rem);letter-spacing:var(--label-large-tracking, .00625rem)}.container[_ngcontent-%COMP%]   .buttons-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.container[_ngcontent-%COMP%]   .buttons-container[_ngcontent-%COMP%]   .finished-post-warning-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;min-height:2.5rem;margin:.5rem 0;color:var(--ion-color-warning);border:1px solid var(--ion-color-warning-shade)}.container[_ngcontent-%COMP%]   .buttons-container[_ngcontent-%COMP%]   .finished-post-warning-wrapper[_ngcontent-%COMP%]   .finished-post-warning[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.container[_ngcontent-%COMP%]   .condition-container[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .description-container[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .characteristics-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.container[_ngcontent-%COMP%]   .condition-label[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .description-label[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .characteristics-label[_ngcontent-%COMP%]{font-size:var(--label-larger-size, 1.25rem);font-style:normal;font-weight:var(--label-larger-weight-prominent, 600);line-height:var(--label-larger-line-height, 1.25rem);letter-spacing:var(--label-larger-tracking, .00625rem)}.container[_ngcontent-%COMP%]   .condition-text[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .description-text[_ngcontent-%COMP%]{font-size:var(--body-large-size, 1rem);font-style:normal;font-weight:var(--body-large-weight, 400);line-height:var(--body-large-line-height, 1.5rem);letter-spacing:var(--body-large-tracking, .03125rem)}.container[_ngcontent-%COMP%]   .characteristics-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.container[_ngcontent-%COMP%]   .characteristics-list[_ngcontent-%COMP%]   .characteristic-text[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.container[_ngcontent-%COMP%]   .characteristics-list[_ngcontent-%COMP%]   .characteristic-text[_ngcontent-%COMP%]   .characteristics-key[_ngcontent-%COMP%]{font-weight:var(--body-medium-weight-prominent, 600)}"]});let t=n;return t})()});Pt();export{tn as PostDetailPage};
