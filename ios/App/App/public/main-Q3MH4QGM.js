import{a as Yg,b as MA}from"./chunk-YHSX2JBD.js";import{a as Jg,b as FA}from"./chunk-D2DXDZBG.js";import{a as ys,b as OA}from"./chunk-6I5QFEE4.js";import{i as zg,j as Wg,k as Gg,l as Hg,m as Kg,n as Qg,o as LA}from"./chunk-ZLVYX7G6.js";import{a as bt,b as sa,c as qg,d as oa}from"./chunk-CC7RULIL.js";import{a as jg,b as VA}from"./chunk-67M6C2S2.js";import{a as $g,b as xA}from"./chunk-7JRGKQWZ.js";import{a as Ng,c as CA,d as Og,e as PA,f as ta,g as xg,i as na,k as Vg,m as ra,n as Lg,p as hl,q as Mg,r as kA,s as Fg,t as DA,u as Ug,v as NA,y as ia,z as Bg}from"./chunk-WI56WTX3.js";import{Ca as Dg,K as Sg,N as Cg,P as Pg,ua as kg}from"./chunk-IBFAPW3Z.js";import{$ as hg,B as _n,C as og,D as ie,E as De,F as yn,Fb as wg,G as ag,Gb as Eg,H as ea,I as At,Ib as Tg,Jb as Ag,Kb as bg,Lb as Rg,R as vn,S as cg,U as ot,Y as ug,Z as lg,a as gs,bb as yg,cb as vg,d as rg,db as ll,e as ig,f as Zo,fa as dg,h as RA,i as al,j as cl,l as Kn,na as fg,nb as he,o as Ce,p as Gt,qa as pg,t as ul,u as Qn,v as _s,w as sg,wa as mg,xa as gg,ya as _g,yb as Ig,z as ve,zb as SA}from"./chunk-S4NGLO4I.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as ae,b as Se,e as ng,f as W,g as bA,i as gn,n as Wt,o as p}from"./chunk-FIPIWZQS.js";var Xg,Zg=W(()=>{"use strict";Xg=()=>{}});function ua(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}function da(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},n=e||"demo-project",i=r.iat||0,s=r.sub||r.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},r);return[vs(JSON.stringify(t)),vs(JSON.stringify(o)),""].join(".")}function _e(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function n_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_e())}function zA(){var r;let e=(r=la())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function r_(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function i_(){let r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function s_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function o_(){let r=_e();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function yl(){return!zA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function $r(){try{return typeof indexedDB=="object"}catch{return!1}}function a_(){return new Promise((r,e)=>{try{let t=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}function GA(r,e){return r.replace(HA,(t,n)=>{let i=e[n];return i!=null?String(i):`<${n}?>`})}function c_(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function ft(r,e){if(r===e)return!0;let t=Object.keys(r),n=Object.keys(e);for(let i of t){if(!n.includes(i))return!1;let s=r[i],o=e[i];if(e_(s)&&e_(o)){if(!ft(s,o))return!1}else if(s!==o)return!1}for(let i of n)if(!t.includes(i))return!1;return!0}function e_(r){return r!==null&&typeof r=="object"}function qr(r){let e=[];for(let[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function jr(r){let e={};return r.replace(/^\?/,"").split("&").forEach(n=>{if(n){let[i,s]=n.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function zr(r){let e=r.indexOf("?");if(!e)return"";let t=r.indexOf("#",e);return r.substring(e,t>0?t:void 0)}function u_(r,e){let t=new pl(r,e);return t.subscribe.bind(t)}function KA(r,e){if(typeof r!="object"||r===null)return!1;for(let t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function dl(){}function ne(r){return r&&r._delegate?r._delegate:r}var t_,UA,aa,fl,BA,vs,ca,$A,qA,jA,la,ml,ha,gl,_l,Yn,WA,Ge,dt,HA,pl,XD,Ht=W(()=>{"use strict";Zg();t_=function(r){let e=[],t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},UA=function(r){let e=[],t=0,n=0;for(;t<r.length;){let i=r[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=r[t++];e[n++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=r[t++],o=r[t++],c=r[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|c&63)-65536;e[n++]=String.fromCharCode(55296+(u>>10)),e[n++]=String.fromCharCode(56320+(u&1023))}else{let s=r[t++],o=r[t++];e[n++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},aa={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<r.length;i+=3){let s=r[i],o=i+1<r.length,c=o?r[i+1]:0,u=i+2<r.length,h=u?r[i+2]:0,f=s>>2,g=(s&3)<<4|c>>4,y=(c&15)<<2|h>>6,T=h&63;u||(T=64,o||(y=64)),n.push(t[f],t[g],t[y],t[T])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(t_(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):UA(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<r.length;){let s=t[r.charAt(i++)],c=i<r.length?t[r.charAt(i)]:0;++i;let h=i<r.length?t[r.charAt(i)]:64;++i;let g=i<r.length?t[r.charAt(i)]:64;if(++i,s==null||c==null||h==null||g==null)throw new fl;let y=s<<2|c>>4;if(n.push(y),h!==64){let T=c<<4&240|h>>2;if(n.push(T),g!==64){let D=h<<6&192|g;n.push(D)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}},fl=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},BA=function(r){let e=t_(r);return aa.encodeByteArray(e,!0)},vs=function(r){return BA(r).replace(/\./g,"")},ca=function(r){try{return aa.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};$A=()=>ua().__FIREBASE_DEFAULTS__,qA=()=>{if(typeof process>"u"||typeof process.env>"u")return;let r=process.env.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},jA=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=r&&ca(r[1]);return e&&JSON.parse(e)},la=()=>{try{return Xg()||$A()||qA()||jA()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},ml=r=>{var e,t;return(t=(e=la())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},ha=r=>{let e=ml(r);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},gl=()=>{var r;return(r=la())===null||r===void 0?void 0:r.config},_l=r=>{var e;return(e=la())===null||e===void 0?void 0:e[`_${r}`]};Yn=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}};WA="FirebaseError",Ge=class r extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=WA,Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,dt.prototype.create)}},dt=class{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?GA(s,n):"Error",c=`${this.serviceName}: ${o} (${i}).`;return new Ge(i,c,n)}};HA=/\{\$([^}]+)}/g;pl=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");KA(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:n},i.next===void 0&&(i.next=dl),i.error===void 0&&(i.error=dl),i.complete===void 0&&(i.complete=dl);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};XD=4*60*60*1e3;});function QA(r){return r===Jn?void 0:r}function YA(r){return r.instantiationMode==="EAGER"}var Ne,Jn,vl,fa,Xn=W(()=>{"use strict";Ht();Ne=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};Jn="[DEFAULT]";vl=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let n=new Yn;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(YA(e))try{this.getOrInitializeService({instanceIdentifier:Jn})}catch{}for(let[t,n]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});n.resolve(s)}catch{}}}}clearInstance(e=Jn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return p(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Jn){return this.instances.has(e)}getOptions(e=Jn){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[s,o]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);n===c&&o.resolve(i)}return i}onInit(e,t){var n;let i=this.normalizeInstanceIdentifier(t),s=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:QA(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Jn){return this.component?this.component.multipleInstances?e:Jn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};fa=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new vl(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}});var JA,Z,XA,ZA,eb,tb,Rt,Wr=W(()=>{"use strict";JA=[],Z=function(r){return r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT",r}(Z||{}),XA={debug:Z.DEBUG,verbose:Z.VERBOSE,info:Z.INFO,warn:Z.WARN,error:Z.ERROR,silent:Z.SILENT},ZA=Z.INFO,eb={[Z.DEBUG]:"log",[Z.VERBOSE]:"log",[Z.INFO]:"info",[Z.WARN]:"warn",[Z.ERROR]:"error"},tb=(r,e,...t)=>{if(e<r.logLevel)return;let n=new Date().toISOString(),i=eb[e];if(i)console[i](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Rt=class{constructor(e){this.name=e,this._logLevel=ZA,this._logHandler=tb,this._userLogHandler=null,JA.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?XA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Z.DEBUG,...e),this._logHandler(this,Z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Z.VERBOSE,...e),this._logHandler(this,Z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Z.INFO,...e),this._logHandler(this,Z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Z.WARN,...e),this._logHandler(this,Z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Z.ERROR,...e),this._logHandler(this,Z.ERROR,...e)}}});function rb(){return l_||(l_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ib(){return h_||(h_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}function sb(r){let e=new Promise((t,n)=>{let i=()=>{r.removeEventListener("success",s),r.removeEventListener("error",o)},s=()=>{t(St(r.result)),i()},o=()=>{n(r.error),i()};r.addEventListener("success",s),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&d_.set(t,r)}).catch(()=>{}),Tl.set(e,r),e}function ob(r){if(wl.has(r))return;let e=new Promise((t,n)=>{let i=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",o),r.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",s),r.addEventListener("error",o),r.addEventListener("abort",o)});wl.set(r,e)}function p_(r){El=r(El)}function ab(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let n=r.call(pa(this),e,...t);return f_.set(n,e.sort?e.sort():[e]),St(n)}:ib().includes(r)?function(...e){return r.apply(pa(this),e),St(d_.get(this))}:function(...e){return St(r.apply(pa(this),e))}}function cb(r){return typeof r=="function"?ab(r):(r instanceof IDBTransaction&&ob(r),nb(r,rb())?new Proxy(r,El):r)}function St(r){if(r instanceof IDBRequest)return sb(r);if(Il.has(r))return Il.get(r);let e=cb(r);return e!==r&&(Il.set(r,e),Tl.set(e,r)),e}var nb,l_,h_,d_,wl,f_,Il,Tl,El,pa,Al=W(()=>{"use strict";nb=(r,e)=>e.some(t=>r instanceof t);d_=new WeakMap,wl=new WeakMap,f_=new WeakMap,Il=new WeakMap,Tl=new WeakMap;El={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return wl.get(r);if(e==="objectStoreNames")return r.objectStoreNames||f_.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return St(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};pa=r=>Tl.get(r)});function g_(r,e,{blocked:t,upgrade:n,blocking:i,terminated:s}={}){let o=indexedDB.open(r,e),c=St(o);return n&&o.addEventListener("upgradeneeded",u=>{n(St(o.result),u.oldVersion,u.newVersion,St(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}function m_(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(bl.get(e))return bl.get(e);let t=e.replace(/FromIndex$/,""),n=e!==t,i=lb.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||ub.includes(t)))return;let s=function(o,...c){return p(this,null,function*(){let u=this.transaction(o,i?"readwrite":"readonly"),h=u.store;return n&&(h=h.index(c.shift())),(yield Promise.all([h[t](...c),i&&u.done]))[0]})};return bl.set(e,s),s}var ub,lb,bl,__=W(()=>{"use strict";Al();Al();ub=["get","getKey","getAll","getAllKeys","count"],lb=["put","add","delete","clear"],bl=new Map;p_(r=>Se(ae({},r),{get:(e,t,n)=>m_(e,t)||r.get(e,t,n),has:(e,t)=>!!m_(e,t)||r.has(e,t)}))});function hb(r){let e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}function v_(r,e){try{r.container.addComponent(e)}catch(t){Kt.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function et(r){let e=r.name;if(kl.has(e))return Kt.debug(`There were multiple attempts to register component ${e}.`),!1;kl.set(e,r);for(let t of Is.values())v_(t,r);for(let t of Bb.values())v_(t,r);return!0}function Qt(r,e){let t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function Oe(r){return r==null?!1:r.settings!==void 0}function xl(r,e={}){let t=r;typeof e!="object"&&(e={name:e});let n=Object.assign({name:Pl,automaticDataCollectionEnabled:!1},e),i=n.name;if(typeof i!="string"||!i)throw In.create("bad-app-name",{appName:String(i)});if(t||(t=gl()),!t)throw In.create("no-options");let s=Is.get(i);if(s){if(ft(t,s.options)&&ft(n,s.config))return s;throw In.create("duplicate-app",{appName:i})}let o=new fa(i);for(let u of kl.values())o.addComponent(u);let c=new Dl(t,n,o);return Is.set(i,c),c}function Yt(r=Pl){let e=Is.get(r);if(!e&&r===Pl&&gl())return xl();if(!e)throw In.create("no-app",{appName:r});return e}function ma(){return Array.from(Is.values())}function le(r,e,t){var n;let i=(n=Ub[r])!==null&&n!==void 0?n:r;t&&(i+=`-${t}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let c=[`Unable to register library "${i}" with version "${e}":`];s&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Kt.warn(c.join(" "));return}et(new Ne(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function T_(){return Rl||(Rl=g_(qb,jb,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(ws)}catch(t){console.warn(t)}}}}).catch(r=>{throw In.create("idb-open",{originalErrorMessage:r.message})})),Rl}function zb(r){return p(this,null,function*(){try{let t=(yield T_()).transaction(ws),n=yield t.objectStore(ws).get(A_(r));return yield t.done,n}catch(e){if(e instanceof Ge)Kt.warn(e.message);else{let t=In.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Kt.warn(t.message)}}})}function I_(r,e){return p(this,null,function*(){try{let n=(yield T_()).transaction(ws,"readwrite");yield n.objectStore(ws).put(e,A_(r)),yield n.done}catch(t){if(t instanceof Ge)Kt.warn(t.message);else{let n=In.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Kt.warn(n.message)}}})}function A_(r){return`${r.name}!${r.options.appId}`}function w_(){return new Date().toISOString().substring(0,10)}function Hb(r,e=Wb){let t=[],n=r.slice();for(let i of r){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),E_(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),E_(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}function E_(r){return vs(JSON.stringify({version:2,heartbeats:r})).length}function Kb(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}function Qb(r){et(new Ne("platform-logger",e=>new Sl(e),"PRIVATE")),et(new Ne("heartbeat",e=>new Nl(e),"PRIVATE")),le(Cl,y_,r),le(Cl,y_,"esm2017"),le("fire-js","")}var Sl,Cl,y_,Kt,db,fb,pb,mb,gb,_b,yb,vb,Ib,wb,Eb,Tb,Ab,bb,Rb,Sb,Cb,Pb,kb,Db,Nb,Ob,xb,Vb,Lb,Mb,Fb,Pl,Ub,Is,Bb,kl,$b,In,Dl,Ct,qb,jb,ws,Rl,Wb,Gb,Nl,Ol,wn=W(()=>{"use strict";Xn();Wr();Ht();Ht();__();Sl=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(hb(t)){let n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}};Cl="@firebase/app",y_="0.11.5";Kt=new Rt("@firebase/app"),db="@firebase/app-compat",fb="@firebase/analytics-compat",pb="@firebase/analytics",mb="@firebase/app-check-compat",gb="@firebase/app-check",_b="@firebase/auth",yb="@firebase/auth-compat",vb="@firebase/database",Ib="@firebase/data-connect",wb="@firebase/database-compat",Eb="@firebase/functions",Tb="@firebase/functions-compat",Ab="@firebase/installations",bb="@firebase/installations-compat",Rb="@firebase/messaging",Sb="@firebase/messaging-compat",Cb="@firebase/performance",Pb="@firebase/performance-compat",kb="@firebase/remote-config",Db="@firebase/remote-config-compat",Nb="@firebase/storage",Ob="@firebase/storage-compat",xb="@firebase/firestore",Vb="@firebase/vertexai",Lb="@firebase/firestore-compat",Mb="firebase",Fb="11.6.1";Pl="[DEFAULT]",Ub={[Cl]:"fire-core",[db]:"fire-core-compat",[pb]:"fire-analytics",[fb]:"fire-analytics-compat",[gb]:"fire-app-check",[mb]:"fire-app-check-compat",[_b]:"fire-auth",[yb]:"fire-auth-compat",[vb]:"fire-rtdb",[Ib]:"fire-data-connect",[wb]:"fire-rtdb-compat",[Eb]:"fire-fn",[Tb]:"fire-fn-compat",[Ab]:"fire-iid",[bb]:"fire-iid-compat",[Rb]:"fire-fcm",[Sb]:"fire-fcm-compat",[Cb]:"fire-perf",[Pb]:"fire-perf-compat",[kb]:"fire-rc",[Db]:"fire-rc-compat",[Nb]:"fire-gcs",[Ob]:"fire-gcs-compat",[xb]:"fire-fst",[Lb]:"fire-fst-compat",[Vb]:"fire-vertex","fire-js":"fire-js",[Mb]:"fire-js-all"};Is=new Map,Bb=new Map,kl=new Map;$b={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},In=new dt("app","Firebase",$b);Dl=class{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ne("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw In.create("app-deleted",{appName:this._name})}};Ct=Fb;qb="firebase-heartbeat-database",jb=1,ws="firebase-heartbeat-store",Rl=null;Wb=1024,Gb=30,Nl=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Ol(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}triggerHeartbeat(){return p(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=w_();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>Gb){let o=Kb(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){Kt.warn(n)}})}getHeartbeatsHeader(){return p(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=w_(),{heartbeatsToSend:n,unsentEntries:i}=Hb(this._heartbeatsCache.heartbeats),s=vs(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Kt.warn(t),""}})}};Ol=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return p(this,null,function*(){return $r()?a_().then(()=>!0).catch(()=>!1):!1})}read(){return p(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield zb(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return p(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return I_(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return p(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return I_(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};Qb("")});var Yb,Jb,En=W(()=>{"use strict";wn();wn();Yb="firebase",Jb="11.6.1";le(Yb,Jb,"app")});function er(r,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(r).getImmediate({optional:!0})}function Xb(r,e){!R_&&(b_>Gr.SILENT||ll())&&(R_=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),b_>=e&&console.warn(`Firebase API called outside injection context: ${r.name}`)}function Zb(r){let e=ie(ot,{optional:!0});return e?e.runOutsideAngular(()=>r()):r()}function Zn(r){let e=ie(ot,{optional:!0});return e?e.run(()=>r()):r()}var kt,Tn,Gr,b_,ga,Dt,R_,eR,K,Hr=W(()=>{"use strict";he();he();En();CA();_s();sg();kt=new yg("ANGULARFIRE2_VERSION");Tn=(r,e)=>{let t=e?[e]:ma(),n=[];return t.forEach(i=>{i.container.getProvider(r).instances.forEach(o=>{n.includes(o)||n.push(o)})}),n},Gr=function(r){return r[r.SILENT=0]="SILENT",r[r.WARN=1]="WARN",r[r.VERBOSE=2]="VERBOSE",r}(Gr||{}),b_=ll()&&typeof Zone<"u"?Gr.WARN:Gr.SILENT,ga=class{zone;delegate;constructor(e,t=ig){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){let i=this.zone,s=function(o){i?i.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])};return this.delegate.schedule(s,t,n)}},Dt=(()=>{let e=class e{outsideAngular;insideAngular;constructor(){let n=ie(ot);this.outsideAngular=n.runOutsideAngular(()=>new ga(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=n.run(()=>new ga(typeof Zone>"u"?void 0:Zone.current,rg))}};gn(e,"\u0275fac",function(i){return new(i||e)}),gn(e,"\u0275prov",ve({token:e,factory:e.\u0275fac,providedIn:"root"}));let r=e;return r})(),R_=!1;eR=(r,e,t)=>(...n)=>(e&&setTimeout(e,0),At(t,()=>Zn(()=>r.apply(void 0,n)))),K=(r,e,t)=>(t||(t=e?Gr.WARN:Gr.VERBOSE),function(){let n,i=arguments,s,o,c;try{s=ie(Dt),o=ie(cg),c=ie(ea)}catch{return Xb(r,t),r.apply(this,i)}for(let h=0;h<arguments.length;h++)typeof i[h]=="function"&&(e&&(n||(n=Zn(()=>o.add()))),i[h]=eR(i[h],n,c));let u=Zb(()=>r.apply(this,i));return e?u instanceof gs?u.pipe(cl(s.outsideAngular),al(s.insideAngular),Ng(c)):u instanceof Promise?Zn(()=>new Promise((h,f)=>{o.run(()=>u).then(g=>At(c,()=>Zn(()=>h(g))),g=>At(c,()=>Zn(()=>f(g))))})):typeof u=="function"&&n?function(){return setTimeout(n,0),u.apply(this,arguments)}:Zn(()=>u):u instanceof gs?u.pipe(cl(s.outsideAngular),al(s.insideAngular)):Zn(()=>u)})});function tR(r){return r&&r.length===1?r[0]:new pt(Yt())}function iR(r){return(e,t)=>{let n=t.get(lg);le("angularfire",kt.full,"core"),le("angularfire",kt.full,"app"),le("angular",vg.full,n.toString());let i=e.runOutsideAngular(()=>r(t));return new pt(i)}}function S_(r,...e){return yn([nR,rR,{provide:Vl,useFactory:iR(r),multi:!0,deps:[ot,vn,Dt,...e]}])}var pt,Jt,Vl,nR,rR,C_,Es=W(()=>{"use strict";En();En();he();Hr();pt=class{constructor(e){return e}},Jt=class{constructor(){return ma()}};Vl=new _n("angularfire2._apps"),nR={provide:pt,useFactory:tR,deps:[[new De,Vl]]},rR={provide:Jt,deps:[[new De,Vl]]};C_=K(xl,!0)});function mt(r){return sR.get(r)||Object.assign({},oR)}function N_(){return aR}function lR(r){return new Promise(e=>{setTimeout(e,r)})}function O_(r){if(!mt(r).activated)throw An.create("use-before-activation",{appName:r.name})}function x_(n,i){return p(this,arguments,function*({url:r,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let T=yield o.getHeartbeatsHeader();T&&(s["X-Firebase-Client"]=T)}let c={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(r,c)}catch(T){throw An.create("fetch-network-error",{originalErrorMessage:T==null?void 0:T.message})}if(u.status!==200)throw An.create("fetch-status-error",{httpStatus:u.status});let h;try{h=yield u.json()}catch(T){throw An.create("fetch-parse-error",{originalErrorMessage:T==null?void 0:T.message})}let f=h.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw An.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});let g=Number(f[1])*1e3,y=Date.now();return{token:h.token,expireTimeMillis:y+g,issuedAtTimeMillis:y}})}function V_(r,e){let{projectId:t,appId:n,apiKey:i}=r.options;return{url:`${cR}/projects/${t}/apps/${n}:${uR}?key=${i}`,body:{debug_token:e}}}function pR(){return _a||(_a=new Promise((r,e)=>{try{let t=indexedDB.open(dR,fR);t.onsuccess=n=>{r(n.target.result)},t.onerror=n=>{var i;e(An.create("storage-open",{originalErrorMessage:(i=n.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=n=>{let i=n.target.result;switch(n.oldVersion){case 0:i.createObjectStore(Ul,{keyPath:"compositeKey"})}}}catch(t){e(An.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}}),_a)}function mR(r,e){return gR(_R(r),e)}function gR(r,e){return p(this,null,function*(){let n=(yield pR()).transaction(Ul,"readwrite"),s=n.objectStore(Ul).put({compositeKey:r,value:e});return new Promise((o,c)=>{s.onsuccess=u=>{o()},n.onerror=u=>{var h;c(An.create("storage-set",{originalErrorMessage:(h=u.target.error)===null||h===void 0?void 0:h.message}))}})})}function _R(r){return`${r.options.appId}-${r.name}`}function Ll(r,e){return $r()?mR(r,e).catch(t=>{Ts.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function L_(){return N_().enabled}function M_(){return p(this,null,function*(){let r=N_();if(r.enabled&&r.token)return r.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}function vR(r){return aa.encodeString(JSON.stringify(r),!1)}function Bl(r,e=!1,t=!1){return p(this,null,function*(){let n=r.app;O_(n);let i=mt(n),s=i.token,o;if(s&&!As(s)&&(i.token=void 0,s=void 0),!s){let h=yield i.cachedTokenPromise;h&&(As(h)?s=h:yield Ll(n,void 0))}if(!e&&s&&As(s))return{token:s.token};let c=!1;if(L_())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=x_(V_(n,yield M_()),r.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),c=!0);let h=yield i.exchangeTokenPromise;return yield Ll(n,h),i.token=h,{token:h.token}}catch(h){return h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?Ts.warn(h.message):t&&Ts.error(h),Ml(h)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),c=!0),s=yield mt(n).exchangeTokenPromise}catch(h){h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?Ts.warn(h.message):t&&Ts.error(h),o=h}let u;return s?o?As(s)?u={token:s.token,internalError:o}:u=Ml(o):(u={token:s.token},i.token=s,yield Ll(n,s)):u=Ml(o),c&&TR(n,u),u})}function IR(r){return p(this,null,function*(){let e=r.app;O_(e);let{provider:t}=mt(e);if(L_()){let n=yield M_(),{token:i}=yield x_(V_(e,n),r.heartbeatServiceProvider);return{token:i}}else{let{token:n}=yield t.getToken();return{token:n}}})}function wR(r,e,t,n){let{app:i}=r,s=mt(i),o={next:t,error:n,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&As(s.token)){let c=s.token;Promise.resolve().then(()=>{t({token:c.token}),k_(r)}).catch(()=>{})}s.cachedTokenPromise.then(()=>k_(r))}function F_(r,e){let t=mt(r),n=t.tokenObservers.filter(i=>i.next!==e);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function k_(r){let{app:e}=r,t=mt(e),n=t.tokenRefresher;n||(n=ER(r),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function ER(r){let{app:e}=r;return new Fl(()=>p(this,null,function*(){let t=mt(e),n;if(t.token?n=yield Bl(r,!0):n=yield Bl(r),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=mt(e);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,i),Math.max(0,n-Date.now())}else return 0},P_.RETRIAL_MIN_WAIT,P_.RETRIAL_MAX_WAIT)}function TR(r,e){let t=mt(r).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function As(r){return r.expireTimeMillis-Date.now()>0}function Ml(r){return{token:vR(yR),error:r}}function AR(r,e){return new $l(r,e)}function bR(r){return{getToken:e=>Bl(r,e),getLimitedUseToken:()=>IR(r),addTokenListener:e=>wR(r,"INTERNAL",e),removeTokenListener:e=>F_(r.app,e)}}function PR(){et(new Ne(CR,r=>{let e=r.getProvider("app").getImmediate(),t=r.getProvider("heartbeat");return AR(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,e,t)=>{r.getProvider(D_).initialize()})),et(new Ne(D_,r=>{let e=r.getProvider("app-check").getImmediate();return bR(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),le(RR,SR)}var sR,oR,aR,cR,uR,P_,QN,Fl,hR,An,dR,fR,Ul,_a,Ts,yR,$l,RR,SR,CR,D_,U_=W(()=>{"use strict";wn();Xn();Ht();Wr();sR=new Map,oR={activated:!1,tokenObservers:[]},aR={initialized:!1,enabled:!1};cR="https://content-firebaseappcheck.googleapis.com/v1",uR="exchangeDebugToken",P_={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},QN=24*60*60*1e3;Fl=class{constructor(e,t,n,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return p(this,null,function*(){this.stop();try{this.pending=new Yn,this.pending.promise.catch(t=>{}),yield lR(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Yn,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};hR={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},An=new dt("appCheck","AppCheck",hR);dR="firebase-app-check-database",fR=1,Ul="firebase-app-check-store",_a=null;Ts=new Rt("@firebase/app-check");yR={error:"UNKNOWN_ERROR"};$l=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=mt(this.app);for(let t of e)F_(this.app,t.next);return Promise.resolve()}};RR="@firebase/app-check",SR="0.8.13";CR="app-check",D_="app-check-internal";PR()});var ql=W(()=>{"use strict";U_()});var kR,bn,DR,cO,ya=W(()=>{"use strict";Hr();En();ql();ql();kR="app-check",bn=class{constructor(){return Tn(kR)}},DR=["localhost","0.0.0.0","127.0.0.1"],cO=typeof window<"u"&&DR.includes(window.location.hostname)});function ty(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function NR(r,...e){Aa.logLevel<=Z.WARN&&Aa.warn(`Auth (${Ct}): ${r}`,...e)}function Ia(r,...e){Aa.logLevel<=Z.ERROR&&Aa.error(`Auth (${Ct}): ${r}`,...e)}function at(r,...e){throw lh(r,...e)}function gt(r,...e){return lh(r,...e)}function uh(r,e,t){let n=Object.assign(Object.assign({},ny()),{[e]:t});return new dt("auth","Firebase",n).create(e,{appName:r.name})}function en(r){return uh(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function OR(r,e,t){let n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&at(r,"argument-error"),uh(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function lh(r,...e){if(typeof r!="string"){let t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return ry.create(r,...e)}function $(r,e,...t){if(!r)throw lh(e,...t)}function Xt(r){let e="INTERNAL ASSERTION FAILED: "+r;throw Ia(e),new Error(e)}function tn(r,e){r||Xt(e)}function Wl(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function xR(){return B_()==="http:"||B_()==="https:"}function B_(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}function VR(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(xR()||i_()||"connection"in navigator)?navigator.onLine:!0}function LR(){if(typeof navigator>"u")return null;let r=navigator;return r.languages&&r.languages[0]||r.language||null}function hh(r,e){tn(r.emulator,"Emulator should always be set here");let{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}function nn(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}function _t(s,o,c,u){return p(this,arguments,function*(r,e,t,n,i={}){return iy(r,i,()=>p(this,null,function*(){let h={},f={};n&&(e==="GET"?f=n:h={body:JSON.stringify(n)});let g=qr(Object.assign({key:r.config.apiKey},f)).slice(1),y=yield r._getAdditionalHeaders();y["Content-Type"]="application/json",r.languageCode&&(y["X-Firebase-Locale"]=r.languageCode);let T=Object.assign({method:e,headers:y},h);return r_()||(T.referrerPolicy="no-referrer"),ba.fetch()(yield sy(r,r.config.apiHost,t,g),T)}))})}function iy(r,e,t){return p(this,null,function*(){r._canInitEmulator=!1;let n=Object.assign(Object.assign({},MR),e);try{let i=new Gl(r),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw va(r,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let c=s.ok?o.errorMessage:o.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw va(r,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw va(r,"email-already-in-use",o);if(u==="USER_DISABLED")throw va(r,"user-disabled",o);let f=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw uh(r,f,h);at(r,f)}}catch(i){if(i instanceof Ge)throw i;at(r,"network-request-failed",{message:String(i)})}})}function xs(s,o,c,u){return p(this,arguments,function*(r,e,t,n,i={}){let h=yield _t(r,e,t,n,i);return"mfaPendingCredential"in h&&at(r,"multi-factor-auth-required",{_serverResponse:h}),h})}function sy(r,e,t,n){return p(this,null,function*(){let i=`${e}${t}?${n}`,s=r,o=s.config.emulator?hh(r.config,i):`${r.config.apiScheme}://${i}`;return FR.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}function BR(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}function va(r,e,t){let n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);let i=gt(r,e,n);return i.customData._tokenResponse=t,i}function $_(r){return r!==void 0&&r.enterprise!==void 0}function $R(r,e){return p(this,null,function*(){return _t(r,"GET","/v2/recaptchaConfig",nn(r,e))})}function qR(r,e){return p(this,null,function*(){return _t(r,"POST","/v1/accounts:delete",e)})}function Ra(r,e){return p(this,null,function*(){return _t(r,"POST","/v1/accounts:lookup",e)})}function Rs(r){if(r)try{let e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function dh(r,e=!1){return p(this,null,function*(){let t=ne(r),n=yield t.getIdToken(e),i=fh(n);$(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:n,authTime:Rs(jl(i.auth_time)),issuedAtTime:Rs(jl(i.iat)),expirationTime:Rs(jl(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}})}function jl(r){return Number(r)*1e3}function fh(r){let[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return Ia("JWT malformed, contained fewer than 3 sections"),null;try{let i=ca(t);return i?JSON.parse(i):(Ia("Failed to decode base64 JWT payload"),null)}catch(i){return Ia("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function q_(r){let e=fh(r);return $(e,"internal-error"),$(typeof e.exp<"u","internal-error"),$(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function nr(r,e,t=!1){return p(this,null,function*(){if(t)return e;try{return yield e}catch(n){throw n instanceof Ge&&jR(n)&&r.auth.currentUser===r&&(yield r.auth.signOut()),n}})}function jR({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}function Sa(r){return p(this,null,function*(){var e;let t=r.auth,n=yield r.getIdToken(),i=yield nr(r,Ra(t,{idToken:n}));$(i==null?void 0:i.users.length,t,"internal-error");let s=i.users[0];r._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?oy(s.providerUserInfo):[],c=zR(r.providerData,o),u=r.isAnonymous,h=!(r.email&&s.passwordHash)&&!(c!=null&&c.length),f=u?h:!1,g={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new Cs(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(r,g)})}function ph(r){return p(this,null,function*(){let e=ne(r);yield Sa(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function zR(r,e){return[...r.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function oy(r){return r.map(e=>{var{providerId:t}=e,n=Zo(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}function WR(r,e){return p(this,null,function*(){let t=yield iy(r,{},()=>p(this,null,function*(){let n=qr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=r.config,o=yield sy(r,i,"/v1/token",`key=${s}`),c=yield r._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",ba.fetch()(o,{method:"POST",headers:c,body:n})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function GR(r,e){return p(this,null,function*(){return _t(r,"POST","/v2/accounts:revokeToken",nn(r,e))})}function Rn(r,e){$(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}function Zt(r){tn(r instanceof Function,"Expected a class definition");let e=j_.get(r);return e?(tn(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,j_.set(r,e),e)}function wa(r,e,t){return`firebase:${r}:${e}:${t}`}function z_(r){let e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(ly(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ay(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(dy(e))return"Blackberry";if(fy(e))return"Webos";if(cy(e))return"Safari";if((e.includes("chrome/")||uy(e))&&!e.includes("edge/"))return"Chrome";if(hy(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function ay(r=_e()){return/firefox\//i.test(r)}function cy(r=_e()){let e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function uy(r=_e()){return/crios\//i.test(r)}function ly(r=_e()){return/iemobile/i.test(r)}function hy(r=_e()){return/android/i.test(r)}function dy(r=_e()){return/blackberry/i.test(r)}function fy(r=_e()){return/webos/i.test(r)}function mh(r=_e()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function KR(r=_e()){var e;return mh(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function QR(){return o_()&&document.documentMode===10}function py(r=_e()){return mh(r)||hy(r)||fy(r)||dy(r)||/windows phone/i.test(r)||ly(r)}function my(r,e=[]){let t;switch(r){case"Browser":t=z_(_e());break;case"Worker":t=`${z_(_e())}-${r}`;break;default:t=r}let n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ct}/${n}`}function YR(t){return p(this,arguments,function*(r,e={}){return _t(r,"GET","/v2/passwordPolicy",nn(r,e))})}function rn(r){return ne(r)}function XR(r){Ma=r}function gy(r){return Ma.loadJS(r)}function ZR(){return Ma.recaptchaEnterpriseScript}function eS(){return Ma.gapiScript}function _y(r){return`__${r}${Math.floor(Math.random()*1e6)}`}function bs(r,e,t,n=!1,i=!1){return p(this,null,function*(){let s=new th(r),o;if(i)o=yy;else try{o=yield s.verify(t)}catch{o=yield s.verify(t,!0)}let c=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){let u=c.phoneEnrollmentInfo.phoneNumber,h=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){let u=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return n?Object.assign(c,{captchaResp:o}):Object.assign(c,{captchaResponse:o}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c})}function ka(r,e,t,n,i){return p(this,null,function*(){var s,o;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((s=r._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let c=yield bs(r,e,t,t==="getOobCode");return n(r,c)}else return n(r,e).catch(c=>p(this,null,function*(){if(c.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let u=yield bs(r,e,t,t==="getOobCode");return n(r,u)}else return Promise.reject(c)}));else if(i==="PHONE_PROVIDER")if(!((o=r._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("PHONE_PROVIDER")){let c=yield bs(r,e,t);return n(r,c).catch(u=>p(this,null,function*(){var h;if(((h=r._getRecaptchaConfig())===null||h===void 0?void 0:h.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(u.code==="auth/missing-recaptcha-token"||u.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let f=yield bs(r,e,t,!1,!0);return n(r,f)}return Promise.reject(u)}))}else{let c=yield bs(r,e,t,!1,!0);return n(r,c)}else return Promise.reject(i+" provider is not supported.")})}function Fa(r,e){let t=Qt(r,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(ft(s,e!=null?e:{}))return i;at(i,"already-initialized")}return t.initialize({options:e})}function nS(r,e){let t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(Zt);e!=null&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function gh(r,e,t){let n=rn(r);$(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");let i=!!(t!=null&&t.disableWarnings),s=vy(e),{host:o,port:c}=rS(e),u=c===null?"":`:${c}`,h={url:`${s}//${o}${u}/`},f=Object.freeze({host:o,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){$(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),$(ft(h,n.config.emulator)&&ft(f,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=h,n.emulatorConfig=f,n.settings.appVerificationDisabledForTesting=!0,i||iS()}function vy(r){let e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function rS(r){let e=vy(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};let n=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let s=i[1];return{host:s,port:W_(n.substr(s.length+1))}}else{let[s,o]=n.split(":");return{host:s,port:W_(o)}}}function W_(r){if(!r)return null;let e=Number(r);return isNaN(e)?null:e}function iS(){function r(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}function sS(r,e){return p(this,null,function*(){return _t(r,"POST","/v1/accounts:update",e)})}function oS(r,e){return p(this,null,function*(){return _t(r,"POST","/v1/accounts:signUp",e)})}function aS(r,e){return p(this,null,function*(){return xs(r,"POST","/v1/accounts:signInWithPassword",nn(r,e))})}function cS(r,e){return p(this,null,function*(){return _t(r,"POST","/v1/accounts:sendOobCode",nn(r,e))})}function uS(r,e){return p(this,null,function*(){return cS(r,e)})}function lS(r,e){return p(this,null,function*(){return xs(r,"POST","/v1/accounts:signInWithEmailLink",nn(r,e))})}function hS(r,e){return p(this,null,function*(){return xs(r,"POST","/v1/accounts:signInWithEmailLink",nn(r,e))})}function Kr(r,e){return p(this,null,function*(){return xs(r,"POST","/v1/accounts:signInWithIdp",nn(r,e))})}function fS(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function pS(r){let e=jr(zr(r)).link,t=e?jr(zr(e)).deep_link_id:null,n=jr(zr(r)).deep_link_id;return(n?jr(zr(n)).link:null)||n||t||e||r}function mS(r,e){return p(this,null,function*(){return xs(r,"POST","/v1/accounts:signUp",nn(r,e))})}function G_(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}function wy(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?nh._fromErrorAndOperation(r,s,e,n):s})}function gS(r,e,t=!1){return p(this,null,function*(){let n=yield nr(r,e._linkToIdToken(r.auth,yield r.getIdToken()),t);return Jr._forOperation(r,"link",n)})}function _S(r,e,t=!1){return p(this,null,function*(){let{auth:n}=r;if(Oe(n.app))return Promise.reject(en(n));let i="reauthenticate";try{let s=yield nr(r,wy(n,i,e,r),t);$(s.idToken,n,"internal-error");let o=fh(s.idToken);$(o,n,"internal-error");let{sub:c}=o;return $(r.uid===c,n,"user-mismatch"),Jr._forOperation(r,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&at(n,"user-mismatch"),s}})}function Ey(r,e,t=!1){return p(this,null,function*(){if(Oe(r.app))return Promise.reject(en(r));let n="signIn",i=yield wy(r,n,e),s=yield Jr._fromIdTokenResponse(r,n,i);return t||(yield r._updateCurrentUser(s.user)),s})}function yh(r,e){return p(this,null,function*(){return Ey(rn(r),e)})}function yS(r,e,t){var n;$(((n=t.url)===null||n===void 0?void 0:n.length)>0,r,"invalid-continue-uri"),$(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,r,"invalid-dynamic-link-domain"),$(typeof t.linkDomain>"u"||t.linkDomain.length>0,r,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&($(t.iOS.bundleId.length>0,r,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&($(t.android.packageName.length>0,r,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}function Ty(r){return p(this,null,function*(){let e=rn(r);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function vh(r,e,t){return p(this,null,function*(){let n=rn(r),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&yS(n,i,t),yield ka(n,i,"getOobCode",uS,"EMAIL_PASSWORD_PROVIDER")})}function Ih(r,e,t){return p(this,null,function*(){if(Oe(r.app))return Promise.reject(en(r));let n=rn(r),o=yield ka(n,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",mS,"EMAIL_PASSWORD_PROVIDER").catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&Ty(r),u}),c=yield Jr._fromIdTokenResponse(n,"signIn",o);return yield n._updateCurrentUser(c.user),c})}function wh(r,e,t){return Oe(r.app)?Promise.reject(en(r)):yh(ne(r),Iy.credential(e,t)).catch(n=>p(this,null,function*(){throw n.code==="auth/password-does-not-meet-requirements"&&Ty(r),n}))}function vS(r,e){return p(this,null,function*(){return _t(r,"POST","/v1/accounts:update",e)})}function Eh(n,i){return p(this,arguments,function*(r,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let s=ne(r),c={idToken:yield s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},u=yield nr(s,vS(s.auth,c));s.displayName=u.displayName||null,s.photoURL=u.photoUrl||null;let h=s.providerData.find(({providerId:f})=>f==="password");h&&(h.displayName=s.displayName,h.photoURL=s.photoURL),yield s._updateTokensIfNecessary(u)})}function Th(r,e){return IS(ne(r),null,e)}function IS(r,e,t){return p(this,null,function*(){let{auth:n}=r,s={idToken:yield r.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);let o=yield nr(r,sS(n,s));yield r._updateTokensIfNecessary(o,!0)})}function Ah(r,e,t,n){return ne(r).onIdTokenChanged(e,t,n)}function bh(r,e,t){return ne(r).beforeAuthStateChanged(e,t)}function Rh(r,e,t,n){return ne(r).onAuthStateChanged(e,t,n)}function Sh(r){return ne(r).signOut()}function bS(r){return Promise.all(r.map(e=>p(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}function Ph(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}function Nt(){return window}function SS(r){Nt().location.href=r}function by(){return typeof Nt().WorkerGlobalScope<"u"&&typeof Nt().importScripts=="function"}function CS(){return p(this,null,function*(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function PS(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function kS(){return by()?self:null}function Ua(r,e){return r.transaction([xa],e?"readwrite":"readonly").objectStore(xa)}function NS(){let r=indexedDB.deleteDatabase(Ry);return new rr(r).toPromise()}function ih(){let r=indexedDB.open(Ry,DS);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{let n=r.result;try{n.createObjectStore(xa,{keyPath:Sy})}catch(i){t(i)}}),r.addEventListener("success",()=>p(this,null,function*(){let n=r.result;n.objectStoreNames.contains(xa)?e(n):(n.close(),yield NS(),e(yield ih()))}))})}function H_(r,e,t){return p(this,null,function*(){let n=Ua(r,!0).put({[Sy]:e,value:t});return new rr(n).toPromise()})}function OS(r,e){return p(this,null,function*(){let t=Ua(r,!1).get(e),n=yield new rr(t).toPromise();return n===void 0?null:n.value})}function K_(r,e){let t=Ua(r,!0).delete(e);return new rr(t).toPromise()}function Cy(r,e){return e?Zt(e):($(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}function MS(r){return Ey(r.auth,new Os(r),r.bypassAuthState)}function FS(r){let{auth:e,user:t}=r;return $(t,e,"internal-error"),_S(t,new Os(r),r.bypassAuthState)}function US(r){return p(this,null,function*(){let{auth:e,user:t}=r;return $(t,e,"internal-error"),gS(t,new Os(r),r.bypassAuthState)})}function kh(r,e,t){return p(this,null,function*(){if(Oe(r.app))return Promise.reject(gt(r,"operation-not-supported-in-this-environment"));let n=rn(r);OR(r,e,ks);let i=Cy(n,t);return new $S(n,"signInViaPopup",e,i).executeNotNull()})}function jS(r,e){return p(this,null,function*(){let t=GS(e),n=WS(r);if(!(yield n._isAvailable()))return!1;let i=(yield n._get(t))==="true";return yield n._remove(t),i})}function zS(r,e){Ea.set(r._key(),e)}function WS(r){return Zt(r._redirectPersistence)}function GS(r){return wa(qS,r.config.apiKey,r.name)}function HS(r,e,t=!1){return p(this,null,function*(){if(Oe(r.app))return Promise.reject(en(r));let n=rn(r),i=Cy(n,e),o=yield new sh(n,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield n._persistUserIfCurrent(o.user),yield n._setRedirectUser(null,e)),o})}function Q_(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function Py({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function QS(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Py(r);default:return!1}}function YS(t){return p(this,arguments,function*(r,e={}){return _t(r,"GET","/v1/projects",e)})}function ZS(r){return p(this,null,function*(){if(r.config.emulator)return;let{authorizedDomains:e}=yield YS(r);for(let t of e)try{if(e0(t))return}catch{}at(r,"unauthorized-domain")})}function e0(r){let e=Wl(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){let o=new URL(r);return o.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!XS.test(t))return!1;if(JS.test(r))return n===r;let i=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}function Y_(){let r=Nt().___jsl;if(r!=null&&r.H){for(let e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function n0(r){return new Promise((e,t)=>{var n,i,s;function o(){Y_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Y_(),t(gt(r,"network-request-failed"))},timeout:t0.get()})}if(!((i=(n=Nt().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Nt().gapi)===null||s===void 0)&&s.load)o();else{let c=_y("iframefcb");return Nt()[c]=()=>{gapi.load?o():t(gt(r,"network-request-failed"))},gy(`${eS()}?onload=${c}`).catch(u=>t(u))}}).catch(e=>{throw Ta=null,e})}function r0(r){return Ta=Ta||n0(r),Ta}function u0(r){let e=r.config;$(e.authDomain,r,"auth-domain-config-required");let t=e.emulator?hh(e,o0):`https://${r.config.authDomain}/${s0}`,n={apiKey:e.apiKey,appName:r.name,v:Ct},i=c0.get(r.config.apiHost);i&&(n.eid=i);let s=r._getFrameworks();return s.length&&(n.fw=s.join(",")),`${t}?${qr(n).slice(1)}`}function l0(r){return p(this,null,function*(){let e=yield r0(r),t=Nt().gapi;return $(t,r,"internal-error"),e.open({where:document.body,url:u0(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:a0,dontclear:!0},n=>new Promise((i,s)=>p(this,null,function*(){yield n.restyle({setHideOnLeave:!1});let o=gt(r,"network-request-failed"),c=Nt().setTimeout(()=>{s(o)},i0.get());function u(){Nt().clearTimeout(c),i(n)}n.ping(u).then(u,()=>{s(o)})})))})}function g0(r,e,t,n=d0,i=f0){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString(),c="",u=Object.assign(Object.assign({},h0),{width:n.toString(),height:i.toString(),top:s,left:o}),h=_e().toLowerCase();t&&(c=uy(h)?p0:t),ay(h)&&(e=e||m0,u.scrollbars="yes");let f=Object.entries(u).reduce((y,[T,D])=>`${y}${T}=${D},`,"");if(KR(h)&&c!=="_self")return _0(e||"",c),new La(null);let g=window.open(e||"",c,f);$(g,r,"popup-blocked");try{g.focus()}catch{}return new La(g)}function _0(r,e){let t=document.createElement("a");t.href=r,t.target=e;let n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}function J_(r,e,t,n,i,s){return p(this,null,function*(){$(r.config.authDomain,r,"auth-domain-config-required"),$(r.config.apiKey,r,"invalid-api-key");let o={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:Ct,eventId:i};if(e instanceof ks){e.setDefaultLanguage(r.languageCode),o.providerId=e.providerId||"",c_(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[f,g]of Object.entries(s||{}))o[f]=g}if(e instanceof Ds){let f=e.getScopes().filter(g=>g!=="");f.length>0&&(o.scopes=f.join(","))}r.tenantId&&(o.tid=r.tenantId);let c=o;for(let f of Object.keys(c))c[f]===void 0&&delete c[f];let u=yield r._getAppCheckToken(),h=u?`#${I0}=${encodeURIComponent(u)}`:"";return`${w0(r)}?${qr(c).slice(1)}${h}`})}function w0({config:r}){return r.emulator?hh(r,v0):`https://${r.authDomain}/${y0}`}function E0(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function T0(r){et(new Ne("auth",(e,{options:t})=>{let n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=n.options;$(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});let u={apiKey:o,authDomain:c,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:my(r)},h=new Xl(n,i,s,u);return nS(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),et(new Ne("auth-internal",e=>{let t=rn(e.getProvider("auth").getImmediate());return(n=>new ch(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),le(X_,Z_,E0(r)),le(X_,Z_,"esm2017")}function Dh(r=Yt()){let e=Qt(r,"auth");if(e.isInitialized())return e.getImmediate();let t=Fa(r,{popupRedirectResolver:ky,persistence:[Ba,Ay,Ch]}),n=_l("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(n,location.origin);if(location.origin===s.origin){let o=R0(s.toString());bh(t,o,()=>o(t.currentUser)),Ah(t,c=>o(c))}}let i=ml("auth");return i&&gh(t,`http://${i}`),t}function S0(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}var ny,ry,Aa,tr,ba,MR,FR,UR,Gl,Hl,Kl,Cs,Ss,Sn,j_,HR,Ql,Ca,Yl,JR,Jl,Xl,Pa,Ma,Zl,eh,tS,yy,th,Qr,Ps,dS,Yr,Da,Iy,ks,Ds,Ns,_h,Jr,nh,Na,Oa,wS,ES,TS,Ay,AS,Ch,RS,rh,Ry,DS,xa,Sy,rr,xS,VS,LS,Ba,_O,yO,Os,Va,BS,$S,qS,Ea,sh,KS,oh,JS,XS,t0,Ta,i0,s0,o0,a0,c0,h0,d0,f0,p0,m0,La,y0,v0,I0,zl,ah,ky,X_,Z_,ch,A0,b0,ey,R0,Dy=W(()=>{"use strict";wn();Ht();Wr();RA();Xn();ny=ty,ry=new dt("auth","Firebase",ty());Aa=new Rt("@firebase/auth");tr=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,tn(t>e,"Short delay should be less than long delay!"),this.isMobile=n_()||s_()}get(){return VR()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};ba=class{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Xt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Xt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Xt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};MR={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};FR=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],UR=new tr(3e4,6e4);Gl=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(gt(this.auth,"network-request-failed")),UR.get())})}};Hl=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return BR(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};Kl=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>p(this,null,function*(){yield this.iteration()}),t)}iteration(){return p(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};Cs=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Rs(this.lastLoginAt),this.creationTime=Rs(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};Ss=class r{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){$(e.idToken,"internal-error"),$(typeof e.idToken<"u","internal-error"),$(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):q_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){$(e.length!==0,"internal-error");let t=q_(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return p(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:($(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return p(this,null,function*(){let{accessToken:n,refreshToken:i,expiresIn:s}=yield WR(e,t);this.updateTokensAndExpiration(n,i,Number(s))})}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:s}=t,o=new r;return n&&($(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),i&&($(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&($(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new r,this.toJSON())}_performRefresh(){return Xt("not implemented")}};Sn=class r{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=Zo(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Kl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Cs(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return p(this,null,function*(){let t=yield nr(this,this.stsTokenManager.getToken(this.auth,e));return $(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return dh(this,e)}reload(){return ph(this)}_assign(e){this!==e&&($(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new r(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){$(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return p(this,null,function*(){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&(yield Sa(this)),yield this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)})}delete(){return p(this,null,function*(){if(Oe(this.auth.app))return Promise.reject(en(this.auth));let e=yield this.getIdToken();return yield nr(this,qR(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,o,c,u,h,f;let g=(n=t.displayName)!==null&&n!==void 0?n:void 0,y=(i=t.email)!==null&&i!==void 0?i:void 0,T=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,D=(o=t.photoURL)!==null&&o!==void 0?o:void 0,N=(c=t.tenantId)!==null&&c!==void 0?c:void 0,k=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,q=(h=t.createdAt)!==null&&h!==void 0?h:void 0,U=(f=t.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:M,emailVerified:j,isAnonymous:X,providerData:G,stsTokenManager:w}=t;$(M&&w,e,"internal-error");let _=Ss.fromJSON(this.name,w);$(typeof M=="string",e,"internal-error"),Rn(g,e.name),Rn(y,e.name),$(typeof j=="boolean",e,"internal-error"),$(typeof X=="boolean",e,"internal-error"),Rn(T,e.name),Rn(D,e.name),Rn(N,e.name),Rn(k,e.name),Rn(q,e.name),Rn(U,e.name);let I=new r({uid:M,auth:e,email:y,emailVerified:j,displayName:g,isAnonymous:X,photoURL:D,phoneNumber:T,tenantId:N,stsTokenManager:_,createdAt:q,lastLoginAt:U});return G&&Array.isArray(G)&&(I.providerData=G.map(E=>Object.assign({},E))),k&&(I._redirectEventId=k),I}static _fromIdTokenResponse(e,t,n=!1){return p(this,null,function*(){let i=new Ss;i.updateFromServerResponse(t);let s=new r({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return yield Sa(s),s})}static _fromGetAccountInfoResponse(e,t,n){return p(this,null,function*(){let i=t.users[0];$(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?oy(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),c=new Ss;c.updateFromIdToken(n);let u=new r({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Cs(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(u,h),u})}};j_=new Map;HR=(()=>{class r{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return p(this,null,function*(){return!0})}_set(t,n){return p(this,null,function*(){this.storage[t]=n})}_get(t){return p(this,null,function*(){let n=this.storage[t];return n===void 0?null:n})}_remove(t){return p(this,null,function*(){delete this.storage[t]})}_addListener(t,n){}_removeListener(t,n){}}return r.type="NONE",r})(),Ql=HR;Ca=class r{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:i,name:s}=this.auth;this.fullUserKey=wa(this.userKey,i.apiKey,s),this.fullPersistenceKey=wa("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return p(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Ra(this.auth,{idToken:e}).catch(()=>{});return t?Sn._fromGetAccountInfoResponse(this.auth,t,e):null}return Sn._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return p(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return p(this,null,function*(){if(!t.length)return new r(Zt(Ql),e,n);let i=(yield Promise.all(t.map(h=>p(this,null,function*(){if(yield h._isAvailable())return h})))).filter(h=>h),s=i[0]||Zt(Ql),o=wa(n,e.config.apiKey,e.name),c=null;for(let h of t)try{let f=yield h._get(o);if(f){let g;if(typeof f=="string"){let y=yield Ra(e,{idToken:f}).catch(()=>{});if(!y)break;g=yield Sn._fromGetAccountInfoResponse(e,y,f)}else g=Sn._fromJSON(e,f);h!==s&&(c=g),s=h;break}}catch{}let u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new r(s,e,n):(s=u[0],c&&(yield s._set(o,c.toJSON())),yield Promise.all(t.map(h=>p(this,null,function*(){if(h!==s)try{yield h._remove(o)}catch{}}))),new r(s,e,n))})}};Yl=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=s=>new Promise((o,c)=>{try{let u=e(s);o(u)}catch(u){c(u)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return p(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)yield n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}})}};JR=6,Jl=class{constructor(e){var t,n,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:JR,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,s,o,c;let u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(n=u.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(s=u.containsUppercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};Xl=class{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Pa(this),this.idTokenSubscription=new Pa(this),this.beforeStateQueue=new Yl(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ry,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Zt(t)),this._initializationPromise=this.queue(()=>p(this,null,function*(){var n,i,s;if(!this._deleted&&(this.persistenceManager=yield Ca.create(this,e),(n=this._resolvePersistenceManagerAvailable)===null||n===void 0||n.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return p(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return p(this,null,function*(){try{let t=yield Ra(this,{idToken:e}),n=yield Sn._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return p(this,null,function*(){var t;if(Oe(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}let n=yield this.assertedPersistence.getCurrentUser(),i=n,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i==null?void 0:i._redirectEventId,u=yield this.tryRedirectSignIn(e);(!o||o===c)&&(u!=null&&u.user)&&(i=u.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return $(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return p(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return p(this,null,function*(){try{yield Sa(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=LR()}_delete(){return p(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return p(this,null,function*(){if(Oe(this.app))return Promise.reject(en(this));let t=e?ne(e):null;return t&&$(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return p(this,null,function*(){if(!this._deleted)return e&&$(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>p(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return p(this,null,function*(){return Oe(this.app)?Promise.reject(en(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Oe(this.app)?Promise.reject(en(this)):this.queue(()=>p(this,null,function*(){yield this.assertedPersistence.setPersistence(Zt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return p(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return p(this,null,function*(){let e=yield YR(this),t=new Jl(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new dt("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}revokeAccessToken(e){return p(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),yield GR(this,n)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return p(this,null,function*(){let n=yield this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return p(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Zt(e)||this._popupRedirectResolver;$(t,this,"argument-error"),this.redirectPersistenceManager=yield Ca.create(this,[Zt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return p(this,null,function*(){var t,n;return this._isInitialized&&(yield this.queue(()=>p(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return p(this,null,function*(){if(e===this.currentUser)return this.queue(()=>p(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if($(c,this,"internal-error"),c.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,n,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}directlySetCurrentUser(e){return p(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return $(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=my(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return p(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();n&&(t["X-Firebase-Client"]=n);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return p(this,null,function*(){var e;if(Oe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t!=null&&t.error&&NR(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token})}};Pa=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=u_(t=>this.observer=t)}get next(){return $(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};Ma={loadJS(){return p(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};Zl=class{constructor(){this.enterprise=new eh}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},eh=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},tS="recaptcha-enterprise",yy="NO_RECAPTCHA",th=class{constructor(e){this.type=tS,this.auth=rn(e)}verify(e="verify",t=!1){return p(this,null,function*(){function n(s){return p(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,c)=>p(this,null,function*(){$R(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let h=new Hl(u);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,o(h.siteKey)}}).catch(u=>{c(u)})}))})}function i(s,o,c){let u=window.grecaptcha;$_(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(h=>{o(h)}).catch(()=>{o(yy)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Zl().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{n(this.auth).then(c=>{if(!t&&$_(window.grecaptcha))i(c,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=ZR();u.length!==0&&(u+=c),gy(u).then(()=>{i(c,s,o)}).catch(h=>{o(h)})}}).catch(c=>{o(c)})})})}};Qr=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Xt("not implemented")}_getIdTokenResponse(e){return Xt("not implemented")}_linkToIdToken(e,t){return Xt("not implemented")}_getReauthenticationResolver(e){return Xt("not implemented")}};Ps=class r extends Qr{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new r(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new r(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return p(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ka(e,t,"signInWithPassword",aS,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return lS(e,{email:this._email,oobCode:this._password});default:at(e,"internal-error")}})}_linkToIdToken(e,t){return p(this,null,function*(){switch(this.signInMethod){case"password":let n={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ka(e,n,"signUpPassword",oS,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return hS(e,{idToken:t,email:this._email,oobCode:this._password});default:at(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};dS="http://localhost",Yr=class r extends Qr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new r(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):at("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=Zo(t,["providerId","signInMethod"]);if(!n||!i)return null;let o=new r(n,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){let t=this.buildRequest();return Kr(e,t)}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,Kr(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,Kr(e,t)}buildRequest(){let e={requestUri:dS,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=qr(t)}return e}};Da=class r{constructor(e){var t,n,i,s,o,c;let u=jr(zr(e)),h=(t=u.apiKey)!==null&&t!==void 0?t:null,f=(n=u.oobCode)!==null&&n!==void 0?n:null,g=fS((i=u.mode)!==null&&i!==void 0?i:null);$(h&&f&&g,"argument-error"),this.apiKey=h,this.operation=g,this.code=f,this.continueUrl=(s=u.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=u.lang)!==null&&o!==void 0?o:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=pS(e);try{return new r(t)}catch{return null}}};Iy=(()=>{class r{constructor(){this.providerId=r.PROVIDER_ID}static credential(t,n){return Ps._fromEmailAndPassword(t,n)}static credentialWithLink(t,n){let i=Da.parseLink(n);return $(i,"argument-error"),Ps._fromEmailAndCode(t,i.code,i.tenantId)}}r.PROVIDER_ID="password",r.EMAIL_PASSWORD_SIGN_IN_METHOD="password",r.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return r})(),ks=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};Ds=class extends ks{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}},Ns=class r extends Ds{static credentialFromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;return $("providerId"in t&&"signInMethod"in t,"argument-error"),Yr._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return $(e.idToken||e.accessToken,"argument-error"),Yr._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return r.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return r.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:i,pendingToken:s,nonce:o,providerId:c}=e;if(!n&&!i&&!t&&!s||!c)return null;try{return new r(c)._credential({idToken:t,accessToken:n,nonce:o,pendingToken:s})}catch{return null}}};_h=(()=>{class r extends Ds{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return Yr._fromParams({providerId:r.PROVIDER_ID,signInMethod:r.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return r.credentialFromTaggedObject(t)}static credentialFromError(t){return r.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:n,oauthAccessToken:i}=t;if(!n&&!i)return null;try{return r.credential(n,i)}catch{return null}}}r.GOOGLE_SIGN_IN_METHOD="google.com",r.PROVIDER_ID="google.com";return r})();Jr=class r{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,i=!1){return p(this,null,function*(){let s=yield Sn._fromIdTokenResponse(e,n,i),o=G_(n);return new r({user:s,providerId:o,_tokenResponse:n,operationType:t})})}static _forOperation(e,t,n){return p(this,null,function*(){yield e._updateTokensIfNecessary(n,!0);let i=G_(n);return new r({user:e,providerId:i,_tokenResponse:n,operationType:t})})}};nh=class r extends Ge{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,r.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new r(e,t,n,i)}};Na="__sak";Oa=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Na,"1"),this.storage.removeItem(Na),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};wS=1e3,ES=10,TS=(()=>{class r extends Oa{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,n)=>this.onStorageEvent(t,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=py(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let n of Object.keys(this.listeners)){let i=this.storage.getItem(n),s=this.localCache[n];i!==s&&t(n,s,i)}}onStorageEvent(t,n=!1){if(!t.key){this.forAllChangedKeys((c,u,h)=>{this.notifyListeners(c,h)});return}let i=t.key;n?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!n&&this.localCache[i]===c||this.notifyListeners(i,c)},o=this.storage.getItem(i);QR()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,ES):s()}notifyListeners(t,n){this.localCache[t]=n;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,n,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:n,newValue:i}),!0)})},wS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(n)}_removeListener(t,n){this.listeners[t]&&(this.listeners[t].delete(n),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,n){return p(this,null,function*(){yield Wt(r.prototype,this,"_set").call(this,t,n),this.localCache[t]=JSON.stringify(n)})}_get(t){return p(this,null,function*(){let n=yield Wt(r.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(n),n})}_remove(t){return p(this,null,function*(){yield Wt(r.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return r.type="LOCAL",r})(),Ay=TS;AS=(()=>{class r extends Oa{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,n){}_removeListener(t,n){}}return r.type="SESSION",r})(),Ch=AS;RS=(()=>{class r{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let n=this.receivers.find(s=>s.isListeningto(t));if(n)return n;let i=new r(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return p(this,null,function*(){let n=t,{eventId:i,eventType:s,data:o}=n.data,c=this.handlersMap[s];if(!(c!=null&&c.size))return;n.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let u=Array.from(c).map(f=>p(this,null,function*(){return f(n.origin,o)})),h=yield bS(u);n.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:h})})}_subscribe(t,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(n)}_unsubscribe(t,n){this.handlersMap[t]&&n&&this.handlersMap[t].delete(n),(!n||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}r.receivers=[];return r})();rh=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){return p(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((c,u)=>{let h=Ph("",20);i.port1.start();let f=setTimeout(()=>{u(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(g){let y=g;if(y.data.eventId===h)switch(y.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(y.data.response);break;default:clearTimeout(f),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};Ry="firebaseLocalStorageDb",DS=1,xa="firebaseLocalStorage",Sy="fbase_key",rr=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};xS=800,VS=3,LS=(()=>{class r{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return p(this,null,function*(){return this.db?this.db:(this.db=yield ih(),this.db)})}_withRetries(t){return p(this,null,function*(){let n=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(n++>VS)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return p(this,null,function*(){return by()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return p(this,null,function*(){this.receiver=RS._getInstance(kS()),this.receiver._subscribe("keyChanged",(t,n)=>p(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(n.key)}})),this.receiver._subscribe("ping",(t,n)=>p(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return p(this,null,function*(){var t,n;if(this.activeServiceWorker=yield CS(),!this.activeServiceWorker)return;this.sender=new rh(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((n=i[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return p(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||PS()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return p(this,null,function*(){try{if(!indexedDB)return!1;let t=yield ih();return yield H_(t,Na,"1"),yield K_(t,Na),!0}catch{}return!1})}_withPendingWrite(t){return p(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,n){return p(this,null,function*(){return this._withPendingWrite(()=>p(this,null,function*(){return yield this._withRetries(i=>H_(i,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)}))})}_get(t){return p(this,null,function*(){let n=yield this._withRetries(i=>OS(i,t));return this.localCache[t]=n,n})}_remove(t){return p(this,null,function*(){return this._withPendingWrite(()=>p(this,null,function*(){return yield this._withRetries(n=>K_(n,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return p(this,null,function*(){let t=yield this._withRetries(s=>{let o=Ua(s,!1).getAll();return new rr(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let n=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),n.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),n.push(s));return n})}notifyListeners(t,n){this.localCache[t]=n;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>p(this,null,function*(){return this._poll()}),xS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(n)}_removeListener(t,n){this.listeners[t]&&(this.listeners[t].delete(n),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return r.type="LOCAL",r})(),Ba=LS;_O=_y("rcb"),yO=new tr(3e4,6e4);Os=class extends Qr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Kr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Kr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Kr(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};Va=class{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>p(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}onAuthEvent(e){return p(this,null,function*(){let{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:o,type:c}=e;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(u))}catch(h){this.reject(h)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return MS;case"linkViaPopup":case"linkViaRedirect":return US;case"reauthViaPopup":case"reauthViaRedirect":return FS;default:at(this.auth,"internal-error")}}resolve(e){tn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){tn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};BS=new tr(2e3,1e4);$S=(()=>{class r extends Va{constructor(t,n,i,s,o){super(t,n,s,o),this.provider=i,this.authWindow=null,this.pollId=null,r.currentPopupAction&&r.currentPopupAction.cancel(),r.currentPopupAction=this}executeNotNull(){return p(this,null,function*(){let t=yield this.execute();return $(t,this.auth,"internal-error"),t})}onExecution(){return p(this,null,function*(){tn(this.filter.length===1,"Popup operations only handle one event");let t=Ph();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(gt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(gt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,r.currentPopupAction=null}pollUserCancellation(){let t=()=>{var n,i;if(!((i=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(gt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,BS.get())};t()}}r.currentPopupAction=null;return r})(),qS="pendingRedirect",Ea=new Map,sh=class r extends Va{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){return p(this,null,function*(){let e=Ea.get(this.auth._key());if(!e){try{let n=(yield jS(this.resolver,this.auth))?yield Wt(r.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Ea.set(this.auth._key(),e)}return this.bypassAuthState||Ea.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return p(this,null,function*(){if(e.type==="signInViaRedirect")return Wt(r.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Wt(r.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return p(this,null,function*(){})}cleanUp(){}};KS=10*60*1e3,oh=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!QS(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Py(e)){let i=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(gt(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=KS&&this.cachedEventUids.clear(),this.cachedEventUids.has(Q_(e))}saveEventToCache(e){this.cachedEventUids.add(Q_(e)),this.lastProcessedEventTime=Date.now()}};JS=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,XS=/^https?/;t0=new tr(3e4,6e4);Ta=null;i0=new tr(5e3,15e3),s0="__/auth/iframe",o0="emulator/auth/iframe",a0={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},c0=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);h0={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},d0=500,f0=600,p0="_blank",m0="http://localhost",La=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};y0="__/auth/handler",v0="emulator/auth/handler",I0=encodeURIComponent("fac");zl="webStorageSupport",ah=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ch,this._completeRedirectFn=HS,this._overrideRedirectResult=zS}_openPopup(e,t,n,i){return p(this,null,function*(){var s;tn((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield J_(e,t,n,Wl(),i);return g0(e,o,Ph())})}_openRedirect(e,t,n,i){return p(this,null,function*(){yield this._originValidation(e);let s=yield J_(e,t,n,Wl(),i);return SS(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(tn(s,"If manager is not set, promise should be"),s)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}initAndGetManager(e){return p(this,null,function*(){let t=yield l0(e),n=new oh(e);return t.register("authEvent",i=>($(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(zl,{type:zl},i=>{var s;let o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[zl];o!==void 0&&t(!!o),at(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=ZS(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return py()||cy()||mh()}},ky=ah,X_="@firebase/auth",Z_="1.10.1";ch=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return p(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){$(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};A0=5*60,b0=_l("authIdTokenMaxAge")||A0,ey=null,R0=r=>e=>p(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>b0)return;let i=t==null?void 0:t.token;ey!==i&&(ey=i,yield fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});XR({loadJS(r){return new Promise((e,t)=>{let n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=i=>{let s=gt("internal-error");s.customData=i,t(s)},n.type="text/javascript",n.charset="UTF-8",S0().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});T0("Browser")});var Ny=W(()=>{"use strict";Dy();wn();Ht();Wr();Xn()});var Nh=W(()=>{"use strict";Ny()});function hC(r,e){let t=er(Oy,r,e);return t&&new ir(t)}function dC(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new ir(n)}}function xy(r,...e){return le("angularfire",kt.full,"auth"),yn([pC,fC,{provide:Oh,useFactory:dC(r),multi:!0,deps:[ot,vn,Dt,Jt,[new De,bn],...e]}])}var Oy,ir,sr,Oh,fC,pC,Vy,Ly,My,Fy,Uy,By,$y,qy,jy,zy,Vs=W(()=>{"use strict";Hr();he();Es();ya();En();Nh();Nh();Oy="auth",ir=class{constructor(e){return e}},sr=class{constructor(){return Tn(Oy)}},Oh=new _n("angularfire2.auth-instances");fC={provide:sr,deps:[[new De,Oh]]},pC={provide:ir,useFactory:hC,deps:[[new De,Oh],pt]};Vy=K(Ih,!0,2),Ly=K(Dh,!0),My=K(Fa,!0),Fy=K(Rh,!0),Uy=K(vh,!0,2),By=K(wh,!0,2),$y=K(kh,!0,2),qy=K(Sh,!0,2),jy=K(Th,!0,2),zy=K(Eh,!0,2)});var Wy,Gy,sn,xh,Hy=W(()=>{"use strict";Wy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Gy={};(function(){var r;function e(w,_){function I(){}I.prototype=_.prototype,w.D=_.prototype,w.prototype=new I,w.prototype.constructor=w,w.C=function(E,A,R){for(var v=Array(arguments.length-2),qt=2;qt<arguments.length;qt++)v[qt-2]=arguments[qt];return _.prototype[A].apply(E,v)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,_,I){I||(I=0);var E=Array(16);if(typeof _=="string")for(var A=0;16>A;++A)E[A]=_.charCodeAt(I++)|_.charCodeAt(I++)<<8|_.charCodeAt(I++)<<16|_.charCodeAt(I++)<<24;else for(A=0;16>A;++A)E[A]=_[I++]|_[I++]<<8|_[I++]<<16|_[I++]<<24;_=w.g[0],I=w.g[1],A=w.g[2];var R=w.g[3],v=_+(R^I&(A^R))+E[0]+3614090360&4294967295;_=I+(v<<7&4294967295|v>>>25),v=R+(A^_&(I^A))+E[1]+3905402710&4294967295,R=_+(v<<12&4294967295|v>>>20),v=A+(I^R&(_^I))+E[2]+606105819&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(_^A&(R^_))+E[3]+3250441966&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(R^I&(A^R))+E[4]+4118548399&4294967295,_=I+(v<<7&4294967295|v>>>25),v=R+(A^_&(I^A))+E[5]+1200080426&4294967295,R=_+(v<<12&4294967295|v>>>20),v=A+(I^R&(_^I))+E[6]+2821735955&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(_^A&(R^_))+E[7]+4249261313&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(R^I&(A^R))+E[8]+1770035416&4294967295,_=I+(v<<7&4294967295|v>>>25),v=R+(A^_&(I^A))+E[9]+2336552879&4294967295,R=_+(v<<12&4294967295|v>>>20),v=A+(I^R&(_^I))+E[10]+4294925233&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(_^A&(R^_))+E[11]+2304563134&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(R^I&(A^R))+E[12]+1804603682&4294967295,_=I+(v<<7&4294967295|v>>>25),v=R+(A^_&(I^A))+E[13]+4254626195&4294967295,R=_+(v<<12&4294967295|v>>>20),v=A+(I^R&(_^I))+E[14]+2792965006&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(_^A&(R^_))+E[15]+1236535329&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(A^R&(I^A))+E[1]+4129170786&4294967295,_=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(_^I))+E[6]+3225465664&4294967295,R=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(R^_))+E[11]+643717713&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^_&(A^R))+E[0]+3921069994&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(A^R&(I^A))+E[5]+3593408605&4294967295,_=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(_^I))+E[10]+38016083&4294967295,R=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(R^_))+E[15]+3634488961&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^_&(A^R))+E[4]+3889429448&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(A^R&(I^A))+E[9]+568446438&4294967295,_=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(_^I))+E[14]+3275163606&4294967295,R=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(R^_))+E[3]+4107603335&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^_&(A^R))+E[8]+1163531501&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(A^R&(I^A))+E[13]+2850285829&4294967295,_=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(_^I))+E[2]+4243563512&4294967295,R=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(R^_))+E[7]+1735328473&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^_&(A^R))+E[12]+2368359562&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(I^A^R)+E[5]+4294588738&4294967295,_=I+(v<<4&4294967295|v>>>28),v=R+(_^I^A)+E[8]+2272392833&4294967295,R=_+(v<<11&4294967295|v>>>21),v=A+(R^_^I)+E[11]+1839030562&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^_)+E[14]+4259657740&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(I^A^R)+E[1]+2763975236&4294967295,_=I+(v<<4&4294967295|v>>>28),v=R+(_^I^A)+E[4]+1272893353&4294967295,R=_+(v<<11&4294967295|v>>>21),v=A+(R^_^I)+E[7]+4139469664&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^_)+E[10]+3200236656&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(I^A^R)+E[13]+681279174&4294967295,_=I+(v<<4&4294967295|v>>>28),v=R+(_^I^A)+E[0]+3936430074&4294967295,R=_+(v<<11&4294967295|v>>>21),v=A+(R^_^I)+E[3]+3572445317&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^_)+E[6]+76029189&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(I^A^R)+E[9]+3654602809&4294967295,_=I+(v<<4&4294967295|v>>>28),v=R+(_^I^A)+E[12]+3873151461&4294967295,R=_+(v<<11&4294967295|v>>>21),v=A+(R^_^I)+E[15]+530742520&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^_)+E[2]+3299628645&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(A^(I|~R))+E[0]+4096336452&4294967295,_=I+(v<<6&4294967295|v>>>26),v=R+(I^(_|~A))+E[7]+1126891415&4294967295,R=_+(v<<10&4294967295|v>>>22),v=A+(_^(R|~I))+E[14]+2878612391&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~_))+E[5]+4237533241&4294967295,I=A+(v<<21&4294967295|v>>>11),v=_+(A^(I|~R))+E[12]+1700485571&4294967295,_=I+(v<<6&4294967295|v>>>26),v=R+(I^(_|~A))+E[3]+2399980690&4294967295,R=_+(v<<10&4294967295|v>>>22),v=A+(_^(R|~I))+E[10]+4293915773&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~_))+E[1]+2240044497&4294967295,I=A+(v<<21&4294967295|v>>>11),v=_+(A^(I|~R))+E[8]+1873313359&4294967295,_=I+(v<<6&4294967295|v>>>26),v=R+(I^(_|~A))+E[15]+4264355552&4294967295,R=_+(v<<10&4294967295|v>>>22),v=A+(_^(R|~I))+E[6]+2734768916&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~_))+E[13]+1309151649&4294967295,I=A+(v<<21&4294967295|v>>>11),v=_+(A^(I|~R))+E[4]+4149444226&4294967295,_=I+(v<<6&4294967295|v>>>26),v=R+(I^(_|~A))+E[11]+3174756917&4294967295,R=_+(v<<10&4294967295|v>>>22),v=A+(_^(R|~I))+E[2]+718787259&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~_))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+_&4294967295,w.g[1]=w.g[1]+(A+(v<<21&4294967295|v>>>11))&4294967295,w.g[2]=w.g[2]+A&4294967295,w.g[3]=w.g[3]+R&4294967295}n.prototype.u=function(w,_){_===void 0&&(_=w.length);for(var I=_-this.blockSize,E=this.B,A=this.h,R=0;R<_;){if(A==0)for(;R<=I;)i(this,w,R),R+=this.blockSize;if(typeof w=="string"){for(;R<_;)if(E[A++]=w.charCodeAt(R++),A==this.blockSize){i(this,E),A=0;break}}else for(;R<_;)if(E[A++]=w[R++],A==this.blockSize){i(this,E),A=0;break}}this.h=A,this.o+=_},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var _=1;_<w.length-8;++_)w[_]=0;var I=8*this.o;for(_=w.length-8;_<w.length;++_)w[_]=I&255,I/=256;for(this.u(w),w=Array(16),_=I=0;4>_;++_)for(var E=0;32>E;E+=8)w[I++]=this.g[_]>>>E&255;return w};function s(w,_){var I=c;return Object.prototype.hasOwnProperty.call(I,w)?I[w]:I[w]=_(w)}function o(w,_){this.h=_;for(var I=[],E=!0,A=w.length-1;0<=A;A--){var R=w[A]|0;E&&R==_||(I[A]=R,E=!1)}this.g=I}var c={};function u(w){return-128<=w&&128>w?s(w,function(_){return new o([_|0],0>_?-1:0)}):new o([w|0],0>w?-1:0)}function h(w){if(isNaN(w)||!isFinite(w))return g;if(0>w)return k(h(-w));for(var _=[],I=1,E=0;w>=I;E++)_[E]=w/I|0,I*=4294967296;return new o(_,0)}function f(w,_){if(w.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(w.charAt(0)=="-")return k(f(w.substring(1),_));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(_,8)),E=g,A=0;A<w.length;A+=8){var R=Math.min(8,w.length-A),v=parseInt(w.substring(A,A+R),_);8>R?(R=h(Math.pow(_,R)),E=E.j(R).add(h(v))):(E=E.j(I),E=E.add(h(v)))}return E}var g=u(0),y=u(1),T=u(16777216);r=o.prototype,r.m=function(){if(N(this))return-k(this).m();for(var w=0,_=1,I=0;I<this.g.length;I++){var E=this.i(I);w+=(0<=E?E:4294967296+E)*_,_*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(D(this))return"0";if(N(this))return"-"+k(this).toString(w);for(var _=h(Math.pow(w,6)),I=this,E="";;){var A=j(I,_).g;I=q(I,A.j(_));var R=((0<I.g.length?I.g[0]:I.h)>>>0).toString(w);if(I=A,D(I))return R+E;for(;6>R.length;)R="0"+R;E=R+E}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function D(w){if(w.h!=0)return!1;for(var _=0;_<w.g.length;_++)if(w.g[_]!=0)return!1;return!0}function N(w){return w.h==-1}r.l=function(w){return w=q(this,w),N(w)?-1:D(w)?0:1};function k(w){for(var _=w.g.length,I=[],E=0;E<_;E++)I[E]=~w.g[E];return new o(I,~w.h).add(y)}r.abs=function(){return N(this)?k(this):this},r.add=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0,A=0;A<=_;A++){var R=E+(this.i(A)&65535)+(w.i(A)&65535),v=(R>>>16)+(this.i(A)>>>16)+(w.i(A)>>>16);E=v>>>16,R&=65535,v&=65535,I[A]=v<<16|R}return new o(I,I[I.length-1]&-2147483648?-1:0)};function q(w,_){return w.add(k(_))}r.j=function(w){if(D(this)||D(w))return g;if(N(this))return N(w)?k(this).j(k(w)):k(k(this).j(w));if(N(w))return k(this.j(k(w)));if(0>this.l(T)&&0>w.l(T))return h(this.m()*w.m());for(var _=this.g.length+w.g.length,I=[],E=0;E<2*_;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var A=0;A<w.g.length;A++){var R=this.i(E)>>>16,v=this.i(E)&65535,qt=w.i(A)>>>16,Ji=w.i(A)&65535;I[2*E+2*A]+=v*Ji,U(I,2*E+2*A),I[2*E+2*A+1]+=R*Ji,U(I,2*E+2*A+1),I[2*E+2*A+1]+=v*qt,U(I,2*E+2*A+1),I[2*E+2*A+2]+=R*qt,U(I,2*E+2*A+2)}for(E=0;E<_;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=_;E<2*_;E++)I[E]=0;return new o(I,0)};function U(w,_){for(;(w[_]&65535)!=w[_];)w[_+1]+=w[_]>>>16,w[_]&=65535,_++}function M(w,_){this.g=w,this.h=_}function j(w,_){if(D(_))throw Error("division by zero");if(D(w))return new M(g,g);if(N(w))return _=j(k(w),_),new M(k(_.g),k(_.h));if(N(_))return _=j(w,k(_)),new M(k(_.g),_.h);if(30<w.g.length){if(N(w)||N(_))throw Error("slowDivide_ only works with positive integers.");for(var I=y,E=_;0>=E.l(w);)I=X(I),E=X(E);var A=G(I,1),R=G(E,1);for(E=G(E,2),I=G(I,2);!D(E);){var v=R.add(E);0>=v.l(w)&&(A=A.add(I),R=v),E=G(E,1),I=G(I,1)}return _=q(w,A.j(_)),new M(A,_)}for(A=g;0<=w.l(_);){for(I=Math.max(1,Math.floor(w.m()/_.m())),E=Math.ceil(Math.log(I)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),R=h(I),v=R.j(_);N(v)||0<v.l(w);)I-=E,R=h(I),v=R.j(_);D(R)&&(R=y),A=A.add(R),w=q(w,v)}return new M(A,w)}r.A=function(w){return j(this,w).h},r.and=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)&w.i(E);return new o(I,this.h&w.h)},r.or=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)|w.i(E);return new o(I,this.h|w.h)},r.xor=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)^w.i(E);return new o(I,this.h^w.h)};function X(w){for(var _=w.g.length+1,I=[],E=0;E<_;E++)I[E]=w.i(E)<<1|w.i(E-1)>>>31;return new o(I,w.h)}function G(w,_){var I=_>>5;_%=32;for(var E=w.g.length-I,A=[],R=0;R<E;R++)A[R]=0<_?w.i(R+I)>>>_|w.i(R+I+1)<<32-_:w.i(R+I);return new o(A,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,xh=Gy.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,sn=Gy.Integer=o}).apply(typeof Wy<"u"?Wy:typeof self<"u"?self:typeof window<"u"?window:{})});var $a,on,Vh,mC,Xr,Lh,Ls,qa,Mh,Fh,Uh,Ky=W(()=>{"use strict";$a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},on={};(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof $a=="object"&&$a];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function i(a,l){if(l)e:{var d=n;a=a.split(".");for(var m=0;m<a.length-1;m++){var b=a[m];if(!(b in d))break e;d=d[b]}a=a[a.length-1],m=d[a],l=l(m),l!=m&&l!=null&&e(d,a,{configurable:!0,writable:!0,value:l})}}function s(a,l){a instanceof String&&(a+="");var d=0,m=!1,b={next:function(){if(!m&&d<a.length){var C=d++;return{value:l(C,a[C]),done:!1}}return m=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}i("Array.prototype.values",function(a){return a||function(){return s(this,function(l,d){return d})}});var o=o||{},c=this||self;function u(a){var l=typeof a;return l=l!="object"?l:a?Array.isArray(a)?"array":l:"null",l=="array"||l=="object"&&typeof a.length=="number"}function h(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function f(a,l,d){return a.call.apply(a.bind,arguments)}function g(a,l,d){if(!a)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,m),a.apply(l,b)}}return function(){return a.apply(l,arguments)}}function y(a,l,d){return y=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,y.apply(null,arguments)}function T(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),a.apply(this,m)}}function D(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(m,b,C){for(var V=Array(arguments.length-2),ue=2;ue<arguments.length;ue++)V[ue-2]=arguments[ue];return l.prototype[b].apply(m,V)}}function N(a){let l=a.length;if(0<l){let d=Array(l);for(let m=0;m<l;m++)d[m]=a[m];return d}return[]}function k(a,l){for(let d=1;d<arguments.length;d++){let m=arguments[d];if(u(m)){let b=a.length||0,C=m.length||0;a.length=b+C;for(let V=0;V<C;V++)a[b+V]=m[V]}else a.push(m)}}class q{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function U(a){return/^[\s\xa0]*$/.test(a)}function M(){var a=c.navigator;return a&&(a=a.userAgent)?a:""}function j(a){return j[" "](a),a}j[" "]=function(){};var X=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function G(a,l,d){for(let m in a)l.call(d,a[m],m,a)}function w(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function _(a){let l={};for(let d in a)l[d]=a[d];return l}let I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(a,l){let d,m;for(let b=1;b<arguments.length;b++){m=arguments[b];for(d in m)a[d]=m[d];for(let C=0;C<I.length;C++)d=I[C],Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}}function A(a){var l=1;a=a.split(":");let d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function R(a){c.setTimeout(()=>{throw a},0)}function v(){var a=Lu;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class qt{constructor(){this.h=this.g=null}add(l,d){let m=Ji.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}}var Ji=new q(()=>new WT,a=>a.reset());class WT{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Xi,Zi=!1,Lu=new qt,tm=()=>{let a=c.Promise.resolve(void 0);Xi=()=>{a.then(GT)}};var GT=()=>{for(var a;a=v();){try{a.h.call(a.g)}catch(d){R(d)}var l=Ji;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}Zi=!1};function dn(){this.s=this.s,this.C=this.C}dn.prototype.s=!1,dn.prototype.ma=function(){this.s||(this.s=!0,this.N())},dn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Me(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}Me.prototype.h=function(){this.defaultPrevented=!0};var HT=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};c.addEventListener("test",d,l),c.removeEventListener("test",d,l)}catch{}return a}();function es(a,l){if(Me.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,m=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(X){e:{try{j(l.nodeName);var b=!0;break e}catch{}b=!1}b||(l=null)}}else d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:KT[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&es.aa.h.call(this)}}D(es,Me);var KT={2:"touch",3:"pen",4:"mouse"};es.prototype.h=function(){es.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var ts="closure_listenable_"+(1e6*Math.random()|0),QT=0;function YT(a,l,d,m,b){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=b,this.key=++QT,this.da=this.fa=!1}function Lo(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Mo(a){this.src=a,this.g={},this.h=0}Mo.prototype.add=function(a,l,d,m,b){var C=a.toString();a=this.g[C],a||(a=this.g[C]=[],this.h++);var V=Fu(a,l,m,b);return-1<V?(l=a[V],d||(l.fa=!1)):(l=new YT(l,this.src,C,!!m,b),l.fa=d,a.push(l)),l};function Mu(a,l){var d=l.type;if(d in a.g){var m=a.g[d],b=Array.prototype.indexOf.call(m,l,void 0),C;(C=0<=b)&&Array.prototype.splice.call(m,b,1),C&&(Lo(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Fu(a,l,d,m){for(var b=0;b<a.length;++b){var C=a[b];if(!C.da&&C.listener==l&&C.capture==!!d&&C.ha==m)return b}return-1}var Uu="closure_lm_"+(1e6*Math.random()|0),Bu={};function nm(a,l,d,m,b){if(m&&m.once)return im(a,l,d,m,b);if(Array.isArray(l)){for(var C=0;C<l.length;C++)nm(a,l[C],d,m,b);return null}return d=zu(d),a&&a[ts]?a.K(l,d,h(m)?!!m.capture:!!m,b):rm(a,l,d,!1,m,b)}function rm(a,l,d,m,b,C){if(!l)throw Error("Invalid event type");var V=h(b)?!!b.capture:!!b,ue=qu(a);if(ue||(a[Uu]=ue=new Mo(a)),d=ue.add(l,d,m,V,C),d.proxy)return d;if(m=JT(),d.proxy=m,m.src=a,m.listener=d,a.addEventListener)HT||(b=V),b===void 0&&(b=!1),a.addEventListener(l.toString(),m,b);else if(a.attachEvent)a.attachEvent(om(l.toString()),m);else if(a.addListener&&a.removeListener)a.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function JT(){function a(d){return l.call(a.src,a.listener,d)}let l=XT;return a}function im(a,l,d,m,b){if(Array.isArray(l)){for(var C=0;C<l.length;C++)im(a,l[C],d,m,b);return null}return d=zu(d),a&&a[ts]?a.L(l,d,h(m)?!!m.capture:!!m,b):rm(a,l,d,!0,m,b)}function sm(a,l,d,m,b){if(Array.isArray(l))for(var C=0;C<l.length;C++)sm(a,l[C],d,m,b);else m=h(m)?!!m.capture:!!m,d=zu(d),a&&a[ts]?(a=a.i,l=String(l).toString(),l in a.g&&(C=a.g[l],d=Fu(C,d,m,b),-1<d&&(Lo(C[d]),Array.prototype.splice.call(C,d,1),C.length==0&&(delete a.g[l],a.h--)))):a&&(a=qu(a))&&(l=a.g[l.toString()],a=-1,l&&(a=Fu(l,d,m,b)),(d=-1<a?l[a]:null)&&$u(d))}function $u(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[ts])Mu(l.i,a);else{var d=a.type,m=a.proxy;l.removeEventListener?l.removeEventListener(d,m,a.capture):l.detachEvent?l.detachEvent(om(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=qu(l))?(Mu(d,a),d.h==0&&(d.src=null,l[Uu]=null)):Lo(a)}}}function om(a){return a in Bu?Bu[a]:Bu[a]="on"+a}function XT(a,l){if(a.da)a=!0;else{l=new es(l,this);var d=a.listener,m=a.ha||a.src;a.fa&&$u(a),a=d.call(m,l)}return a}function qu(a){return a=a[Uu],a instanceof Mo?a:null}var ju="__closure_events_fn_"+(1e9*Math.random()>>>0);function zu(a){return typeof a=="function"?a:(a[ju]||(a[ju]=function(l){return a.handleEvent(l)}),a[ju])}function Fe(){dn.call(this),this.i=new Mo(this),this.M=this,this.F=null}D(Fe,dn),Fe.prototype[ts]=!0,Fe.prototype.removeEventListener=function(a,l,d,m){sm(this,a,l,d,m)};function ze(a,l){var d,m=a.F;if(m)for(d=[];m;m=m.F)d.push(m);if(a=a.M,m=l.type||l,typeof l=="string")l=new Me(l,a);else if(l instanceof Me)l.target=l.target||a;else{var b=l;l=new Me(m,a),E(l,b)}if(b=!0,d)for(var C=d.length-1;0<=C;C--){var V=l.g=d[C];b=Fo(V,m,!0,l)&&b}if(V=l.g=a,b=Fo(V,m,!0,l)&&b,b=Fo(V,m,!1,l)&&b,d)for(C=0;C<d.length;C++)V=l.g=d[C],b=Fo(V,m,!1,l)&&b}Fe.prototype.N=function(){if(Fe.aa.N.call(this),this.i){var a=this.i,l;for(l in a.g){for(var d=a.g[l],m=0;m<d.length;m++)Lo(d[m]);delete a.g[l],a.h--}}this.F=null},Fe.prototype.K=function(a,l,d,m){return this.i.add(String(a),l,!1,d,m)},Fe.prototype.L=function(a,l,d,m){return this.i.add(String(a),l,!0,d,m)};function Fo(a,l,d,m){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();for(var b=!0,C=0;C<l.length;++C){var V=l[C];if(V&&!V.da&&V.capture==d){var ue=V.listener,ke=V.ha||V.src;V.fa&&Mu(a.i,V),b=ue.call(ke,m)!==!1&&b}}return b&&!m.defaultPrevented}function am(a,l,d){if(typeof a=="function")d&&(a=y(a,d));else if(a&&typeof a.handleEvent=="function")a=y(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:c.setTimeout(a,l||0)}function cm(a){a.g=am(()=>{a.g=null,a.i&&(a.i=!1,cm(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class ZT extends dn{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:cm(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ns(a){dn.call(this),this.h=a,this.g={}}D(ns,dn);var um=[];function lm(a){G(a.g,function(l,d){this.g.hasOwnProperty(d)&&$u(l)},a),a.g={}}ns.prototype.N=function(){ns.aa.N.call(this),lm(this)},ns.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Wu=c.JSON.stringify,eA=c.JSON.parse,tA=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function Gu(){}Gu.prototype.h=null;function hm(a){return a.h||(a.h=a.i())}function dm(){}var rs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Hu(){Me.call(this,"d")}D(Hu,Me);function Ku(){Me.call(this,"c")}D(Ku,Me);var zn={},fm=null;function Uo(){return fm=fm||new Fe}zn.La="serverreachability";function pm(a){Me.call(this,zn.La,a)}D(pm,Me);function is(a){let l=Uo();ze(l,new pm(l))}zn.STAT_EVENT="statevent";function mm(a,l){Me.call(this,zn.STAT_EVENT,a),this.stat=l}D(mm,Me);function We(a){let l=Uo();ze(l,new mm(l,a))}zn.Ma="timingevent";function gm(a,l){Me.call(this,zn.Ma,a),this.size=l}D(gm,Me);function ss(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},l)}function os(){this.g=!0}os.prototype.xa=function(){this.g=!1};function nA(a,l,d,m,b,C){a.info(function(){if(a.g)if(C)for(var V="",ue=C.split("&"),ke=0;ke<ue.length;ke++){var re=ue[ke].split("=");if(1<re.length){var Ue=re[0];re=re[1];var Be=Ue.split("_");V=2<=Be.length&&Be[1]=="type"?V+(Ue+"="+re+"&"):V+(Ue+"=redacted&")}}else V=null;else V=C;return"XMLHTTP REQ ("+m+") [attempt "+b+"]: "+l+`
`+d+`
`+V})}function rA(a,l,d,m,b,C,V){a.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+b+"]: "+l+`
`+d+`
`+C+" "+V})}function Mr(a,l,d,m){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+sA(a,d)+(m?" "+m:"")})}function iA(a,l){a.info(function(){return"TIMEOUT: "+l})}os.prototype.info=function(){};function sA(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var m=d[a];if(!(2>m.length)){var b=m[1];if(Array.isArray(b)&&!(1>b.length)){var C=b[0];if(C!="noop"&&C!="stop"&&C!="close")for(var V=1;V<b.length;V++)b[V]=""}}}}return Wu(d)}catch{return l}}var Bo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},_m={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Qu;function $o(){}D($o,Gu),$o.prototype.g=function(){return new XMLHttpRequest},$o.prototype.i=function(){return{}},Qu=new $o;function fn(a,l,d,m){this.j=a,this.i=l,this.l=d,this.R=m||1,this.U=new ns(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ym}function ym(){this.i=null,this.g="",this.h=!1}var vm={},Yu={};function Ju(a,l,d){a.L=1,a.v=Wo(jt(l)),a.m=d,a.P=!0,Im(a,null)}function Im(a,l){a.F=Date.now(),qo(a),a.A=jt(a.v);var d=a.A,m=a.R;Array.isArray(m)||(m=[String(m)]),xm(d.i,"t",m),a.C=0,d=a.j.J,a.h=new ym,a.g=Xm(a.j,d?l:null,!a.m),0<a.O&&(a.M=new ZT(y(a.Y,a,a.g),a.O)),l=a.U,d=a.g,m=a.ca;var b="readystatechange";Array.isArray(b)||(b&&(um[0]=b.toString()),b=um);for(var C=0;C<b.length;C++){var V=nm(d,b[C],m||l.handleEvent,!1,l.h||l);if(!V)break;l.g[V.key]=V}l=a.H?_(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),is(),nA(a.i,a.u,a.A,a.l,a.R,a.m)}fn.prototype.ca=function(a){a=a.target;let l=this.M;l&&zt(a)==3?l.j():this.Y(a)},fn.prototype.Y=function(a){try{if(a==this.g)e:{let Be=zt(this.g);var l=this.g.Ba();let Br=this.g.Z();if(!(3>Be)&&(Be!=3||this.g&&(this.h.h||this.g.oa()||$m(this.g)))){this.J||Be!=4||l==7||(l==8||0>=Br?is(3):is(2)),Xu(this);var d=this.g.Z();this.X=d;t:if(wm(this)){var m=$m(this.g);a="";var b=m.length,C=zt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Wn(this),as(this);var V="";break t}this.h.i=new c.TextDecoder}for(l=0;l<b;l++)this.h.h=!0,a+=this.h.i.decode(m[l],{stream:!(C&&l==b-1)});m.length=0,this.h.g+=a,this.C=0,V=this.h.g}else V=this.g.oa();if(this.o=d==200,rA(this.i,this.u,this.A,this.l,this.R,Be,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ue,ke=this.g;if((ue=ke.g?ke.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(ue)){var re=ue;break t}}re=null}if(d=re)Mr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Zu(this,d);else{this.o=!1,this.s=3,We(12),Wn(this),as(this);break e}}if(this.P){d=!0;let ht;for(;!this.J&&this.C<V.length;)if(ht=oA(this,V),ht==Yu){Be==4&&(this.s=4,We(14),d=!1),Mr(this.i,this.l,null,"[Incomplete Response]");break}else if(ht==vm){this.s=4,We(15),Mr(this.i,this.l,V,"[Invalid Chunk]"),d=!1;break}else Mr(this.i,this.l,ht,null),Zu(this,ht);if(wm(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Be!=4||V.length!=0||this.h.h||(this.s=1,We(16),d=!1),this.o=this.o&&d,!d)Mr(this.i,this.l,V,"[Invalid Chunked Response]"),Wn(this),as(this);else if(0<V.length&&!this.W){this.W=!0;var Ue=this.j;Ue.g==this&&Ue.ba&&!Ue.M&&(Ue.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),sl(Ue),Ue.M=!0,We(11))}}else Mr(this.i,this.l,V,null),Zu(this,V);Be==4&&Wn(this),this.o&&!this.J&&(Be==4?Km(this.j,this):(this.o=!1,qo(this)))}else TA(this.g),d==400&&0<V.indexOf("Unknown SID")?(this.s=3,We(12)):(this.s=0,We(13)),Wn(this),as(this)}}}catch{}finally{}};function wm(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function oA(a,l){var d=a.C,m=l.indexOf(`
`,d);return m==-1?Yu:(d=Number(l.substring(d,m)),isNaN(d)?vm:(m+=1,m+d>l.length?Yu:(l=l.slice(m,m+d),a.C=m+d,l)))}fn.prototype.cancel=function(){this.J=!0,Wn(this)};function qo(a){a.S=Date.now()+a.I,Em(a,a.I)}function Em(a,l){if(a.B!=null)throw Error("WatchDog timer not null");a.B=ss(y(a.ba,a),l)}function Xu(a){a.B&&(c.clearTimeout(a.B),a.B=null)}fn.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(iA(this.i,this.A),this.L!=2&&(is(),We(17)),Wn(this),this.s=2,as(this)):Em(this,this.S-a)};function as(a){a.j.G==0||a.J||Km(a.j,a)}function Wn(a){Xu(a);var l=a.M;l&&typeof l.ma=="function"&&l.ma(),a.M=null,lm(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function Zu(a,l){try{var d=a.j;if(d.G!=0&&(d.g==a||el(d.h,a))){if(!a.K&&el(d.h,a)&&d.G==3){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var b=m;if(b[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)Yo(d),Ko(d);else break e;il(d),We(18)}}else d.za=b[1],0<d.za-d.T&&37500>b[2]&&d.F&&d.v==0&&!d.C&&(d.C=ss(y(d.Za,d),6e3));if(1>=bm(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Hn(d,11)}else if((a.K||d.g==a)&&Yo(d),!U(l))for(b=d.Da.g.parse(l),l=0;l<b.length;l++){let re=b[l];if(d.T=re[0],re=re[1],d.G==2)if(re[0]=="c"){d.K=re[1],d.ia=re[2];let Ue=re[3];Ue!=null&&(d.la=Ue,d.j.info("VER="+d.la));let Be=re[4];Be!=null&&(d.Aa=Be,d.j.info("SVER="+d.Aa));let Br=re[5];Br!=null&&typeof Br=="number"&&0<Br&&(m=1.5*Br,d.L=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;let ht=a.g;if(ht){let Xo=ht.g?ht.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Xo){var C=m.h;C.g||Xo.indexOf("spdy")==-1&&Xo.indexOf("quic")==-1&&Xo.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(tl(C,C.h),C.h=null))}if(m.D){let ol=ht.g?ht.g.getResponseHeader("X-HTTP-Session-Id"):null;ol&&(m.ya=ol,de(m.I,m.D,ol))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),m=d;var V=a;if(m.qa=Jm(m,m.J?m.ia:null,m.W),V.K){Rm(m.h,V);var ue=V,ke=m.L;ke&&(ue.I=ke),ue.B&&(Xu(ue),qo(ue)),m.g=V}else Gm(m);0<d.i.length&&Qo(d)}else re[0]!="stop"&&re[0]!="close"||Hn(d,7);else d.G==3&&(re[0]=="stop"||re[0]=="close"?re[0]=="stop"?Hn(d,7):rl(d):re[0]!="noop"&&d.l&&d.l.ta(re),d.v=0)}}is(4)}catch{}}var aA=class{constructor(a,l){this.g=a,this.map=l}};function Tm(a){this.l=a||10,c.PerformanceNavigationTiming?(a=c.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Am(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function bm(a){return a.h?1:a.g?a.g.size:0}function el(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function tl(a,l){a.g?a.g.add(l):a.h=l}function Rm(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}Tm.prototype.cancel=function(){if(this.i=Sm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Sm(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.D);return l}return N(a.i)}function cA(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var l=[],d=a.length,m=0;m<d;m++)l.push(a[m]);return l}l=[],d=0;for(m in a)l[d++]=a[m];return l}function uA(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(let m in a)l[d++]=m;return l}}}function Cm(a,l){if(a.forEach&&typeof a.forEach=="function")a.forEach(l,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,l,void 0);else for(var d=uA(a),m=cA(a),b=m.length,C=0;C<b;C++)l.call(void 0,m[C],d&&d[C],a)}var Pm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lA(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var m=a[d].indexOf("="),b=null;if(0<=m){var C=a[d].substring(0,m);b=a[d].substring(m+1)}else C=a[d];l(C,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function Gn(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof Gn){this.h=a.h,jo(this,a.j),this.o=a.o,this.g=a.g,zo(this,a.s),this.l=a.l;var l=a.i,d=new ls;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),km(this,d),this.m=a.m}else a&&(l=String(a).match(Pm))?(this.h=!1,jo(this,l[1]||"",!0),this.o=cs(l[2]||""),this.g=cs(l[3]||"",!0),zo(this,l[4]),this.l=cs(l[5]||"",!0),km(this,l[6]||"",!0),this.m=cs(l[7]||"")):(this.h=!1,this.i=new ls(null,this.h))}Gn.prototype.toString=function(){var a=[],l=this.j;l&&a.push(us(l,Dm,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(us(l,Dm,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(us(d,d.charAt(0)=="/"?fA:dA,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",us(d,mA)),a.join("")};function jt(a){return new Gn(a)}function jo(a,l,d){a.j=d?cs(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function zo(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function km(a,l,d){l instanceof ls?(a.i=l,gA(a.i,a.h)):(d||(l=us(l,pA)),a.i=new ls(l,a.h))}function de(a,l,d){a.i.set(l,d)}function Wo(a){return de(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function cs(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function us(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,hA),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function hA(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Dm=/[#\/\?@]/g,dA=/[#\?:]/g,fA=/[#\?]/g,pA=/[#\?@]/g,mA=/#/g;function ls(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function pn(a){a.g||(a.g=new Map,a.h=0,a.i&&lA(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}r=ls.prototype,r.add=function(a,l){pn(this),this.i=null,a=Fr(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function Nm(a,l){pn(a),l=Fr(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function Om(a,l){return pn(a),l=Fr(a,l),a.g.has(l)}r.forEach=function(a,l){pn(this),this.g.forEach(function(d,m){d.forEach(function(b){a.call(l,b,m,this)},this)},this)},r.na=function(){pn(this);let a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){let b=a[m];for(let C=0;C<b.length;C++)d.push(l[m])}return d},r.V=function(a){pn(this);let l=[];if(typeof a=="string")Om(this,a)&&(l=l.concat(this.g.get(Fr(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},r.set=function(a,l){return pn(this),this.i=null,a=Fr(this,a),Om(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},r.get=function(a,l){return a?(a=this.V(a),0<a.length?String(a[0]):l):l};function xm(a,l,d){Nm(a,l),0<d.length&&(a.i=null,a.g.set(Fr(a,l),N(d)),a.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];let C=encodeURIComponent(String(m)),V=this.V(m);for(m=0;m<V.length;m++){var b=C;V[m]!==""&&(b+="="+encodeURIComponent(String(V[m]))),a.push(b)}}return this.i=a.join("&")};function Fr(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function gA(a,l){l&&!a.j&&(pn(a),a.i=null,a.g.forEach(function(d,m){var b=m.toLowerCase();m!=b&&(Nm(this,m),xm(this,b,d))},a)),a.j=l}function _A(a,l){let d=new os;if(c.Image){let m=new Image;m.onload=T(mn,d,"TestLoadImage: loaded",!0,l,m),m.onerror=T(mn,d,"TestLoadImage: error",!1,l,m),m.onabort=T(mn,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=T(mn,d,"TestLoadImage: timeout",!1,l,m),c.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=a}else l(!1)}function yA(a,l){let d=new os,m=new AbortController,b=setTimeout(()=>{m.abort(),mn(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:m.signal}).then(C=>{clearTimeout(b),C.ok?mn(d,"TestPingServer: ok",!0,l):mn(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(b),mn(d,"TestPingServer: error",!1,l)})}function mn(a,l,d,m,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),m(d)}catch{}}function vA(){this.g=new tA}function IA(a,l,d){let m=d||"";try{Cm(a,function(b,C){let V=b;h(b)&&(V=Wu(b)),l.push(m+C+"="+encodeURIComponent(V))})}catch(b){throw l.push(m+"type="+encodeURIComponent("_badmap")),b}}function hs(a){this.l=a.Ub||null,this.j=a.eb||!1}D(hs,Gu),hs.prototype.g=function(){return new Go(this.l,this.j)},hs.prototype.i=function(a){return function(){return a}}({});function Go(a,l){Fe.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(Go,Fe),r=Go.prototype,r.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,fs(this)},r.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||c).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ds(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,fs(this)),this.g&&(this.readyState=3,fs(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Vm(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function Vm(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?ds(this):fs(this),this.readyState==3&&Vm(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,ds(this))},r.Qa=function(a){this.g&&(this.response=a,ds(this))},r.ga=function(){this.g&&ds(this)};function ds(a){a.readyState=4,a.l=null,a.j=null,a.v=null,fs(a)}r.setRequestHeader=function(a,l){this.u.append(a,l)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function fs(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Go.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Lm(a){let l="";return G(a,function(d,m){l+=m,l+=":",l+=d,l+=`\r
`}),l}function nl(a,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=Lm(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):de(a,l,d))}function me(a){Fe.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(me,Fe);var wA=/^https?$/i,EA=["POST","PUT"];r=me.prototype,r.Ha=function(a){this.J=a},r.ea=function(a,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Qu.g(),this.v=this.o?hm(this.o):hm(Qu),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(C){Mm(this,C);return}if(a=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var b in m)d.set(b,m[b]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let C of m.keys())d.set(C,m.get(C));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(C=>C.toLowerCase()=="content-type"),b=c.FormData&&a instanceof c.FormData,!(0<=Array.prototype.indexOf.call(EA,l,void 0))||m||b||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[C,V]of d)this.g.setRequestHeader(C,V);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Bm(this),this.u=!0,this.g.send(a),this.u=!1}catch(C){Mm(this,C)}};function Mm(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,Fm(a),Ho(a)}function Fm(a){a.A||(a.A=!0,ze(a,"complete"),ze(a,"error"))}r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,ze(this,"complete"),ze(this,"abort"),Ho(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ho(this,!0)),me.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Um(this):this.bb())},r.bb=function(){Um(this)};function Um(a){if(a.h&&typeof o<"u"&&(!a.v[1]||zt(a)!=4||a.Z()!=2)){if(a.u&&zt(a)==4)am(a.Ea,0,a);else if(ze(a,"readystatechange"),zt(a)==4){a.h=!1;try{let V=a.Z();e:switch(V){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=V===0){var b=String(a.D).match(Pm)[1]||null;!b&&c.self&&c.self.location&&(b=c.self.location.protocol.slice(0,-1)),m=!wA.test(b?b.toLowerCase():"")}d=m}if(d)ze(a,"complete"),ze(a,"success");else{a.m=6;try{var C=2<zt(a)?a.g.statusText:""}catch{C=""}a.l=C+" ["+a.Z()+"]",Fm(a)}}finally{Ho(a)}}}}function Ho(a,l){if(a.g){Bm(a);let d=a.g,m=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||ze(a,"ready");try{d.onreadystatechange=m}catch{}}}function Bm(a){a.I&&(c.clearTimeout(a.I),a.I=null)}r.isActive=function(){return!!this.g};function zt(a){return a.g?a.g.readyState:0}r.Z=function(){try{return 2<zt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),eA(l)}};function $m(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function TA(a){let l={};a=(a.g&&2<=zt(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<a.length;m++){if(U(a[m]))continue;var d=A(a[m]);let b=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let C=l[b]||[];l[b]=C,C.push(d)}w(l,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ps(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function qm(a){this.Aa=0,this.i=[],this.j=new os,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ps("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ps("baseRetryDelayMs",5e3,a),this.cb=ps("retryDelaySeedMs",1e4,a),this.Wa=ps("forwardChannelMaxRetries",2,a),this.wa=ps("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Tm(a&&a.concurrentRequestLimit),this.Da=new vA,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=qm.prototype,r.la=8,r.G=1,r.connect=function(a,l,d,m){We(0),this.W=a,this.H=l||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=Jm(this,null,this.W),Qo(this)};function rl(a){if(jm(a),a.G==3){var l=a.U++,d=jt(a.I);if(de(d,"SID",a.K),de(d,"RID",l),de(d,"TYPE","terminate"),ms(a,d),l=new fn(a,a.j,l),l.L=2,l.v=Wo(jt(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=l.v,d=!0),d||(l.g=Xm(l.j,null),l.g.ea(l.v)),l.F=Date.now(),qo(l)}Ym(a)}function Ko(a){a.g&&(sl(a),a.g.cancel(),a.g=null)}function jm(a){Ko(a),a.u&&(c.clearTimeout(a.u),a.u=null),Yo(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&c.clearTimeout(a.s),a.s=null)}function Qo(a){if(!Am(a.h)&&!a.s){a.s=!0;var l=a.Ga;Xi||tm(),Zi||(Xi(),Zi=!0),Lu.add(l,a),a.B=0}}function AA(a,l){return bm(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=l.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=ss(y(a.Ga,a,l),Qm(a,a.B)),a.B++,!0)}r.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let b=new fn(this,this.j,a),C=this.o;if(this.S&&(C?(C=_(C),E(C,this.S)):C=this.S),this.m!==null||this.O||(b.H=C,C=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Wm(this,b,l),d=jt(this.I),de(d,"RID",a),de(d,"CVER",22),this.D&&de(d,"X-HTTP-Session-Id",this.D),ms(this,d),C&&(this.O?l="headers="+encodeURIComponent(String(Lm(C)))+"&"+l:this.m&&nl(d,this.m,C)),tl(this.h,b),this.Ua&&de(d,"TYPE","init"),this.P?(de(d,"$req",l),de(d,"SID","null"),b.T=!0,Ju(b,d,null)):Ju(b,d,l),this.G=2}}else this.G==3&&(a?zm(this,a):this.i.length==0||Am(this.h)||zm(this))};function zm(a,l){var d;l?d=l.l:d=a.U++;let m=jt(a.I);de(m,"SID",a.K),de(m,"RID",d),de(m,"AID",a.T),ms(a,m),a.m&&a.o&&nl(m,a.m,a.o),d=new fn(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=Wm(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),tl(a.h,d),Ju(d,m,l)}function ms(a,l){a.H&&G(a.H,function(d,m){de(l,m,d)}),a.l&&Cm({},function(d,m){de(l,m,d)})}function Wm(a,l,d){d=Math.min(a.i.length,d);var m=a.l?y(a.l.Na,a.l,a):null;e:{var b=a.i;let C=-1;for(;;){let V=["count="+d];C==-1?0<d?(C=b[0].g,V.push("ofs="+C)):C=0:V.push("ofs="+C);let ue=!0;for(let ke=0;ke<d;ke++){let re=b[ke].g,Ue=b[ke].map;if(re-=C,0>re)C=Math.max(0,b[ke].g-100),ue=!1;else try{IA(Ue,V,"req"+re+"_")}catch{m&&m(Ue)}}if(ue){m=V.join("&");break e}}}return a=a.i.splice(0,d),l.D=a,m}function Gm(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;Xi||tm(),Zi||(Xi(),Zi=!0),Lu.add(l,a),a.v=0}}function il(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=ss(y(a.Fa,a),Qm(a,a.v)),a.v++,!0)}r.Fa=function(){if(this.u=null,Hm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=ss(y(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,We(10),Ko(this),Hm(this))};function sl(a){a.A!=null&&(c.clearTimeout(a.A),a.A=null)}function Hm(a){a.g=new fn(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var l=jt(a.qa);de(l,"RID","rpc"),de(l,"SID",a.K),de(l,"AID",a.T),de(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&de(l,"TO",a.ja),de(l,"TYPE","xmlhttp"),ms(a,l),a.m&&a.o&&nl(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=Wo(jt(l)),d.m=null,d.P=!0,Im(d,a)}r.Za=function(){this.C!=null&&(this.C=null,Ko(this),il(this),We(19))};function Yo(a){a.C!=null&&(c.clearTimeout(a.C),a.C=null)}function Km(a,l){var d=null;if(a.g==l){Yo(a),sl(a),a.g=null;var m=2}else if(el(a.h,l))d=l.D,Rm(a.h,l),m=1;else return;if(a.G!=0){if(l.o)if(m==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var b=a.B;m=Uo(),ze(m,new gm(m,d)),Qo(a)}else Gm(a);else if(b=l.s,b==3||b==0&&0<l.X||!(m==1&&AA(a,l)||m==2&&il(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),b){case 1:Hn(a,5);break;case 4:Hn(a,10);break;case 3:Hn(a,6);break;default:Hn(a,2)}}}function Qm(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function Hn(a,l){if(a.j.info("Error code "+l),l==2){var d=y(a.fb,a),m=a.Xa;let b=!m;m=new Gn(m||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||jo(m,"https"),Wo(m),b?_A(m.toString(),d):yA(m.toString(),d)}else We(2);a.G=0,a.l&&a.l.sa(l),Ym(a),jm(a)}r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),We(2)):(this.j.info("Failed to ping google.com"),We(1))};function Ym(a){if(a.G=0,a.ka=[],a.l){let l=Sm(a.h);(l.length!=0||a.i.length!=0)&&(k(a.ka,l),k(a.ka,a.i),a.h.i.length=0,N(a.i),a.i.length=0),a.l.ra()}}function Jm(a,l,d){var m=d instanceof Gn?jt(d):new Gn(d);if(m.g!="")l&&(m.g=l+"."+m.g),zo(m,m.s);else{var b=c.location;m=b.protocol,l=l?l+"."+b.hostname:b.hostname,b=+b.port;var C=new Gn(null);m&&jo(C,m),l&&(C.g=l),b&&zo(C,b),d&&(C.l=d),m=C}return d=a.D,l=a.ya,d&&l&&de(m,d,l),de(m,"VER",a.la),ms(a,m),m}function Xm(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Ca&&!a.pa?new me(new hs({eb:d})):new me(a.pa),l.Ha(a.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Zm(){}r=Zm.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Jo(){}Jo.prototype.g=function(a,l){return new Ze(a,l)};function Ze(a,l){Fe.call(this),this.g=new qm(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!U(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!U(l)&&(this.g.D=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new Ur(this)}D(Ze,Fe),Ze.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ze.prototype.close=function(){rl(this.g)},Ze.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=Wu(a),a=d);l.i.push(new aA(l.Ya++,a)),l.G==3&&Qo(l)},Ze.prototype.N=function(){this.g.l=null,delete this.j,rl(this.g),delete this.g,Ze.aa.N.call(this)};function eg(a){Hu.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(let d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}D(eg,Hu);function tg(){Ku.call(this),this.status=1}D(tg,Ku);function Ur(a){this.g=a}D(Ur,Zm),Ur.prototype.ua=function(){ze(this.g,"a")},Ur.prototype.ta=function(a){ze(this.g,new eg(a))},Ur.prototype.sa=function(a){ze(this.g,new tg)},Ur.prototype.ra=function(){ze(this.g,"b")},Jo.prototype.createWebChannel=Jo.prototype.g,Ze.prototype.send=Ze.prototype.o,Ze.prototype.open=Ze.prototype.m,Ze.prototype.close=Ze.prototype.close,Uh=on.createWebChannelTransport=function(){return new Jo},Fh=on.getStatEventTarget=function(){return Uo()},Mh=on.Event=zn,qa=on.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Bo.NO_ERROR=0,Bo.TIMEOUT=8,Bo.HTTP_ERROR=6,Ls=on.ErrorCode=Bo,_m.COMPLETE="complete",Lh=on.EventType=_m,dm.EventType=rs,rs.OPEN="a",rs.CLOSE="b",rs.ERROR="c",rs.MESSAGE="d",Fe.prototype.listen=Fe.prototype.K,Xr=on.WebChannel=dm,mC=on.FetchXmlHttpFactory=hs,me.prototype.listenOnce=me.prototype.L,me.prototype.getLastError=me.prototype.Ka,me.prototype.getLastErrorCode=me.prototype.Ba,me.prototype.getStatus=me.prototype.Z,me.prototype.getResponseJson=me.prototype.Oa,me.prototype.getResponseText=me.prototype.oa,me.prototype.send=me.prototype.ea,me.prototype.setWithCredentials=me.prototype.Ha,Vh=on.XhrIo=me}).apply(typeof $a<"u"?$a:typeof self<"u"?self:typeof window<"u"?window:{})});function si(){return Ir.logLevel}function O(r,...e){if(Ir.logLevel<=Z.DEBUG){let t=e.map(jf);Ir.debug(`Firestore (${Fi}): ${r}`,...t)}}function He(r,...e){if(Ir.logLevel<=Z.ERROR){let t=e.map(jf);Ir.error(`Firestore (${Fi}): ${r}`,...t)}}function mi(r,...e){if(Ir.logLevel<=Z.WARN){let t=e.map(jf);Ir.warn(`Firestore (${Fi}): ${r}`,...t)}}function jf(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}function F(r,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,uI(r,n,t)}function uI(r,e,t){let n=`FIRESTORE (${Fi}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw He(n),new Error(n)}function B(r,e,t,n){let i="Unexpected state";typeof t=="string"?i=t:n=t,r||uI(e,i,n)}function Q(r,e){return r}function gC(r){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}function lI(){return new TextEncoder}function H(r,e){return r<e?-1:r>e?1:0}function Xh(r,e){let t=0;for(;t<r.length&&t<e.length;){let n=r.codePointAt(t),i=e.codePointAt(t);if(n!==i){if(n<128&&i<128)return H(n,i);{let s=lI(),o=_C(s.encode(Jy(r,t)),s.encode(Jy(e,t)));return o!==0?o:H(n,i)}}t+=n>65535?2:1}return H(r.length,e.length)}function Jy(r,e){return r.codePointAt(e)>65535?r.substring(e,e+2):r.substring(e,e+1)}function _C(r,e){for(let t=0;t<r.length&&t<e.length;++t)if(r[t]!==e[t])return H(r[t],e[t]);return H(r.length,e.length)}function gi(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function hI(r){return r+"\0"}function Zh(r){return r.fields.find(e=>e.kind===2)}function ar(r){return r.fields.filter(e=>e.kind!==2)}function vC(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=z.fromTimestamp(n===1e9?new J(t+1,0):new J(t,n));return new lt(i,L.empty(),e)}function dI(r){return new lt(r.readTime,r.key,Hs)}function zf(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(r.documentKey,e.documentKey),t!==0?t:H(r.largestBatchId,e.largestBatchId))}function Pr(r){return p(this,null,function*(){if(r.code!==P.FAILED_PRECONDITION||r.message!==fI)throw r;O("LocalStore","Unexpectedly lost primary lease")})}function pI(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function qn(r){return r.name==="IndexedDbTransactionError"}function ur(r){return new S((e,t)=>{r.onsuccess=n=>{let i=n.target.result;e(i)},r.onerror=n=>{let i=Wf(n.target.error);t(i)}})}function Wf(r){let e=yi.M(_e());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return tv||(tv=!0,setTimeout(()=>{throw n},0)),n}}return r}function ou(r){return r==null}function Qs(r){return r===0&&1/r==-1/0}function IC(r){return typeof r=="number"&&Number.isInteger(r)&&!Qs(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function qe(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=nv(e)),e=wC(r.get(t),e);return nv(e)}function wC(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case ac:t+="";break;default:t+=s}}return t}function nv(r){return r+ac+""}function Ot(r){let e=r.length;if(B(e>=2,64408,{path:r}),e===2)return B(r.charAt(0)===ac&&r.charAt(1)==="",56145,{path:r}),se.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let o=r.indexOf(ac,s);switch((o<0||o>t)&&F(50515,{path:r}),r.charAt(o+1)){case"":let c=r.substring(s,o),u;i.length===0?u=c:(i+=c,u=i,i=""),n.push(u);break;case"":i+=r.substring(s,o),i+="\0";break;case"":i+=r.substring(s,o+1);break;default:F(61167,{path:r})}s=o+2}return new se(n)}function Ka(r,e){return[r,qe(e)]}function mI(r,e,t){return[r,qe(e),t]}function be(r,e){let t=Q(r);return yi.N(t.he,e)}function sv(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function jn(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function AI(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function ei(r){return r.hasNext()?r.getNext():void 0}function cn(r){if(B(!!r,39018),typeof r=="string"){let e=0,t=HC.exec(r);if(B(!!t,46558,{timestamp:r}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:fe(r.seconds),nanos:fe(r.nanos)}}function fe(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function un(r){return typeof r=="string"?Ae.fromBase64String(r):Ae.fromUint8Array(r)}function lu(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{})[RI])===null||t===void 0?void 0:t.stringValue)===bI}function hu(r){let e=r.mapValue.fields[SI];return lu(e)?hu(e):e}function eo(r){let e=cn(r.mapValue.fields[CI].timestampValue);return new J(e.seconds,e.nanos)}function xn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?lu(r)?4:kI(r)?9007199254740991:du(r)?10:11:F(28295,{value:r})}function Lt(r,e){if(r===e)return!0;let t=xn(r);if(t!==xn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return eo(r).isEqual(eo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=cn(i.timestampValue),c=cn(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return un(i.bytesValue).isEqual(un(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return fe(i.geoPointValue.latitude)===fe(s.geoPointValue.latitude)&&fe(i.geoPointValue.longitude)===fe(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return fe(i.integerValue)===fe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=fe(i.doubleValue),c=fe(s.doubleValue);return o===c?Qs(o)===Qs(c):isNaN(o)&&isNaN(c)}return!1}(r,e);case 9:return gi(r.arrayValue.values||[],e.arrayValue.values||[],Lt);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(sv(o)!==sv(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!Lt(o[u],c[u])))return!1;return!0}(r,e);default:return F(52216,{left:r})}}function no(r,e){return(r.values||[]).find(t=>Lt(t,e))!==void 0}function Vn(r,e){if(r===e)return 0;let t=xn(r),n=xn(e);if(t!==n)return H(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return H(r.booleanValue,e.booleanValue);case 2:return function(s,o){let c=fe(s.integerValue||s.doubleValue),u=fe(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(r,e);case 3:return ov(r.timestampValue,e.timestampValue);case 4:return ov(eo(r),eo(e));case 5:return Xh(r.stringValue,e.stringValue);case 6:return function(s,o){let c=un(s),u=un(o);return c.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(s,o){let c=s.split("/"),u=o.split("/");for(let h=0;h<c.length&&h<u.length;h++){let f=H(c[h],u[h]);if(f!==0)return f}return H(c.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,o){let c=H(fe(s.latitude),fe(o.latitude));return c!==0?c:H(fe(s.longitude),fe(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return av(r.arrayValue,e.arrayValue);case 10:return function(s,o){var c,u,h,f;let g=s.fields||{},y=o.fields||{},T=(c=g[Ai])===null||c===void 0?void 0:c.arrayValue,D=(u=y[Ai])===null||u===void 0?void 0:u.arrayValue,N=H(((h=T==null?void 0:T.values)===null||h===void 0?void 0:h.length)||0,((f=D==null?void 0:D.values)===null||f===void 0?void 0:f.length)||0);return N!==0?N:av(T,D)}(r.mapValue,e.mapValue);case 11:return function(s,o){if(s===Nn.mapValue&&o===Nn.mapValue)return 0;if(s===Nn.mapValue)return 1;if(o===Nn.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),h=o.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let g=0;g<u.length&&g<f.length;++g){let y=Xh(u[g],f[g]);if(y!==0)return y;let T=Vn(c[u[g]],h[f[g]]);if(T!==0)return T}return H(u.length,f.length)}(r.mapValue,e.mapValue);default:throw F(23264,{Pe:t})}}function ov(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return H(r,e);let t=cn(r),n=cn(e),i=H(t.seconds,n.seconds);return i!==0?i:H(t.nanos,n.nanos)}function av(r,e){let t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){let s=Vn(t[i],n[i]);if(s)return s}return H(t.length,n.length)}function bi(r){return cd(r)}function cd(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){let n=cn(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return un(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return L.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=cd(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of n)s?s=!1:i+=",",i+=`${o}:${cd(t.fields[o])}`;return i+"}"}(r.mapValue):F(61005,{value:r})}function Ja(r){switch(xn(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=hu(r);return e?16+Ja(e):16;case 5:return 2*r.stringValue.length;case 6:return un(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,s)=>i+Ja(s),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return jn(n.fields,(s,o)=>{i+=s.length+Ja(o)}),i}(r.mapValue);default:throw F(13486,{value:r})}}function wr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function ud(r){return!!r&&"integerValue"in r}function ro(r){return!!r&&"arrayValue"in r}function cv(r){return!!r&&"nullValue"in r}function uv(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Xa(r){return!!r&&"mapValue"in r}function du(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{})[Yf])===null||t===void 0?void 0:t.stringValue)===Jf}function zs(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return jn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=zs(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=zs(r.arrayValue.values[t]);return e}return Object.assign({},r)}function kI(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===PI}function KC(r){return"nullValue"in r?Ya:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?wr(Ti.empty(),L.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?du(r)?DI:{mapValue:{}}:F(35942,{value:r})}function QC(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?wr(Ti.empty(),L.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?DI:"mapValue"in r?du(r)?{mapValue:{}}:Nn:F(61959,{value:r})}function lv(r,e){let t=Vn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function hv(r,e){let t=Vn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}function NI(r){let e=[];return jn(r.fields,(t,n)=>{let i=new Te([t]);if(Xa(n)){let s=NI(n.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new nt(e)}function dv(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],o=r.position[i];if(s.field.isKeyField()?n=L.comparator(L.fromName(o.referenceValue),t.key):n=Vn(o,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function fv(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Lt(r.position[t],e.position[t]))return!1;return!0}function YC(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}function Ri(r){return r.op==="and"}function ld(r){return r.op==="or"}function Xf(r){return OI(r)&&Ri(r)}function OI(r){for(let e of r.filters)if(e instanceof oe)return!1;return!0}function hd(r){if(r instanceof ee)return r.field.canonicalString()+r.op.toString()+bi(r.value);if(Xf(r))return r.filters.map(e=>hd(e)).join(",");{let e=r.filters.map(t=>hd(t)).join(",");return`${r.op}(${e})`}}function xI(r,e){return r instanceof ee?function(n,i){return i instanceof ee&&n.op===i.op&&n.field.isEqual(i.field)&&Lt(n.value,i.value)}(r,e):r instanceof oe?function(n,i){return i instanceof oe&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,o,c)=>s&&xI(o,i.filters[c]),!0):!1}(r,e):void F(19439)}function VI(r,e){let t=r.filters.concat(e);return oe.create(t,r.op)}function LI(r){return r instanceof ee?function(t){return`${t.field.canonicalString()} ${t.op} ${bi(t.value)}`}(r):r instanceof oe?function(t){return t.op.toString()+" {"+t.getFilters().map(LI).join(" ,")+"}"}(r):"Filter"}function MI(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>L.fromName(n.referenceValue))}function vd(r,e=null,t=[],n=[],i=null,s=null,o=null){return new yd(r,e,t,n,i,s,o)}function Tr(r){let e=Q(r);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>hd(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),ou(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>bi(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>bi(n)).join(",")),e.Ie=t}return e.Ie}function wo(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!YC(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!xI(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!fv(r.startAt,e.startAt)&&fv(r.endAt,e.endAt)}function gc(r){return L.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function _c(r,e){return r.filters.filter(t=>t instanceof ee&&t.field.isEqual(e))}function pv(r,e,t){let n=Ya,i=!0;for(let s of _c(r,e)){let o=Ya,c=!0;switch(s.op){case"<":case"<=":o=KC(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=Ya}lv({value:n,inclusive:i},{value:o,inclusive:c})<0&&(n=o,i=c)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];lv({value:n,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}function mv(r,e,t){let n=Nn,i=!0;for(let s of _c(r,e)){let o=Nn,c=!0;switch(s.op){case">=":case">":o=QC(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=Nn}hv({value:n,inclusive:i},{value:o,inclusive:c})>0&&(n=o,i=c)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];hv({value:n,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}function JC(r,e,t,n,i,s,o,c){return new Ft(r,e,t,n,i,s,o,c)}function Eo(r){return new Ft(r)}function gv(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Zf(r){return r.collectionGroup!==null}function di(r){let e=Q(r);if(e.Ee===null){e.Ee=[];let t=new Set;for(let s of e.explicitOrderBy)e.Ee.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new ce(Te.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ee.push(new Er(s,n))}),t.has(Te.keyField().canonicalString())||e.Ee.push(new Er(Te.keyField(),n))}return e.Ee}function ut(r){let e=Q(r);return e.de||(e.de=XC(e,di(r))),e.de}function XC(r,e){if(r.limitType==="F")return vd(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Er(i.field,s)});let t=r.endAt?new Mt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Mt(r.startAt.position,r.startAt.inclusive):null;return vd(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function Id(r,e){let t=r.filters.concat([e]);return new Ft(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function yc(r,e,t){return new Ft(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function fu(r,e){return wo(ut(r),ut(e))&&r.limitType===e.limitType}function FI(r){return`${Tr(ut(r))}|lt:${r.limitType}`}function oi(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>LI(i)).join(", ")}]`),ou(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>bi(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>bi(i)).join(",")),`Target(${n})`}(ut(r))}; limitType=${r.limitType})`}function To(r,e){return e.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):L.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(let s of di(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(o,c,u){let h=dv(o,c,u);return o.inclusive?h<=0:h<0}(n.startAt,di(n),i)||n.endAt&&!function(o,c,u){let h=dv(o,c,u);return o.inclusive?h>=0:h>0}(n.endAt,di(n),i))}(r,e)}function ZC(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function UI(r){return(e,t)=>{let n=!1;for(let i of di(r)){let s=eP(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function eP(r,e,t){let n=r.field.isKeyField()?L.comparator(e.key,t.key):function(s,o,c){let u=o.data.field(s),h=c.data.field(s);return u!==null&&h!==null?Vn(u,h):F(42886)}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return F(19790,{direction:r.dir})}}function rt(){return tP}function $s(...r){let e=BI;for(let t of r)e=e.insert(t.key,t);return e}function $I(r){let e=BI;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function xt(){return Ws()}function qI(){return Ws()}function Ws(){return new It(r=>r.toString(),(r,e)=>r.isEqual(e))}function Y(...r){let e=rP;for(let t of r)e=e.add(t);return e}function sP(){return iP}function ep(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qs(e)?"-0":e}}function jI(r){return{integerValue:""+r}}function oP(r,e){return IC(e)?jI(e):ep(r,e)}function aP(r,e,t){return r instanceof Ln?function(i,s){let o={fields:{[RI]:{stringValue:bI},[CI]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&lu(s)&&(s=hu(s)),s&&(o.fields[SI]=s),{mapValue:o}}(t,e):r instanceof Mn?WI(r,e):r instanceof Fn?GI(r,e):function(i,s){let o=zI(i,s),c=_v(o)+_v(i.Re);return ud(o)&&ud(i.Re)?jI(c):ep(i.serializer,c)}(r,e)}function cP(r,e,t){return r instanceof Mn?WI(r,e):r instanceof Fn?GI(r,e):t}function zI(r,e){return r instanceof Ar?function(n){return ud(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}function WI(r,e){let t=HI(e);for(let n of r.elements)t.some(i=>Lt(i,n))||t.push(n);return{arrayValue:{values:t}}}function GI(r,e){let t=HI(e);for(let n of r.elements)t=t.filter(i=>!Lt(i,n));return{arrayValue:{values:t}}}function _v(r){return fe(r.integerValue||r.doubleValue)}function HI(r){return ro(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function uP(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof Mn&&i instanceof Mn||n instanceof Fn&&i instanceof Fn?gi(n.elements,i.elements,Lt):n instanceof Ar&&i instanceof Ar?Lt(n.Re,i.Re):n instanceof Ln&&i instanceof Ln}(r.transform,e.transform)}function Za(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}function KI(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Pi(r.key,Je.none()):new Un(r.key,r.data,Je.none());{let t=r.data,n=Ke.empty(),i=new ce(Te.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?n.delete(s):n.set(s,o),i=i.add(s)}return new wt(r.key,n,new nt(i.toArray()),Je.none())}}function lP(r,e,t){r instanceof Un?function(i,s,o){let c=i.value.clone(),u=vv(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(r,e,t):r instanceof wt?function(i,s,o){if(!Za(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=vv(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(QI(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Gs(r,e,t,n){return r instanceof Un?function(s,o,c,u){if(!Za(s.precondition,o))return c;let h=s.value.clone(),f=Iv(s.fieldTransforms,u,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof wt?function(s,o,c,u){if(!Za(s.precondition,o))return c;let h=Iv(s.fieldTransforms,u,o),f=o.data;return f.setAll(QI(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,e,t,n):function(s,o,c){return Za(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(r,e,t)}function hP(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=zI(n.transform,i||null);s!=null&&(t===null&&(t=Ke.empty()),t.set(n.field,s))}return t||null}function yv(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&gi(n,i,(s,o)=>uP(s,o))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}function QI(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function vv(r,e,t){let n=new Map;B(r.length===t.length,32656,{Ve:t.length,me:r.length});for(let i=0;i<t.length;i++){let s=r[i],o=s.transform,c=e.data.field(s.field);n.set(s.field,cP(o,c,t[i]))}return n}function Iv(r,e,t){let n=new Map;for(let i of r){let s=i.transform,o=t.data.field(i.field);n.set(i.field,aP(s,o,e))}return n}function dP(r){switch(r){case P.OK:return F(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return F(15467,{code:r})}}function YI(r){if(r===void 0)return He("GRPC error has no .code"),P.UNKNOWN;switch(r){case Ie.OK:return P.OK;case Ie.CANCELLED:return P.CANCELLED;case Ie.UNKNOWN:return P.UNKNOWN;case Ie.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Ie.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Ie.INTERNAL:return P.INTERNAL;case Ie.UNAVAILABLE:return P.UNAVAILABLE;case Ie.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Ie.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Ie.NOT_FOUND:return P.NOT_FOUND;case Ie.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Ie.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Ie.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Ie.ABORTED:return P.ABORTED;case Ie.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Ie.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Ie.DATA_LOSS:return P.DATA_LOSS;default:return F(39323,{code:r})}}function Ev(r){let e=lI().encode(r),t=new xh;return t.update(e),new Uint8Array(t.digest())}function Tv(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new sn([t,n],0),new sn([i,s],0)]}function ja(){return new pe(L.comparator)}function Av(){return new pe(L.comparator)}function Sd(r,e){return r.useProto3Json||ou(e)?e:{value:e}}function ki(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function JI(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function _P(r,e){return ki(r,e.toTimestamp())}function Qe(r){return B(!!r,49232),z.fromTimestamp(function(t){let n=cn(t);return new J(n.seconds,n.nanos)}(r))}function tp(r,e){return Cd(r,e).canonicalString()}function Cd(r,e){let t=function(i){return new se(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function XI(r){let e=se.fromString(r);return B(aw(e),10190,{key:e.toString()}),e}function bc(r,e){return tp(r.databaseId,e.path)}function vr(r,e){let t=XI(e);if(t.get(1)!==r.databaseId.projectId)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new L(tw(t))}function ZI(r,e){return tp(r.databaseId,e)}function ew(r){let e=XI(r);return e.length===4?se.emptyPath():tw(e)}function Pd(r){return new se(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function tw(r){return B(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function bv(r,e,t){return{name:bc(r,e),fields:t.value.mapValue.fields}}function yP(r,e,t){let n=vr(r,e.name),i=Qe(e.updateTime),s=e.createTime?Qe(e.createTime):z.min(),o=new Ke({mapValue:{fields:e.fields}}),c=xe.newFoundDocument(n,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function vP(r,e){let t;if("targetChange"in e){e.targetChange;let n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:F(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(B(f===void 0||typeof f=="string",58123),Ae.fromBase64String(f||"")):(B(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ae.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(h){let f=h.code===void 0?P.UNKNOWN:YI(h.code);return new x(f,h.message||"")}(o);t=new Tc(n,i,s,c||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=vr(r,n.document.name),s=Qe(n.document.updateTime),o=n.document.createTime?Qe(n.document.createTime):z.min(),c=new Ke({mapValue:{fields:n.document.fields}}),u=xe.newFoundDocument(i,s,o,c),h=n.targetIds||[],f=n.removedTargetIds||[];t=new fi(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=vr(r,n.document),s=n.readTime?Qe(n.readTime):z.min(),o=xe.newNoDocument(i,s),c=n.removedTargetIds||[];t=new fi([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=vr(r,n.document),s=n.removedTargetIds||[];t=new fi([],s,i,null)}else{if(!("filter"in e))return F(11601,{Vt:e});{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,o=new Td(i,s),c=n.targetId;t=new Ec(c,o)}}return t}function Rc(r,e){let t;if(e instanceof Un)t={update:bv(r,e.key,e.value)};else if(e instanceof Pi)t={delete:bc(r,e.key)};else if(e instanceof wt)t={update:bv(r,e.key,e.data),updateMask:bP(e.fieldMask)};else{if(!(e instanceof Ic))return F(16599,{ft:e.type});t={verify:bc(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){let c=o.transform;if(c instanceof Ln)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Mn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Fn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Ar)return{fieldPath:o.field.canonicalString(),increment:c.Re};throw F(20930,{transform:o.transform})}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:_P(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:F(27497)}(r,e.precondition)),t}function kd(r,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Je.updateTime(Qe(s.updateTime)):s.exists!==void 0?Je.exists(s.exists):Je.none()}(e.currentDocument):Je.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(o,c){let u=null;if("setToServerValue"in c)B(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),u=new Ln;else if("appendMissingElements"in c){let f=c.appendMissingElements.values||[];u=new Mn(f)}else if("removeAllFromArray"in c){let f=c.removeAllFromArray.values||[];u=new Fn(f)}else"increment"in c?u=new Ar(o,c.increment):F(16584,{proto:c});let h=Te.fromServerFormat(c.fieldPath);return new vc(h,u)}(r,i)):[];if(e.update){e.update.name;let i=vr(r,e.update.name),s=new Ke({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let h=u.fieldPaths||[];return new nt(h.map(f=>Te.fromServerFormat(f)))}(e.updateMask);return new wt(i,s,o,t,n)}return new Un(i,s,t,n)}if(e.delete){let i=vr(r,e.delete);return new Pi(i,t)}if(e.verify){let i=vr(r,e.verify);return new Ic(i,t)}return F(1463,{proto:e})}function IP(r,e){return r&&r.length>0?(B(e!==void 0,14353),r.map(t=>function(i,s){let o=i.updateTime?Qe(i.updateTime):Qe(s);return o.isEqual(z.min())&&(o=Qe(s)),new wd(o,i.transformResults||[])}(t,e))):[]}function nw(r,e){return{documents:[ZI(r,e.path)]}}function rw(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=ZI(r,i);let s=function(h){if(h.length!==0)return ow(oe.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(f=>function(y){return{field:ai(y.field),direction:EP(y.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=Sd(r,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{gt:t,parent:i}}function iw(r){let e=ew(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){B(n===1,65062);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(g){let y=sw(g);return y instanceof oe&&Xf(y)?y.getFilters():[y]}(t.where));let o=[];t.orderBy&&(o=function(g){return g.map(y=>function(D){return new Er(ci(D.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(D.direction))}(y))}(t.orderBy));let c=null;t.limit&&(c=function(g){let y;return y=typeof g=="object"?g.value:g,ou(y)?null:y}(t.limit));let u=null;t.startAt&&(u=function(g){let y=!!g.before,T=g.values||[];return new Mt(T,y)}(t.startAt));let h=null;return t.endAt&&(h=function(g){let y=!g.before,T=g.values||[];return new Mt(T,y)}(t.endAt)),JC(e,i,o,s,c,"F",u,h)}function wP(r,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function sw(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=ci(t.unaryFilter.field);return ee.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=ci(t.unaryFilter.field);return ee.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ci(t.unaryFilter.field);return ee.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ci(t.unaryFilter.field);return ee.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}}(r):r.fieldFilter!==void 0?function(t){return ee.create(ci(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return oe.create(t.compositeFilter.filters.map(n=>sw(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return F(1026)}}(t.compositeFilter.op))}(r):F(30097,{filter:r})}function EP(r){return pP[r]}function TP(r){return mP[r]}function AP(r){return gP[r]}function ai(r){return{fieldPath:r.canonicalString()}}function ci(r){return Te.fromServerFormat(r.fieldPath)}function ow(r){return r instanceof ee?function(t){if(t.op==="=="){if(uv(t.value))return{unaryFilter:{field:ai(t.field),op:"IS_NAN"}};if(cv(t.value))return{unaryFilter:{field:ai(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(uv(t.value))return{unaryFilter:{field:ai(t.field),op:"IS_NOT_NAN"}};if(cv(t.value))return{unaryFilter:{field:ai(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ai(t.field),op:TP(t.op),value:t.value}}}(r):r instanceof oe?function(t){let n=t.getFilters().map(i=>ow(i));return n.length===1?n[0]:{compositeFilter:{op:AP(t.op),filters:n}}}(r):F(54877,{filter:r})}function bP(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function aw(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}function RP(r,e){let t;if(e.document)t=yP(r.wt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=L.fromSegments(e.noDocument.path),i=Rr(e.noDocument.readTime);t=xe.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return F(56709);{let n=L.fromSegments(e.unknownDocument.path),i=Rr(e.unknownDocument.version);t=xe.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){let s=new J(i[0],i[1]);return z.fromTimestamp(s)}(e.readTime)),t}function Rv(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Cc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,o){return{name:bc(s,o.key),fields:o.data.value.mapValue.fields,updateTime:ki(s,o.version.toTimestamp()),createTime:ki(s,o.createTime.toTimestamp())}}(r.wt,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:br(e.version)};else{if(!e.isUnknownDocument())return F(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:br(e.version)}}return n}function Cc(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function br(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Rr(r){let e=new J(r.seconds,r.nanoseconds);return z.fromTimestamp(e)}function lr(r,e){let t=(e.baseMutations||[]).map(s=>kd(r.wt,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>kd(r.wt,s)),i=J.fromMillis(e.localWriteTimeMs);return new io(e.batchId,i,t,n)}function qs(r){let e=Rr(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?Rr(r.lastLimboFreeSnapshotVersion):z.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){let o=s.documents.length;return B(o===1,1966,{count:o}),ut(Eo(ew(s.documents[0])))}(r.query):function(s){return ut(iw(s))}(r.query),new Di(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Ae.fromBase64String(r.resumeToken))}function cw(r,e){let t=br(e.snapshotVersion),n=br(e.lastLimboFreeSnapshotVersion),i;i=gc(e.target)?nw(r.wt,e.target):rw(r.wt,e.target).gt;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Tr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function uw(r){let e=iw({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?yc(e,e.limit,"L"):e}function Bh(r,e){return new so(e.largestBatchId,kd(r.wt,e.overlayMutation))}function Sv(r,e){let t=e.path.lastSegment();return[r,qe(e.path.popLast()),t]}function Cv(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:br(n.readTime),documentKey:qe(n.documentKey.path),largestBatchId:n.largestBatchId}}function Pv(r){return be(r,au)}function kv(r){return be(r,cu)}function Ms(r){return be(r,uu)}function SP(r){if(r===0)return 8;let e=0;return r>>4||(e+=4,r<<=4),r>>6||(e+=2,r<<=2),r>>7||(e+=1),e}function Dv(r){let e=64-function(n){let i=0;for(let s=0;s<8;++s){let o=SP(255&n[s]);if(i+=o,o!==8)break}return i}(r);return Math.ceil(e/8)}function Cn(r,e){let t=r.indexId-e.indexId;return t!==0?t:(t=Nv(r.arrayValue,e.arrayValue),t!==0?t:(t=Nv(r.directionalValue,e.directionalValue),t!==0?t:L.comparator(r.documentKey,e.documentKey)))}function Nv(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}function lw(r){var e,t;if(B(r instanceof ee||r instanceof oe,20012),r instanceof ee){if(r instanceof mc){let i=((t=(e=r.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ee.create(r.field,"==",s)))||[];return oe.create(i,"or")}return r}let n=r.filters.map(i=>lw(i));return oe.create(n,r.op)}function CP(r){if(r.getFilters().length===0)return[];let e=Fd(lw(r));return B(hw(e),7391),Ld(e)||Md(e)?[e]:e.getFilters()}function Ld(r){return r instanceof ee}function Md(r){return r instanceof oe&&Xf(r)}function hw(r){return Ld(r)||Md(r)||function(t){if(t instanceof oe&&ld(t)){for(let n of t.getFilters())if(!Ld(n)&&!Md(n))return!1;return!0}return!1}(r)}function Fd(r){if(B(r instanceof ee||r instanceof oe,34018),r instanceof ee)return r;if(r.filters.length===1)return Fd(r.filters[0]);let e=r.filters.map(n=>Fd(n)),t=oe.create(e,r.op);return t=Dc(t),hw(t)?t:(B(t instanceof oe,64498),B(Ri(t),40251),B(t.filters.length>1,57927),t.filters.reduce((n,i)=>np(n,i)))}function np(r,e){let t;return B(r instanceof ee||r instanceof oe,38388),B(e instanceof ee||e instanceof oe,25473),t=r instanceof ee?e instanceof ee?function(i,s){return oe.create([i,s],"and")}(r,e):Ov(r,e):e instanceof ee?Ov(e,r):function(i,s){if(B(i.filters.length>0&&s.filters.length>0,48005),Ri(i)&&Ri(s))return VI(i,s.getFilters());let o=ld(i)?i:s,c=ld(i)?s:i,u=o.filters.map(h=>np(h,c));return oe.create(u,"or")}(r,e),Dc(t)}function Ov(r,e){if(Ri(e))return VI(e,r.getFilters());{let t=e.filters.map(n=>np(r,n));return oe.create(t,"or")}}function Dc(r){if(B(r instanceof ee||r instanceof oe,11850),r instanceof ee)return r;let e=r.getFilters();if(e.length===1)return Dc(e[0]);if(OI(r))return r;let t=e.map(i=>Dc(i)),n=[];return t.forEach(i=>{i instanceof ee?n.push(i):i instanceof oe&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:oe.create(n,r.op)}function Vv(r){return be(r,Xs)}function ni(r){return be(r,hc)}function Fs(r){return be(r,Hf)}function ri(r){return be(r,lc)}function Lv(r){B(r.length!==0,28825);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;zf(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new lt(e.readTime,e.documentKey,t)}function fw(r,e,t){let n=r.store(yt),i=r.store(vi),s=[],o=IDBKeyRange.only(t.batchId),c=0,u=n.te({range:o},(f,g,y)=>(c++,y.delete()));s.push(u.next(()=>{B(c===1,47070,{batchId:t.batchId})}));let h=[];for(let f of t.mutations){let g=mI(e,f.key.path,t.batchId);s.push(i.delete(g)),h.push(f.key)}return S.waitFor(s).next(()=>h)}function Nc(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw F(14731);e=r.noDocument}return JSON.stringify(e).length}function pw(r,e,t){let n=Ka(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n),o=!1;return ui(r).te({range:s,ee:!0},(c,u,h)=>{let[f,g,y]=c;f===e&&g===i&&(o=!0),h.done()}).next(()=>o)}function Pn(r){return be(r,yt)}function ui(r){return be(r,vi)}function mw(r){return be(r,Ys)}function ii(r){return be(r,Ii)}function Fv(r){return be(r,yr)}function Dn(r){return be(r,wi)}function Bv([r,e],[t,n]){let i=H(r,t);return i===0?H(e,n):i}function _w(r,e){return new jd(r,e)}function Wa(r,e){return Dn(r).put(function(n,i){return{targetId:0,path:qe(n.path),sequenceNumber:i}}(e,r.currentSequenceNumber))}function yw(r){return new Wd(r)}function $v(r){return be(r,Js)}function or(r){return be(r,cc)}function Us(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function qv(r,e){let t=e.documentKey.path.toArray();return[r,Cc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function jv(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=H(t[s],n[s]),i)return i;return i=H(t.length,n.length),i||(i=H(t[t.length-2],n[n.length-2]),i||H(t[t.length-1],n[n.length-1]))}function zv(r){r.createObjectStore(wi,{keyPath:CC}).createIndex(Gf,PC,{unique:!0}),r.createObjectStore(Ii,{keyPath:"targetId"}).createIndex(_I,SC,{unique:!0}),r.createObjectStore(yr)}function Bs(r){return be(r,Io)}function Ga(r){return be(r,Ei)}function kP(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}function vw(r,e,t,n){return new af(r,e,t,n)}function Iw(r,e){return p(this,null,function*(){let t=Q(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.Fs(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let o=[],c=[],u=Y();for(let h of i){o.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}for(let h of s){c.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(n,u).next(h=>({Ms:h,removedBatchIds:o,addedBatchIds:c}))})})})}function NP(r,e){let t=Q(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.Cs.newChangeBuffer({trackRemovals:!0});return function(c,u,h,f){let g=h.batch,y=g.keys(),T=S.resolve();return y.forEach(D=>{T=T.next(()=>f.getEntry(u,D)).next(N=>{let k=h.docVersions.get(D);B(k!==null,48541),N.version.compareTo(k)<0&&(g.applyToRemoteDocument(N,h),N.isValidDocument()&&(N.setReadTime(h.commitVersion),f.addEntry(N)))})}),T.next(()=>c.mutationQueue.removeMutationBatch(u,g))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let u=Y();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(u=u.add(c.batch.mutations[h].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function ww(r){let e=Q(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.ai.getLastRemoteSnapshotVersion(t))}function OP(r,e){let t=Q(r),n=e.snapshotVersion,i=t.Ss;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.Cs.newChangeBuffer({trackRemovals:!0});i=t.Ss;let c=[];e.targetChanges.forEach((f,g)=>{let y=i.get(g);if(!y)return;c.push(t.ai.removeMatchingKeys(s,f.removedDocuments,g).next(()=>t.ai.addMatchingKeys(s,f.addedDocuments,g)));let T=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(g)!==null?T=T.withResumeToken(Ae.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):f.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(f.resumeToken,n)),i=i.insert(g,T),function(N,k,q){return N.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=DP?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(y,T,f)&&c.push(t.ai.updateTargetData(s,T))});let u=rt(),h=Y();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(xP(s,o,e.documentUpdates).next(f=>{u=f.xs,h=f.Os})),!n.isEqual(z.min())){let f=t.ai.getLastRemoteSnapshotVersion(s).next(g=>t.ai.setTargetsMetadata(s,s.currentSequenceNumber,n));c.push(f)}return S.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,h)).next(()=>u)}).then(s=>(t.Ss=i,s))}function xP(r,e,t){let n=Y(),i=Y();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let o=rt();return t.forEach((c,u)=>{let h=s.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(z.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):O(rp,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)}),{xs:o,Os:i}})}function VP(r,e){let t=Q(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=_r),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function LP(r,e){let t=Q(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.ai.getTargetData(n,e).next(s=>s?(i=s,S.resolve(i)):t.ai.allocateTargetId(n).next(o=>(i=new Di(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.ai.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.Ss.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ss=t.Ss.insert(n.targetId,n),t.Ds.set(e,n.targetId)),n})}function cf(r,e,t){return p(this,null,function*(){let n=Q(r),i=n.Ss.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,o=>n.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!qn(o))throw o;O(rp,`Failed to update sequence numbers for target ${e}: ${o}`)}n.Ss=n.Ss.remove(e),n.Ds.delete(i.target)})}function Wv(r,e,t){let n=Q(r),i=z.min(),s=Y();return n.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,f){let g=Q(u),y=g.Ds.get(f);return y!==void 0?S.resolve(g.Ss.get(y)):g.ai.getTargetData(h,f)}(n,o,ut(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,n.ai.getMatchingKeysForTargetId(o,c.targetId).next(u=>{s=u})}).next(()=>n.bs.getDocumentsMatchingQuery(o,e,t?i:z.min(),t?s:Y())).next(c=>(MP(n,ZC(e),c),{documents:c,Ns:s})))}function MP(r,e,t){let n=r.vs.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.vs.set(e,n)}function lf(){return Ha===null?Ha=function(){return 268435456+Math.round(2147483648*Math.random())}():Ha++,"0x"+Ha.toString(16)}function UP(){return typeof window<"u"?window:null}function ec(){return typeof document<"u"?document:null}function pu(r){return new Rd(r,!0)}function mu(r){return p(this,null,function*(){if(kr(r))for(let e of r.ua)yield e(!0)})}function Ao(r){return p(this,null,function*(){for(let e of r.ua)yield e(!1)})}function Ew(r,e){let t=Q(r);t._a.has(e.targetId)||(t._a.set(e.targetId,e),ap(t)?op(t):Ui(t).b_()&&sp(t,e))}function ip(r,e){let t=Q(r),n=Ui(t);t._a.delete(e),n.b_()&&Tw(t,e),t._a.size===0&&(n.b_()?n.v_():kr(t)&&t.la.set("Unknown"))}function sp(r,e){if(r.ha.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ui(r).U_(e)}function Tw(r,e){r.ha.Ke(e),Ui(r).K_(e)}function op(r){r.ha=new bd({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>r._a.get(e)||null,Pt:()=>r.datastore.serializer.databaseId}),Ui(r).start(),r.la.ta()}function ap(r){return kr(r)&&!Ui(r).w_()&&r._a.size>0}function kr(r){return Q(r).aa.size===0}function Aw(r){r.ha=void 0}function BP(r){return p(this,null,function*(){r.la.set("Online")})}function $P(r){return p(this,null,function*(){r._a.forEach((e,t)=>{sp(r,e)})})}function qP(r,e){return p(this,null,function*(){Aw(r),ap(r)?(r.la.ia(e),op(r)):r.la.set("Unknown")})}function jP(r,e,t){return p(this,null,function*(){if(r.la.set("Online"),e instanceof Tc&&e.state===2&&e.cause)try{yield function(i,s){return p(this,null,function*(){let o=s.cause;for(let c of s.targetIds)i._a.has(c)&&(yield i.remoteSyncer.rejectListen(c,o),i._a.delete(c),i.ha.removeTarget(c))})}(r,e)}catch(n){O(Sr,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Wc(r,n)}else if(e instanceof fi?r.ha.Xe(e):e instanceof Ec?r.ha.ot(e):r.ha.nt(e),!t.isEqual(z.min()))try{let n=yield ww(r.localStore);t.compareTo(n)>=0&&(yield function(s,o){let c=s.ha.It(o);return c.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let f=s._a.get(h);f&&s._a.set(h,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,h)=>{let f=s._a.get(u);if(!f)return;s._a.set(u,f.withResumeToken(Ae.EMPTY_BYTE_STRING,f.snapshotVersion)),Tw(s,u);let g=new Di(f.target,u,h,f.sequenceNumber);sp(s,g)}),s.remoteSyncer.applyRemoteEvent(c)}(r,t))}catch(n){O(Sr,"Failed to raise snapshot:",n),yield Wc(r,n)}})}function Wc(r,e,t){return p(this,null,function*(){if(!qn(e))throw e;r.aa.add(1),yield Ao(r),r.la.set("Offline"),t||(t=()=>ww(r.localStore)),r.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){O(Sr,"Retrying IndexedDB access"),yield t(),r.aa.delete(1),yield mu(r)}))})}function bw(r,e){return e().catch(t=>Wc(r,t,e))}function bo(r){return p(this,null,function*(){let e=Q(r),t=Bn(e),n=e.oa.length>0?e.oa[e.oa.length-1].batchId:_r;for(;zP(e);)try{let i=yield VP(e.localStore,n);if(i===null){e.oa.length===0&&t.v_();break}n=i.batchId,WP(e,i)}catch(i){yield Wc(e,i)}Rw(e)&&Sw(e)})}function zP(r){return kr(r)&&r.oa.length<10}function WP(r,e){r.oa.push(e);let t=Bn(r);t.b_()&&t.W_&&t.G_(e.mutations)}function Rw(r){return kr(r)&&!Bn(r).w_()&&r.oa.length>0}function Sw(r){Bn(r).start()}function GP(r){return p(this,null,function*(){Bn(r).H_()})}function HP(r){return p(this,null,function*(){let e=Bn(r);for(let t of r.oa)e.G_(t.mutations)})}function KP(r,e,t){return p(this,null,function*(){let n=r.oa.shift(),i=Ed.from(n,e,t);yield bw(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield bo(r)})}function QP(r,e){return p(this,null,function*(){e&&Bn(r).W_&&(yield function(n,i){return p(this,null,function*(){if(function(o){return dP(o)&&o!==P.ABORTED}(i.code)){let s=n.oa.shift();Bn(n).D_(),yield bw(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield bo(n)}})}(r,e)),Rw(r)&&Sw(r)})}function Kv(r,e){return p(this,null,function*(){let t=Q(r);t.asyncQueue.verifyOperationInProgress(),O(Sr,"RemoteStore received new credentials");let n=kr(t);t.aa.add(3),yield Ao(t),n&&t.la.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.aa.delete(3),yield mu(t)})}function YP(r,e){return p(this,null,function*(){let t=Q(r);e?(t.aa.delete(2),yield mu(t)):e||(t.aa.add(2),yield Ao(t),t.la.set("Unknown"))})}function Ui(r){return r.Pa||(r.Pa=function(t,n,i){let s=Q(t);return s.Y_(),new pf(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{jo:BP.bind(null,r),Jo:$P.bind(null,r),Zo:qP.bind(null,r),Q_:jP.bind(null,r)}),r.ua.push(e=>p(this,null,function*(){e?(r.Pa.D_(),ap(r)?op(r):r.la.set("Unknown")):(yield r.Pa.stop(),Aw(r))}))),r.Pa}function Bn(r){return r.Ta||(r.Ta=function(t,n,i){let s=Q(t);return s.Y_(),new mf(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{jo:()=>Promise.resolve(),Jo:GP.bind(null,r),Zo:QP.bind(null,r),z_:HP.bind(null,r),j_:KP.bind(null,r)}),r.ua.push(e=>p(this,null,function*(){e?(r.Ta.D_(),yield bo(r)):(yield r.Ta.stop(),r.oa.length>0&&(O(Sr,`Stopping write stream with ${r.oa.length} pending writes`),r.oa=[]))}))),r.Ta}function cp(r,e){if(He("AsyncQueue",`${e}: ${r}`),qn(r))return new x(P.UNAVAILABLE,`${e}: ${r}`);throw r}function Qv(){return new It(r=>FI(r),fu)}function up(r,e){return p(this,null,function*(){let t=Q(r),n=3,i=e.query,s=t.queries.get(i);s?!s.Va()&&e.ma()&&(n=2):(s=new wf,n=e.ma()?0:1);try{switch(n){case 0:s.Aa=yield t.onListen(i,!0);break;case 1:s.Aa=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let c=cp(o,`Initialization of query '${oi(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.Ra.push(e),e.ga(t.onlineState),s.Aa&&e.pa(s.Aa)&&hp(t)})}function lp(r,e){return p(this,null,function*(){let t=Q(r),n=e.query,i=3,s=t.queries.get(n);if(s){let o=s.Ra.indexOf(e);o>=0&&(s.Ra.splice(o,1),s.Ra.length===0?i=e.ma()?0:1:!s.Va()&&e.ma()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function JP(r,e){let t=Q(r),n=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.Ra)c.pa(i)&&(n=!0);o.Aa=i}}n&&hp(t)}function XP(r,e,t){let n=Q(r),i=n.queries.get(e);if(i)for(let s of i.Ra)s.onError(t);n.queries.delete(e)}function hp(r){r.fa.forEach(e=>{e.next()})}function ZP(r,e,t=!0){return p(this,null,function*(){let n=Ow(r),i,s=n.ru.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.eu()):i=yield Cw(n,e,t,!0),i})}function ek(r,e){return p(this,null,function*(){let t=Ow(r);yield Cw(t,e,!0,!1)})}function Cw(r,e,t,n){return p(this,null,function*(){let i=yield LP(r.localStore,ut(e)),s=i.targetId,o=r.sharedClientState.addLocalQueryTarget(s,t),c;return n&&(c=yield tk(r,e,s,o==="current",i.resumeToken)),r.isPrimaryClient&&t&&Ew(r.remoteStore,i),c})}function tk(r,e,t,n,i){return p(this,null,function*(){r.Pu=(g,y,T)=>function(N,k,q,U){return p(this,null,function*(){let M=k.view.Ga(q);M.ys&&(M=yield Wv(N.localStore,k.query,!1).then(({documents:w})=>k.view.Ga(w,M)));let j=U&&U.targetChanges.get(k.targetId),X=U&&U.targetMismatches.get(k.targetId)!=null,G=k.view.applyChanges(M,N.isPrimaryClient,j,X);return Xv(N,k.targetId,G.Ya),G.snapshot})}(r,g,y,T);let s=yield Wv(r.localStore,e,!0),o=new Af(e,s.Ns),c=o.Ga(s.documents),u=oo.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),h=o.applyChanges(c,r.isPrimaryClient,u);Xv(r,t,h.Ya);let f=new bf(e,t,o);return r.ru.set(e,f),r.iu.has(t)?r.iu.get(t).push(e):r.iu.set(t,[e]),h.snapshot})}function nk(r,e,t){return p(this,null,function*(){let n=Q(r),i=n.ru.get(e),s=n.iu.get(i.targetId);if(s.length>1)return n.iu.set(i.targetId,s.filter(o=>!fu(o,e))),void n.ru.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield cf(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&ip(n.remoteStore,i.targetId),Cf(n,i.targetId)}).catch(Pr))):(Cf(n,i.targetId),yield cf(n.localStore,i.targetId,!0))})}function rk(r,e){return p(this,null,function*(){let t=Q(r),n=t.ru.get(e),i=t.iu.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),ip(t.remoteStore,n.targetId))})}function ik(r,e,t){return p(this,null,function*(){let n=xw(r);try{let i=yield function(o,c){let u=Q(o),h=J.now(),f=c.reduce((T,D)=>T.add(D.key),Y()),g,y;return u.persistence.runTransaction("Locally write mutations","readwrite",T=>{let D=rt(),N=Y();return u.Cs.getEntries(T,f).next(k=>{D=k,D.forEach((q,U)=>{U.isValidDocument()||(N=N.add(q))})}).next(()=>u.localDocuments.getOverlayedDocuments(T,D)).next(k=>{g=k;let q=[];for(let U of c){let M=hP(U,g.get(U.key).overlayedDocument);M!=null&&q.push(new wt(U.key,M,NI(M.value.mapValue),Je.exists(!0)))}return u.mutationQueue.addMutationBatch(T,h,q,c)}).next(k=>{y=k;let q=k.applyToLocalDocumentSet(g,N);return u.documentOverlayCache.saveOverlays(T,k.batchId,q)})}).then(()=>({batchId:y.batchId,changes:$I(g)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,c,u){let h=o.uu[o.currentUser.toKey()];h||(h=new pe(H)),h=h.insert(c,u),o.uu[o.currentUser.toKey()]=h}(n,i.batchId,t),yield Ro(n,i.changes),yield bo(n.remoteStore)}catch(i){let s=cp(i,"Failed to persist write");t.reject(s)}})}function Pw(r,e){return p(this,null,function*(){let t=Q(r);try{let n=yield OP(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t._u.get(s);o&&(B(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.tu=!0:i.modifiedDocuments.size>0?B(o.tu,14607):i.removedDocuments.size>0&&(B(o.tu,42227),o.tu=!1))}),yield Ro(t,n,e)}catch(n){yield Pr(n)}})}function Jv(r,e,t){let n=Q(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.ru.forEach((s,o)=>{let c=o.view.ga(e);c.snapshot&&i.push(c.snapshot)}),function(o,c){let u=Q(o);u.onlineState=c;let h=!1;u.queries.forEach((f,g)=>{for(let y of g.Ra)y.ga(c)&&(h=!0)}),h&&hp(u)}(n.eventManager,e),i.length&&n.nu.Q_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function sk(r,e,t){return p(this,null,function*(){let n=Q(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n._u.get(e),s=i&&i.key;if(s){let o=new pe(L.comparator);o=o.insert(s,xe.newNoDocument(s,z.min()));let c=Y().add(s),u=new wc(z.min(),new Map,new pe(H),o,c);yield Pw(n,u),n.ou=n.ou.remove(s),n._u.delete(e),fp(n)}else yield cf(n.localStore,e,!1).then(()=>Cf(n,e,t)).catch(Pr)})}function ok(r,e){return p(this,null,function*(){let t=Q(r),n=e.batch.batchId;try{let i=yield NP(t.localStore,e);Dw(t,n,null),kw(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Ro(t,i)}catch(i){yield Pr(i)}})}function ak(r,e,t){return p(this,null,function*(){let n=Q(r);try{let i=yield function(o,c){let u=Q(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return u.mutationQueue.lookupMutationBatch(h,c).next(g=>(B(g!==null,37113),f=g.keys(),u.mutationQueue.removeMutationBatch(h,g))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>u.localDocuments.getDocuments(h,f))})}(n.localStore,e);Dw(n,e,t),kw(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Ro(n,i)}catch(i){yield Pr(i)}})}function kw(r,e){(r.cu.get(e)||[]).forEach(t=>{t.resolve()}),r.cu.delete(e)}function Dw(r,e,t){let n=Q(r),i=n.uu[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.uu[n.currentUser.toKey()]=i}}function Cf(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.iu.get(e))r.ru.delete(n),t&&r.nu.Tu(n,t);r.iu.delete(e),r.isPrimaryClient&&r.au.Ur(e).forEach(n=>{r.au.containsKey(n)||Nw(r,n)})}function Nw(r,e){r.su.delete(e.path.canonicalString());let t=r.ou.get(e);t!==null&&(ip(r.remoteStore,t),r.ou=r.ou.remove(e),r._u.delete(t),fp(r))}function Xv(r,e,t){for(let n of t)n instanceof Kc?(r.au.addReference(n.key,e),ck(r,n)):n instanceof Qc?(O(dp,"Document no longer in limbo: "+n.key),r.au.removeReference(n.key,e),r.au.containsKey(n.key)||Nw(r,n.key)):F(19791,{Iu:n})}function ck(r,e){let t=e.key,n=t.path.canonicalString();r.ou.get(t)||r.su.has(n)||(O(dp,"New document in limbo: "+t),r.su.add(n),fp(r))}function fp(r){for(;r.su.size>0&&r.ou.size<r.maxConcurrentLimboResolutions;){let e=r.su.values().next().value;r.su.delete(e);let t=new L(se.fromString(e)),n=r.lu.next();r._u.set(n,new Rf(t)),r.ou=r.ou.insert(t,n),Ew(r.remoteStore,new Di(ut(Eo(t.path)),n,"TargetPurposeLimboResolution",vt.le))}}function Ro(r,e,t){return p(this,null,function*(){let n=Q(r),i=[],s=[],o=[];n.ru.isEmpty()||(n.ru.forEach((c,u)=>{o.push(n.Pu(u,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){let g=h?!h.fromCache:(f=t==null?void 0:t.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(u.targetId,g?"current":"not-current")}if(h){i.push(h);let g=sf.Ps(u.targetId,h);s.push(g)}}))}),yield Promise.all(o),n.nu.Q_(i),yield function(u,h){return p(this,null,function*(){let f=Q(u);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(h,y=>S.forEach(y.ls,T=>f.persistence.referenceDelegate.addReference(g,y.targetId,T)).next(()=>S.forEach(y.hs,T=>f.persistence.referenceDelegate.removeReference(g,y.targetId,T)))))}catch(g){if(!qn(g))throw g;O(rp,"Failed to update sequence numbers: "+g)}for(let g of h){let y=g.targetId;if(!g.fromCache){let T=f.Ss.get(y),D=T.snapshotVersion,N=T.withLastLimboFreeSnapshotVersion(D);f.Ss=f.Ss.insert(y,N)}}})}(n.localStore,s))})}function uk(r,e){return p(this,null,function*(){let t=Q(r);if(!t.currentUser.isEqual(e)){O(dp,"User change. New user:",e.toKey());let n=yield Iw(t.localStore,e);t.currentUser=e,function(s,o){s.cu.forEach(c=>{c.forEach(u=>{u.reject(new x(P.CANCELLED,o))})}),s.cu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Ro(t,n.Ms)}})}function lk(r,e){let t=Q(r),n=t._u.get(e);if(n&&n.tu)return Y().add(n.key);{let i=Y(),s=t.iu.get(e);if(!s)return i;for(let o of s){let c=t.ru.get(o);i=i.unionWith(c.view.Wa)}return i}}function Ow(r){let e=Q(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Pw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lk.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=sk.bind(null,e),e.nu.Q_=JP.bind(null,e.eventManager),e.nu.Tu=XP.bind(null,e.eventManager),e}function xw(r){let e=Q(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ok.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ak.bind(null,e),e}function Wh(r,e){return p(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),O($n,"Initializing OfflineComponentProvider");let t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(i=>p(this,null,function*(){n.isEqual(i)||(yield Iw(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e})}function Zv(r,e){return p(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let t=yield hk(r);O($n,"Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Kv(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Kv(e.remoteStore,i)),r._onlineComponents=e})}function hk(r){return p(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){O($n,"Using user provided OfflineComponentProvider");try{yield Wh(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;mi("Error using user provided cache. Falling back to memory cache: "+t),yield Wh(r,new pp)}}else O($n,"Using default OfflineComponentProvider"),yield Wh(r,new Pf(void 0));return r._offlineComponents})}function Lw(r){return p(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(O($n,"Using user provided OnlineComponentProvider"),yield Zv(r,r._uninitializedComponentsProvider._online)):(O($n,"Using default OnlineComponentProvider"),yield Zv(r,new Vw))),r._onlineComponents})}function dk(r){return Lw(r).then(e=>e.syncEngine)}function Yc(r){return p(this,null,function*(){let e=yield Lw(r),t=e.eventManager;return t.onListen=ZP.bind(null,e.syncEngine),t.onUnlisten=nk.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=ek.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=rk.bind(null,e.syncEngine),t})}function fk(r,e,t={}){let n=new ct;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,c,u,h){let f=new ho({next:y=>{f.yu(),o.enqueueAndForget(()=>lp(s,g));let T=y.docs.has(c);!T&&y.fromCache?h.reject(new x(P.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&y.fromCache&&u&&u.source==="server"?h.reject(new x(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new lo(Eo(c.path),f,{includeMetadataChanges:!0,Fa:!0});return up(s,g)}(yield Yc(r),r.asyncQueue,e,t,n)})),n.promise}function pk(r,e,t={}){let n=new ct;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,c,u,h){let f=new ho({next:y=>{f.yu(),o.enqueueAndForget(()=>lp(s,g)),y.fromCache&&u.source==="server"?h.reject(new x(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new lo(c,f,{includeMetadataChanges:!0,Fa:!0});return up(s,g)}(yield Yc(r),r.asyncQueue,e,t,n)})),n.promise}function Mw(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}function Fw(r,e,t){if(!t)throw new x(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function mk(r,e,t,n){if(e===!0&&n===!0)throw new x(P.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function tI(r){if(!L.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function nI(r){if(L.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function gu(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":F(12329,{type:typeof r})}function Xe(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=gu(r);throw new x(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function gk(r,e){if(e<=0)throw new x(P.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}function Bw(r,e,t,n={}){var i;let s=(r=Xe(r,xi))._getSettings(),o=Object.assign(Object.assign({},s),{emulatorOptions:r._getEmulatorOptions()}),c=`${e}:${t}`;s.host!==Uw&&s.host!==c&&mi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u=Object.assign(Object.assign({},s),{host:c,ssl:!1,emulatorOptions:n});if(!ft(u,o)&&(r._setSettings(u),n.mockUserToken)){let h,f;if(typeof n.mockUserToken=="string")h=n.mockUserToken,f=Ee.MOCK_USER;else{h=da(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let g=n.mockUserToken.sub||n.mockUserToken.user_id;if(!g)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Ee(g)}r._authCredentials=new Hh(new tc(h,f))}}function $w(r,e,...t){if(r=ne(r),Fw("collection","path",e),r instanceof xi){let n=se.fromString(e,...t);return nI(n),new On(r,null,n)}{if(!(r instanceof je||r instanceof On))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(se.fromString(e,...t));return nI(n),new On(r.firestore,null,n)}}function mp(r,e,...t){if(r=ne(r),arguments.length===1&&(e=rc.newId()),Fw("doc","path",e),r instanceof xi){let n=se.fromString(e,...t);return tI(n),new je(r,null,new L(n))}{if(!(r instanceof je||r instanceof On))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(se.fromString(e,...t));return tI(n),new je(r.firestore,r instanceof On?r.converter:null,new L(n))}}function sI(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}function oI(r){return function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}function qw(r,e,t){t||(t=to);let n=Qt(r,"firestore");if(n.isInitialized(t)){let i=n.getImmediate({identifier:t}),s=n.getOptions(t);if(ft(s,e))return i;throw new x(P.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new x(P.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<gw)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:e,instanceIdentifier:t})}function jw(r,e){let t=typeof r=="object"?r:Yt(),n=typeof r=="string"?r:e||to,i=Qt(t,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=ha("firestore");s&&Bw(i,...s)}return i}function _u(r){if(r._terminated)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||_k(r),r._firestoreClient}function _k(r){var e,t,n;let i=r._freezeSettings(),s=function(c,u,h,f){return new ad(c,u,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Mw(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Df(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(c){let u=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(u),_online:u}}(r._componentsProvider))}function zw(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{oc:r})}}function So(r){let e=r._freezeSettings(),t=pu(r._databaseId);return new xf(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Ww(r,e,t,n,i,s={}){let o=r.dc(s.merge||s.mergeFields?2:0,e,t,i);gp("Data must be an object, but it was:",o,n);let c=Hw(n,o),u,h;if(s.merge)u=new nt(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let y=Lf(e,g,t);if(!o.contains(y))throw new x(P.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);Qw(f,y)||f.push(y)}u=new nt(f),h=o.fieldTransforms.filter(g=>u.covers(g.field))}else u=null,h=o.fieldTransforms;return new Nf(new Ke(c),u,h)}function vk(r,e,t,n){let i=r.dc(1,e,t);gp("Data must be an object, but it was:",i,n);let s=[],o=Ke.empty();jn(n,(u,h)=>{let f=_p(e,u,t);h=ne(h);let g=i.hc(f);if(h instanceof eu)s.push(f);else{let y=Co(h,g);y!=null&&(s.push(f),o.set(f,y))}});let c=new nt(s);return new Zc(o,c,i.fieldTransforms)}function Ik(r,e,t,n,i,s){let o=r.dc(1,e,t),c=[Lf(e,n,t)],u=[i];if(s.length%2!=0)throw new x(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<s.length;y+=2)c.push(Lf(e,s[y])),u.push(s[y+1]);let h=[],f=Ke.empty();for(let y=c.length-1;y>=0;--y)if(!Qw(h,c[y])){let T=c[y],D=u[y];D=ne(D);let N=o.hc(T);if(D instanceof eu)h.push(T);else{let k=Co(D,N);k!=null&&(h.push(T),f.set(T,k))}}let g=new nt(h);return new Zc(f,g,o.fieldTransforms)}function Gw(r,e,t,n=!1){return Co(t,r.dc(n?4:3,e))}function Co(r,e){if(Kw(r=ne(r)))return gp("Unsupported field value:",e,r),Hw(r,e);if(r instanceof Li)return function(n,i){if(!zw(i.oc))throw i.Tc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Tc(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.cc&&e.oc!==4)throw e.Tc("Nested arrays are not supported");return function(n,i){let s=[],o=0;for(let c of n){let u=Co(c,i.Pc(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=ne(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return oP(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=J.fromDate(n);return{timestampValue:ki(i.serializer,s)}}if(n instanceof J){let s=new J(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:ki(i.serializer,s)}}if(n instanceof po)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof fo)return{bytesValue:JI(i.serializer,n._byteString)};if(n instanceof je){let s=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw i.Tc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:tp(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof mo)return function(o,c){return{mapValue:{fields:{[Yf]:{stringValue:Jf},[Ai]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw c.Tc("VectorValues must only contain numeric values.");return ep(c.serializer,h)})}}}}}}(n,i);throw i.Tc(`Unsupported field value: ${gu(n)}`)}(r,e)}function Hw(r,e){let t={};return AI(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):jn(r,(n,i)=>{let s=Co(i,e.uc(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function Kw(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof J||r instanceof po||r instanceof fo||r instanceof je||r instanceof Li||r instanceof mo)}function gp(r,e,t){if(!Kw(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let n=gu(t);throw n==="an object"?e.Tc(r+" a custom object"):e.Tc(r+" "+n)}}function Lf(r,e,t){if((e=ne(e))instanceof Vi)return e._internalPath;if(typeof e=="string")return _p(r,e);throw tu("Field path arguments must be of type string or ",r,!1,void 0,t)}function _p(r,e,t){if(e.search(wk)>=0)throw tu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Vi(...e.split("."))._internalPath}catch{throw tu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function tu(r,e,t,n,i){let s=n&&!n.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${n}`),o&&(u+=` in document ${i}`),u+=")"),new x(P.INVALID_ARGUMENT,c+r+u)}function Qw(r,e){return r.some(t=>t.isEqual(e))}function yu(r,e){return typeof e=="string"?_p(r,e):e instanceof Vi?e._internalPath:e._delegate._internalPath}function Yw(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Jw(r,e,...t){let n=[];e instanceof _o&&n.push(e),n=n.concat(t),function(s){let o=s.filter(u=>u instanceof Mi).length,c=s.filter(u=>u instanceof yo).length;if(o>1||o>0&&c>0)throw new x(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}function Xw(r,e,t){let n=e,i=yu("where",r);return yo._create(i,n,t)}function Zw(...r){return r.forEach(e=>uE("or",e)),Mi._create("or",r)}function eE(...r){return r.forEach(e=>uE("and",e)),Mi._create("and",r)}function tE(r,e="asc"){let t=e,n=yu("orderBy",r);return Ff._create(n,t)}function nE(r){return gk("limit",r),Uf._create("limit",r,"F")}function rE(...r){return nu._create("startAt",r,!0)}function iE(...r){return nu._create("startAfter",r,!1)}function sE(...r){return ru._create("endBefore",r,!1)}function oE(...r){return ru._create("endAt",r,!0)}function aE(r,e,t,n){if(t[0]=ne(t[0]),t[0]instanceof go)return function(s,o,c,u,h){if(!u)throw new x(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let g of di(s))if(g.field.isKeyField())f.push(wr(o,u.key));else{let y=u.data.field(g.field);if(lu(y))throw new x(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(y===null){let T=g.field.canonicalString();throw new x(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${T}' (used as the orderBy) does not exist.`)}f.push(y)}return new Mt(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{let i=So(r.firestore);return function(o,c,u,h,f,g){let y=o.explicitOrderBy;if(f.length>y.length)throw new x(P.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let T=[];for(let D=0;D<f.length;D++){let N=f[D];if(y[D].field.isKeyField()){if(typeof N!="string")throw new x(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof N}`);if(!Zf(o)&&N.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${N}' contains a slash.`);let k=o.path.child(se.fromString(N));if(!L.isDocumentKey(k))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);let q=new L(k);T.push(wr(c,q))}else{let k=Gw(u,h,N);T.push(k)}}return new Mt(T,g)}(r._query,r.firestore._databaseId,i,e,t,n)}}function aI(r,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new x(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Zf(e)&&t.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(se.fromString(t));if(!L.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return wr(r,new L(n))}if(t instanceof je)return wr(r,t._key);throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${gu(t)}.`)}function cI(r,e){if(!Array.isArray(r)||r.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function cE(r,e){let t=function(i,s){for(let o of i)for(let c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function uE(r,e){if(!(e instanceof yo||e instanceof Mi))throw new x(P.INVALID_ARGUMENT,`Function ${r}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function lE(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}function Ek(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:r})}}function hE(r){r=Xe(r,je);let e=Xe(r.firestore,Tt);return fk(_u(e),r._key).then(t=>_E(e,r,t))}function dE(r){r=Xe(r,Et);let e=Xe(r.firestore,Tt),t=_u(e),n=new vo(e);return Yw(r._query),pk(t,r._query).then(i=>new su(e,n,r,i))}function fE(r,e,t){r=Xe(r,je);let n=Xe(r.firestore,Tt),i=lE(r.converter,e,t);return vu(n,[Ww(So(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,Je.none())])}function pE(r,e,t,...n){r=Xe(r,je);let i=Xe(r.firestore,Tt),s=So(i),o;return o=typeof(e=ne(e))=="string"||e instanceof Vi?Ik(s,"updateDoc",r._key,e,t,n):vk(s,"updateDoc",r._key,e),vu(i,[o.toMutation(r._key,Je.exists(!0))])}function mE(r){return vu(Xe(r.firestore,Tt),[new Pi(r._key,Je.none())])}function gE(r,e){let t=Xe(r.firestore,Tt),n=mp(r),i=lE(r.converter,e);return vu(t,[Ww(So(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,Je.exists(!1))]).then(()=>n)}function yp(r,...e){var t,n,i;r=ne(r);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||oI(e[o])||(s=e[o],o++);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(oI(e[o])){let g=e[o];e[o]=(t=g.next)===null||t===void 0?void 0:t.bind(g),e[o+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),e[o+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let u,h,f;if(r instanceof je)h=Xe(r.firestore,Tt),f=Eo(r._key.path),u={next:g=>{e[o]&&e[o](_E(h,r,g))},error:e[o+1],complete:e[o+2]};else{let g=Xe(r,Et);h=Xe(g.firestore,Tt),f=g._query;let y=new vo(h);u={next:T=>{e[o]&&e[o](new su(h,y,g,T))},error:e[o+1],complete:e[o+2]},Yw(r._query)}return function(y,T,D,N){let k=new ho(N),q=new lo(T,k,D);return y.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return up(yield Yc(y),q)})),()=>{k.yu(),y.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return lp(yield Yc(y),q)}))}}(_u(h),f,c,u)}function vu(r,e){return function(n,i){let s=new ct;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return ik(yield dk(n),i,s)})),s.promise}(_u(r),e)}function _E(r,e,t){let n=t.docs.get(e._key),i=new vo(r);return new iu(r,i,e._key,n,new mr(t.hasPendingWrites,t.fromCache),e.converter)}function yE(r){return new $f(r)}function Tk(r){return new qf(r==null?void 0:r.forceOwnership)}function Re(){return new Vf("serverTimestamp")}var Qy,Yy,Ee,Fi,Ir,P,x,ct,tc,Gh,Hh,Kh,Qh,Yh,nc,Jh,rc,Xy,Zy,J,z,ev,ic,se,yC,Te,L,Hs,_i,hi,Ks,lt,fI,sc,S,tt,oc,yi,ed,gr,td,tv,js,nd,rd,vt,_r,ac,cr,Io,Zr,Ys,EC,yt,rv,fr,iv,TC,vi,cc,AC,Qa,bC,gI,RC,Js,id,Ii,_I,SC,wi,CC,Gf,PC,uc,yr,Xs,kC,Ei,DC,au,NC,cu,OC,Hf,xC,sd,VC,lc,LC,yI,MC,hc,FC,vI,UC,uu,BC,od,$C,II,qC,Kf,jC,wI,zC,EI,TI,Qf,WC,GC,Zs,pe,li,Vt,ce,dc,nt,fc,Ae,HC,bI,RI,SI,CI,ad,to,Ti,Yf,PI,Nn,Jf,Ai,Ya,DI,Ke,xe,Mt,Er,pc,ee,oe,dd,fd,pd,md,mc,gd,_d,yd,Ft,It,tP,BI,nP,rP,iP,Si,Ln,Mn,Fn,Ar,vc,wd,Je,Ci,Un,wt,Pi,Ic,io,Ed,so,Td,Ie,te,wv,fP,Ad,pr,wc,oo,fi,Ec,Tc,Ac,bd,pP,mP,gP,Rd,Di,Sc,Dd,Pc,Nd,an,ti,Od,xd,Vd,hr,dr,kc,Ud,ao,xv,za,Bd,Mv,dw,Ye,Oc,Ni,$d,Uv,gw,qd,xc,jd,zd,Vc,Wd,Gd,Hd,Lc,Kd,Qd,Yd,co,we,Jd,Xd,Zd,ef,uo,tf,Mc,Fc,nf,kn,$h,qh,jh,PP,rf,sf,of,Uc,rp,DP,af,Bc,$c,uf,Gv,qc,Ha,zh,FP,hf,df,$e,ff,jc,Hv,zc,pf,mf,gf,_f,yf,Sr,vf,If,Gc,Hc,Oi,wf,Ef,Tf,Yv,lo,Kc,Qc,Af,dp,bf,Rf,Sf,pp,Pf,kf,Vw,ho,$n,Df,eI,Uw,rI,Jc,xi,Et,je,On,iI,Xc,Tt,fo,Vi,Li,po,mo,yk,Nf,Zc,Of,xf,eu,Vf,wk,go,Mf,_o,Cr,yo,Mi,Ff,Uf,nu,ru,Bf,mr,iu,pi,su,vo,$f,qf,vE=W(()=>{"use strict";wn();Xn();Wr();Ht();Hy();Ky();Qy="@firebase/firestore",Yy="4.7.11";Ee=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ee.UNAUTHENTICATED=new Ee(null),Ee.GOOGLE_CREDENTIALS=new Ee("google-credentials-uid"),Ee.FIRST_PARTY=new Ee("first-party-uid"),Ee.MOCK_USER=new Ee("mock-user");Fi="11.6.1";Ir=new Rt("@firebase/firestore");P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends Ge{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};ct=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};tc=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Gh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ee.UNAUTHENTICATED))}shutdown(){}},Hh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Kh=class{constructor(e){this.t=e,this.currentUser=Ee.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){B(this.o===void 0,42304);let n=this.i,i=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve(),s=new ct;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ct,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>p(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},c=u=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ct)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(B(typeof n.accessToken=="string",31837,{l:n}),new tc(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return B(e===null||typeof e=="string",2055,{h:e}),new Ee(e)}},Qh=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Ee.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Yh=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Qh(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Ee.FIRST_PARTY))}shutdown(){}invalidateToken(){}},nc=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Jh=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Oe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){B(this.o===void 0,3512);let n=s=>{s.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,O("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new nc(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(B(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new nc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};rc=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let i=gC(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%62))}return n}};Xy=-62135596800,Zy=1e6,J=class r{static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Zy);return new r(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Xy)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Zy}_compareTo(e){return this.seconds===e.seconds?H(this.nanoseconds,e.nanoseconds):H(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-Xy;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};z=class r{static fromTimestamp(e){return new r(e)}static min(){return new r(new J(0,0))}static max(){return new r(new J(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};ev="__name__",ic=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&F(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&F(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=r.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return H(e.length,t.length)}static compareSegments(e,t){let n=r.isNumericId(e),i=r.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?r.extractNumericId(e).compare(r.extractNumericId(t)):Xh(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return sn.fromString(e.substring(4,e.length-2))}},se=class r extends ic{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},yC=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Te=class r extends ic{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return yC.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ev}static keyField(){return new r([ev])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(n+=c,i++):(s(),i++)}if(s(),o)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};L=class r{constructor(e){this.path=e}static fromPath(e){return new r(se.fromString(e))}static fromName(e){return new r(se.fromString(e).popFirst(5))}static empty(){return new r(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new se(e.slice()))}};Hs=-1,_i=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};_i.UNKNOWN_ID=-1;hi=class{constructor(e,t){this.fieldPath=e,this.kind=t}},Ks=class r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r(0,lt.min())}};lt=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r(z.min(),L.empty(),Hs)}static max(){return new r(z.max(),L.empty(),Hs)}};fI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",sc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};S=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},u=>n(u))}),o=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next(f=>{o[h]=f,++c,c===s&&n(o)},f=>i(f))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};tt="SimpleDb",oc=class r{static open(e,t,n,i){try{return new r(t,e.transaction(i,n))}catch(s){throw new gr(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new ct,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new gr(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{let i=Wf(n.target.error);this.S.reject(new gr(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(O(tt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new td(t)}},yi=class r{static delete(e){return O(tt,"Removing database:",e),ur(ua().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!$r())return!1;if(r.F())return!0;let e=_e(),t=r.M(e),n=0<t&&t<10,i=pI(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,r.M(_e())===12.2&&He("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(e){return p(this,null,function*(){return this.db||(O(tt,"Opening database:",this.name),this.db=yield new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{n(new gr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?n(new x(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new x(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new gr(e,o))},i.onupgradeneeded=s=>{O(tt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${o.version}`);this.B.q(o,i.transaction,s.oldVersion,this.version).next(()=>{O(tt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",t=>{let n=t.target;this.L=n.version},{passive:!0})),this.$&&(this.db.onversionchange=t=>this.$(t)),this.db})}U(e){this.$=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return p(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.k(e);let c=oc.open(this.db,e,s?"readonly":"readwrite",n),u=i(c).next(h=>(c.v(),h)).catch(h=>(c.abort(h),S.reject(h))).toPromise();return u.catch(()=>{}),yield c.D,u}catch(c){let u=c,h=u.name!=="FirebaseError"&&o<3;if(O(tt,"Transaction failed with error:",u.message,"Retrying:",h),this.close(),!h)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};ed=class{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return ur(this.K.delete())}},gr=class extends x{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};td=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(O(tt,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(O(tt,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ur(n)}add(e){return O(tt,"ADD",this.store.name,e,e),ur(this.store.add(e))}get(e){return ur(this.store.get(e)).next(t=>(t===void 0&&(t=null),O(tt,"GET",this.store.name,e,t),t))}delete(e){return O(tt,"DELETE",this.store.name,e),ur(this.store.delete(e))}count(){return O(tt,"COUNT",this.store.name),ur(this.store.count())}J(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new S((o,c)=>{s.onerror=u=>{c(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(n),o=[];return this.Y(s,(c,u)=>{o.push(u)}).next(()=>o)}}Z(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new S((i,s)=>{n.onerror=o=>{s(o.target.error)},n.onsuccess=o=>{i(o.target.result)}})}X(e,t){O(tt,"DELETE ALL",this.store.name);let n=this.options(e,t);n.ee=!1;let i=this.cursor(n);return this.Y(i,(s,o,c)=>c.delete())}te(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.Y(i,t)}ne(e){let t=this.cursor({});return new S((n,i)=>{t.onerror=s=>{let o=Wf(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():n()}):n()}})}Y(e,t){let n=[];return new S((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let c=o.target.result;if(!c)return void i();let u=new ed(c),h=t(c.primaryKey,c.value,u);if(h instanceof S){let f=h.catch(g=>(u.done(),S.reject(g)));n.push(f)}u.isDone?i():u.j===null?c.continue():c.continue(u.j)}}).next(()=>S.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.ee?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};tv=!1;js="IndexBackfiller",nd=class{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ie(e){O(js,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>p(this,null,function*(){this.task=null;try{let t=yield this.re.se();O(js,`Documents written: ${t}`)}catch(t){qn(t)?O(js,"Ignoring IndexedDB error during index backfill: ",t):yield Pr(t)}yield this.ie(6e4)}))}},rd=class{constructor(e,t){this.localStore=e,this.persistence=t}se(e=50){return p(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.oe(t,e))})}oe(e,t){let n=new Set,i=t,s=!0;return S.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return O(js,`Processing collection: ${o}`),this._e(e,o,i).next(c=>{i-=c,n.add(o)});s=!1})).next(()=>t-i)}_e(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ae(i,s)).next(c=>(O(js,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}ae(e,t){let n=e;return t.changes.forEach((i,s)=>{let o=dI(s);zf(o,n)>0&&(n=o)}),new lt(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};vt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ue(i),this.ce=i=>n.writeSequenceNumber(i))}ue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ce&&this.ce(t),t}}r.le=-1;return r})(),_r=-1;ac="";cr="remoteDocuments",Io="owner",Zr="owner",Ys="mutationQueues",EC="userId",yt="mutations",rv="batchId",fr="userMutationsIndex",iv=["userId","batchId"];TC={},vi="documentMutations",cc="remoteDocumentsV14",AC=["prefixPath","collectionGroup","readTime","documentId"],Qa="documentKeyIndex",bC=["prefixPath","collectionGroup","documentId"],gI="collectionGroupIndex",RC=["collectionGroup","readTime","prefixPath","documentId"],Js="remoteDocumentGlobal",id="remoteDocumentGlobalKey",Ii="targets",_I="queryTargetsIndex",SC=["canonicalId","targetId"],wi="targetDocuments",CC=["targetId","path"],Gf="documentTargetsIndex",PC=["path","targetId"],uc="targetGlobalKey",yr="targetGlobal",Xs="collectionParents",kC=["collectionId","parent"],Ei="clientMetadata",DC="clientId",au="bundles",NC="bundleId",cu="namedQueries",OC="name",Hf="indexConfiguration",xC="indexId",sd="collectionGroupIndex",VC="collectionGroup",lc="indexState",LC=["indexId","uid"],yI="sequenceNumberIndex",MC=["uid","sequenceNumber"],hc="indexEntries",FC=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],vI="documentKeyIndex",UC=["indexId","uid","orderedDocumentKey"],uu="documentOverlays",BC=["userId","collectionPath","documentId"],od="collectionPathOverlayIndex",$C=["userId","collectionPath","largestBatchId"],II="collectionGroupOverlayIndex",qC=["userId","collectionGroup","largestBatchId"],Kf="globals",jC="name",wI=[Ys,yt,vi,cr,Ii,Io,yr,wi,Ei,Js,Xs,au,cu],zC=[...wI,uu],EI=[Ys,yt,vi,cc,Ii,Io,yr,wi,Ei,Js,Xs,au,cu,uu],TI=EI,Qf=[...TI,Hf,lc,hc],WC=Qf,GC=[...Qf,Kf];Zs=class extends sc{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}};pe=class r{constructor(e,t){this.comparator=e,this.root=t||Vt.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Vt.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new li(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new li(this.root,e,this.comparator,!1)}getReverseIterator(){return new li(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new li(this.root,e,this.comparator,!0)}},li=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Vt=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n!=null?n:r.RED,this.left=i!=null?i:r.EMPTY,this.right=s!=null?s:r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e!=null?e:this.key,t!=null?t:this.value,n!=null?n:this.color,i!=null?i:this.left,s!=null?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw F(27949);return e+(this.isRed()?0:1)}};Vt.EMPTY=null,Vt.RED=!0,Vt.BLACK=!1;Vt.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new Vt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};ce=class r{constructor(e){this.comparator=e,this.data=new pe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new dc(this.data.getIterator())}getIteratorFrom(e){return new dc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},dc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};nt=class r{constructor(e){this.fields=e,e.sort(Te.comparator)}static empty(){return new r([])}unionWith(e){let t=new ce(Te.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gi(this.fields,e.fields,(t,n)=>t.isEqual(n))}};fc=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};Ae=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new fc("Invalid base64 string: "+s):s}}(e);return new r(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return H(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ae.EMPTY_BYTE_STRING=new Ae("");HC=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);bI="server_timestamp",RI="__type__",SI="__previous_value__",CI="__local_write_time__";ad=class{constructor(e,t,n,i,s,o,c,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h}},to="(default)",Ti=class r{constructor(e,t){this.projectId=e,this.database=t||to}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===to}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};Yf="__type__",PI="__max__",Nn={mapValue:{fields:{__type__:{stringValue:PI}}}},Jf="__vector__",Ai="value",Ya={nullValue:"NULL_VALUE"};DI={mapValue:{fields:{[Yf]:{stringValue:Jf},[Ai]:{arrayValue:{}}}}};Ke=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Xa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=zs(t)}setAll(e){let t=Te.emptyPath(),n={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,n,i),n={},i=[],t=c.popLast()}o?n[c.lastSegment()]=zs(o):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());Xa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Lt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Xa(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){jn(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(zs(this.value))}};xe=class r{constructor(e,t,n,i,s,o,c){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new r(e,0,z.min(),z.min(),z.min(),Ke.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,z.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,z.min(),z.min(),Ke.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,z.min(),z.min(),Ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};Mt=class{constructor(e,t){this.position=e,this.inclusive=t}};Er=class{constructor(e,t="asc"){this.field=e,this.dir=t}};pc=class{},ee=class r extends pc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new dd(e,t,n):t==="array-contains"?new md(e,n):t==="in"?new mc(e,n):t==="not-in"?new gd(e,n):t==="array-contains-any"?new _d(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new fd(e,n):new pd(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Vn(t,this.value)):t!==null&&xn(this.value)===xn(t)&&this.matchesComparison(Vn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},oe=class r extends pc{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new r(e,t)}matches(e){return Ri(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}};dd=class extends ee{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},fd=class extends ee{constructor(e,t){super(e,"in",t),this.keys=MI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},pd=class extends ee{constructor(e,t){super(e,"not-in",t),this.keys=MI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};md=class extends ee{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ro(t)&&no(t.arrayValue,this.value)}},mc=class extends ee{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&no(this.value.arrayValue,t)}},gd=class extends ee{constructor(e,t){super(e,"not-in",t)}matches(e){if(no(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!no(this.value.arrayValue,t)}},_d=class extends ee{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ro(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>no(this.value.arrayValue,n))}};yd=class{constructor(e,t=null,n=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.Ie=null}};Ft=class{constructor(e,t=null,n=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}};It=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){jn(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return AI(this.inner)}size(){return this.innerSize}};tP=new pe(L.comparator);BI=new pe(L.comparator);nP=new pe(L.comparator),rP=new ce(L.comparator);iP=new ce(H);Si=class{constructor(){this._=void 0}};Ln=class extends Si{},Mn=class extends Si{constructor(e){super(),this.elements=e}};Fn=class extends Si{constructor(e){super(),this.elements=e}};Ar=class extends Si{constructor(e,t){super(),this.serializer=e,this.Re=t}};vc=class{constructor(e,t){this.field=e,this.transform=t}};wd=class{constructor(e,t){this.version=e,this.transformResults=t}},Je=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};Ci=class{};Un=class extends Ci{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},wt=class extends Ci{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};Pi=class extends Ci{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ic=class extends Ci{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};io=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&lP(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=Gs(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=Gs(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=qI();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=KI(o,c);u!==null&&n.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(z.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Y())}isEqual(e){return this.batchId===e.batchId&&gi(this.mutations,e.mutations,(t,n)=>yv(t,n))&&gi(this.baseMutations,e.baseMutations,(t,n)=>yv(t,n))}},Ed=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){B(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let i=function(){return nP}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,n[o].version);return new r(e,t,n,i)}};so=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};Td=class{constructor(e,t){this.count=e,this.unchangedNames=t}};(te=Ie||(Ie={}))[te.OK=0]="OK",te[te.CANCELLED=1]="CANCELLED",te[te.UNKNOWN=2]="UNKNOWN",te[te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",te[te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",te[te.NOT_FOUND=5]="NOT_FOUND",te[te.ALREADY_EXISTS=6]="ALREADY_EXISTS",te[te.PERMISSION_DENIED=7]="PERMISSION_DENIED",te[te.UNAUTHENTICATED=16]="UNAUTHENTICATED",te[te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",te[te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",te[te.ABORTED=10]="ABORTED",te[te.OUT_OF_RANGE=11]="OUT_OF_RANGE",te[te.UNIMPLEMENTED=12]="UNIMPLEMENTED",te[te.INTERNAL=13]="INTERNAL",te[te.UNAVAILABLE=14]="UNAVAILABLE",te[te.DATA_LOSS=15]="DATA_LOSS";wv=null;fP=new sn([4294967295,4294967295],0);Ad=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new pr(`Invalid padding: ${t}`);if(n<0)throw new pr(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new pr(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new pr(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=sn.fromNumber(this.pe)}we(e,t,n){let i=e.add(t.multiply(sn.fromNumber(n)));return i.compare(fP)===1&&(i=new sn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;let t=Ev(e),[n,i]=Tv(t);for(let s=0;s<this.hashCount;s++){let o=this.we(n,i,s);if(!this.be(o))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new r(s,i,t);return n.forEach(c=>o.insert(c)),o}insert(e){if(this.pe===0)return;let t=Ev(e),[n,i]=Tv(t);for(let s=0;s<this.hashCount;s++){let o=this.we(n,i,s);this.Se(o)}}Se(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},pr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};wc=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,oo.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r(z.min(),i,new pe(H),rt(),Y())}},oo=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,Y(),Y(),Y())}};fi=class{constructor(e,t,n,i){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=i}},Ec=class{constructor(e,t){this.targetId=e,this.Ce=t}},Tc=class{constructor(e,t,n=Ae.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},Ac=class{constructor(){this.Fe=0,this.Me=Av(),this.xe=Ae.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=Y(),t=Y(),n=Y();return this.Me.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:F(38017,{changeType:s})}}),new oo(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=Av()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,B(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}},bd=class{constructor(e){this.ze=e,this.je=new Map,this.He=rt(),this.Je=ja(),this.Ye=ja(),this.Ze=new pe(H)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:F(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((n,i)=>{this.it(i)&&t(i)})}ot(e){let t=e.targetId,n=e.Ce.count,i=this._t(t);if(i){let s=i.target;if(gc(s))if(n===0){let o=new L(s.path);this.tt(t,o,xe.newNoDocument(o,z.min()))}else B(n===1,20013,{expectedCount:n});else{let o=this.ut(t);if(o!==n){let c=this.ct(e),u=c?this.lt(c,e,o):1;if(u!==0){this.st(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,h)}wv==null||wv.ht(function(f,g,y,T,D){var N,k,q,U,M,j;let X={localCacheCount:f,existenceFilterCount:g.count,databaseId:y.database,projectId:y.projectId},G=g.unchangedNames;return G&&(X.bloomFilter={applied:D===0,hashCount:(N=G==null?void 0:G.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(U=(q=(k=G==null?void 0:G.bits)===null||k===void 0?void 0:k.bitmap)===null||q===void 0?void 0:q.length)!==null&&U!==void 0?U:0,padding:(j=(M=G==null?void 0:G.bits)===null||M===void 0?void 0:M.padding)!==null&&j!==void 0?j:0,mightContain:w=>{var _;return(_=T==null?void 0:T.mightContain(w))!==null&&_!==void 0&&_}}),X}(o,e.Ce,this.ze.Pt(),c,u))}}}}ct(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,o,c;try{o=un(n).toUint8Array()}catch(u){if(u instanceof fc)return mi("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Ad(o,i,s)}catch(u){return mi(u instanceof pr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.pe===0?null:c}lt(e,t,n){return t.Ce.count===n-this.Tt(e,t.targetId)?0:2}Tt(e,t){let n=this.ze.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let o=this.ze.Pt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.tt(t,s,null),i++)}),i}It(e){let t=new Map;this.je.forEach((s,o)=>{let c=this._t(o);if(c){if(s.current&&gc(c.target)){let u=new L(c.target.path);this.Et(u).has(o)||this.dt(o,u)||this.tt(o,u,xe.newNoDocument(u,e))}s.Le&&(t.set(o,s.qe()),s.Qe())}});let n=Y();this.Ye.forEach((s,o)=>{let c=!0;o.forEachWhile(u=>{let h=this._t(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(s))}),this.He.forEach((s,o)=>o.setReadTime(e));let i=new wc(e,t,this.Ze,this.He,n);return this.He=rt(),this.Je=ja(),this.Ye=ja(),this.Ze=new pe(H),i}et(e,t){if(!this.it(e))return;let n=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;let i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new Ac,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new ce(H),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new ce(H),this.Je=this.Je.insert(e,t)),t}it(e){let t=this._t(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new Ac),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}};pP={asc:"ASCENDING",desc:"DESCENDING"},mP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gP={and:"AND",or:"OR"},Rd=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};Di=class r{constructor(e,t,n,i,s=z.min(),o=z.min(),c=Ae.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};Sc=class{constructor(e){this.wt=e}};Dd=class{getBundleMetadata(e,t){return Pv(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:Rr(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return Pv(e).put(function(i){return{bundleId:i.id,createTime:br(Qe(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return kv(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:uw(s.bundledQuery),readTime:Rr(s.readTime)}}(n)})}saveNamedQuery(e,t){return kv(e).put(function(i){return{name:i.name,readTime:br(Qe(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};Pc=class r{constructor(e,t){this.serializer=e,this.userId=t}static bt(e,t){let n=t.uid||"";return new r(e,n)}getOverlay(e,t){return Ms(e).get(Sv(this.userId,t)).next(n=>n?Bh(this.serializer,n):null)}getOverlays(e,t){let n=xt();return S.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,o)=>{let c=new so(t,o);i.push(this.St(e,c))}),S.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(o=>i.add(qe(o.getCollectionPath())));let s=[];return i.forEach(o=>{let c=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);s.push(Ms(e).X(od,c))}),S.waitFor(s)}getOverlaysForCollection(e,t,n){let i=xt(),s=qe(t),o=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ms(e).J(od,o).next(c=>{for(let u of c){let h=Bh(this.serializer,u);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s=xt(),o,c=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ms(e).te({index:II,range:c},(u,h,f)=>{let g=Bh(this.serializer,h);s.size()<i||g.largestBatchId===o?(s.set(g.getKey(),g),o=g.largestBatchId):f.done()}).next(()=>s)}St(e,t){return Ms(e).put(function(i,s,o){let[c,u,h]=Sv(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Rc(i.wt,o.mutation)}}(this.serializer,this.userId,t))}};Nd=class{Dt(e){return be(e,Kf)}getSessionToken(e){return this.Dt(e).get("sessionToken").next(t=>{let n=t==null?void 0:t.value;return n?Ae.fromUint8Array(n):Ae.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}};an=class{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(fe(e.integerValue));else if("doubleValue"in e){let n=fe(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),Qs(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),typeof n=="string"&&(n=cn(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(un(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?kI(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):du(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):F(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let n=e.fields||{};this.Mt(t,55);for(let i of Object.keys(n))this.Nt(i,t),this.Ct(n[i],t)}qt(e,t){var n,i;let s=e.fields||{};this.Mt(t,53);let o=Ai,c=((i=(n=s[o].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.Mt(t,15),t.xt(fe(c)),this.Nt(o,t),this.Ct(s[o],t)}$t(e,t){let n=e.values||[];this.Mt(t,50);for(let i of n)this.Ct(i,t)}kt(e,t){this.Mt(t,37),L.fromName(e).path.forEach(n=>{this.Mt(t,60),this.Kt(n,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}};an.Wt=new an;ti=255;Od=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.zt(n.value),n=t.next();this.jt()}Ht(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Yt()}Zt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.zt(n);else if(n<2048)this.zt(960|n>>>6),this.zt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.zt(480|n>>>12),this.zt(128|63&n>>>6),this.zt(128|63&n);else{let i=t.codePointAt(0);this.zt(240|i>>>18),this.zt(128|63&i>>>12),this.zt(128|63&i>>>6),this.zt(128|63&i)}}this.jt()}Xt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{let i=t.codePointAt(0);this.Jt(240|i>>>18),this.Jt(128|63&i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i)}}this.Yt()}en(e){let t=this.tn(e),n=Dv(t);this.nn(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}rn(e){let t=this.tn(e),n=Dv(t);this.nn(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}sn(){this._n(ti),this._n(255)}an(){this.un(ti),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}zt(e){let t=255&e;t===0?(this._n(0),this._n(255)):t===ti?(this._n(ti),this._n(0)):this._n(t)}Jt(e){let t=255&e;t===0?(this.un(0),this.un(255)):t===ti?(this.un(ti),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},xd=class{constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}},Vd=class{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}},hr=class{constructor(){this.ln=new Od,this.hn=new xd(this.ln),this.Pn=new Vd(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return e===0?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}};dr=class r{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}In(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};kc=class{constructor(e){this.En=new ce((t,n)=>Te.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.An=[];for(let t of e.filters){let n=t;n.isInequality()?this.En=this.En.add(n):this.An.push(n)}}get Rn(){return this.En.size>1}Vn(e){if(B(e.collectionGroup===this.collectionId,49279),this.Rn)return!1;let t=Zh(e);if(t!==void 0&&!this.mn(t))return!1;let n=ar(e),i=new Set,s=0,o=0;for(;s<n.length&&this.mn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.En.size>0){let c=this.En.getIterator().getNext();if(!i.has(c.field.canonicalString())){let u=n[s];if(!this.fn(c,u)||!this.gn(this.dn[o++],u))return!1}++s}for(;s<n.length;++s){let c=n[s];if(o>=this.dn.length||!this.gn(this.dn[o++],c))return!1}return!0}pn(){if(this.Rn)return null;let e=new ce(Te.comparator),t=[];for(let n of this.An)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new hi(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new hi(n.field,0))}for(let n of this.dn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new hi(n.field,n.dir==="asc"?0:1)));return new _i(_i.UNKNOWN_ID,this.collectionId,t,Ks.empty())}mn(e){for(let t of this.An)if(this.fn(t,e))return!0;return!1}fn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}gn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};Ud=class{constructor(){this.yn=new ao}addToCollectionParentIndex(e,t){return this.yn.add(t),S.resolve()}getCollectionParents(e,t){return S.resolve(this.yn.getEntries(t))}addFieldIndex(e,t){return S.resolve()}deleteFieldIndex(e,t){return S.resolve()}deleteAllFieldIndexes(e){return S.resolve()}createTargetIndexes(e,t){return S.resolve()}getDocumentsMatchingTarget(e,t){return S.resolve(null)}getIndexType(e,t){return S.resolve(0)}getFieldIndexes(e,t){return S.resolve([])}getNextCollectionGroupToUpdate(e){return S.resolve(null)}getMinOffset(e,t){return S.resolve(lt.min())}getMinOffsetFromCollectionGroup(e,t){return S.resolve(lt.min())}updateCollectionGroup(e,t,n){return S.resolve()}updateIndexEntries(e,t){return S.resolve()}},ao=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new ce(se.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new ce(se.comparator)).toArray()}};xv="IndexedDbIndexManager",za=new Uint8Array(0),Bd=class{constructor(e,t){this.databaseId=t,this.wn=new ao,this.bn=new It(n=>Tr(n),(n,i)=>wo(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.wn.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.wn.add(t)});let s={collectionId:n,parent:qe(i)};return Vv(e).put(s)}return S.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[hI(t),""],!1,!0);return Vv(e).J(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;n.push(Ot(o.parent))}return n})}addFieldIndex(e,t){let n=Fs(e),i=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=n.add(i);if(t.indexState){let o=ri(e);return s.next(c=>{o.put(Cv(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=Fs(e),i=ri(e),s=ni(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Fs(e),n=ni(e),i=ri(e);return t.X().next(()=>n.X()).next(()=>i.X())}createTargetIndexes(e,t){return S.forEach(this.Sn(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new kc(n).pn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=ni(e),i=!0,s=new Map;return S.forEach(this.Sn(t),o=>this.Dn(e,o).next(c=>{i&&(i=!!c),s.set(o,c)})).next(()=>{if(i){let o=Y(),c=[];return S.forEach(s,(u,h)=>{O(xv,`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(u)} to execute ${Tr(t)}`);let f=function(M,j){let X=Zh(j);if(X===void 0)return null;for(let G of _c(M,X.fieldPath))switch(G.op){case"array-contains-any":return G.value.arrayValue.values||[];case"array-contains":return[G.value]}return null}(h,u),g=function(M,j){let X=new Map;for(let G of ar(j))for(let w of _c(M,G.fieldPath))switch(w.op){case"==":case"in":X.set(G.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return X.set(G.fieldPath.canonicalString(),w.value),Array.from(X.values())}return null}(h,u),y=function(M,j){let X=[],G=!0;for(let w of ar(j)){let _=w.kind===0?pv(M,w.fieldPath,M.startAt):mv(M,w.fieldPath,M.startAt);X.push(_.value),G&&(G=_.inclusive)}return new Mt(X,G)}(h,u),T=function(M,j){let X=[],G=!0;for(let w of ar(j)){let _=w.kind===0?mv(M,w.fieldPath,M.endAt):pv(M,w.fieldPath,M.endAt);X.push(_.value),G&&(G=_.inclusive)}return new Mt(X,G)}(h,u),D=this.vn(u,h,y),N=this.vn(u,h,T),k=this.Cn(u,h,g),q=this.Fn(u.indexId,f,D,y.inclusive,N,T.inclusive,k);return S.forEach(q,U=>n.Z(U,t.limit).next(M=>{M.forEach(j=>{let X=L.fromSegments(j.documentKey);o.has(X)||(o=o.add(X),c.push(X))})}))}).next(()=>c)}return S.resolve(null)})}Sn(e){let t=this.bn.get(e);return t||(e.filters.length===0?t=[e]:t=CP(oe.create(e.filters,"and")).map(n=>vd(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.bn.set(e,t),t)}Fn(e,t,n,i,s,o,c){let u=(t!=null?t.length:1)*Math.max(n.length,s.length),h=u/(t!=null?t.length:1),f=[];for(let g=0;g<u;++g){let y=t?this.Mn(t[g/h]):za,T=this.xn(e,y,n[g%h],i),D=this.On(e,y,s[g%h],o),N=c.map(k=>this.xn(e,y,k,!0));f.push(...this.createRange(T,D,N))}return f}xn(e,t,n,i){let s=new dr(e,L.empty(),t,n);return i?s:s.In()}On(e,t,n,i){let s=new dr(e,L.empty(),t,n);return i?s.In():s}Dn(e,t){let n=new kc(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let c of s)n.Vn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let n=2,i=this.Sn(t);return S.forEach(i,s=>this.Dn(e,s).next(o=>{o?n!==0&&o.fields.length<function(u){let h=new ce(Te.comparator),f=!1;for(let g of u.filters)for(let y of g.getFlattenedFilters())y.field.isKeyField()||(y.op==="array-contains"||y.op==="array-contains-any"?f=!0:h=h.add(y.field));for(let g of u.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&n===2?1:n)}Nn(e,t){let n=new hr;for(let i of ar(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=n.Tn(i.kind);an.Wt.vt(s,o)}return n.cn()}Mn(e){let t=new hr;return an.Wt.vt(e,t.Tn(0)),t.cn()}Bn(e,t){let n=new hr;return an.Wt.vt(wr(this.databaseId,t),n.Tn(function(s){let o=ar(s);return o.length===0?0:o[o.length-1].kind}(e))),n.cn()}Cn(e,t,n){if(n===null)return[];let i=[];i.push(new hr);let s=0;for(let o of ar(e)){let c=n[s++];for(let u of i)if(this.Ln(t,o.fieldPath)&&ro(c))i=this.kn(i,o,c);else{let h=u.Tn(o.kind);an.Wt.vt(c,h)}}return this.qn(i)}vn(e,t,n){return this.Cn(e,t,n.position)}qn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].cn();return t}kn(e,t,n){let i=[...e],s=[];for(let o of n.arrayValue.values||[])for(let c of i){let u=new hr;u.seed(c.cn()),an.Wt.vt(o,u.Tn(t.kind)),s.push(u)}return s}Ln(e,t){return!!e.filters.find(n=>n instanceof ee&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=Fs(e),i=ri(e);return(t?n.J(sd,IDBKeyRange.bound(t,t)):n.J()).next(s=>{let o=[];return S.forEach(s,c=>i.get([c.indexId,this.uid]).next(u=>{o.push(function(f,g){let y=g?new Ks(g.sequenceNumber,new lt(Rr(g.readTime),new L(Ot(g.documentKey)),g.largestBatchId)):Ks.empty(),T=f.fields.map(([D,N])=>new hi(Te.fromServerFormat(D),N));return new _i(f.indexId,f.collectionGroup,T,y)}(c,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:H(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=Fs(e),s=ri(e);return this.Qn(e).next(o=>i.J(sd,IDBKeyRange.bound(t,t)).next(c=>S.forEach(c,u=>s.put(Cv(u.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return S.forEach(t,(i,s)=>{let o=n.get(i.collectionGroup);return(o?S.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(c=>(n.set(i.collectionGroup,c),S.forEach(c,u=>this.$n(e,i,u).next(h=>{let f=this.Un(s,u);return h.isEqual(f)?S.resolve():this.Kn(e,s,u,h,f)}))))})}Wn(e,t,n,i){return ni(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Bn(n,t.key),documentKey:t.key.path.toArray()})}Gn(e,t,n,i){return ni(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Bn(n,t.key),t.key.path.toArray()])}$n(e,t,n){let i=ni(e),s=new ce(Cn);return i.te({index:vI,range:IDBKeyRange.only([n.indexId,this.uid,this.Bn(n,t)])},(o,c)=>{s=s.add(new dr(n.indexId,t,c.arrayValue,c.directionalValue))}).next(()=>s)}Un(e,t){let n=new ce(Cn),i=this.Nn(t,e);if(i==null)return n;let s=Zh(t);if(s!=null){let o=e.data.field(s.fieldPath);if(ro(o))for(let c of o.arrayValue.values||[])n=n.add(new dr(t.indexId,e.key,this.Mn(c),i))}else n=n.add(new dr(t.indexId,e.key,za,i));return n}Kn(e,t,n,i,s){O(xv,"Updating index entries for document '%s'",t.key);let o=[];return function(u,h,f,g,y){let T=u.getIterator(),D=h.getIterator(),N=ei(T),k=ei(D);for(;N||k;){let q=!1,U=!1;if(N&&k){let M=f(N,k);M<0?U=!0:M>0&&(q=!0)}else N!=null?U=!0:q=!0;q?(g(k),k=ei(D)):U?(y(N),N=ei(T)):(N=ei(T),k=ei(D))}}(i,s,Cn,c=>{o.push(this.Wn(e,t,n,c))},c=>{o.push(this.Gn(e,t,n,c))}),S.waitFor(o)}Qn(e){let t=1;return ri(e).te({index:yI,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,c)=>Cn(o,c)).filter((o,c,u)=>!c||Cn(o,u[c-1])!==0);let i=[];i.push(e);for(let o of n){let c=Cn(o,e),u=Cn(o,t);if(c===0)i[0]=e.In();else if(c>0&&u<0)i.push(o),i.push(o.In());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.zn(i[o],i[o+1]))return[];let c=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,za,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,za,[]];s.push(IDBKeyRange.bound(c,u))}return s}zn(e,t){return Cn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Lv)}getMinOffset(e,t){return S.mapArray(this.Sn(t),n=>this.Dn(e,n).next(i=>i||F(44426))).next(Lv)}};Mv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},dw=41943040,Ye=class r{static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}};Ye.DEFAULT_COLLECTION_PERCENTILE=10,Ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ye.DEFAULT=new Ye(dw,Ye.DEFAULT_COLLECTION_PERCENTILE,Ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ye.DISABLED=new Ye(-1,0,0);Oc=class r{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.jn={}}static bt(e,t,n,i){B(e.uid!=="",64387);let s=e.isAuthenticated()?e.uid:"";return new r(s,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Pn(e).te({index:fr,range:n},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=ui(e),o=Pn(e);return o.add({}).next(c=>{B(typeof c=="number",49019);let u=new io(c,t,n,i),h=function(T,D,N){let k=N.baseMutations.map(U=>Rc(T.wt,U)),q=N.mutations.map(U=>Rc(T.wt,U));return{userId:D,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:k,mutations:q}}(this.serializer,this.userId,u),f=[],g=new ce((y,T)=>H(y.canonicalString(),T.canonicalString()));for(let y of i){let T=mI(this.userId,y.key.path,c);g=g.add(y.key.path.popLast()),f.push(o.put(h)),f.push(s.put(T,TC))}return g.forEach(y=>{f.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.jn[c]=u.keys()}),S.waitFor(f).next(()=>u)})}lookupMutationBatch(e,t){return Pn(e).get(t).next(n=>n?(B(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),lr(this.serializer,n)):null)}Hn(e,t){return this.jn[t]?S.resolve(this.jn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.jn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Pn(e).te({index:fr,range:i},(o,c,u)=>{c.userId===this.userId&&(B(c.batchId>=n,47524,{Jn:n}),s=lr(this.serializer,c)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=_r;return Pn(e).te({index:fr,range:t,reverse:!0},(i,s,o)=>{n=s.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,_r],[this.userId,Number.POSITIVE_INFINITY]);return Pn(e).J(fr,t).next(n=>n.map(i=>lr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=Ka(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return ui(e).te({range:i},(o,c,u)=>{let[h,f,g]=o,y=Ot(f);if(h===this.userId&&t.path.isEqual(y))return Pn(e).get(g).next(T=>{if(!T)throw F(61480,{Yn:o,batchId:g});B(T.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:T.userId,batchId:g}),s.push(lr(this.serializer,T))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ce(H),i=[];return t.forEach(s=>{let o=Ka(this.userId,s.path),c=IDBKeyRange.lowerBound(o),u=ui(e).te({range:c},(h,f,g)=>{let[y,T,D]=h,N=Ot(T);y===this.userId&&s.path.isEqual(N)?n=n.add(D):g.done()});i.push(u)}),S.waitFor(i).next(()=>this.Zn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=Ka(this.userId,n),o=IDBKeyRange.lowerBound(s),c=new ce(H);return ui(e).te({range:o},(u,h,f)=>{let[g,y,T]=u,D=Ot(y);g===this.userId&&n.isPrefixOf(D)?D.length===i&&(c=c.add(T)):f.done()}).next(()=>this.Zn(e,c))}Zn(e,t){let n=[],i=[];return t.forEach(s=>{i.push(Pn(e).get(s).next(o=>{if(o===null)throw F(35274,{batchId:s});B(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),n.push(lr(this.serializer,o))}))}),S.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return fw(e.he,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Xn(t.batchId)}),S.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Xn(e){delete this.jn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return S.resolve();let n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return ui(e).te({range:n},(s,o,c)=>{if(s[0]===this.userId){let u=Ot(s[1]);i.push(u)}else c.done()}).next(()=>{B(i.length===0,56720,{er:i.map(s=>s.canonicalString())})})})}containsKey(e,t){return pw(e,this.userId,t)}tr(e){return mw(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:_r,lastStreamToken:""})}};Ni=class r{constructor(e){this.nr=e}next(){return this.nr+=2,this.nr}static rr(){return new r(0)}static ir(){return new r(-1)}};$d=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.sr(e).next(t=>{let n=new Ni(t.highestTargetId);return t.highestTargetId=n.next(),this._r(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.sr(e).next(t=>z.fromTimestamp(new J(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.sr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.sr(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this._r(e,i)))}addTargetData(e,t){return this.ar(e,t).next(()=>this.sr(e).next(n=>(n.targetCount+=1,this.ur(t,n),this._r(e,n))))}updateTargetData(e,t){return this.ar(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ii(e).delete(t.targetId)).next(()=>this.sr(e)).next(n=>(B(n.targetCount>0,8065),n.targetCount-=1,this._r(e,n)))}removeTargets(e,t,n){let i=0,s=[];return ii(e).te((o,c)=>{let u=qs(c);u.sequenceNumber<=t&&n.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>S.waitFor(s)).next(()=>i)}forEachTarget(e,t){return ii(e).te((n,i)=>{let s=qs(i);t(s)})}sr(e){return Fv(e).get(uc).next(t=>(B(t!==null,2888),t))}_r(e,t){return Fv(e).put(uc,t)}ar(e,t){return ii(e).put(cw(this.serializer,t))}ur(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.sr(e).next(t=>t.targetCount)}getTargetData(e,t){let n=Tr(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return ii(e).te({range:i,index:_I},(o,c,u)=>{let h=qs(c);wo(t,h.target)&&(s=h,u.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=Dn(e);return t.forEach(o=>{let c=qe(o.path);i.push(s.put({targetId:n,path:c})),i.push(this.referenceDelegate.addReference(e,n,o))}),S.waitFor(i)}removeMatchingKeys(e,t,n){let i=Dn(e);return S.forEach(t,s=>{let o=qe(s.path);return S.waitFor([i.delete([n,o]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=Dn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Dn(e),s=Y();return i.te({range:n,ee:!0},(o,c,u)=>{let h=Ot(o[1]),f=new L(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){let n=qe(t.path),i=IDBKeyRange.bound([n],[hI(n)],!1,!0),s=0;return Dn(e).te({index:Gf,ee:!0,range:i},([o,c],u,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}Rt(e,t){return ii(e).get(t).next(n=>n?qs(n):null)}};Uv="LruGarbageCollector",gw=1048576;qd=class{constructor(e){this.cr=e,this.buffer=new ce(Bv),this.lr=0}hr(){return++this.lr}Pr(e){let t=[e,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();Bv(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},xc=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Tr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return this.Tr!==null}Ir(e){O(Uv,`Garbage collection scheduled in ${e}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>p(this,null,function*(){this.Tr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){qn(t)?O(Uv,"Ignoring IndexedDB error during garbage collection: ",t):yield Pr(t)}yield this.Ir(3e5)}))}},jd=class{constructor(e,t){this.Er=e,this.params=t}calculateTargetCount(e,t){return this.Er.dr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return S.resolve(vt.le);let n=new qd(t);return this.Er.forEachTarget(e,i=>n.Pr(i.sequenceNumber)).next(()=>this.Er.Ar(e,i=>n.Pr(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Er.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Er.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Mv)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Mv):this.Rr(e,t))}getCacheSize(e){return this.Er.getCacheSize(e)}Rr(e,t){let n,i,s,o,c,u,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,o=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(n=g,c=Date.now(),this.removeTargets(e,n,t))).next(g=>(s=g,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(g=>(h=Date.now(),si()<=Z.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(c-o)+`ms
	Removed ${s} targets in `+(u-c)+`ms
	Removed ${g} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};zd=class{constructor(e,t){this.db=e,this.garbageCollector=_w(this,t)}dr(e){let t=this.Vr(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Vr(e){let t=0;return this.Ar(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ar(e,t){return this.mr(e,(n,i)=>t(i))}addReference(e,t,n){return Wa(e,n)}removeReference(e,t,n){return Wa(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Wa(e,t)}gr(e,t){return function(i,s){let o=!1;return mw(i).ne(c=>pw(i,c,s).next(u=>(u&&(o=!0),S.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.mr(e,(o,c)=>{if(c<=t){let u=this.gr(e,o).next(h=>{if(!h)return s++,n.getEntry(e,o).next(()=>(n.removeEntry(o,z.min()),Dn(e).delete(function(g){return[0,qe(g.path)]}(o))))});i.push(u)}}).next(()=>S.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Wa(e,t)}mr(e,t){let n=Dn(e),i,s=vt.le;return n.te({index:Gf},([o,c],{path:u,sequenceNumber:h})=>{o===0?(s!==vt.le&&t(new L(Ot(i)),s),s=h,i=u):s=vt.le}).next(()=>{s!==vt.le&&t(new L(Ot(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};Vc=class{constructor(){this.changes=new It(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?S.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};Wd=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return or(e).put(n)}removeEntry(e,t,n){return or(e).delete(function(s,o){let c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Cc(o),c[c.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.pr(e,n)))}getEntry(e,t){let n=xe.newInvalidDocument(t);return or(e).te({index:Qa,range:IDBKeyRange.only(Us(t))},(i,s)=>{n=this.yr(t,s)}).next(()=>n)}wr(e,t){let n={size:0,document:xe.newInvalidDocument(t)};return or(e).te({index:Qa,range:IDBKeyRange.only(Us(t))},(i,s)=>{n={document:this.yr(t,s),size:Nc(s)}}).next(()=>n)}getEntries(e,t){let n=rt();return this.br(e,t,(i,s)=>{let o=this.yr(i,s);n=n.insert(i,o)}).next(()=>n)}Sr(e,t){let n=rt(),i=new pe(L.comparator);return this.br(e,t,(s,o)=>{let c=this.yr(s,o);n=n.insert(s,c),i=i.insert(s,Nc(o))}).next(()=>({documents:n,Dr:i}))}br(e,t,n){if(t.isEmpty())return S.resolve();let i=new ce(jv);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(Us(i.first()),Us(i.last())),o=i.getIterator(),c=o.getNext();return or(e).te({index:Qa,range:s},(u,h,f)=>{let g=L.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;c&&jv(c,g)<0;)n(c,null),c=o.getNext();c&&c.isEqual(g)&&(n(c,h),c=o.hasNext()?o.getNext():null),c?f.H(Us(c)):f.done()}).next(()=>{for(;c;)n(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let o=t.path,c=[o.popLast().toArray(),o.lastSegment(),Cc(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return or(e).J(IDBKeyRange.bound(c,u,!0)).next(h=>{s==null||s.incrementDocumentReadCount(h.length);let f=rt();for(let g of h){let y=this.yr(L.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);y.isFoundDocument()&&(To(t,y)||i.has(y.key))&&(f=f.insert(y.key,y))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=rt(),o=qv(t,n),c=qv(t,lt.max());return or(e).te({index:gI,range:IDBKeyRange.bound(o,c,!0)},(u,h,f)=>{let g=this.yr(L.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Gd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return $v(e).get(id).next(t=>(B(!!t,20021),t))}pr(e,t){return $v(e).put(id,t)}yr(e,t){if(t){let n=RP(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(z.min())))return n}return xe.newInvalidDocument(e)}};Gd=class extends Vc{constructor(e,t){super(),this.vr=e,this.trackRemovals=t,this.Cr=new It(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new ce((s,o)=>H(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let c=this.Cr.get(s);if(t.push(this.vr.removeEntry(e,s,c.readTime)),o.isValidDocument()){let u=Rv(this.vr.serializer,o);i=i.add(s.path.popLast());let h=Nc(u);n+=h-c.size,t.push(this.vr.addEntry(e,s,u))}else if(n-=c.size,this.trackRemovals){let u=Rv(this.vr.serializer,o.convertToNoDocument(z.min()));t.push(this.vr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.vr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.vr.updateMetadata(e,n)),S.waitFor(t)}getFromCache(e,t){return this.vr.wr(e,t).next(n=>(this.Cr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.vr.Sr(e,t).next(({documents:n,Dr:i})=>(i.forEach((s,o)=>{this.Cr.set(s,{size:o,readTime:n.get(s).readTime})}),n))}};Hd=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};Lc=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&Gs(n.mutation,i,nt.empty(),J.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Y()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Y()){let i=xt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let o=$s();return s.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=xt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Y()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,n,i){let s=rt(),o=Ws(),c=function(){return Ws()}();return t.forEach((u,h)=>{let f=n.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof wt)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Gs(f.mutation,h,f.mutation.getFieldMask(),J.now())):o.set(h.key,nt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var g;return c.set(h,new Hd(f,(g=o.get(h))!==null&&g!==void 0?g:null))}),c))}recalculateAndSaveOverlays(e,t){let n=Ws(),i=new pe((o,c)=>o-c),s=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let c of o)c.keys().forEach(u=>{let h=t.get(u);if(h===null)return;let f=n.get(u)||nt.empty();f=c.applyToLocalView(h,f),n.set(u,f);let g=(i.get(c.batchId)||Y()).add(u);i=i.insert(c.batchId,g)})}).next(()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),h=u.key,f=u.value,g=qI();f.forEach(y=>{if(!s.has(y)){let T=KI(t.get(y),n.get(y));T!==null&&g.set(y,T),s=s.add(y)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,g))}return S.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(o){return L.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Zf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):S.resolve(xt()),c=Hs,u=s;return o.next(h=>S.forEach(h,(f,g)=>(c<g.largestBatchId&&(c=g.largestBatchId),s.get(f)?S.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{u=u.insert(f,y)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,u,h,Y())).next(f=>({batchId:c,changes:$I(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(n=>{let i=$s();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,o=$s();return this.indexManager.getCollectionParents(e,s).next(c=>S.forEach(c,u=>{let h=function(g,y){return new Ft(y,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((g,y)=>{o=o.insert(g,y)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(o=>{s.forEach((u,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,xe.newInvalidDocument(f)))});let c=$s();return o.forEach((u,h)=>{let f=s.get(u);f!==void 0&&Gs(f.mutation,h,nt.empty(),J.now()),To(t,h)&&(c=c.insert(u,h))}),c})}};Kd=class{constructor(e){this.serializer=e,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(e,t){return S.resolve(this.Fr.get(t))}saveBundleMetadata(e,t){return this.Fr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Qe(i.createTime)}}(t)),S.resolve()}getNamedQuery(e,t){return S.resolve(this.Mr.get(t))}saveNamedQuery(e,t){return this.Mr.set(t.name,function(i){return{name:i.name,query:uw(i.bundledQuery),readTime:Qe(i.readTime)}}(t)),S.resolve()}};Qd=class{constructor(){this.overlays=new pe(L.comparator),this.Or=new Map}getOverlay(e,t){return S.resolve(this.overlays.get(t))}getOverlays(e,t){let n=xt();return S.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.St(e,t,s)}),S.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Or.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Or.delete(n)),S.resolve()}getOverlaysForCollection(e,t,n){let i=xt(),s=t.length+1,o=new L(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>n&&i.set(u.getKey(),u)}return S.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new pe((h,f)=>h-f),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);f===null&&(f=xt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let c=xt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,f)=>c.set(h,f)),!(c.size()>=i)););return S.resolve(c)}St(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let o=this.Or.get(i.largestBatchId).delete(n.key);this.Or.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new so(t,n));let s=this.Or.get(t);s===void 0&&(s=Y(),this.Or.set(t,s)),this.Or.set(t,s.add(n.key))}};Yd=class{constructor(){this.sessionToken=Ae.EMPTY_BYTE_STRING}getSessionToken(e){return S.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,S.resolve()}};co=class{constructor(){this.Nr=new ce(we.Br),this.Lr=new ce(we.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(e,t){let n=new we(e,t);this.Nr=this.Nr.add(n),this.Lr=this.Lr.add(n)}qr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Qr(new we(e,t))}$r(e,t){e.forEach(n=>this.removeReference(n,t))}Ur(e){let t=new L(new se([])),n=new we(t,e),i=new we(t,e+1),s=[];return this.Lr.forEachInRange([n,i],o=>{this.Qr(o),s.push(o.key)}),s}Kr(){this.Nr.forEach(e=>this.Qr(e))}Qr(e){this.Nr=this.Nr.delete(e),this.Lr=this.Lr.delete(e)}Wr(e){let t=new L(new se([])),n=new we(t,e),i=new we(t,e+1),s=Y();return this.Lr.forEachInRange([n,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new we(e,0),n=this.Nr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},we=class{constructor(e,t){this.key=e,this.Gr=t}static Br(e,t){return L.comparator(e.key,t.key)||H(e.Gr,t.Gr)}static kr(e,t){return H(e.Gr,t.Gr)||L.comparator(e.key,t.key)}};Jd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Jn=1,this.zr=new ce(we.Br)}checkEmpty(e){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new io(s,t,n,i);this.mutationQueue.push(o);for(let c of i)this.zr=this.zr.add(new we(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return S.resolve(o)}lookupMutationBatch(e,t){return S.resolve(this.jr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.Hr(n),s=i<0?0:i;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?_r:this.Jn-1)}getAllMutationBatches(e){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new we(t,0),i=new we(t,Number.POSITIVE_INFINITY),s=[];return this.zr.forEachInRange([n,i],o=>{let c=this.jr(o.Gr);s.push(c)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ce(H);return t.forEach(i=>{let s=new we(i,0),o=new we(i,Number.POSITIVE_INFINITY);this.zr.forEachInRange([s,o],c=>{n=n.add(c.Gr)})}),S.resolve(this.Jr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;L.isDocumentKey(s)||(s=s.child(""));let o=new we(new L(s),0),c=new ce(H);return this.zr.forEachWhile(u=>{let h=u.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(c=c.add(u.Gr)),!0)},o),S.resolve(this.Jr(c))}Jr(e){let t=[];return e.forEach(n=>{let i=this.jr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){B(this.Yr(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.zr;return S.forEach(t.mutations,i=>{let s=new we(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.zr=n})}Xn(e){}containsKey(e,t){let n=new we(t,0),i=this.zr.firstAfterOrEqual(n);return S.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,S.resolve()}Yr(e,t){return this.Hr(e)}Hr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}jr(e){let t=this.Hr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};Xd=class{constructor(e){this.Zr=e,this.docs=function(){return new pe(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,o=this.Zr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return S.resolve(n?n.document.mutableCopy():xe.newInvalidDocument(t))}getEntries(e,t){let n=rt();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():xe.newInvalidDocument(i))}),S.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=rt(),o=t.path,c=new L(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:h,value:{document:f}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||zf(dI(f),n)<=0||(i.has(f.key)||To(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(e,t,n,i){F(9500)}Xr(e,t){return S.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Zd(this)}getSize(e){return S.resolve(this.size)}},Zd=class extends Vc{constructor(e){super(),this.vr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.vr.addEntry(e,i)):this.vr.removeEntry(n)}),S.waitFor(t)}getFromCache(e,t){return this.vr.getEntry(e,t)}getAllFromCache(e,t){return this.vr.getEntries(e,t)}};ef=class{constructor(e){this.persistence=e,this.ei=new It(t=>Tr(t),wo),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.ti=0,this.ni=new co,this.targetCount=0,this.ri=Ni.rr()}forEachTarget(e,t){return this.ei.forEach((n,i)=>t(i)),S.resolve()}getLastRemoteSnapshotVersion(e){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return S.resolve(this.ti)}allocateTargetId(e){return this.highestTargetId=this.ri.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ti&&(this.ti=t),S.resolve()}ar(e){this.ei.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ri=new Ni(t),this.highestTargetId=t),e.sequenceNumber>this.ti&&(this.ti=e.sequenceNumber)}addTargetData(e,t){return this.ar(t),this.targetCount+=1,S.resolve()}updateTargetData(e,t){return this.ar(t),S.resolve()}removeTargetData(e,t){return this.ei.delete(t.target),this.ni.Ur(t.targetId),this.targetCount-=1,S.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.ei.forEach((o,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.ei.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),S.waitFor(s).next(()=>i)}getTargetCount(e){return S.resolve(this.targetCount)}getTargetData(e,t){let n=this.ei.get(t)||null;return S.resolve(n)}addMatchingKeys(e,t,n){return this.ni.qr(t,n),S.resolve()}removeMatchingKeys(e,t,n){this.ni.$r(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),S.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.ni.Ur(t),S.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ni.Wr(t);return S.resolve(n)}containsKey(e,t){return S.resolve(this.ni.containsKey(t))}};uo=class{constructor(e,t){this.ii={},this.overlays={},this.si=new vt(0),this.oi=!1,this.oi=!0,this._i=new Yd,this.referenceDelegate=e(this),this.ai=new ef(this),this.indexManager=new Ud,this.remoteDocumentCache=function(i){return new Xd(i)}(n=>this.referenceDelegate.ui(n)),this.serializer=new Sc(t),this.ci=new Kd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Qd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ii[e.toKey()];return n||(n=new Jd(t,this.referenceDelegate),this.ii[e.toKey()]=n),n}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(e,t,n){O("MemoryPersistence","Starting transaction:",e);let i=new tf(this.si.next());return this.referenceDelegate.li(),n(i).next(s=>this.referenceDelegate.hi(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Pi(e,t){return S.or(Object.values(this.ii).map(n=>()=>n.containsKey(e,t)))}},tf=class extends sc{constructor(e){super(),this.currentSequenceNumber=e}},Mc=class r{constructor(e){this.persistence=e,this.Ti=new co,this.Ii=null}static Ei(e){return new r(e)}get di(){if(this.Ii)return this.Ii;throw F(60996)}addReference(e,t,n){return this.Ti.addReference(n,t),this.di.delete(n.toString()),S.resolve()}removeReference(e,t,n){return this.Ti.removeReference(n,t),this.di.add(n.toString()),S.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),S.resolve()}removeTarget(e,t){this.Ti.Ur(t.targetId).forEach(i=>this.di.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.di.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}li(){this.Ii=new Set}hi(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.di,n=>{let i=L.fromPath(n);return this.Ai(e,i).next(s=>{s||t.removeEntry(i,z.min())})}).next(()=>(this.Ii=null,t.apply(e)))}updateLimboDocument(e,t){return this.Ai(e,t).next(n=>{n?this.di.delete(t.toString()):this.di.add(t.toString())})}ui(e){return 0}Ai(e,t){return S.or([()=>S.resolve(this.Ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Pi(e,t)])}},Fc=class r{constructor(e,t){this.persistence=e,this.Ri=new It(n=>qe(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=_w(this,t)}static Ei(e,t){return new r(e,t)}li(){}hi(e){return S.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.Vr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Vr(e){let t=0;return this.Ar(e,n=>{t++}).next(()=>t)}Ar(e,t){return S.forEach(this.Ri,(n,i)=>this.gr(e,n,i).next(s=>s?S.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.Xr(e,o=>this.gr(e,o,t).next(c=>{c||(n++,s.removeEntry(o,z.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.Ri.set(t,e.currentSequenceNumber),S.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),S.resolve()}removeReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),S.resolve()}updateLimboDocument(e,t){return this.Ri.set(t,e.currentSequenceNumber),S.resolve()}ui(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ja(e.data.value)),t}gr(e,t,n){return S.or([()=>this.persistence.Pi(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.Ri.get(t);return S.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};nf=class{constructor(e){this.serializer=e}q(e,t,n,i){let s=new oc("createOrUpgrade",t);n<1&&i>=1&&(function(u){u.createObjectStore(Io)}(e),function(u){u.createObjectStore(Ys,{keyPath:EC}),u.createObjectStore(yt,{keyPath:rv,autoIncrement:!0}).createIndex(fr,iv,{unique:!0}),u.createObjectStore(vi)}(e),zv(e),function(u){u.createObjectStore(cr)}(e));let o=S.resolve();return n<3&&i>=3&&(n!==0&&(function(u){u.deleteObjectStore(wi),u.deleteObjectStore(Ii),u.deleteObjectStore(yr)}(e),zv(e)),o=o.next(()=>function(u){let h=u.store(yr),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return h.put(uc,f)}(s))),n<4&&i>=4&&(n!==0&&(o=o.next(()=>function(u,h){return h.store(yt).J().next(g=>{u.deleteObjectStore(yt),u.createObjectStore(yt,{keyPath:rv,autoIncrement:!0}).createIndex(fr,iv,{unique:!0});let y=h.store(yt),T=g.map(D=>y.put(D));return S.waitFor(T)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore(Ei,{keyPath:DC})})(e)})),n<5&&i>=5&&(o=o.next(()=>this.Vi(s))),n<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore(Js)}(e),this.mi(s)))),n<7&&i>=7&&(o=o.next(()=>this.fi(s))),n<8&&i>=8&&(o=o.next(()=>this.gi(e,s))),n<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&i>=10&&(o=o.next(()=>this.pi(s))),n<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore(au,{keyPath:NC})})(e),function(u){u.createObjectStore(cu,{keyPath:OC})}(e)})),n<12&&i>=12&&(o=o.next(()=>{(function(u){let h=u.createObjectStore(uu,{keyPath:BC});h.createIndex(od,$C,{unique:!1}),h.createIndex(II,qC,{unique:!1})})(e)})),n<13&&i>=13&&(o=o.next(()=>function(u){let h=u.createObjectStore(cc,{keyPath:AC});h.createIndex(Qa,bC),h.createIndex(gI,RC)}(e)).next(()=>this.yi(e,s)).next(()=>e.deleteObjectStore(cr))),n<14&&i>=14&&(o=o.next(()=>this.wi(e,s))),n<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore(Hf,{keyPath:xC,autoIncrement:!0}).createIndex(sd,VC,{unique:!1}),u.createObjectStore(lc,{keyPath:LC}).createIndex(yI,MC,{unique:!1}),u.createObjectStore(hc,{keyPath:FC}).createIndex(vI,UC,{unique:!1})}(e))),n<16&&i>=16&&(o=o.next(()=>{t.objectStore(lc).clear()}).next(()=>{t.objectStore(hc).clear()})),n<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore(Kf,{keyPath:jC})})(e)})),o}mi(e){let t=0;return e.store(cr).te((n,i)=>{t+=Nc(i)}).next(()=>{let n={byteSize:t};return e.store(Js).put(id,n)})}Vi(e){let t=e.store(Ys),n=e.store(yt);return t.J().next(i=>S.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,_r],[s.userId,s.lastAcknowledgedBatchId]);return n.J(fr,o).next(c=>S.forEach(c,u=>{B(u.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});let h=lr(this.serializer,u);return fw(e,s.userId,h).next(()=>{})}))}))}fi(e){let t=e.store(wi),n=e.store(cr);return e.store(yr).get(uc).next(i=>{let s=[];return n.te((o,c)=>{let u=new se(o),h=function(g){return[0,qe(g)]}(u);s.push(t.get(h).next(f=>f?S.resolve():(g=>t.put({targetId:0,path:qe(g),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>S.waitFor(s))})}gi(e,t){e.createObjectStore(Xs,{keyPath:kC});let n=t.store(Xs),i=new ao,s=o=>{if(i.add(o)){let c=o.lastSegment(),u=o.popLast();return n.put({collectionId:c,parent:qe(u)})}};return t.store(cr).te({ee:!0},(o,c)=>{let u=new se(o);return s(u.popLast())}).next(()=>t.store(vi).te({ee:!0},([o,c,u],h)=>{let f=Ot(c);return s(f.popLast())}))}pi(e){let t=e.store(Ii);return t.te((n,i)=>{let s=qs(i),o=cw(this.serializer,s);return t.put(o)})}yi(e,t){let n=t.store(cr),i=[];return n.te((s,o)=>{let c=t.store(cc),u=function(g){return g.document?new L(se.fromString(g.document.name).popFirst(5)):g.noDocument?L.fromSegments(g.noDocument.path):g.unknownDocument?L.fromSegments(g.unknownDocument.path):F(36783)}(o).path.toArray(),h={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(c.put(h))}).next(()=>S.waitFor(i))}wi(e,t){let n=t.store(yt),i=yw(this.serializer),s=new uo(Mc.Ei,this.serializer.wt);return n.J().next(o=>{let c=new Map;return o.forEach(u=>{var h;let f=(h=c.get(u.userId))!==null&&h!==void 0?h:Y();lr(this.serializer,u).keys().forEach(g=>f=f.add(g)),c.set(u.userId,f)}),S.forEach(c,(u,h)=>{let f=new Ee(h),g=Pc.bt(this.serializer,f),y=s.getIndexManager(f),T=Oc.bt(f,this.serializer,y,s.referenceDelegate);return new Lc(i,T,g,y).recalculateAndSaveOverlaysForDocumentKeys(new Zs(t,vt.le),u).next()})})}};kn="IndexedDbPersistence",$h=18e5,qh=5e3,jh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",PP="main",rf=class r{constructor(e,t,n,i,s,o,c,u,h,f,g=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.bi=s,this.window=o,this.document=c,this.Si=h,this.Di=f,this.Ci=g,this.si=null,this.oi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fi=null,this.inForeground=!1,this.Mi=null,this.xi=null,this.Oi=Number.NEGATIVE_INFINITY,this.Ni=y=>Promise.resolve(),!r.C())throw new x(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new zd(this,i),this.Bi=t+PP,this.serializer=new Sc(u),this.Li=new yi(this.Bi,this.Ci,new nf(this.serializer)),this._i=new Nd,this.ai=new $d(this.referenceDelegate,this.serializer),this.remoteDocumentCache=yw(this.serializer),this.ci=new Dd,this.window&&this.window.localStorage?this.ki=this.window.localStorage:(this.ki=null,f===!1&&He(kn,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.qi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,jh);return this.Qi(),this.$i(),this.Ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ai.getHighestSequenceNumber(e))}).then(e=>{this.si=new vt(e,this.Si)}).then(()=>{this.oi=!0}).catch(e=>(this.Li&&this.Li.close(),Promise.reject(e)))}Ki(e){return this.Ni=t=>p(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Li.U(t=>p(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.bi.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.qi())})))}qi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ga(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Wi(e).next(t=>{t||(this.isPrimary=!1,this.bi.enqueueRetryable(()=>this.Ni(!1)))})}).next(()=>this.Gi(e)).next(t=>this.isPrimary&&!t?this.zi(e).next(()=>!1):!!t&&this.ji(e).next(()=>!0))).catch(e=>{if(qn(e))return O(kn,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return O(kn,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.bi.enqueueRetryable(()=>this.Ni(e)),this.isPrimary=e})}Wi(e){return Bs(e).get(Zr).next(t=>S.resolve(this.Hi(t)))}Ji(e){return Ga(e).delete(this.clientId)}Yi(){return p(this,null,function*(){if(this.isPrimary&&!this.Zi(this.Oi,$h)){this.Oi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=be(t,Ei);return n.J().next(i=>{let s=this.Xi(i,$h),o=i.filter(c=>s.indexOf(c)===-1);return S.forEach(o,c=>n.delete(c.clientId)).next(()=>o)})}).catch(()=>[]);if(this.ki)for(let t of e)this.ki.removeItem(this.es(t.clientId))}})}Ui(){this.xi=this.bi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.qi().then(()=>this.Yi()).then(()=>this.Ui()))}Hi(e){return!!e&&e.ownerId===this.clientId}Gi(e){return this.Di?S.resolve(!0):Bs(e).get(Zr).next(t=>{if(t!==null&&this.Zi(t.leaseTimestampMs,qh)&&!this.ts(t.ownerId)){if(this.Hi(t)&&this.networkEnabled)return!0;if(!this.Hi(t)){if(!t.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,jh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ga(e).J().next(n=>this.Xi(n,qh).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,c=this.networkEnabled===i.networkEnabled;if(s||o&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&O(kn,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return p(this,null,function*(){this.oi=!1,this.ns(),this.xi&&(this.xi.cancel(),this.xi=null),this.rs(),this.ss(),yield this.Li.runTransaction("shutdown","readwrite",[Io,Ei],e=>{let t=new Zs(e,vt.le);return this.zi(t).next(()=>this.Ji(t))}),this.Li.close(),this._s()})}Xi(e,t){return e.filter(n=>this.Zi(n.updateTimeMs,t)&&!this.ts(n.clientId))}us(){return this.runTransaction("getActiveClients","readonly",e=>Ga(e).J().next(t=>this.Xi(t,$h).map(n=>n.clientId)))}get started(){return this.oi}getGlobalsCache(){return this._i}getMutationQueue(e,t){return Oc.bt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Bd(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return Pc.bt(this.serializer,e)}getBundleCache(){return this.ci}runTransaction(e,t,n){O(kn,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===17?GC:u===16?WC:u===15?Qf:u===14?TI:u===13?EI:u===12?zC:u===11?wI:void F(60245)}(this.Ci),o;return this.Li.runTransaction(e,i,s,c=>(o=new Zs(c,this.si?this.si.next():vt.le),t==="readwrite-primary"?this.Wi(o).next(u=>!!u||this.Gi(o)).next(u=>{if(!u)throw He(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.bi.enqueueRetryable(()=>this.Ni(!1)),new x(P.FAILED_PRECONDITION,fI);return n(o)}).next(u=>this.ji(o).next(()=>u)):this.cs(o).next(()=>n(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}cs(e){return Bs(e).get(Zr).next(t=>{if(t!==null&&this.Zi(t.leaseTimestampMs,qh)&&!this.ts(t.ownerId)&&!this.Hi(t)&&!(this.Di||this.allowTabSynchronization&&t.allowTabSynchronization))throw new x(P.FAILED_PRECONDITION,jh)})}ji(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Bs(e).put(Zr,t)}static C(){return yi.C()}zi(e){let t=Bs(e);return t.get(Zr).next(n=>this.Hi(n)?(O(kn,"Releasing primary lease."),t.delete(Zr)):S.resolve())}Zi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(He(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Qi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Mi=()=>{this.bi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.qi()))},this.document.addEventListener("visibilitychange",this.Mi),this.inForeground=this.document.visibilityState==="visible")}rs(){this.Mi&&(this.document.removeEventListener("visibilitychange",this.Mi),this.Mi=null)}$i(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Fi=()=>{this.ns();let t=/(?:Version|Mobile)\/1[456]/;yl()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.bi.enterRestrictedMode(!0),this.bi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Fi))}ss(){this.Fi&&(this.window.removeEventListener("pagehide",this.Fi),this.Fi=null)}ts(e){var t;try{let n=((t=this.ki)===null||t===void 0?void 0:t.getItem(this.es(e)))!==null;return O(kn,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return He(kn,"Failed to get zombied client id.",n),!1}}ns(){if(this.ki)try{this.ki.setItem(this.es(this.clientId),String(Date.now()))}catch(e){He("Failed to set zombie client id.",e)}}_s(){if(this.ki)try{this.ki.removeItem(this.es(this.clientId))}catch{}}es(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};sf=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.ls=n,this.hs=i}static Ps(e,t){let n=Y(),i=Y();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};of=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};Uc=class{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=function(){return yl()?8:pI(_e())>0?6:4}()}initialize(e,t){this.As=e,this.indexManager=t,this.Ts=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.Rs(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Vs(e,t,i,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new of;return this.fs(e,t,o).next(c=>{if(s.result=c,this.Is)return this.gs(e,t,o,c.size)})}).next(()=>s.result)}gs(e,t,n,i){return n.documentReadCount<this.Es?(si()<=Z.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",oi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),S.resolve()):(si()<=Z.DEBUG&&O("QueryEngine","Query:",oi(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ds*i?(si()<=Z.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",oi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ut(t))):S.resolve())}Rs(e,t){if(gv(t))return S.resolve(null);let n=ut(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=yc(t,null,"F"),n=ut(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let o=Y(...s);return this.As.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,n).next(u=>{let h=this.ps(t,c);return this.ys(t,h,o,u.readTime)?this.Rs(e,yc(t,null,"F")):this.ws(e,h,t,u)}))})))}Vs(e,t,n,i){return gv(t)||i.isEqual(z.min())?S.resolve(null):this.As.getDocuments(e,n).next(s=>{let o=this.ps(t,s);return this.ys(t,o,n,i)?S.resolve(null):(si()<=Z.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),oi(t)),this.ws(e,o,t,vC(i,Hs)).next(c=>c))})}ps(e,t){let n=new ce(UI(e));return t.forEach((i,s)=>{To(e,s)&&(n=n.add(s))}),n}ys(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}fs(e,t,n){return si()<=Z.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",oi(t)),this.As.getDocumentsMatchingQuery(e,t,lt.min(),n)}ws(e,t,n,i){return this.As.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};rp="LocalStore",DP=3e8,af=class{constructor(e,t,n,i){this.persistence=e,this.bs=t,this.serializer=i,this.Ss=new pe(H),this.Ds=new It(s=>Tr(s),wo),this.vs=new Map,this.Cs=e.getRemoteDocumentCache(),this.ai=e.getTargetCache(),this.ci=e.getBundleCache(),this.Fs(n)}Fs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Lc(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ss))}};Bc=class{constructor(){this.activeTargetIds=sP()}$s(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Qs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},$c=class{constructor(){this.So=new Bc,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.So.$s(e),this.Do[e]||"not-current"}updateQueryState(e,t,n){this.Do[e]=t}removeLocalQueryTarget(e){this.So.Us(e)}isLocalQueryTarget(e){return this.So.activeTargetIds.has(e)}clearQueryState(e){delete this.Do[e]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(e){return this.So.activeTargetIds.has(e)}start(){return this.So=new Bc,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};uf=class{vo(e){}shutdown(){}};Gv="ConnectivityMonitor",qc=class{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(e){this.Oo.push(e)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){O(Gv,"Network connectivity changed: AVAILABLE");for(let e of this.Oo)e(0)}xo(){O(Gv,"Network connectivity changed: UNAVAILABLE");for(let e of this.Oo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};Ha=null;zh="RestConnection",FP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},hf=class{get Bo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Lo=t+"://"+e.host,this.ko=`projects/${n}/databases/${i}`,this.qo=this.databaseId.database===to?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Qo(e,t,n,i,s){let o=lf(),c=this.$o(e,t.toUriEncodedString());O(zh,`Sending RPC '${e}' ${o}:`,c,n);let u={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};return this.Uo(u,i,s),this.Ko(e,c,u,n).then(h=>(O(zh,`Received RPC '${e}' ${o}: `,h),h),h=>{throw mi(zh,`RPC '${e}' ${o} failed with error: `,h,"url: ",c,"request:",n),h})}Wo(e,t,n,i,s,o){return this.Qo(e,t,n,i,s)}Uo(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Fi}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),n&&n.headers.forEach((i,s)=>e[s]=i)}$o(e,t){let n=FP[e];return`${this.Lo}/v1/${t}:${n}`}terminate(){}};df=class{constructor(e){this.Go=e.Go,this.zo=e.zo}jo(e){this.Ho=e}Jo(e){this.Yo=e}Zo(e){this.Xo=e}onMessage(e){this.e_=e}close(){this.zo()}send(e){this.Go(e)}t_(){this.Ho()}n_(){this.Yo()}r_(e){this.Xo(e)}i_(e){this.e_(e)}};$e="WebChannelConnection",ff=class extends hf{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ko(e,t,n,i){let s=lf();return new Promise((o,c)=>{let u=new Vh;u.setWithCredentials(!0),u.listenOnce(Lh.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Ls.NO_ERROR:let f=u.getResponseJson();O($e,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),o(f);break;case Ls.TIMEOUT:O($e,`RPC '${e}' ${s} timed out`),c(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case Ls.HTTP_ERROR:let g=u.getStatus();if(O($e,`RPC '${e}' ${s} failed with status:`,g,"response text:",u.getResponseText()),g>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);let T=y==null?void 0:y.error;if(T&&T.status&&T.message){let D=function(k){let q=k.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(q)>=0?q:P.UNKNOWN}(T.status);c(new x(D,T.message))}else c(new x(P.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new x(P.UNAVAILABLE,"Connection failed."));break;default:F(9055,{s_:e,streamId:s,o_:u.getLastErrorCode(),__:u.getLastError()})}}finally{O($e,`RPC '${e}' ${s} completed.`)}});let h=JSON.stringify(i);O($e,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",h,n,15)})}a_(e,t,n){let i=lf(),s=[this.Lo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Uh(),c=Fh(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Uo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;let f=s.join("");O($e,`Creating RPC '${e}' stream ${i}: ${f}`,u);let g=o.createWebChannel(f,u),y=!1,T=!1,D=new df({Go:k=>{T?O($e,`Not sending because RPC '${e}' stream ${i} is closed:`,k):(y||(O($e,`Opening RPC '${e}' stream ${i} transport.`),g.open(),y=!0),O($e,`RPC '${e}' stream ${i} sending:`,k),g.send(k))},zo:()=>g.close()}),N=(k,q,U)=>{k.listen(q,M=>{try{U(M)}catch(j){setTimeout(()=>{throw j},0)}})};return N(g,Xr.EventType.OPEN,()=>{T||(O($e,`RPC '${e}' stream ${i} transport opened.`),D.t_())}),N(g,Xr.EventType.CLOSE,()=>{T||(T=!0,O($e,`RPC '${e}' stream ${i} transport closed`),D.r_())}),N(g,Xr.EventType.ERROR,k=>{T||(T=!0,mi($e,`RPC '${e}' stream ${i} transport errored. Name:`,k.name,"Message:",k.message),D.r_(new x(P.UNAVAILABLE,"The operation could not be completed")))}),N(g,Xr.EventType.MESSAGE,k=>{var q;if(!T){let U=k.data[0];B(!!U,16349);let M=U,j=(M==null?void 0:M.error)||((q=M[0])===null||q===void 0?void 0:q.error);if(j){O($e,`RPC '${e}' stream ${i} received error:`,j);let X=j.status,G=function(I){let E=Ie[I];if(E!==void 0)return YI(E)}(X),w=j.message;G===void 0&&(G=P.INTERNAL,w="Unknown error status: "+X+" with message "+j.message),T=!0,D.r_(new x(G,w)),g.close()}else O($e,`RPC '${e}' stream ${i} received:`,U),D.i_(U)}}),N(c,Mh.STAT_EVENT,k=>{k.stat===qa.PROXY?O($e,`RPC '${e}' stream ${i} detected buffering proxy`):k.stat===qa.NOPROXY&&O($e,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{D.n_()},0),D}};jc=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.bi=e,this.timerId=t,this.u_=n,this.c_=i,this.l_=s,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(e){this.cancel();let t=Math.floor(this.h_+this.d_()),n=Math.max(0,Date.now()-this.T_),i=Math.max(0,t-n);i>0&&O("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.h_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,i,()=>(this.T_=Date.now(),e())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){this.P_!==null&&(this.P_.skipDelay(),this.P_=null)}cancel(){this.P_!==null&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}};Hv="PersistentStream",zc=class{constructor(e,t,n,i,s,o,c,u){this.bi=e,this.R_=n,this.V_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new jc(e,t)}w_(){return this.state===1||this.state===5||this.b_()}b_(){return this.state===2||this.state===3}start(){this.p_=0,this.state!==4?this.auth():this.S_()}stop(){return p(this,null,function*(){this.w_()&&(yield this.close(0))})}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&this.f_===null&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(e){this.M_(),this.stream.send(e)}C_(){return p(this,null,function*(){if(this.b_())return this.close(0)})}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}close(e,t){return p(this,null,function*(){this.M_(),this.x_(),this.y_.cancel(),this.m_++,e!==4?this.y_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(He(t.toString()),He("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.O_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Zo(t)})}O_(){}auth(){this.state=1;let e=this.N_(this.m_),t=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.m_===t&&this.B_(n,i)},n=>{e(()=>{let i=new x(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.L_(i)})})}B_(e,t){let n=this.N_(this.m_);this.stream=this.k_(e,t),this.stream.jo(()=>{n(()=>this.listener.jo())}),this.stream.Jo(()=>{n(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(i=>{n(()=>this.L_(i))}),this.stream.onMessage(i=>{n(()=>++this.p_==1?this.q_(i):this.onNext(i))})}S_(){this.state=5,this.y_.E_(()=>p(this,null,function*(){this.state=0,this.start()}))}L_(e){return O(Hv,`close with error: ${e}`),this.stream=null,this.close(4,e)}N_(e){return t=>{this.bi.enqueueAndForget(()=>this.m_===e?t():(O(Hv,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},pf=class extends zc{constructor(e,t,n,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}k_(e,t){return this.connection.a_("Listen",e,t)}q_(e){return this.onNext(e)}onNext(e){this.y_.reset();let t=vP(this.serializer,e),n=function(s){if(!("targetChange"in s))return z.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?z.min():o.readTime?Qe(o.readTime):z.min()}(e);return this.listener.Q_(t,n)}U_(e){let t={};t.database=Pd(this.serializer),t.addTarget=function(s,o){let c,u=o.target;if(c=gc(u)?{documents:nw(s,u)}:{query:rw(s,u).gt},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=JI(s,o.resumeToken);let h=Sd(s,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(z.min())>0){c.readTime=ki(s,o.snapshotVersion.toTimestamp());let h=Sd(s,o.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);let n=wP(this.serializer,e);n&&(t.labels=n),this.F_(t)}K_(e){let t={};t.database=Pd(this.serializer),t.removeTarget=e,this.F_(t)}},mf=class extends zc{constructor(e,t,n,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(e,t){return this.connection.a_("Write",e,t)}q_(e){return B(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,B(!e.writeResults||e.writeResults.length===0,55816),this.listener.z_()}onNext(e){B(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.y_.reset();let t=IP(e.writeResults,e.commitTime),n=Qe(e.commitTime);return this.listener.j_(n,t)}H_(){let e={};e.database=Pd(this.serializer),this.F_(e)}G_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>Rc(this.serializer,n))};this.F_(t)}};gf=class{},_f=class extends gf{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.J_=!1}Y_(){if(this.J_)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(e,t,n,i){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Qo(e,Cd(t,n),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(P.UNKNOWN,s.toString())})}Wo(e,t,n,i,s){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Wo(e,Cd(t,n),i,o,c,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new x(P.UNKNOWN,o.toString())})}terminate(){this.J_=!0,this.connection.terminate()}},yf=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){this.Z_===0&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(e){this.state==="Online"?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.na("Offline")))}set(e){this.sa(),this.Z_=0,e==="Online"&&(this.ea=!1),this.na(e)}na(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ra(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(He(t),this.ea=!1):O("OnlineStateTracker",t)}sa(){this.X_!==null&&(this.X_.cancel(),this.X_=null)}};Sr="RemoteStore",vf=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=s,this.ca.vo(o=>{n.enqueueAndForget(()=>p(this,null,function*(){kr(this)&&(O(Sr,"Restarting streams for network reachability change."),yield function(u){return p(this,null,function*(){let h=Q(u);h.aa.add(4),yield Ao(h),h.la.set("Unknown"),h.aa.delete(4),yield mu(h)})}(this))}))}),this.la=new yf(n,i)}};If=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new ct,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let o=Date.now()+n,c=new r(e,t,o,i,s);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};Gc=class r{static emptySet(e){return new r(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||L.comparator(t.key,n.key):(t,n)=>L.comparator(t.key,n.key),this.keyedMap=$s(),this.sortedSet=new pe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};Hc=class{constructor(){this.Ia=new pe(L.comparator)}track(e){let t=e.doc.key,n=this.Ia.get(t);n?e.type!==0&&n.type===3?this.Ia=this.Ia.insert(t,e):e.type===3&&n.type!==1?this.Ia=this.Ia.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.Ia=this.Ia.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.Ia=this.Ia.remove(t):e.type===1&&n.type===2?this.Ia=this.Ia.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):F(63341,{Vt:e,Ea:n}):this.Ia=this.Ia.insert(t,e)}da(){let e=[];return this.Ia.inorderTraversal((t,n)=>{e.push(n)}),e}},Oi=class r{constructor(e,t,n,i,s,o,c,u,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){let o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new r(e,t,Gc.emptySet(t),o,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};wf=class{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(e=>e.ma())}},Ef=class{constructor(){this.queries=Qv(),this.onlineState="Unknown",this.fa=new Set}terminate(){(function(t,n){let i=Q(t),s=i.queries;i.queries=Qv(),s.forEach((o,c)=>{for(let u of c.Ra)u.onError(n)})})(this,new x(P.ABORTED,"Firestore shutting down"))}};(Yv=Tf||(Tf={})).ya="default",Yv.Cache="cache";lo=class{constructor(e,t,n){this.query=e,this.wa=t,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=n||{}}pa(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new Oi(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ba?this.Da(e)&&(this.wa.next(e),t=!0):this.va(e,this.onlineState)&&(this.Ca(e),t=!0),this.Sa=e,t}onError(e){this.wa.error(e)}ga(e){this.onlineState=e;let t=!1;return this.Sa&&!this.ba&&this.va(this.Sa,e)&&(this.Ca(this.Sa),t=!0),t}va(e,t){if(!e.fromCache||!this.ma())return!0;let n=t!=="Offline";return(!this.options.Fa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Da(e){if(e.docChanges.length>0)return!0;let t=this.Sa&&this.Sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Ca(e){e=Oi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ba=!0,this.wa.next(e)}ma(){return this.options.source!==Tf.Cache}};Kc=class{constructor(e){this.key=e}},Qc=class{constructor(e){this.key=e}},Af=class{constructor(e,t){this.query=e,this.qa=t,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=Y(),this.mutatedKeys=Y(),this.Ua=UI(e),this.Ka=new Gc(this.Ua)}get Wa(){return this.qa}Ga(e,t){let n=t?t.za:new Hc,i=t?t.Ka:this.Ka,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,g)=>{let y=i.get(f),T=To(this.query,g)?g:null,D=!!y&&this.mutatedKeys.has(y.key),N=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations),k=!1;y&&T?y.data.isEqual(T.data)?D!==N&&(n.track({type:3,doc:T}),k=!0):this.ja(y,T)||(n.track({type:2,doc:T}),k=!0,(u&&this.Ua(T,u)>0||h&&this.Ua(T,h)<0)&&(c=!0)):!y&&T?(n.track({type:0,doc:T}),k=!0):y&&!T&&(n.track({type:1,doc:y}),k=!0,(u||h)&&(c=!0)),k&&(T?(o=o.add(T),s=N?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ka:o,za:n,ys:c,mutatedKeys:s}}ja(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.Ka;this.Ka=e.Ka,this.mutatedKeys=e.mutatedKeys;let o=e.za.da();o.sort((f,g)=>function(T,D){let N=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Vt:k})}};return N(T)-N(D)}(f.type,g.type)||this.Ua(f.doc,g.doc)),this.Ha(n),i=i!=null&&i;let c=t&&!i?this.Ja():[],u=this.$a.size===0&&this.current&&!i?1:0,h=u!==this.Qa;return this.Qa=u,o.length!==0||h?{snapshot:new Oi(this.query,e.Ka,s,o,e.mutatedKeys,u===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ya:c}:{Ya:c}}ga(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new Hc,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(e){return!this.qa.has(e)&&!!this.Ka.has(e)&&!this.Ka.get(e).hasLocalMutations}Ha(e){e&&(e.addedDocuments.forEach(t=>this.qa=this.qa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qa=this.qa.delete(t)),this.current=e.current)}Ja(){if(!this.current)return[];let e=this.$a;this.$a=Y(),this.Ka.forEach(n=>{this.Za(n.key)&&(this.$a=this.$a.add(n.key))});let t=[];return e.forEach(n=>{this.$a.has(n)||t.push(new Qc(n))}),this.$a.forEach(n=>{e.has(n)||t.push(new Kc(n))}),t}Xa(e){this.qa=e.Ns,this.$a=Y();let t=this.Ga(e.documents);return this.applyChanges(t,!0)}eu(){return Oi.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,this.Qa===0,this.hasCachedResults)}},dp="SyncEngine",bf=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Rf=class{constructor(e){this.key=e,this.tu=!1}},Sf=class{constructor(e,t,n,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.nu={},this.ru=new It(c=>FI(c),fu),this.iu=new Map,this.su=new Set,this.ou=new pe(L.comparator),this._u=new Map,this.au=new co,this.uu={},this.cu=new Map,this.lu=Ni.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return this.hu===!0}};pp=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=pu(t.databaseInfo.databaseId),this.sharedClientState=this.Au(t),this.persistence=this.Ru(t),yield this.persistence.start(),this.localStore=this.Vu(t),this.gcScheduler=this.mu(t,this.localStore),this.indexBackfillerScheduler=this.fu(t,this.localStore)})}mu(t,n){return null}fu(t,n){return null}Vu(t){return vw(this.persistence,new Uc,t.initialUser,this.serializer)}Ru(t){return new uo(Mc.Ei,this.serializer)}Au(t){return new $c}terminate(){return p(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),Pf=class extends pp{constructor(e){super(),this.cacheSizeBytes=e}mu(e,t){B(this.persistence.referenceDelegate instanceof Fc,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new xc(n,e.asyncQueue,t)}Ru(e){let t=this.cacheSizeBytes!==void 0?Ye.withCacheSize(this.cacheSizeBytes):Ye.DEFAULT;return new uo(n=>Fc.Ei(n,t),this.serializer)}},kf=class r extends pp{constructor(e,t,n){super(),this.gu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return p(this,null,function*(){yield Wt(r.prototype,this,"initialize").call(this,e),yield this.gu.initialize(this,e),yield xw(this.gu.syncEngine),yield bo(this.gu.remoteStore),yield this.persistence.Ki(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}Vu(e){return vw(this.persistence,new Uc,e.initialUser,this.serializer)}mu(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new xc(n,e.asyncQueue,t)}fu(e,t){let n=new rd(t,this.persistence);return new nd(e.asyncQueue,n)}Ru(e){let t=kP(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Ye.withCacheSize(this.cacheSizeBytes):Ye.DEFAULT;return new rf(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,UP(),ec(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Au(e){return new $c}},Vw=(()=>{class r{initialize(t,n){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Jv(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=uk.bind(null,this.syncEngine),yield YP(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Ef}()}createDatastore(t){let n=pu(t.databaseInfo.databaseId),i=function(o){return new ff(o)}(t.databaseInfo);return function(o,c,u,h){return new _f(o,c,u,h)}(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return function(i,s,o,c,u){return new vf(i,s,o,c,u)}(this.localStore,this.datastore,t.asyncQueue,n=>Jv(this.syncEngine,n,0),function(){return qc.C()?new qc:new uf}())}createSyncEngine(t,n){return function(s,o,c,u,h,f,g){let y=new Sf(s,o,c,u,h,f);return g&&(y.hu=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return p(this,null,function*(){var t,n;yield function(s){return p(this,null,function*(){let o=Q(s);O(Sr,"RemoteStore shutting down."),o.aa.add(5),yield Ao(o),o.ca.shutdown(),o.la.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();ho=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.pu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.pu(this.observer.error,e):He("Uncaught Error in snapshot listener:",e.toString()))}yu(){this.muted=!0}pu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};$n="FirestoreClient",Df=class{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ee.UNAUTHENTICATED,this.clientId=rc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,o=>p(this,null,function*(){O($n,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,o=>(O($n,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ct;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=cp(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};eI=new Map;Uw="firestore.googleapis.com",rI=!0,Jc=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Uw,this.ssl=rI}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:rI;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=dw;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<gw)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}mk("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Mw((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},xi=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Gh;switch(n.type){case"firstParty":return new Yh(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return p(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=eI.get(t);n&&(O("ComponentProvider","Removing Datastore"),eI.delete(t),n.terminate())}(this),Promise.resolve()}};Et=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},je=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new On(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}},On=class r extends Et{constructor(e,t,n){super(e,t,Eo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new je(this.firestore,null,new L(e))}withConverter(e){return new r(this.firestore,e,this._path)}};iI="AsyncQueue",Xc=class{constructor(e=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new jc(this,"async_queue_retry"),this.ju=()=>{let n=ec();n&&O(iI,"Visibility state changed to "+n.visibilityState),this.y_.A_()},this.Hu=e;let t=ec();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ju(),this.Yu(e)}enterRestrictedMode(e){if(!this.$u){this.$u=!0,this.Gu=e||!1;let t=ec();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.ju)}}enqueue(e){if(this.Ju(),this.$u)return new Promise(()=>{});let t=new ct;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qu.push(e),this.Zu()))}Zu(){return p(this,null,function*(){if(this.Qu.length!==0){try{yield this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(e){if(!qn(e))throw e;O(iI,"Operation failed with retryable error: "+e)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}})}Yu(e){let t=this.Hu.then(()=>(this.Wu=!0,e().catch(n=>{throw this.Ku=n,this.Wu=!1,He("INTERNAL UNHANDLED ERROR: ",sI(n)),n}).then(n=>(this.Wu=!1,n))));return this.Hu=t,t}enqueueAfterDelay(e,t,n){this.Ju(),this.zu.indexOf(e)>-1&&(t=0);let i=If.createAndSchedule(this,e,t,n,s=>this.Xu(s));return this.Uu.push(i),i}Ju(){this.Ku&&F(47125,{ec:sI(this.Ku)})}verifyOperationInProgress(){}tc(){return p(this,null,function*(){let e;do e=this.Hu,yield e;while(e!==this.Hu)})}nc(e){for(let t of this.Uu)if(t.timerId===e)return!0;return!1}rc(e){return this.tc().then(()=>{this.Uu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.Uu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.tc()})}sc(e){this.zu.push(e)}Xu(e){let t=this.Uu.indexOf(e);this.Uu.splice(t,1)}};Tt=class extends xi{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Xc,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}_terminate(){return p(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Xc(e),this._firestoreClient=void 0,yield e}})}};fo=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(Ae.fromBase64String(e))}catch(t){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(Ae.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};Vi=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Te(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};Li=class{constructor(e){this._methodName=e}};po=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return H(this._lat,e._lat)||H(this._long,e._long)}};mo=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}};yk=/^__.*__$/,Nf=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new wt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Un(e,this.data,t,this.fieldTransforms)}},Zc=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new wt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};Of=class r{constructor(e,t,n,i,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this._c(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(e){return new r(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ac({path:n,cc:!1});return i.lc(e),i}hc(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ac({path:n,cc:!1});return i._c(),i}Pc(e){return this.ac({path:void 0,cc:!0})}Tc(e){return tu(e,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}_c(){if(this.path)for(let e=0;e<this.path.length;e++)this.lc(this.path.get(e))}lc(e){if(e.length===0)throw this.Tc("Document fields must not be empty");if(zw(this.oc)&&yk.test(e))throw this.Tc('Document fields cannot begin and end with "__"')}},xf=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||pu(e)}dc(e,t,n,i=!1){return new Of({oc:e,methodName:t,Ec:n,path:Te.emptyPath(),cc:!1,Ic:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};eu=class r extends Li{_toFieldTransform(e){if(e.oc!==2)throw e.oc===1?e.Tc(`${this._methodName}() can only appear at the top level of your update data`):e.Tc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}},Vf=class r extends Li{_toFieldTransform(e){return new vc(e.path,new Ln)}isEqual(e){return e instanceof r}};wk=new RegExp("[~\\*/\\[\\]]");go=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new je(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Mf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(yu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Mf=class extends go{data(){return super.data()}};_o=class{},Cr=class extends _o{};yo=class r extends Cr{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=this._parse(e);return cE(e._query,t),new Et(e.firestore,e.converter,Id(e._query,t))}_parse(e){let t=So(e.firestore);return function(s,o,c,u,h,f,g){let y;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new x(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){cI(g,f);let D=[];for(let N of g)D.push(aI(u,s,N));y={arrayValue:{values:D}}}else y=aI(u,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||cI(g,f),y=Gw(c,o,g,f==="in"||f==="not-in");return ee.create(h,f,y)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};Mi=class r extends _o{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new r(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:oe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,c=s.getFlattenedFilters();for(let u of c)cE(o,u),o=Id(o,u)}(e._query,t),new Et(e.firestore,e.converter,Id(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};Ff=class r extends Cr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new r(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Er(s,o)}(e._query,this._field,this._direction);return new Et(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Ft(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};Uf=class r extends Cr{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){return new Et(e.firestore,e.converter,yc(e._query,this._limit,this._limitType))}};nu=class r extends Cr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=aE(e,this.type,this._docOrFields,this._inclusive);return new Et(e.firestore,e.converter,function(i,s){return new Ft(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};ru=class r extends Cr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=aE(e,this.type,this._docOrFields,this._inclusive);return new Et(e.firestore,e.converter,function(i,s){return new Ft(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};Bf=class{convertValue(e,t="none"){switch(xn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(un(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw F(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return jn(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;let s=(i=(n=(t=e.fields)===null||t===void 0?void 0:t[Ai].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(o=>fe(o.doubleValue));return new mo(s)}convertGeoPoint(e){return new po(fe(e.latitude),fe(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=hu(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(eo(e));default:return null}}convertTimestamp(e){let t=cn(e);return new J(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=se.fromString(e);B(aw(n),9688,{name:e});let i=new Ti(n.get(1),n.get(3)),s=new L(n.popFirst(5));return i.isEqual(t)||He(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};mr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},iu=class extends go{constructor(e,t,n,i,s,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new pi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(yu("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},pi=class extends iu{data(e={}){return super.data(e)}},su=class{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new mr(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new pi(this._firestore,this._userDataWriter,n.key,n,new mr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>{let u=new pi(i._firestore,i._userDataWriter,c.doc.key,c.doc,new mr(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let u=new pi(i._firestore,i._userDataWriter,c.doc.key,c.doc,new mr(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:Ek(c.type),doc:u,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};vo=class extends Bf{constructor(e){super(),this.firestore=e}convertBytes(e){return new fo(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new je(this.firestore,null,t)}};$f=class{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=Tk(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}};qf=class{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Vw.provider,this._offlineComponentProvider={build:t=>new kf(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}};(function(e,t=!0){(function(i){Fi=i})(Ct),et(new Ne("firestore",(n,{instanceIdentifier:i,options:s})=>{let o=n.getProvider("app").getImmediate(),c=new Tt(new Kh(n.getProvider("auth-internal")),new Jh(o,n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ti(h.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),le(Qy,Yy,e),le(Qy,Yy,"esm2017")})()});var Dr=W(()=>{"use strict";vE()});function vp(r,e){return e===void 0&&(e=Rk),new gs(function(t){var n=yp(r,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:n}})}function IE(r){return vp(r,{includeMetadataChanges:!0})}function wE(r,e){return e===void 0&&(e={}),IE(r).pipe(Ce(function(t){return Ip(t,e)}))}function Ip(r,e){var t;e===void 0&&(e={});var n=r.data(e);return!r.exists()||typeof n!="object"||n===null||!e.idField?n:Iu(Iu({},n),(t={},t[e.idField]=r.id,t))}function EE(r){return vp(r,{includeMetadataChanges:!0}).pipe(Ce(function(e){return e.docs}))}function TE(r,e){return e===void 0&&(e={}),EE(r).pipe(Ce(function(t){return t.map(function(n){return Ip(n,e)})}))}var Iu,Rk,AE=W(()=>{"use strict";Dr();_s();sg();Iu=function(){return Iu=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Iu.apply(this,arguments)};Rk={includeMetadataChanges:!1};});function Sk(r,e){let t=er(bE,r,e);return t&&new Nr(t)}function Ck(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new Nr(n)}}function RE(r,...e){return le("angularfire",kt.full,"fst"),yn([kk,Pk,{provide:Ep,useFactory:Ck(r),multi:!0,deps:[ot,vn,Dt,Jt,[new De,sr],[new De,bn],...e]}])}var Nr,bE,wp,Ep,Pk,kk,wu,SE,Tp,CE,ln,PE,hn,Ap,bp,Or,Eu,kE,DE,Rp,NE,Sp,Po,Cp,Pp,kp,Dp,Tu,ko=W(()=>{"use strict";Hr();he();Es();ya();Vs();En();AE();Dr();Dr();Nr=class{constructor(e){return e}},bE="firestore",wp=class{constructor(){return Tn(bE)}},Ep=new _n("angularfire2.firestore-instances");Pk={provide:wp,deps:[[new De,Ep]]},kk={provide:Nr,useFactory:Sk,deps:[[new De,Ep],pt]};wu=K(TE,!0),SE=K(wE,!0),Tp=K(gE,!0,2),CE=K(eE,!0,2),ln=K($w,!0,2),PE=K(mE,!0,2),hn=K(mp,!0,2),Ap=K(oE,!0,2),bp=K(sE,!0,2),Or=K(hE,!0),Eu=K(dE,!0),kE=K(jw,!0),DE=K(qw,!0),Rp=K(nE,!0,2),NE=K(Zw,!0,2),Sp=K(tE,!0,2),Po=K(Jw,!0,2),Cp=K(fE,!0,2),Pp=K(iE,!0,2),kp=K(rE,!0,2),Dp=K(pE,!0,2),Tu=K(Xw,!0,2)});function Np(r){return"storage/"+r}function Up(){let r="An unknown error occurred, please check the error payload for server response.";return new ge(ye.UNKNOWN,r)}function Ok(r){return new ge(ye.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function xk(r){return new ge(ye.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Vk(){let r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ge(ye.UNAUTHENTICATED,r)}function Lk(){return new ge(ye.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Mk(r){return new ge(ye.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function Fk(){return new ge(ye.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Uk(){return new ge(ye.CANCELED,"User canceled the upload/download.")}function Bk(r){return new ge(ye.INVALID_URL,"Invalid URL '"+r+"'.")}function $k(r){return new ge(ye.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function qk(){return new ge(ye.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+$E+"' property when initializing the app?")}function jk(){return new ge(ye.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function zk(){return new ge(ye.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Wk(r){return new ge(ye.UNSUPPORTED_ENVIRONMENT,`${r} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Op(r){return new ge(ye.INVALID_ARGUMENT,r)}function qE(){return new ge(ye.APP_DELETED,"The Firebase app was deleted.")}function Gk(r){return new ge(ye.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function No(r,e){return new ge(ye.INVALID_FORMAT,"String does not match format '"+r+"': "+e)}function Do(r){throw new ge(ye.INTERNAL_ERROR,"Internal error: "+r)}function Hk(r,e,t){let n=1,i=null,s=null,o=!1,c=0;function u(){return c===2}let h=!1;function f(...k){h||(h=!0,e.apply(null,k))}function g(k){i=setTimeout(()=>{i=null,r(T,u())},k)}function y(){s&&clearTimeout(s)}function T(k,...q){if(h){y();return}if(k){y(),f.call(null,k,...q);return}if(u()||o){y(),f.call(null,k,...q);return}n<64&&(n*=2);let M;c===1?(c=2,M=0):M=(n+Math.random())*1e3,g(M)}let D=!1;function N(k){D||(D=!0,y(),!h&&(i!==null?(k||(c=2),clearTimeout(i),g(0)):k||(c=1)))}return g(0),s=setTimeout(()=>{o=!0,N(!0)},t),N}function Kk(r){r(!1)}function Qk(r){return r!==void 0}function Yk(r){return typeof r=="object"&&!Array.isArray(r)}function Bp(r){return typeof r=="string"||r instanceof String}function OE(r){return $p()&&r instanceof Blob}function $p(){return typeof Blob<"u"}function Vp(r,e,t,n){if(n<e)throw Op(`Invalid value for '${r}'. Expected ${e} or greater.`);if(n>t)throw Op(`Invalid value for '${r}'. Expected ${t} or less.`)}function ji(r,e,t){let n=e;return t==null&&(n=`https://${e}`),`${t}://${n}/v0${r}`}function jE(r){let e=encodeURIComponent,t="?";for(let n in r)if(r.hasOwnProperty(n)){let i=e(n)+"="+e(r[n]);t=t+i+"&"}return t=t.slice(0,-1),t}function Jk(r,e){let t=r>=500&&r<600,i=[408,429].indexOf(r)!==-1,s=e.indexOf(r)!==-1;return t||i||s}function Xk(r,e){e!==null&&e.length>0&&(r.Authorization="Firebase "+e)}function Zk(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e!=null?e:"AppManager")}function eD(r,e){e&&(r["X-Firebase-GMPID"]=e)}function tD(r,e){e!==null&&(r["X-Firebase-AppCheck"]=e)}function nD(r,e,t,n,i,s,o=!0){let c=jE(r.urlParams),u=r.url+c,h=Object.assign({},r.headers);return eD(h,e),Xk(h,t),Zk(h,s),tD(h,n),new Lp(u,r.method,h,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,i,o)}function rD(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function iD(...r){let e=rD();if(e!==void 0){let t=new e;for(let n=0;n<r.length;n++)t.append(r[n]);return t.getBlob()}else{if($p())return new Blob(r);throw new ge(ye.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function sD(r,e,t){return r.webkitSlice?r.webkitSlice(e,t):r.mozSlice?r.mozSlice(e,t):r.slice?r.slice(e,t):null}function oD(r){if(typeof atob>"u")throw Wk("base-64");return atob(r)}function aD(r,e){switch(r){case Ut.RAW:return new Oo(zE(e));case Ut.BASE64:case Ut.BASE64URL:return new Oo(WE(r,e));case Ut.DATA_URL:return new Oo(uD(e),lD(e))}throw Up()}function zE(r){let e=[];for(let t=0;t<r.length;t++){let n=r.charCodeAt(t);if(n<=127)e.push(n);else if(n<=2047)e.push(192|n>>6,128|n&63);else if((n&64512)===55296)if(!(t<r.length-1&&(r.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{let s=n,o=r.charCodeAt(++t);n=65536|(s&1023)<<10|o&1023,e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63)}else(n&64512)===56320?e.push(239,191,189):e.push(224|n>>12,128|n>>6&63,128|n&63)}return new Uint8Array(e)}function cD(r){let e;try{e=decodeURIComponent(r)}catch{throw No(Ut.DATA_URL,"Malformed data URL.")}return zE(e)}function WE(r,e){switch(r){case Ut.BASE64:{let i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw No(r,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Ut.BASE64URL:{let i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw No(r,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=oD(e)}catch(i){throw i.message.includes("polyfill")?i:No(r,"Invalid character found")}let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}function uD(r){let e=new bu(r);return e.base64?WE(Ut.BASE64,e.rest):cD(e.rest)}function lD(r){return new bu(r).contentType}function hD(r,e){return r.length>=e.length?r.substring(r.length-e.length)===e:!1}function qp(r){let e;try{e=JSON.parse(r)}catch{return null}return Yk(e)?e:null}function dD(r){if(r.length===0)return null;let e=r.lastIndexOf("/");return e===-1?"":r.slice(0,e)}function fD(r,e){let t=e.split("/").filter(n=>n.length>0).join("/");return r.length===0?t:r+"/"+t}function GE(r){let e=r.lastIndexOf("/",r.length-2);return e===-1?r:r.slice(e+1)}function pD(r,e){return e}function mD(r){return!Bp(r)||r.length<2?r:GE(r)}function jp(){if(Au)return Au;let r=[];r.push(new Ve("bucket")),r.push(new Ve("generation")),r.push(new Ve("metageneration")),r.push(new Ve("name","fullPath",!0));function e(s,o){return mD(o)}let t=new Ve("name");t.xform=e,r.push(t);function n(s,o){return o!==void 0?Number(o):o}let i=new Ve("size");return i.xform=n,r.push(i),r.push(new Ve("timeCreated")),r.push(new Ve("updated")),r.push(new Ve("md5Hash",null,!0)),r.push(new Ve("cacheControl",null,!0)),r.push(new Ve("contentDisposition",null,!0)),r.push(new Ve("contentEncoding",null,!0)),r.push(new Ve("contentLanguage",null,!0)),r.push(new Ve("contentType",null,!0)),r.push(new Ve("metadata","customMetadata",!0)),Au=r,Au}function gD(r,e){function t(){let n=r.bucket,i=r.fullPath,s=new it(n,i);return e._makeStorageReference(s)}Object.defineProperty(r,"ref",{get:t})}function _D(r,e,t){let n={};n.type="file";let i=t.length;for(let s=0;s<i;s++){let o=t[s];n[o.local]=o.xform(n,e[o.server])}return gD(n,r),n}function HE(r,e,t){let n=qp(e);return n===null?null:_D(r,n,t)}function yD(r,e,t,n){let i=qp(e);if(i===null||!Bp(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(h=>{let f=r.bucket,g=r.fullPath,y="/b/"+o(f)+"/o/"+o(g),T=ji(y,t,n),D=jE({alt:"media",token:h});return T+D})[0]}function vD(r,e){let t={},n=e.length;for(let i=0;i<n;i++){let s=e[i];s.writable&&(t[s.server]=r[s.local])}return JSON.stringify(t)}function ID(r,e,t){let n={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[xE])for(let i of t[xE]){let s=i.replace(/\/$/,""),o=r._makeStorageReference(new it(e,s));n.prefixes.push(o)}if(t[VE])for(let i of t[VE]){let s=r._makeStorageReference(new it(e,i.name));n.items.push(s)}return n}function wD(r,e,t){let n=qp(t);return n===null?null:ID(r,e,n)}function zp(r){if(!r)throw Up()}function KE(r,e){function t(n,i){let s=HE(r,i,e);return zp(s!==null),s}return t}function ED(r,e){function t(n,i){let s=wD(r,e,i);return zp(s!==null),s}return t}function TD(r,e){function t(n,i){let s=HE(r,i,e);return zp(s!==null),yD(s,i,r.host,r._protocol)}return t}function Wp(r){function e(t,n){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=Lk():i=Vk():t.getStatus()===402?i=xk(r.bucket):t.getStatus()===403?i=Mk(r.path):i=n,i.status=t.getStatus(),i.serverResponse=n.serverResponse,i}return e}function Gp(r){let e=Wp(r);function t(n,i){let s=e(n,i);return n.getStatus()===404&&(s=Ok(r.path)),s.serverResponse=i.serverResponse,s}return t}function AD(r,e,t){let n=e.fullServerUrl(),i=ji(n,r.host,r._protocol),s="GET",o=r.maxOperationRetryTime,c=new xr(i,s,KE(r,t),o);return c.errorHandler=Gp(e),c}function bD(r,e,t,n,i){let s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",t&&t.length>0&&(s.delimiter=t),n&&(s.pageToken=n),i&&(s.maxResults=i);let o=e.bucketOnlyServerUrl(),c=ji(o,r.host,r._protocol),u="GET",h=r.maxOperationRetryTime,f=new xr(c,u,ED(r,e.bucket),h);return f.urlParams=s,f.errorHandler=Wp(e),f}function RD(r,e,t){let n=e.fullServerUrl(),i=ji(n,r.host,r._protocol),s="GET",o=r.maxOperationRetryTime,c=new xr(i,s,TD(r,t),o);return c.errorHandler=Gp(e),c}function SD(r,e){let t=e.fullServerUrl(),n=ji(t,r.host,r._protocol),i="DELETE",s=r.maxOperationRetryTime;function o(u,h){}let c=new xr(n,i,o,s);return c.successCodes=[200,204],c.errorHandler=Gp(e),c}function CD(r,e){return r&&r.contentType||e&&e.type()||"application/octet-stream"}function PD(r,e,t){let n=Object.assign({},t);return n.fullPath=r.path,n.size=e.size(),n.contentType||(n.contentType=CD(null,e)),n}function kD(r,e,t,n,i){let s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function c(){let M="";for(let j=0;j<2;j++)M=M+Math.random().toString().slice(2);return M}let u=c();o["Content-Type"]="multipart/related; boundary="+u;let h=PD(e,n,i),f=vD(h,t),g="--"+u+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+f+`\r
--`+u+`\r
Content-Type: `+h.contentType+`\r
\r
`,y=`\r
--`+u+"--",T=Ru.getBlob(g,n,y);if(T===null)throw jk();let D={name:h.fullPath},N=ji(s,r.host,r._protocol),k="POST",q=r.maxUploadRetryTime,U=new xr(N,k,KE(r,t),q);return U.urlParams=D,U.headers=o,U.body=T.uploadData(),U.errorHandler=Wp(e),U}function Vo(){return LE?LE():new Fp}function DD(r,e,t){r._throwIfRoot("uploadBytes");let n=kD(r.storage,r._location,jp(),new Ru(e,!0),t);return r.storage.makeRequestWithTokens(n,Vo).then(i=>({metadata:i,ref:r}))}function ND(r){let e={prefixes:[],items:[]};return QE(r,e).then(()=>e)}function QE(r,e,t){return p(this,null,function*(){let i=yield OD(r,{pageToken:t});e.prefixes.push(...i.prefixes),e.items.push(...i.items),i.nextPageToken!=null&&(yield QE(r,e,i.nextPageToken))})}function OD(r,e){e!=null&&typeof e.maxResults=="number"&&Vp("options.maxResults",1,1e3,e.maxResults);let t=e||{},n=bD(r.storage,r._location,"/",t.pageToken,t.maxResults);return r.storage.makeRequestWithTokens(n,Vo)}function xD(r){r._throwIfRoot("getMetadata");let e=AD(r.storage,r._location,jp());return r.storage.makeRequestWithTokens(e,Vo)}function VD(r){r._throwIfRoot("getDownloadURL");let e=RD(r.storage,r._location,jp());return r.storage.makeRequestWithTokens(e,Vo).then(t=>{if(t===null)throw zk();return t})}function LD(r){r._throwIfRoot("deleteObject");let e=SD(r.storage,r._location);return r.storage.makeRequestWithTokens(e,Vo)}function MD(r,e){let t=fD(r._location.path,e),n=new it(r._location.bucket,t);return new qi(r.storage,n)}function FD(r){return/^[A-Za-z]+:\/\//.test(r)}function UD(r,e){return new qi(r,e)}function YE(r,e){if(r instanceof xo){let t=r;if(t._bucket==null)throw qk();let n=new qi(t,t._bucket);return e!=null?YE(n,e):n}else return e!==void 0?MD(r,e):r}function BD(r,e){if(e&&FD(e)){if(r instanceof xo)return UD(r,e);throw Op("To use ref(service, url), the first argument must be a Storage instance.")}else return YE(r,e)}function ME(r,e){let t=e==null?void 0:e[$E];return t==null?null:it.makeFromBucketSpec(t,r)}function $D(r,e,t,n={}){r.host=`${e}:${t}`,r._protocol="http";let{mockUserToken:i}=n;i&&(r._overrideAuthToken=typeof i=="string"?i:da(i,r.app.options.projectId))}function XE(r,e,t){return r=ne(r),DD(r,e,t)}function ZE(r){return r=ne(r),xD(r)}function eT(r){return r=ne(r),ND(r)}function tT(r){return r=ne(r),VD(r)}function nT(r){return r=ne(r),LD(r)}function rT(r,e){return r=ne(r),BD(r,e)}function iT(r=Yt(),e){r=ne(r);let n=Qt(r,JE).getImmediate({identifier:e}),i=ha("storage");return i&&sT(n,...i),n}function sT(r,e,t,n={}){$D(r,e,t,n)}function qD(r,{instanceIdentifier:e}){let t=r.getProvider("app").getImmediate(),n=r.getProvider("auth-internal"),i=r.getProvider("app-check-internal");return new xo(t,n,i,e,Ct)}function jD(){et(new Ne(JE,qD,"PUBLIC").setMultipleInstances(!0)),le(FE,UE,""),le(FE,UE,"esm2017")}var BE,$E,Dk,Nk,ge,ye,it,xp,$i,Lp,Bi,Ut,Oo,bu,Ru,Ve,Au,xE,VE,xr,k1,LE,Mp,Fp,qi,xo,FE,UE,JE,oT=W(()=>{"use strict";wn();Ht();Xn();BE="firebasestorage.googleapis.com",$E="storageBucket",Dk=2*60*1e3,Nk=10*60*1e3;ge=class r extends Ge{constructor(e,t,n=0){super(Np(e),`Firebase Storage: ${t} (${Np(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,r.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Np(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},ye=function(r){return r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment",r}(ye||{});it=class r{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=r.makeFromUrl(e,t)}catch{return new r(e,"")}if(n.path==="")return n;throw $k(e)}static makeFromUrl(e,t){let n=null,i="([A-Za-z0-9.\\-_]+)";function s(j){j.path.charAt(j.path.length-1)==="/"&&(j.path_=j.path_.slice(0,-1))}let o="(/(.*))?$",c=new RegExp("^gs://"+i+o,"i"),u={bucket:1,path:3};function h(j){j.path_=decodeURIComponent(j.path)}let f="v[A-Za-z0-9_]+",g=t.replace(/[.]/g,"\\."),y="(/([^?#]*).*)?$",T=new RegExp(`^https?://${g}/${f}/b/${i}/o${y}`,"i"),D={bucket:1,path:3},N=t===BE?"(?:storage.googleapis.com|storage.cloud.google.com)":t,k="([^?#]*)",q=new RegExp(`^https?://${N}/${i}/${k}`,"i"),M=[{regex:c,indices:u,postModify:s},{regex:T,indices:D,postModify:h},{regex:q,indices:{bucket:1,path:2},postModify:h}];for(let j=0;j<M.length;j++){let X=M[j],G=X.regex.exec(e);if(G){let w=G[X.indices.bucket],_=G[X.indices.path];_||(_=""),n=new r(w,_),X.postModify(n);break}}if(n==null)throw Bk(e);return n}},xp=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};$i=function(r){return r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT",r}($i||{});Lp=class{constructor(e,t,n,i,s,o,c,u,h,f,g,y=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=u,this.timeout_=h,this.progressCallback_=f,this.connectionFactory_=g,this.retry=y,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((T,D)=>{this.resolve_=T,this.reject_=D,this.start_()})}start_(){let e=(n,i)=>{if(i){n(!1,new Bi(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=c=>{let u=c.loaded,h=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,h)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let c=s.getErrorCode()===$i.NO_ERROR,u=s.getStatus();if(!c||Jk(u,this.additionalRetryCodes_)&&this.retry){let f=s.getErrorCode()===$i.ABORT;n(!1,new Bi(!1,null,f));return}let h=this.successCodes_.indexOf(u)!==-1;n(!0,new Bi(h,s))})},t=(n,i)=>{let s=this.resolve_,o=this.reject_,c=i.connection;if(i.wasSuccessCode)try{let u=this.callback_(c,c.getResponse());Qk(u)?s(u):s()}catch(u){o(u)}else if(c!==null){let u=Up();u.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,u)):o(u)}else if(i.canceled){let u=this.appDelete_?qE():Uk();o(u)}else{let u=Fk();o(u)}};this.canceled_?t(!1,new Bi(!1,null,!0)):this.backoffId_=Hk(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Kk(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},Bi=class{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}};Ut={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Oo=class{constructor(e,t){this.data=e,this.contentType=t||null}};bu=class{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(t===null)throw No(Ut.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let n=t[1]||null;n!=null&&(this.base64=hD(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}};Ru=class r{constructor(e,t){let n=0,i="";OE(e)?(this.data_=e,n=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(OE(this.data_)){let n=this.data_,i=sD(n,e,t);return i===null?null:new r(i)}else{let n=new Uint8Array(this.data_.buffer,e,t-e);return new r(n,!0)}}static getBlob(...e){if($p()){let t=e.map(n=>n instanceof r?n.data_:n);return new r(iD.apply(null,t))}else{let t=e.map(o=>Bp(o)?aD(Ut.RAW,o).data:o.data_),n=0;t.forEach(o=>{n+=o.byteLength});let i=new Uint8Array(n),s=0;return t.forEach(o=>{for(let c=0;c<o.length;c++)i[s++]=o[c]}),new r(i,!0)}}uploadData(){return this.data_}};Ve=class{constructor(e,t,n,i){this.server=e,this.local=t||e,this.writable=!!n,this.xform=i||pD}},Au=null;xE="prefixes",VE="items";xr=class{constructor(e,t,n,i){this.url=e,this.method=t,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};k1=256*1024;LE=null,Mp=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=$i.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=$i.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=$i.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,i){if(this.sent_)throw Do("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return n!==void 0?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Do("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Do("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Do("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Do("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},Fp=class extends Mp{initXhr(){this.xhr_.responseType="text"}};qi=class r{constructor(e,t){this._service=e,t instanceof it?this._location=t:this._location=it.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new r(e,t)}get root(){let e=new it(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return GE(this._location.path)}get storage(){return this._service}get parent(){let e=dD(this._location.path);if(e===null)return null;let t=new it(this._location.bucket,e);return new r(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw Gk(e)}};xo=class{constructor(e,t,n,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=BE,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Dk,this._maxUploadRetryTime=Nk,this._requests=new Set,i!=null?this._bucket=it.makeFromBucketSpec(i,this._host):this._bucket=ME(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=it.makeFromBucketSpec(this._url,e):this._bucket=ME(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Vp("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Vp("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return p(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return p(this,null,function*(){if(Oe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new qi(this,e)}_makeRequest(e,t,n,i,s=!0){if(this._deleted)return new xp(qE());{let o=nD(e,this._appId,n,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return p(this,null,function*(){let[n,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()})}},FE="@firebase/storage",UE="0.13.7";JE="storage";jD()});var Hp=W(()=>{"use strict";oT()});function zD(r,e){let t=er(aT,r,e);return t&&new Vr(t)}function WD(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new Vr(n)}}function cT(r,...e){return le("angularfire",kt.full,"gcs"),yn([HD,GD,{provide:Qp,useFactory:WD(r),multi:!0,deps:[ot,vn,Dt,Jt,[new De,sr],[new De,bn],...e]}])}var Vr,aT,Kp,Qp,GD,HD,uT,Yp,lT,hT,dT,zi,fT,Su=W(()=>{"use strict";Hr();he();Es();ya();Vs();En();Hp();Hp();Vr=class{constructor(e){return e}},aT="storage",Kp=class{constructor(){return Tn(aT)}},Qp=new _n("angularfire2.storage-instances");GD={provide:Kp,deps:[[new De,Qp]]},HD={provide:Vr,useFactory:zD,deps:[[new De,Qp],pt]};uT=K(nT,!0,2),Yp=K(tT,!0),lT=K(ZE,!0),hT=K(iT,!0),dT=K(eT,!0),zi=K(rT,!0,2),fT=K(XE,!0)});var pT,mT=W(()=>{"use strict";OA();pT=[{path:"auth",loadChildren:()=>import("./chunk-2HO7K7JR.js").then(r=>r.AuthRoutes),canMatch:[ys],data:{authStateMustBe:!1}},{path:"",loadChildren:()=>import("./chunk-TN4PHSQE.js").then(r=>r.TabsRoutes),canMatch:[ys],data:{authStateMustBe:!0}},{path:"cart",loadComponent:()=>import("./chunk-JRURE7KI.js").then(r=>r.CartPage),canMatch:[ys],data:{authStateMustBe:!0}},{path:"checkout",loadChildren:()=>import("./chunk-JSEP7QS2.js").then(r=>r.CheckoutRoutes),canMatch:[ys],data:{authStateMustBe:!0}},{path:"search",loadComponent:()=>import("./chunk-RURVW4VZ.js").then(r=>r.SearchPage)},{path:"conversation/:conversationId",loadComponent:()=>import("./chunk-74QO5D7Q.js").then(r=>r.ConversationPage)}]});var gT,_T=W(()=>{"use strict";Dg();he();gT=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=dg({type:e,selectors:[["app-root"]],decls:2,vars:1,consts:[[3,"animated"]],template:function(i,s){i&1&&(mg(0,"ion-app"),_g(1,"ion-router-outlet",0),gg()),i&2&&(hg(),pg("animated",!1))},dependencies:[Pg,Cg],encapsulation:2});let r=e;return r})()});var yT,vT=W(()=>{"use strict";yT={production:!1,firebase:{apiKey:"AIzaSyAVCQrk9BinjVxO-eEHD4gKwb6UMOahJso",authDomain:"beatmarket-uoc.firebaseapp.com",projectId:"beatmarket-uoc",storageBucket:"beatmarket-uoc.firebasestorage.app",messagingSenderId:"61948068505",appId:"1:61948068505:web:39e9c0e8f5f7d4c56aee08"}}});var Bt,IT,Cu,$t,Wi=W(()=>{"use strict";he();ko();he();Bt=(r,e)=>p(void 0,null,function*(){return yield At(r,()=>new Promise((t,n)=>{e().then(t).catch(n)}))}),IT=r=>["where","or","and"].includes(r.type),Cu=r=>{let e=[];return Array.from(r).forEach(t=>{if("or"in t){let i=Cu(t.or).filter(IT);e.push(NE(...i))}else if("and"in t){let i=Cu(t.and).filter(IT);e.push(CE(...i))}else e.push(Tu(t.field,t.operator,t.value))}),e},$t=(()=>{let e=class e{constructor(){this.firestore=ie(Nr),this.injector=ie(ea)}getById(n,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(i&&!i.collection)throw new Error("You must specify the collection");try{let s=hn(this.firestore,`${i==null?void 0:i.collection}/${n}`);s=i!=null&&i.converter?s.withConverter(i.converter):s;let o=yield Or(s);return o.exists()?Se(ae({},o.data()),{_id:o.id}):null}catch(s){throw this.getErrorMessage(s)}}))})}getById$(n,i){return At(this.injector,()=>{if(!(i!=null&&i.collection))throw new Error("You must specify the collection");try{let s=hn(this.firestore,`${i==null?void 0:i.collection}/${n}`);return s=i!=null&&i.converter?s.withConverter(i.converter):s,SE(s)}catch(s){throw this.getErrorMessage(s)}})}getByField(n,i,s){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(s!=null&&s.collection))throw new Error("You must specify the collection");try{let o=ln(this.firestore,s==null?void 0:s.collection);o=s!=null&&s.converter?o.withConverter(s.converter):o;let c=Po(o,Tu(n,"==",i)),u=yield Eu(c);return u.empty?null:u.docs.map(h=>Se(ae({},h.data()),{_id:h.id}))}catch(o){throw this.getErrorMessage(o)}}))})}getByField$(n,i,s){return At(this.injector,()=>{if(!(s!=null&&s.collection))throw new Error("You must specify the collection");try{let o=ln(this.firestore,s==null?void 0:s.collection);o=s!=null&&s.converter?o.withConverter(s.converter):o;let c=Po(o,Tu(n,"==",i));return wu(c,{idField:"_id"})}catch(o){throw this.getErrorMessage(o)}})}getCollection(n){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(n!=null&&n.collection))throw new Error("You must provide the collection.");try{let i=ln(this.firestore,n.collection);return i=n!=null&&n.converter?i.withConverter(n.converter):i,(yield Eu(i)).docs.map(s=>Se(ae({},s.data()),{_id:s.id}))}catch(i){throw this.getErrorMessage(i)}}))})}getCollection$(n){return At(this.injector,()=>{if(!(n!=null&&n.collection))throw new Error("You must provide the collection.");try{let i=ln(this.firestore,n.collection);return i=n!=null&&n.converter?i.withConverter(n.converter):i,wu(i,{idField:"_id"})}catch(i){throw this.getErrorMessage(i)}})}create(n,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let s=Re(),o=Se(ae({},n),{createdAt:s,updatedAt:s}),c;if(n._id)c=hn(this.firestore,`${i.collection}/${n._id}`),c=i!=null&&i.converter?c.withConverter(i.converter):c,yield Cp(c,o);else{let h=ln(this.firestore,i.collection);h=i!=null&&i.converter?h.withConverter(i.converter):h,c=yield Tp(h,n)}let u=(yield Or(c)).data();return Se(ae({},u),{_id:c.id})}catch(s){throw this.getErrorMessage(s)}}))})}createInSubcollection(n,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let s;if(n._id)s=hn(this.firestore,`${i.collection}/${n._id}`),s=i!=null&&i.converter?s.withConverter(i.converter):s,yield Cp(s,n);else{let c=ln(this.firestore,i.collection);c=i!=null&&i.converter?c.withConverter(i.converter):c,s=yield Tp(c,n)}let o=(yield Or(s)).data();return Se(ae({},o),{_id:s.id})}catch(s){throw this.getErrorMessage(s)}}))})}updateInSubcollection(n,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let s=hn(this.firestore,`${i.collection}`);s=i!=null&&i.converter?s.withConverter(i.converter):s,yield Dp(s,n);let o=(yield Or(s)).data();return Se(ae({},o),{_id:s.id})}catch(s){throw this.getErrorMessage(s)}}))})}update(n,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let o=hn(this.firestore,i.collection,n._id);o=i!=null&&i.converter?o.withConverter(i.converter):o;let s=n,{_id:c}=s,u=ng(s,["_id"]);return yield Dp(o,Se(ae({},u),{updatedAt:Re()})),this.getById(n._id,i)}catch(o){throw this.getErrorMessage(o)}}))})}remove(n,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(i&&!i.collection)throw new Error("You must provide the collection.");try{let s=hn(this.firestore,`${i==null?void 0:i.collection}/${n}`);return(yield Or(s)).exists()?(yield PE(s),!0):(console.error(`Document with uid ${n} does not exist.`),!1)}catch(s){throw this.getErrorMessage(s)}}))})}exists(n,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(i&&!i.collection)throw new Error("You must provide the collection.");try{let s=hn(this.firestore,`${i==null?void 0:i.collection}/${n}`);return(yield Or(s)).exists()}catch(s){throw this.getErrorMessage(s)}}))})}query(n){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!n.collection)throw new Error("You must provide the collection.");if(!n.queryConstraints)throw new Error("You must provide the query constraints.");try{let i=ln(this.firestore,n.collection);i=n!=null&&n.converter?i.withConverter(n.converter):i;let s=[],{filters:o,orderBy:c,limit:u,startAt:h,startAfter:f,endAt:g,endBefore:y}=n.queryConstraints;o!=null&&o.length&&s.push(...Cu(o)),c&&s.push(Sp(c.field,c.direction||"asc")),u!==void 0&&s.push(Rp(u)),h!==void 0&&s.push(kp(h)),f!==void 0&&s.push(Pp(f)),g!==void 0&&s.push(Ap(g)),y!==void 0&&s.push(bp(y));let T=Po(i,...s);return(yield Eu(T)).docs.map(N=>Se(ae({},N.data()),{_id:N.id}))}catch(i){throw this.getErrorMessage(i)}}))})}query$(n){return At(this.injector,()=>{if(!n.collection)throw new Error("You must provide the collection.");if(!n.queryConstraints)throw new Error("You must provide the query constraints.");try{let i=ln(this.firestore,n.collection);i=n!=null&&n.converter?i.withConverter(n.converter):i;let s=[],{filters:o,orderBy:c,limit:u,startAt:h,startAfter:f,endAt:g,endBefore:y}=n.queryConstraints;o!=null&&o.length&&s.push(...Cu(o)),c&&s.push(Sp(c.field,c.direction||"asc")),u!==void 0&&s.push(Rp(u)),h!==void 0&&s.push(kp(h)),f!==void 0&&s.push(Pp(f)),g!==void 0&&s.push(Ap(g)),y!==void 0&&s.push(bp(y));let T=Po(i,...s);return wu(T,{idField:"_id"})}catch(i){throw this.getErrorMessage(i)}})}getErrorMessage(n){return console.error(n),"Database error"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var Gi,Jp=W(()=>{"use strict";oa();Gi=class r{constructor(e={}){this._id="",this.title="",this.description="",this.mainImageURL="",this.imagesURLs=[],this.user={userId:"",username:"",profilePictureURL:""},this.price=0,this.isActive=!0,this.finishedAt=null,this.article={category:bt.None,condition:sa.None,characteristics:{category:bt.None}},Object.assign(this,ae({},e))}static Build(e={}){return new r(e)}toJSON(){let e=Object.assign(this);delete e._id;try{return JSON.stringify(e)}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});function Le(r){return typeof r=="string"||typeof r=="number"||r instanceof Date}function Pe(r){return typeof r=="object"&&r!==null&&"_methodName"in r}function st(r){return typeof r=="object"&&r!==null&&"toDate"in r&&typeof r.toDate=="function"}var Hi=W(()=>{"use strict"});var Pu,wT=W(()=>{"use strict";Dr();oa();Jp();LA();Hi();Pu=class{toFirestore(e){var s;let t=e.article,n=bt.None,i={category:bt.None};if(qg(t)){n=t.category;let o=t.characteristics;zg(o,n)?i={type:o.type,brand:o.brand,model:o.model,color:o.color,fabricationYear:o.fabricationYear,serialNumber:o.serialNumber,instrumentLevel:o.instrumentLevel}:Wg(o,n)?i={author:o.author,theme:o.theme,edition:o.edition,publisher:o.publisher,year:o.year,pages:o.pages,language:o.language,isbn:o.isbn,series:o.series,volume:o.volume}:Gg(o,n)?i={format:o.format,recordingTitle:o.recordingTitle,artist:o.artist,genre:o.genre,year:o.year,duration:o.duration,label:o.label,catalogNumber:o.catalogNumber,isrc:o.isrc,barcode:o.barcode,releaseDate:o.releaseDate,releaseCountry:o.releaseCountry,releaseFormat:o.releaseFormat,trackCount:o.trackCount}:Hg(o,n)?i={type:o.type,name:o.name,brand:o.brand,associatedInstrument:o.associatedInstrument}:Kg(o,n)?i={type:o.type,name:o.name,brand:o.brand,model:o.model,color:o.color,fabricationYear:o.fabricationYear,serialNumber:o.serialNumber,accessories:o.accessories,warranty:o.warranty,warrantyDuration:o.warrantyDuration,warrantyType:o.warrantyType}:Qg(o,n)&&(i={description:o.description})}return{title:e.title,description:e.description,mainImageURL:e.mainImageURL,imagesURLs:e.imagesURLs,user:e.user,price:e.price,isActive:e.isActive,finishedAt:Le(e.finishedAt)?J.fromDate(new Date(e.finishedAt)):Pe(e.finishedAt)?e.finishedAt:null,article:{category:n,condition:(s=e.article.condition)!=null?s:"",characteristics:ae({},i)},createdAt:Le(e.createdAt)?J.fromDate(new Date(e.createdAt)):Pe(e.createdAt)?e.createdAt:Re(),updatedAt:Le(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Pe(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){let n=e.data(t);return Gi.Build({_id:e.id,title:n.title,description:n.description,mainImageURL:n.mainImageURL,imagesURLs:n.imagesURLs,user:n.user,price:n.price,isActive:n.isActive,finishedAt:st(n.finishedAt)?n.finishedAt.toDate():null,article:{category:n.article.category,condition:n.article.condition,characteristics:n.article.characteristics},createdAt:st(n.createdAt)?n.createdAt.toDate():null,updatedAt:st(n.updatedAt)?n.updatedAt.toDate():null})}}});var ET,TT=W(()=>{"use strict";he();Wi();Jp();wT();he();ET=(()=>{let e=class e{constructor(){this.firestore=ie($t),this.postConverter=new Pu}getPostById(n){return p(this,null,function*(){try{return yield this.firestore.getById(n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}})}getPostById$(n){try{return this.firestore.getById$(n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}}getPostsByUserId(n){return p(this,null,function*(){try{return yield this.firestore.getByField("userId",n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}})}getPostsByUserId$(n){try{return this.firestore.getByField$("userId",n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}}getPostsByUsername(n){return p(this,null,function*(){try{return yield this.firestore.getByField("username",n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}})}getPostsByUsername$(n){try{return this.firestore.getByField$("username",n,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}}getAllPosts(){return p(this,null,function*(){try{return this.firestore.getCollection({collection:"posts",converter:this.postConverter})}catch(n){throw console.error(n),n}})}getAllPosts$(){try{return this.firestore.getCollection$({collection:"posts",converter:this.postConverter})}catch(n){throw console.error(n),n}}queryPosts(n){return p(this,null,function*(){try{return this.firestore.query({collection:"posts",converter:this.postConverter,queryConstraints:n})}catch(i){throw console.error(i),i}})}queryPosts$(n){try{return this.firestore.query$({collection:"posts",converter:this.postConverter,queryConstraints:n})}catch(i){throw console.error(i),i}}savePost(n){return p(this,null,function*(){try{let i=Gi.Build(n),s;return(s=yield this.firestore.create(i,{collection:"posts",converter:this.postConverter}))?s:null}catch(i){throw i}})}updatePost(n){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(n,{collection:"posts",converter:this.postConverter}))?i:null}catch(i){throw i}})}deletePost(n){return p(this,null,function*(){try{return yield this.firestore.remove(n)}catch(i){throw i}})}postExists(n){return p(this,null,function*(){try{return yield this.firestore.exists(n)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var Ki,Xp=W(()=>{"use strict";Ki=class r{constructor(e={}){this._id="",this.userId="",this.items=[],Object.assign(this,ae({},e))}static Build(e={}){return new r(e)}toJSON(){let e=Object.assign(this);delete e._id;try{return JSON.stringify(e)}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});var ku,AT=W(()=>{"use strict";Dr();Xp();Hi();ku=class{toFirestore(e){return{userId:e.userId,items:e.items,createdAt:Le(e.createdAt)?J.fromDate(new Date(e.createdAt)):Pe(e.createdAt)?e.createdAt:Re(),updatedAt:Le(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Pe(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){var i,s;let n=e.data(t);return Ki.Build({_id:e.id,userId:(i=n.userId)!=null?i:"",items:(s=n.items)!=null?s:[],createdAt:st(n.createdAt)?n.createdAt.toDate():null,updatedAt:st(n.updatedAt)?n.updatedAt.toDate():null})}}});var bT,RT=W(()=>{"use strict";he();_s();Wi();Xp();AT();he();bT=(()=>{let e=class e{constructor(){this.firestore=ie($t),this.cartConverter=new ku}getCartById(n){return p(this,null,function*(){try{return yield this.firestore.getById(n,{collection:"carts",converter:this.cartConverter})}catch(i){throw console.error(i),i}})}getCartById$(n){try{return this.firestore.getById$(n,{collection:"carts",converter:this.cartConverter})}catch(i){throw console.error(i),i}}getCartByUserId(n){return p(this,null,function*(){try{let i=yield this.firestore.getByField("userId",n,{collection:"carts",converter:this.cartConverter});return i&&i.length>0?i[0]:null}catch(i){throw console.error(i),i}})}getCartByUserId$(n){try{return this.firestore.getByField$("userId",n,{collection:"carts",converter:this.cartConverter}).pipe(Ce(i=>i&&i.length>0?i[0]:null))}catch(i){throw console.error(i),i}}getAllCarts(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"carts",converter:this.cartConverter})}catch(n){throw console.error(n),n}})}getAllCarts$(){try{return this.firestore.getCollection$({collection:"carts",converter:this.cartConverter})}catch(n){throw console.error(n),n}}saveCart(n){return p(this,null,function*(){try{let i=Ki.Build(n),s;return(s=yield this.firestore.create(i,{collection:"carts",converter:this.cartConverter}))?s:null}catch(i){throw i}})}updateCart(n){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(n,{collection:"carts",converter:this.cartConverter}))?i:null}catch(i){console.error(i)}return null})}deleteCart(n){return p(this,null,function*(){try{return yield this.firestore.remove(n)}catch(i){throw i}})}cartExists(n){return p(this,null,function*(){try{return yield this.firestore.exists(n)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var Du,Nu,ST=W(()=>{"use strict";ko();Vg();oa();Hi();Du=class{toFirestore(e){return{email:e.email,username:e.username,profilePictureURL:e.profilePictureURL,name:e.name,address:e.address,roles:Array.isArray(e.roles)?e.roles.map(t=>t.toString()):e.roles,bio:e.bio,fcmToken:e.fcmToken,createdAt:Le(e.createdAt)?J.fromDate(new Date(e.createdAt)):Pe(e.createdAt)?e.createdAt:Re(),updatedAt:Le(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Pe(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){var i,s,o,c,u,h,f;let n=e.data(t);return na.Build({_id:e.id,email:(i=n.email)!=null?i:"",username:(s=n.username)!=null?s:"",profilePictureURL:(o=n.profilePictureURL)!=null?o:"",name:(c=n.name)!=null?c:{first:"",last:""},address:(u=n.address)!=null?u:{line1:"",city:"",country:"",zipcode:""},roles:((h=n.roles)!=null?h:[]).map(g=>g),bio:(f=n.bio)!=null?f:"",fcmToken:n.fcmToken,createdAt:st(n.createdAt)?n.createdAt.toDate():null,updatedAt:st(n.updatedAt)?n.updatedAt.toDate():null})}},Nu=class{toFirestore(e){var t,n,i;return{title:typeof e.title=="string"?e.title:"",category:(n=(t=e==null?void 0:e.category)==null?void 0:t.toString())!=null?n:bt.None,price:typeof e.price=="number"?e.price:0,mainImageURL:(i=e==null?void 0:e.mainImageURL)!=null?i:""}}fromFirestore(e,t){var o,c,u,h;let n=e.data(t),i=(o=n==null?void 0:n.category)!=null?o:"",s=Object.values(bt).includes(i)?i:bt.None;return{_id:e.id,title:(c=n==null?void 0:n.title)!=null?c:"",category:s,price:(u=n==null?void 0:n.price)!=null?u:0,mainImageURL:(h=n==null?void 0:n.mainImageURL)!=null?h:""}}}});var CT,PT=W(()=>{"use strict";he();_s();Wi();Vg();ST();he();CT=(()=>{let e=class e{constructor(){this.firestore=ie($t),this.userConverter=new Du,this.activePostConverter=new Nu}getUserById(n,i=!0){return p(this,null,function*(){try{let s=yield this.firestore.getById(n,{collection:"users",converter:this.userConverter});if(!s)return null;if(!i||!this.firestore.getCollection)return s;let o=yield this.firestore.getCollection({collection:`users/${n}/activePosts`,converter:this.activePostConverter});return s.activePosts=o!=null?o:[],s}catch(s){throw console.error(s),s}})}getUserById$(n,i=!0){try{let s=this.firestore.getById$(n,{collection:"users",converter:this.userConverter});if(!i||!this.firestore.getCollection$)return s;let o=this.firestore.getCollection$({collection:`users/${n}/activePosts`,converter:this.activePostConverter});return Gt([s,o]).pipe(Ce(([c,u])=>c?(c.activePosts=u!=null?u:[],c):null))}catch(s){throw console.error(s),s}}getUserByEmail(n,i=!0){return p(this,null,function*(){try{let s=null,o=yield this.firestore.getByField("email",n,{collection:"users",converter:this.userConverter});if(o&&o.length>0&&(s=o[0]),!i||!this.firestore.getCollection)return s;let c=yield this.firestore.getCollection({collection:`users/${s==null?void 0:s._id}/activePosts`,converter:this.activePostConverter});return s&&(s.activePosts=c!=null?c:[]),s}catch(s){throw console.error(s),s}})}getUserByEmail$(n,i=!0){try{let s=this.firestore.getByField$("email",n,{collection:"users",converter:this.userConverter}).pipe(Ce(o=>o&&o.length>0?o[0]:null));return!i||!this.firestore.getCollection$?s:s.pipe(Qn(o=>!o||!this.firestore.getCollection$?Kn(null):this.firestore.getCollection$({collection:`users/${o._id}/activePosts`,converter:this.activePostConverter}).pipe(Ce(c=>(o.activePosts=c!=null?c:[],o)))))}catch(s){throw console.error(s),s}}getUserByUsername(n){return p(this,null,function*(){try{let i=yield this.firestore.getByField("username",n,{collection:"users",converter:this.userConverter});return i&&i.length>0?i[0]:null}catch(i){throw console.error(i),i}})}getUserByUsername$(n){try{return this.firestore.getByField$("username",n,{collection:"users"}).pipe(Ce(i=>i&&i.length>0?i[0]:null))}catch(i){throw console.error(i),i}}getAllUsers(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"users",converter:this.userConverter})}catch(n){throw console.error(n),n}})}getAllUsers$(){try{return this.firestore.getCollection$({collection:"users",converter:this.userConverter})}catch(n){throw console.error(n),n}}saveUser(n){return p(this,null,function*(){try{let i=na.Build(n),s;return(s=yield this.firestore.create(i,{collection:"users",converter:this.userConverter}))?s:null}catch(i){throw i}})}updateUser(n){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(n,{collection:"users",converter:this.userConverter}))?i:null}catch(i){throw i}})}saveActivePost(s){return p(this,arguments,function*({userId:n,activePostData:i}){try{let o;return(o=yield this.firestore.createInSubcollection(i,{collection:`users/${n}/activePosts`,converter:this.activePostConverter}))?o:null}catch(o){throw o}})}userExists(n){return p(this,null,function*(){return yield this.firestore.exists(n)})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var Qi,Zp=W(()=>{"use strict";oa();Qi=class r{constructor(e={}){this._id="",this.postData={postId:"",title:"",articleCondition:sa.None,price:0,mainImageURL:""},this.buyerData={userId:"",username:"",profilePictureURL:""},this.sellerData={userId:"",username:"",profilePictureURL:""},this.paymentData={cardName:"",cardNumber:"",expirationMonth:"",expirationYear:"",cvc:""},Object.assign(this,ae({},e))}static Build(e={}){return new r(e)}toJSON(){let e=Object.assign(this);delete e._id;try{return JSON.stringify(e)}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});var Ou,kT=W(()=>{"use strict";Dr();Zp();Hi();Ou=class{toFirestore(e){return{postData:e.postData,buyerData:e.buyerData,sellerData:e.sellerData,paymentData:e.paymentData,createdAt:Le(e.createdAt)?J.fromDate(new Date(e.createdAt)):Pe(e.createdAt)?e.createdAt:Re(),updatedAt:Le(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Pe(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){let n=e.data(t);return Qi.Build({_id:e.id,postData:{postId:n.postData.postId,title:n.postData.title,articleCondition:n.postData.articleCondition,price:n.postData.price,mainImageURL:n.postData.mainImageURL},buyerData:{userId:n.buyerData.userId,username:n.buyerData.username,profilePictureURL:n.buyerData.profilePictureURL},sellerData:{userId:n.sellerData.userId,username:n.sellerData.username,profilePictureURL:n.sellerData.profilePictureURL},paymentData:{cardName:n.paymentData.cardName,cardNumber:n.paymentData.cardNumber,expirationMonth:n.paymentData.expirationMonth,expirationYear:n.paymentData.expirationYear,cvc:n.paymentData.cvc},createdAt:n.createdAt.toDate(),updatedAt:n.updatedAt.toDate()})}}});var DT,NT=W(()=>{"use strict";he();Wi();Zp();kT();he();DT=(()=>{let e=class e{constructor(){this.firestore=ie($t),this.saleConverter=new Ou}getSaleById(n){return p(this,null,function*(){try{return yield this.firestore.getById(n,{collection:"sales"})}catch(i){throw console.error(i),i}})}getSaleById$(n){try{return this.firestore.getById$(n,{collection:"sales"})}catch(i){throw console.error(i),i}}getSalesByBuyerId(n){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.userId",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesByBuyerId$(n){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.userId",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getSalesByBuyerUsername(n){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.username",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesByBuyerUsername$(n){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.username",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getSalesBySellerId(n){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.userId",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesBySellerId$(n){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.userId",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getSalesBySellerUsername(n){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.username",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesBySellerUsername$(n){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.username",operator:"==",value:n}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getAllSales(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"sales",converter:this.saleConverter})}catch(n){throw console.error(n),n}})}getAllSales$(){try{return this.firestore.getCollection$({collection:"sales",converter:this.saleConverter})}catch(n){throw console.error(n),n}}saveSale(n){return p(this,null,function*(){try{let i=Qi.Build(n),s;return(s=yield this.firestore.create(i,{collection:"sales",converter:this.saleConverter}))?s:null}catch(i){throw i}})}updateSale(n){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(n,{collection:"sales",converter:this.saleConverter}))?i:null}catch(i){throw i}})}deleteSale(n){return p(this,null,function*(){try{return yield this.firestore.remove(n)}catch(i){throw i}})}saleExists(n){return p(this,null,function*(){try{return yield this.firestore.exists(n)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var Yi,em=W(()=>{"use strict";Yi=class r{constructor(e={}){this._id="",this.relatedPost={postId:"",title:"",price:0,isActive:!0,mainImageURL:""},this.participants={buyer:{userId:"",username:"",profilePictureURL:""},seller:{userId:"",username:"",profilePictureURL:""}},this.messages=[],Object.assign(this,ae({},e))}static Build(e={}){return new r(e)}toJSON(){let e=Object.assign(this);delete e._id;try{let t=JSON.stringify(e);return console.log({jsonStr:t}),t}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});var xu,Vu,OT=W(()=>{"use strict";ko();em();Hi();xu=class{toFirestore(e){return{relatedPost:e.relatedPost,participants:Pe(e.participants)?e.participants:{buyer:{userId:e.participants.buyer.userId,username:e.participants.buyer.username,profilePictureURL:e.participants.buyer.profilePictureURL},seller:{userId:e.participants.seller.userId,username:e.participants.seller.username,profilePictureURL:e.participants.seller.profilePictureURL}},createdAt:Le(e.createdAt)?J.fromDate(new Date(e.createdAt)):Pe(e.createdAt)?e.createdAt:Re(),updatedAt:Le(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Pe(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){let n=e.data(t);return Yi.Build({_id:e.id,relatedPost:n.relatedPost,participants:{buyer:{userId:n.participants.buyer.userId,username:n.participants.buyer.username,profilePictureURL:n.participants.buyer.profilePictureURL},seller:{userId:n.participants.seller.userId,username:n.participants.seller.username,profilePictureURL:n.participants.seller.profilePictureURL}},createdAt:st(n.createdAt)?n.createdAt.toDate():null,updatedAt:st(n.updatedAt)?n.updatedAt.toDate():null})}},Vu=class{toFirestore(e){return{text:e.text,timestamp:Le(e.timestamp)?J.fromDate(new Date(e.timestamp)):Pe(e.timestamp)?e.timestamp:Re(),senderId:e.senderId,recipientId:e.recipientId}}fromFirestore(e,t){let n=e.data(t);return{_id:e.id,text:n.text,timestamp:n.timestamp.toDate(),senderId:n.senderId,recipientId:n.recipientId}}}});var xT,VT=W(()=>{"use strict";he();Wi();em();OT();_s();he();xT=(()=>{let e=class e{constructor(){this.firestore=ie($t),this.conversationConverter=new xu,this.messageConverter=new Vu}getConversationById(n){return p(this,null,function*(){try{let i=yield this.firestore.getById(n,{collection:"conversations",converter:this.conversationConverter});if(!i)return null;let s=yield this.firestore.getCollection({collection:`conversations/${n}/messages`,converter:this.messageConverter});return i.messages=s!=null?s:[],i}catch(i){throw console.error(i),i}})}getConversationById$(n){try{let i=this.firestore.getById$(n,{collection:"conversations",converter:this.conversationConverter}),s=this.firestore.query$({collection:`conversations/${n}/messages`,converter:this.messageConverter,queryConstraints:{orderBy:{field:"timestamp",direction:"desc"}}});return Gt([i,s]).pipe(Ce(([o,c])=>o?Se(ae({},o),{messages:c!=null?c:[]}):null),ul((o,c)=>(o==null?void 0:o.messages.length)===(c==null?void 0:c.messages.length)))}catch(i){throw console.error(i),i}}getConversationsByBuyerId(n){return p(this,null,function*(){try{let i=yield this.firestore.getByField("participants.buyer.userId",n,{collection:"conversations",converter:this.conversationConverter});if(!this.firestore.getCollection||i===null)return i;for(let s of i)s.messages=yield this.firestore.getCollection({collection:`conversations/${s._id}/messages`,converter:this.messageConverter});return i}catch(i){throw console.error(i),i}})}getConversationsByBuyerId$(n){try{return this.firestore.getByField$("participants.buyer.userId",n,{collection:"conversations",converter:this.conversationConverter}).pipe(Qn(s=>{if(!s||s.length===0)return Kn(null);let o=s.map(c=>this.firestore.getCollection$({collection:`conversations/${c._id}/messages`,converter:this.messageConverter}).pipe(Ce(u=>Se(ae({},c),{messages:u!=null?u:[]}))));return Gt(o)}))}catch(i){throw console.error(i),i}}getConversationsBySellerId(n){return p(this,null,function*(){try{let i=yield this.firestore.getByField("participants.seller.userId",n,{collection:"conversations",converter:this.conversationConverter});if(i===null)return i;for(let s of i)s.messages=yield this.firestore.getCollection({collection:`conversations/${s._id}/messages`,converter:this.messageConverter});return i}catch(i){throw console.error(i),i}})}getConversationsBySellerId$(n){try{return this.firestore.getByField$("participants.seller.userId",n,{collection:"conversations",converter:this.conversationConverter}).pipe(Qn(s=>{if(!s||s.length===0)return Kn(null);let o=s.map(c=>this.firestore.getCollection$({collection:`conversations/${c._id}/messages`,converter:this.messageConverter}).pipe(Ce(h=>Se(ae({},c),{messages:h!=null?h:[]}))));return Gt(o)}))}catch(i){throw console.error(i),i}}getConversationsByParticipantId(n){return p(this,null,function*(){var i,s;try{let o=(i=yield this.firestore.getByField("participants.buyer.userId",n,{collection:"conversations",converter:this.conversationConverter}))!=null?i:[],c=(s=yield this.firestore.getByField("participants.seller.userId",n,{collection:"conversations",converter:this.conversationConverter}))!=null?s:[];for(let u of o)u.messages=yield this.firestore.getCollection({collection:`conversations/${u._id}/messages`,converter:this.messageConverter});for(let u of c)u.messages=yield this.firestore.getCollection({collection:`conversations/${u._id}/messages`,converter:this.messageConverter});return o.concat(c)}catch(o){throw console.error(o),o}})}getConversationsByParticipantId$(n){try{let i=this.firestore.getByField$("participants.buyer.userId",n,{collection:"conversations",converter:this.conversationConverter}),s=this.firestore.getByField$("participants.seller.userId",n,{collection:"conversations",converter:this.conversationConverter});return Gt([i,s]).pipe(Ce(([o,c])=>(o!=null?o:[]).concat(c!=null?c:[])),Qn(o=>{if(!o||o.length===0)return Kn(null);let c=o.map(u=>this.firestore.getCollection$({collection:`conversations/${u._id}/messages`,converter:this.messageConverter}).pipe(Ce(h=>Se(ae({},u),{messages:h!=null?h:[]}))));return Gt(c)}))}catch(i){throw console.error(i),i}}getConversationsByPostId(n){return p(this,null,function*(){var i;try{let s=(i=yield this.firestore.getByField("relatedPost.postId",n,{collection:"conversations",converter:this.conversationConverter}))!=null?i:[];for(let o of s)o.messages=yield this.firestore.getCollection({collection:`conversations/${o._id}/messages`,converter:this.messageConverter});return s}catch(s){throw console.error(s),s}})}getConversationsByPostId$(n){try{return this.firestore.getByField$("relatedPost.postId",n,{collection:"conversations",converter:this.conversationConverter}).pipe(Qn(s=>{if(!s||s.length===0)return Kn(null);let o=s.map(c=>this.firestore.getCollection$({collection:`conversations/${c._id}/messages`,converter:this.messageConverter}).pipe(Ce(u=>Se(ae({},c),{messages:u!=null?u:[]}))));return Gt(o)}))}catch(i){throw console.error(i),i}}getAllConversations(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"conversations",converter:this.conversationConverter})}catch(n){throw console.error(n),n}})}getAllConversations$(){try{return this.firestore.getCollection$({collection:"conversations",converter:this.conversationConverter})}catch(n){throw console.error(n),n}}queryConversations(n){return p(this,null,function*(){try{return this.firestore.query({collection:"conversations",converter:this.conversationConverter,queryConstraints:n})}catch(i){throw console.error(i),i}})}queryConversations$(n){try{return this.firestore.query$({collection:"conversations",converter:this.conversationConverter,queryConstraints:n})}catch(i){throw console.error(i),i}}saveConversation(n){return p(this,null,function*(){try{let i=Yi.Build(n),s;return(s=yield this.firestore.create(i,{collection:"conversations",converter:this.conversationConverter}))?s:null}catch(i){throw i}})}updateConversation(n){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(n,{collection:"conversations",converter:this.conversationConverter}))?i:null}catch(i){throw i}})}saveMessage(s){return p(this,arguments,function*({conversationId:n,messageData:i}){try{let o;return(o=yield this.firestore.createInSubcollection(i,{collection:`conversations/${n}/messages`,converter:this.messageConverter}))?o:null}catch(o){throw o}})}deleteConversation(n){return p(this,null,function*(){try{return yield this.firestore.remove(n)}catch(i){throw i}})}conversationExists(n){return p(this,null,function*(){try{return yield this.firestore.exists(n)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var LT,MT=W(()=>{"use strict";he();Vs();he();LT=(()=>{let e=class e{get firebaseUser(){return this._firebaseUser.asReadonly()}constructor(){this.firebaseAuth=ie(ir),this._firebaseUser=ug(null),Fy(this.firebaseAuth,n=>p(this,null,function*(){this._firebaseUser.set(n)}))}registerWithEmail(n){return p(this,null,function*(){try{let i=yield Vy(this.firebaseAuth,n.email,n.password).then(s=>s.user);return yield zy(i,{displayName:n.username}),{uid:i.uid}}catch(i){throw this.getErrorMessage(i.code||i.message)}})}registerWithProvider(n){return p(this,null,function*(){return yield this.loginWithProvider(n)})}loginWithEmail(n,i){return p(this,null,function*(){try{return{uid:(yield By(this.firebaseAuth,n,i)).user.uid}}catch(s){throw this.getErrorMessage(s.code||s.message)}})}loginWithProvider(n){return p(this,null,function*(){try{let i=n==="google"?new _h:new Ns("apple.com");return{uid:(yield $y(this.firebaseAuth,i)).user.uid}}catch(i){throw this.getErrorMessage(i.code||i.message)}})}logout(){return p(this,null,function*(){try{yield qy(this.firebaseAuth)}catch(n){throw n}})}resetPassword(n){return p(this,null,function*(){try{console.log("resetting password"),yield Uy(this.firebaseAuth,n)}catch(i){throw i}})}updatePassword(n){return p(this,null,function*(){try{let i=this._firebaseUser();if(!i)return;yield jy(i,n)}catch(i){throw i}})}getErrorMessage(n){return console.error(n),"Las credenciales son incorrectas."}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var FT,UT=W(()=>{"use strict";Su();he();Su();FT=(()=>{let e=class e{constructor(n){this.storage=n}upload(o,c){return p(this,arguments,function*(n,i,s={}){let u=zi(this.storage,n);return yield fT(u,i,s),yield Yp(u)})}delete(n){return p(this,null,function*(){let i=zi(this.storage,n);yield uT(i)})}getDownloadURL(n){return p(this,null,function*(){let i=zi(this.storage,n);return yield Yp(i)})}getMetadata(n){return p(this,null,function*(){let i=zi(this.storage,n);return yield lT(i)})}list(n){return p(this,null,function*(){let i=zi(this.storage,n);return(yield dT(i)).items.map(o=>o.name)})}};e.\u0275fac=function(i){return new(i||e)(og(Vr))},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var BT=W(()=>{"use strict"});var Lr,$T=W(()=>{"use strict";hl();BT();Lr=Lg("PushNotifications",{})});var qT,jT=W(()=>{"use strict";he();$T();hl();Bg();xg();Rg();DA();he();qT=(()=>{let e=class e{constructor(){this.authService=ie(ia),this.userRepository=ie(ta),this.cache=ie(Fg),this.router=ie(Eg)}initPushNotifications(){ra.isNativePlatform()&&(Lr.requestPermissions().then(n=>p(this,null,function*(){n.receive==="granted"?(console.log("Push notifications permissions granted!"),Lr.register()):console.warn(`Error in permissions request: ${n}`)})),Lr.addListener("registration",n=>p(this,null,function*(){if((yield this.cache.get("fcmToken"))!==n.value){console.log(`Push registration success, token: ${n.value}`),this.cache.set("fcmToken",n.value);let s=this.authService.currentUser();s&&(yield this.userRepository.updateUser({_id:s._id,fcmToken:n.value}))}})),Lr.addListener("registrationError",n=>{console.error("Error on push notifications registration: "+JSON.stringify(n))}),Lr.addListener("pushNotificationReceived",n=>{console.log("Push received: "+JSON.stringify(n))}),Lr.addListener("pushNotificationActionPerformed",n=>{var s,o,c;console.log("Push action performed: "+JSON.stringify(n));let i=(s=n.notification.data)==null?void 0:s.type;switch(i){case"sale":let u=(o=n.notification.data)==null?void 0:o.postId;u&&this.router.navigate([`/tabs/post-detail/${u}`]);break;case"message":let h=(c=n.notification.data)==null?void 0:c.conversationId;h&&this.router.navigate([`/tabs/conversation/${h}`]);break;default:console.warn(`Unhandled push notification type: ${i}`);break}}))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})()});var QD=bA(zT=>{he();SA();Rg();Dg();Es();Vs();ko();Su();mT();_T();vT();he();kA();hl();Bg();VA();TT();xA();RT();xg();PT();FA();NT();MA();VT();MT();PA();UT();NA();jT();Ig(gT,{providers:[{provide:wg,useClass:Sg},kg({mode:"ios"}),Ag(pT,bg(Tg)),S_(()=>{let r=C_(yT.firebase);return ra.isNativePlatform()&&(DE(r,{localCache:yE()}),My(r,{persistence:Ba})),r}),xy(()=>Ly()),RE(()=>kE()),cT(()=>hT()),ag(Mg.forRoot()),{provide:Og,useClass:LT},{provide:ta,useClass:CT},{provide:jg,useClass:ET},{provide:$g,useClass:bT},{provide:Jg,useClass:DT},{provide:Yg,useClass:xT},{provide:Ug,useClass:FT},fg(()=>p(zT,null,function*(){let r=ie(ia),e=ie(qT);yield r.init(),e.initPushNotifications()}))]})});export default QD();
