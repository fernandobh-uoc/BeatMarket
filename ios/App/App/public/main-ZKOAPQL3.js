import{a as Zg,b as BA}from"./chunk-XZOZKGXX.js";import{a as e_,b as $A}from"./chunk-HWNQPEWS.js";import{a as vs,b as LA}from"./chunk-J54E6WEV.js";import{i as Hg,j as Kg,k as Qg,l as Yg,m as Jg,n as Xg,o as UA}from"./chunk-ZLVYX7G6.js";import{a as bt,b as sa,c as Wg,d as oa}from"./chunk-CC7RULIL.js";import{a as Gg,b as FA}from"./chunk-ATV22YZD.js";import{a as Lg,c as DA,d as zg,e as MA}from"./chunk-26KUR5UJ.js";import{a as $r,b as dl,d as na,f as Mg,g as Fg,h as NA,j as ra,k as Ug,m as fl,n as Bg,o as OA,p as $g,q as xA,r as qg,s as VA,v as ia,w as jg}from"./chunk-GIZGGZ62.js";import{Ba as Vg,J as Dg,M as Ng,O as Og,ta as xg}from"./chunk-XVXSUTZI.js";import{$ as pg,Aa as wg,Ab as Ag,B as ve,Bb as kA,D as _n,E as lg,F as ie,G as De,H as yn,Hb as bg,I as hg,Ib as Rg,J as ta,K as At,Kb as Sg,Lb as Pg,Mb as Cg,Nb as kg,T as vn,U as dg,W as ot,_ as fg,a as _s,ba as mg,d as ag,db as Eg,e as cg,eb as Tg,f as ea,fb as hl,h as CA,ha as gg,i as cl,j as ul,l as Kn,p as Pe,pa as _g,pb as he,q as Gt,sa as yg,v as ll,w as Qn,x as ys,y as ug,ya as vg,za as Ig}from"./chunk-LBGYGD76.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as ae,b as Se,e as ig,f as W,g as PA,i as gn,j as al,k as sg,l as og,n as Wt,o as p}from"./chunk-FIPIWZQS.js";var t_,n_=W(()=>{"use strict";t_=()=>{}});function ua(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}function da(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Is(JSON.stringify(t)),Is(JSON.stringify(o)),""].join(".")}function _e(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function s_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_e())}function HA(){var n;let e=(n=la())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function o_(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function a_(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function c_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function u_(){let n=_e();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Il(){return!HA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function qr(){try{return typeof indexedDB=="object"}catch{return!1}}function l_(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}function QA(n,e){return n.replace(YA,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}function h_(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ft(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],o=e[i];if(r_(s)&&r_(o)){if(!ft(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function r_(n){return n!==null&&typeof n=="object"}function jr(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function zr(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Wr(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function d_(n,e){let t=new gl(n,e);return t.subscribe.bind(t)}function JA(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function pl(){}function ne(n){return n&&n._delegate?n._delegate:n}var i_,qA,aa,ml,jA,Is,ca,zA,WA,GA,la,_l,ha,yl,vl,Yn,KA,Ge,dt,YA,gl,tN,Ht=W(()=>{"use strict";n_();i_=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},qA=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],o=n[t++],c=n[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{let s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},aa={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,c=o?n[i+1]:0,u=i+2<n.length,h=u?n[i+2]:0,f=s>>2,g=(s&3)<<4|c>>4,y=(c&15)<<2|h>>6,T=h&63;u||(T=64,o||(y=64)),r.push(t[f],t[g],t[y],t[T])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(i_(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):qA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let h=i<n.length?t[n.charAt(i)]:64;++i;let g=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||h==null||g==null)throw new ml;let y=s<<2|c>>4;if(r.push(y),h!==64){let T=c<<4&240|h>>2;if(r.push(T),g!==64){let D=h<<6&192|g;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},ml=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},jA=function(n){let e=i_(n);return aa.encodeByteArray(e,!0)},Is=function(n){return jA(n).replace(/\./g,"")},ca=function(n){try{return aa.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};zA=()=>ua().__FIREBASE_DEFAULTS__,WA=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},GA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&ca(n[1]);return e&&JSON.parse(e)},la=()=>{try{return t_()||zA()||WA()||GA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},_l=n=>{var e,t;return(t=(e=la())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},ha=n=>{let e=_l(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},yl=()=>{var n;return(n=la())===null||n===void 0?void 0:n.config},vl=n=>{var e;return(e=la())===null||e===void 0?void 0:e[`_${n}`]};Yn=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};KA="FirebaseError",Ge=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=KA,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,dt.prototype.create)}},dt=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?QA(s,r):"Error",c=`${this.serviceName}: ${o} (${i}).`;return new Ge(i,c,r)}};YA=/\{\$([^}]+)}/g;gl=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");JA(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=pl),i.error===void 0&&(i.error=pl),i.complete===void 0&&(i.complete=pl);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};tN=4*60*60*1e3;});function XA(n){return n===Jn?void 0:n}function ZA(n){return n.instantiationMode==="EAGER"}var Ne,Jn,wl,fa,Xn=W(()=>{"use strict";Ht();Ne=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};Jn="[DEFAULT]";wl=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Yn;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ZA(e))try{this.getOrInitializeService({instanceIdentifier:Jn})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Jn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return p(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Jn){return this.instances.has(e)}getOptions(e=Jn){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,o]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&o.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:XA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Jn){return this.component?this.component.multipleInstances?e:Jn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};fa=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new wl(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}});var eb,Z,tb,nb,rb,ib,Rt,Gr=W(()=>{"use strict";eb=[],Z=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(Z||{}),tb={debug:Z.DEBUG,verbose:Z.VERBOSE,info:Z.INFO,warn:Z.WARN,error:Z.ERROR,silent:Z.SILENT},nb=Z.INFO,rb={[Z.DEBUG]:"log",[Z.VERBOSE]:"log",[Z.INFO]:"info",[Z.WARN]:"warn",[Z.ERROR]:"error"},ib=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=rb[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Rt=class{constructor(e){this.name=e,this._logLevel=nb,this._logHandler=ib,this._userLogHandler=null,eb.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tb[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Z.DEBUG,...e),this._logHandler(this,Z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Z.VERBOSE,...e),this._logHandler(this,Z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Z.INFO,...e),this._logHandler(this,Z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Z.WARN,...e),this._logHandler(this,Z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Z.ERROR,...e),this._logHandler(this,Z.ERROR,...e)}}});function ob(){return f_||(f_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ab(){return p_||(p_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}function cb(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(St(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&m_.set(t,n)}).catch(()=>{}),bl.set(e,n),e}function ub(n){if(Tl.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});Tl.set(n,e)}function __(n){Al=n(Al)}function lb(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(pa(this),e,...t);return g_.set(r,e.sort?e.sort():[e]),St(r)}:ab().includes(n)?function(...e){return n.apply(pa(this),e),St(m_.get(this))}:function(...e){return St(n.apply(pa(this),e))}}function hb(n){return typeof n=="function"?lb(n):(n instanceof IDBTransaction&&ub(n),sb(n,ob())?new Proxy(n,Al):n)}function St(n){if(n instanceof IDBRequest)return cb(n);if(El.has(n))return El.get(n);let e=hb(n);return e!==n&&(El.set(n,e),bl.set(e,n)),e}var sb,f_,p_,m_,Tl,g_,El,bl,Al,pa,Rl=W(()=>{"use strict";sb=(n,e)=>e.some(t=>n instanceof t);m_=new WeakMap,Tl=new WeakMap,g_=new WeakMap,El=new WeakMap,bl=new WeakMap;Al={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Tl.get(n);if(e==="objectStoreNames")return n.objectStoreNames||g_.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return St(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};pa=n=>bl.get(n)});function v_(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(n,e),c=St(o);return r&&o.addEventListener("upgradeneeded",u=>{r(St(o.result),u.oldVersion,u.newVersion,St(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}function y_(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Sl.get(e))return Sl.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=fb.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||db.includes(t)))return;let s=function(o,...c){return p(this,null,function*(){let u=this.transaction(o,i?"readwrite":"readonly"),h=u.store;return r&&(h=h.index(c.shift())),(yield Promise.all([h[t](...c),i&&u.done]))[0]})};return Sl.set(e,s),s}var db,fb,Sl,I_=W(()=>{"use strict";Rl();Rl();db=["get","getKey","getAll","getAllKeys","count"],fb=["put","add","delete","clear"],Sl=new Map;__(n=>Se(ae({},n),{get:(e,t,r)=>y_(e,t)||n.get(e,t,r),has:(e,t)=>!!y_(e,t)||n.has(e,t)}))});function pb(n){let e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}function E_(n,e){try{n.container.addComponent(e)}catch(t){Kt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function et(n){let e=n.name;if(Nl.has(e))return Kt.debug(`There were multiple attempts to register component ${e}.`),!1;Nl.set(e,n);for(let t of ws.values())E_(t,n);for(let t of jb.values())E_(t,n);return!0}function Qt(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Oe(n){return n==null?!1:n.settings!==void 0}function Ll(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:Dl,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw In.create("bad-app-name",{appName:String(i)});if(t||(t=yl()),!t)throw In.create("no-options");let s=ws.get(i);if(s){if(ft(t,s.options)&&ft(r,s.config))return s;throw In.create("duplicate-app",{appName:i})}let o=new fa(i);for(let u of Nl.values())o.addComponent(u);let c=new Ol(t,r,o);return ws.set(i,c),c}function Yt(n=Dl){let e=ws.get(n);if(!e&&n===Dl&&yl())return Ll();if(!e)throw In.create("no-app",{appName:n});return e}function ma(){return Array.from(ws.values())}function le(n,e,t){var r;let i=(r=qb[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let c=[`Unable to register library "${i}" with version "${e}":`];s&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Kt.warn(c.join(" "));return}et(new Ne(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function R_(){return Pl||(Pl=v_(Wb,Gb,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Es)}catch(t){console.warn(t)}}}}).catch(n=>{throw In.create("idb-open",{originalErrorMessage:n.message})})),Pl}function Hb(n){return p(this,null,function*(){try{let t=(yield R_()).transaction(Es),r=yield t.objectStore(Es).get(S_(n));return yield t.done,r}catch(e){if(e instanceof Ge)Kt.warn(e.message);else{let t=In.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Kt.warn(t.message)}}})}function T_(n,e){return p(this,null,function*(){try{let r=(yield R_()).transaction(Es,"readwrite");yield r.objectStore(Es).put(e,S_(n)),yield r.done}catch(t){if(t instanceof Ge)Kt.warn(t.message);else{let r=In.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Kt.warn(r.message)}}})}function S_(n){return`${n.name}!${n.options.appId}`}function A_(){return new Date().toISOString().substring(0,10)}function Yb(n,e=Kb){let t=[],r=n.slice();for(let i of n){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),b_(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),b_(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}function b_(n){return Is(JSON.stringify({version:2,heartbeats:n})).length}function Jb(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Xb(n){et(new Ne("platform-logger",e=>new Cl(e),"PRIVATE")),et(new Ne("heartbeat",e=>new xl(e),"PRIVATE")),le(kl,w_,n),le(kl,w_,"esm2017"),le("fire-js","")}var Cl,kl,w_,Kt,mb,gb,_b,yb,vb,Ib,wb,Eb,Tb,Ab,bb,Rb,Sb,Pb,Cb,kb,Db,Nb,Ob,xb,Vb,Lb,Mb,Fb,Ub,Bb,$b,Dl,qb,ws,jb,Nl,zb,In,Ol,Pt,Wb,Gb,Es,Pl,Kb,Qb,xl,Vl,wn=W(()=>{"use strict";Xn();Gr();Ht();Ht();I_();Cl=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(pb(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};kl="@firebase/app",w_="0.11.5";Kt=new Rt("@firebase/app"),mb="@firebase/app-compat",gb="@firebase/analytics-compat",_b="@firebase/analytics",yb="@firebase/app-check-compat",vb="@firebase/app-check",Ib="@firebase/auth",wb="@firebase/auth-compat",Eb="@firebase/database",Tb="@firebase/data-connect",Ab="@firebase/database-compat",bb="@firebase/functions",Rb="@firebase/functions-compat",Sb="@firebase/installations",Pb="@firebase/installations-compat",Cb="@firebase/messaging",kb="@firebase/messaging-compat",Db="@firebase/performance",Nb="@firebase/performance-compat",Ob="@firebase/remote-config",xb="@firebase/remote-config-compat",Vb="@firebase/storage",Lb="@firebase/storage-compat",Mb="@firebase/firestore",Fb="@firebase/vertexai",Ub="@firebase/firestore-compat",Bb="firebase",$b="11.6.1";Dl="[DEFAULT]",qb={[kl]:"fire-core",[mb]:"fire-core-compat",[_b]:"fire-analytics",[gb]:"fire-analytics-compat",[vb]:"fire-app-check",[yb]:"fire-app-check-compat",[Ib]:"fire-auth",[wb]:"fire-auth-compat",[Eb]:"fire-rtdb",[Tb]:"fire-data-connect",[Ab]:"fire-rtdb-compat",[bb]:"fire-fn",[Rb]:"fire-fn-compat",[Sb]:"fire-iid",[Pb]:"fire-iid-compat",[Cb]:"fire-fcm",[kb]:"fire-fcm-compat",[Db]:"fire-perf",[Nb]:"fire-perf-compat",[Ob]:"fire-rc",[xb]:"fire-rc-compat",[Vb]:"fire-gcs",[Lb]:"fire-gcs-compat",[Mb]:"fire-fst",[Ub]:"fire-fst-compat",[Fb]:"fire-vertex","fire-js":"fire-js",[Bb]:"fire-js-all"};ws=new Map,jb=new Map,Nl=new Map;zb={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},In=new dt("app","Firebase",zb);Ol=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ne("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw In.create("app-deleted",{appName:this._name})}};Pt=$b;Wb="firebase-heartbeat-database",Gb=1,Es="firebase-heartbeat-store",Pl=null;Kb=1024,Qb=30,xl=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Vl(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return p(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=A_();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>Qb){let o=Jb(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Kt.warn(r)}})}getHeartbeatsHeader(){return p(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=A_(),{heartbeatsToSend:r,unsentEntries:i}=Yb(this._heartbeatsCache.heartbeats),s=Is(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Kt.warn(t),""}})}};Vl=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return p(this,null,function*(){return qr()?l_().then(()=>!0).catch(()=>!1):!1})}read(){return p(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield Hb(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return p(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return T_(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return p(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return T_(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};Xb("")});var Zb,eR,En=W(()=>{"use strict";wn();wn();Zb="firebase",eR="11.6.1";le(Zb,eR,"app")});function er(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}function tR(n,e){!C_&&(P_>Hr.SILENT||hl())&&(C_=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),P_>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function nR(n){let e=ie(ot,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function Zn(n){let e=ie(ot,{optional:!0});return e?e.run(()=>n()):n()}var kt,Tn,Hr,P_,ga,Dt,C_,rR,K,Kr=W(()=>{"use strict";he();he();En();DA();ys();ug();kt=new Eg("ANGULARFIRE2_VERSION");Tn=(n,e)=>{let t=e?[e]:ma(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Hr=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(Hr||{}),P_=hl()&&typeof Zone<"u"?Hr.WARN:Hr.SILENT,ga=class{zone;delegate;constructor(e,t=cg){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i?i.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])};return this.delegate.schedule(s,t,r)}},Dt=(()=>{let e=class e{outsideAngular;insideAngular;constructor(){let r=ie(ot);this.outsideAngular=r.runOutsideAngular(()=>new ga(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=r.run(()=>new ga(typeof Zone>"u"?void 0:Zone.current,ag))}};gn(e,"\u0275fac",function(i){return new(i||e)}),gn(e,"\u0275prov",ve({token:e,factory:e.\u0275fac,providedIn:"root"}));let n=e;return n})(),C_=!1;rR=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),At(t,()=>Zn(()=>n.apply(void 0,r)))),K=(n,e,t)=>(t||(t=e?Hr.WARN:Hr.VERBOSE),function(){let r,i=arguments,s,o,c;try{s=ie(Dt),o=ie(dg),c=ie(ta)}catch{return tR(n,t),n.apply(this,i)}for(let h=0;h<arguments.length;h++)typeof i[h]=="function"&&(e&&(r||(r=Zn(()=>o.add()))),i[h]=rR(i[h],r,c));let u=nR(()=>n.apply(this,i));return e?u instanceof _s?u.pipe(ul(s.outsideAngular),cl(s.insideAngular),Lg(c)):u instanceof Promise?Zn(()=>new Promise((h,f)=>{o.run(()=>u).then(g=>At(c,()=>Zn(()=>h(g))),g=>At(c,()=>Zn(()=>f(g))))})):typeof u=="function"&&r?function(){return setTimeout(r,0),u.apply(this,arguments)}:Zn(()=>u):u instanceof _s?u.pipe(ul(s.outsideAngular),cl(s.insideAngular)):Zn(()=>u)})});function iR(n){return n&&n.length===1?n[0]:new pt(Yt())}function aR(n){return(e,t)=>{let r=t.get(pg);le("angularfire",kt.full,"core"),le("angularfire",kt.full,"app"),le("angular",Tg.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new pt(i)}}function k_(n,...e){return yn([sR,oR,{provide:Ml,useFactory:aR(n),multi:!0,deps:[ot,vn,Dt,...e]}])}var pt,Jt,Ml,sR,oR,D_,Ts=W(()=>{"use strict";En();En();he();Kr();pt=class{constructor(e){return e}},Jt=class{constructor(){return ma()}};Ml=new _n("angularfire2._apps"),sR={provide:pt,useFactory:iR,deps:[[new De,Ml]]},oR={provide:Jt,deps:[[new De,Ml]]};D_=K(Ll,!0)});function mt(n){return cR.get(n)||Object.assign({},uR)}function V_(){return lR}function fR(n){return new Promise(e=>{setTimeout(e,n)})}function L_(n){if(!mt(n).activated)throw An.create("use-before-activation",{appName:n.name})}function M_(r,i){return p(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let T=yield o.getHeartbeatsHeader();T&&(s["X-Firebase-Client"]=T)}let c={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(n,c)}catch(T){throw An.create("fetch-network-error",{originalErrorMessage:T==null?void 0:T.message})}if(u.status!==200)throw An.create("fetch-status-error",{httpStatus:u.status});let h;try{h=yield u.json()}catch(T){throw An.create("fetch-parse-error",{originalErrorMessage:T==null?void 0:T.message})}let f=h.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw An.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});let g=Number(f[1])*1e3,y=Date.now();return{token:h.token,expireTimeMillis:y+g,issuedAtTimeMillis:y}})}function F_(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${hR}/projects/${t}/apps/${r}:${dR}?key=${i}`,body:{debug_token:e}}}function _R(){return _a||(_a=new Promise((n,e)=>{try{let t=indexedDB.open(mR,gR);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(An.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore($l,{keyPath:"compositeKey"})}}}catch(t){e(An.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}}),_a)}function yR(n,e){return vR(IR(n),e)}function vR(n,e){return p(this,null,function*(){let r=(yield _R()).transaction($l,"readwrite"),s=r.objectStore($l).put({compositeKey:n,value:e});return new Promise((o,c)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var h;c(An.create("storage-set",{originalErrorMessage:(h=u.target.error)===null||h===void 0?void 0:h.message}))}})})}function IR(n){return`${n.options.appId}-${n.name}`}function Fl(n,e){return qr()?yR(n,e).catch(t=>{As.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function U_(){return V_().enabled}function B_(){return p(this,null,function*(){let n=V_();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}function ER(n){return aa.encodeString(JSON.stringify(n),!1)}function ql(n,e=!1,t=!1){return p(this,null,function*(){let r=n.app;L_(r);let i=mt(r),s=i.token,o;if(s&&!bs(s)&&(i.token=void 0,s=void 0),!s){let h=yield i.cachedTokenPromise;h&&(bs(h)?s=h:yield Fl(r,void 0))}if(!e&&s&&bs(s))return{token:s.token};let c=!1;if(U_())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=M_(F_(r,yield B_()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),c=!0);let h=yield i.exchangeTokenPromise;return yield Fl(r,h),i.token=h,{token:h.token}}catch(h){return h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?As.warn(h.message):t&&As.error(h),Ul(h)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),c=!0),s=yield mt(r).exchangeTokenPromise}catch(h){h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?As.warn(h.message):t&&As.error(h),o=h}let u;return s?o?bs(s)?u={token:s.token,internalError:o}:u=Ul(o):(u={token:s.token},i.token=s,yield Fl(r,s)):u=Ul(o),c&&RR(r,u),u})}function TR(n){return p(this,null,function*(){let e=n.app;L_(e);let{provider:t}=mt(e);if(U_()){let r=yield B_(),{token:i}=yield M_(F_(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function AR(n,e,t,r){let{app:i}=n,s=mt(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&bs(s.token)){let c=s.token;Promise.resolve().then(()=>{t({token:c.token}),O_(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>O_(n))}function $_(n,e){let t=mt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function O_(n){let{app:e}=n,t=mt(e),r=t.tokenRefresher;r||(r=bR(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function bR(n){let{app:e}=n;return new Bl(()=>p(this,null,function*(){let t=mt(e),r;if(t.token?r=yield ql(n,!0):r=yield ql(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=mt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},N_.RETRIAL_MIN_WAIT,N_.RETRIAL_MAX_WAIT)}function RR(n,e){let t=mt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function bs(n){return n.expireTimeMillis-Date.now()>0}function Ul(n){return{token:ER(wR),error:n}}function SR(n,e){return new jl(n,e)}function PR(n){return{getToken:e=>ql(n,e),getLimitedUseToken:()=>TR(n),addTokenListener:e=>AR(n,"INTERNAL",e),removeTokenListener:e=>$_(n.app,e)}}function NR(){et(new Ne(DR,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return SR(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(x_).initialize()})),et(new Ne(x_,n=>{let e=n.getProvider("app-check").getImmediate();return PR(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),le(CR,kR)}var cR,uR,lR,hR,dR,N_,XN,Bl,pR,An,mR,gR,$l,_a,As,wR,jl,CR,kR,DR,x_,q_=W(()=>{"use strict";wn();Xn();Ht();Gr();cR=new Map,uR={activated:!1,tokenObservers:[]},lR={initialized:!1,enabled:!1};hR="https://content-firebaseappcheck.googleapis.com/v1",dR="exchangeDebugToken",N_={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},XN=24*60*60*1e3;Bl=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return p(this,null,function*(){this.stop();try{this.pending=new Yn,this.pending.promise.catch(t=>{}),yield fR(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Yn,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};pR={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},An=new dt("appCheck","AppCheck",pR);mR="firebase-app-check-database",gR=1,$l="firebase-app-check-store",_a=null;As=new Rt("@firebase/app-check");wR={error:"UNKNOWN_ERROR"};jl=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=mt(this.app);for(let t of e)$_(this.app,t.next);return Promise.resolve()}};CR="@firebase/app-check",kR="0.8.13";DR="app-check",x_="app-check-internal";NR()});var zl=W(()=>{"use strict";q_()});var OR,bn,xR,hO,ya=W(()=>{"use strict";Kr();En();zl();zl();OR="app-check",bn=class{constructor(){return Tn(OR)}},xR=["localhost","0.0.0.0","127.0.0.1"],hO=typeof window<"u"&&xR.includes(window.location.hostname)});function iy(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function VR(n,...e){Aa.logLevel<=Z.WARN&&Aa.warn(`Auth (${Pt}): ${n}`,...e)}function Ia(n,...e){Aa.logLevel<=Z.ERROR&&Aa.error(`Auth (${Pt}): ${n}`,...e)}function at(n,...e){throw dh(n,...e)}function gt(n,...e){return dh(n,...e)}function hh(n,e,t){let r=Object.assign(Object.assign({},sy()),{[e]:t});return new dt("auth","Firebase",r).create(e,{appName:n.name})}function en(n){return hh(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function LR(n,e,t){let r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&at(n,"argument-error"),hh(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function dh(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return oy.create(n,...e)}function $(n,e,...t){if(!n)throw dh(e,...t)}function Xt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Ia(e),new Error(e)}function tn(n,e){n||Xt(e)}function Hl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function MR(){return j_()==="http:"||j_()==="https:"}function j_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function FR(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(MR()||a_()||"connection"in navigator)?navigator.onLine:!0}function UR(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}function fh(n,e){tn(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}function nn(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function _t(s,o,c,u){return p(this,arguments,function*(n,e,t,r,i={}){return ay(n,i,()=>p(this,null,function*(){let h={},f={};r&&(e==="GET"?f=r:h={body:JSON.stringify(r)});let g=jr(Object.assign({key:n.config.apiKey},f)).slice(1),y=yield n._getAdditionalHeaders();y["Content-Type"]="application/json",n.languageCode&&(y["X-Firebase-Locale"]=n.languageCode);let T=Object.assign({method:e,headers:y},h);return o_()||(T.referrerPolicy="no-referrer"),ba.fetch()(yield cy(n,n.config.apiHost,t,g),T)}))})}function ay(n,e,t){return p(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},BR),e);try{let i=new Kl(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw va(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let c=s.ok?o.errorMessage:o.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw va(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw va(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw va(n,"user-disabled",o);let f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw hh(n,f,h);at(n,f)}}catch(i){if(i instanceof Ge)throw i;at(n,"network-request-failed",{message:String(i)})}})}function Vs(s,o,c,u){return p(this,arguments,function*(n,e,t,r,i={}){let h=yield _t(n,e,t,r,i);return"mfaPendingCredential"in h&&at(n,"multi-factor-auth-required",{_serverResponse:h}),h})}function cy(n,e,t,r){return p(this,null,function*(){let i=`${e}${t}?${r}`,s=n,o=s.config.emulator?fh(n.config,i):`${n.config.apiScheme}://${i}`;return $R.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}function jR(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}function va(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=gt(n,e,r);return i.customData._tokenResponse=t,i}function z_(n){return n!==void 0&&n.enterprise!==void 0}function zR(n,e){return p(this,null,function*(){return _t(n,"GET","/v2/recaptchaConfig",nn(n,e))})}function WR(n,e){return p(this,null,function*(){return _t(n,"POST","/v1/accounts:delete",e)})}function Ra(n,e){return p(this,null,function*(){return _t(n,"POST","/v1/accounts:lookup",e)})}function Ss(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function ph(n,e=!1){return p(this,null,function*(){let t=ne(n),r=yield t.getIdToken(e),i=mh(r);$(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Ss(Wl(i.auth_time)),issuedAtTime:Ss(Wl(i.iat)),expirationTime:Ss(Wl(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}})}function Wl(n){return Number(n)*1e3}function mh(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ia("JWT malformed, contained fewer than 3 sections"),null;try{let i=ca(t);return i?JSON.parse(i):(Ia("Failed to decode base64 JWT payload"),null)}catch(i){return Ia("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function W_(n){let e=mh(n);return $(e,"internal-error"),$(typeof e.exp<"u","internal-error"),$(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function nr(n,e,t=!1){return p(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof Ge&&GR(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function GR({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}function Sa(n){return p(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield nr(n,Ra(t,{idToken:r}));$(i==null?void 0:i.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?uy(s.providerUserInfo):[],c=HR(n.providerData,o),u=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!(c!=null&&c.length),f=u?h:!1,g={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new Cs(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(n,g)})}function gh(n){return p(this,null,function*(){let e=ne(n);yield Sa(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function HR(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function uy(n){return n.map(e=>{var{providerId:t}=e,r=ea(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function KR(n,e){return p(this,null,function*(){let t=yield ay(n,{},()=>p(this,null,function*(){let r=jr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=yield cy(n,i,"/v1/token",`key=${s}`),c=yield n._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",ba.fetch()(o,{method:"POST",headers:c,body:r})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function QR(n,e){return p(this,null,function*(){return _t(n,"POST","/v2/accounts:revokeToken",nn(n,e))})}function Rn(n,e){$(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}function Zt(n){tn(n instanceof Function,"Expected a class definition");let e=G_.get(n);return e?(tn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,G_.set(n,e),e)}function wa(n,e,t){return`firebase:${n}:${e}:${t}`}function H_(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(fy(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ly(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(my(e))return"Blackberry";if(gy(e))return"Webos";if(hy(e))return"Safari";if((e.includes("chrome/")||dy(e))&&!e.includes("edge/"))return"Chrome";if(py(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function ly(n=_e()){return/firefox\//i.test(n)}function hy(n=_e()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function dy(n=_e()){return/crios\//i.test(n)}function fy(n=_e()){return/iemobile/i.test(n)}function py(n=_e()){return/android/i.test(n)}function my(n=_e()){return/blackberry/i.test(n)}function gy(n=_e()){return/webos/i.test(n)}function _h(n=_e()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function JR(n=_e()){var e;return _h(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function XR(){return u_()&&document.documentMode===10}function _y(n=_e()){return _h(n)||py(n)||gy(n)||my(n)||/windows phone/i.test(n)||fy(n)}function yy(n,e=[]){let t;switch(n){case"Browser":t=H_(_e());break;case"Worker":t=`${H_(_e())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Pt}/${r}`}function ZR(t){return p(this,arguments,function*(n,e={}){return _t(n,"GET","/v2/passwordPolicy",nn(n,e))})}function rn(n){return ne(n)}function tS(n){Ma=n}function vy(n){return Ma.loadJS(n)}function nS(){return Ma.recaptchaEnterpriseScript}function rS(){return Ma.gapiScript}function Iy(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function Rs(n,e,t,r=!1,i=!1){return p(this,null,function*(){let s=new rh(n),o;if(i)o=wy;else try{o=yield s.verify(t)}catch{o=yield s.verify(t,!0)}let c=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){let u=c.phoneEnrollmentInfo.phoneNumber,h=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){let u=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return r?Object.assign(c,{captchaResp:o}):Object.assign(c,{captchaResponse:o}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c})}function ka(n,e,t,r,i){return p(this,null,function*(){var s,o;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let c=yield Rs(n,e,t,t==="getOobCode");return r(n,c)}else return r(n,e).catch(c=>p(this,null,function*(){if(c.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let u=yield Rs(n,e,t,t==="getOobCode");return r(n,u)}else return Promise.reject(c)}));else if(i==="PHONE_PROVIDER")if(!((o=n._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("PHONE_PROVIDER")){let c=yield Rs(n,e,t);return r(n,c).catch(u=>p(this,null,function*(){var h;if(((h=n._getRecaptchaConfig())===null||h===void 0?void 0:h.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(u.code==="auth/missing-recaptcha-token"||u.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let f=yield Rs(n,e,t,!1,!0);return r(n,f)}return Promise.reject(u)}))}else{let c=yield Rs(n,e,t,!1,!0);return r(n,c)}else return Promise.reject(i+" provider is not supported.")})}function Fa(n,e){let t=Qt(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(ft(s,e!=null?e:{}))return i;at(i,"already-initialized")}return t.initialize({options:e})}function sS(n,e){let t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Zt);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function yh(n,e,t){let r=rn(n);$(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!(t!=null&&t.disableWarnings),s=Ey(e),{host:o,port:c}=oS(e),u=c===null?"":`:${c}`,h={url:`${s}//${o}${u}/`},f=Object.freeze({host:o,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){$(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),$(ft(h,r.config.emulator)&&ft(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,i||aS()}function Ey(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function oS(n){let e=Ey(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:K_(r.substr(s.length+1))}}else{let[s,o]=r.split(":");return{host:s,port:K_(o)}}}function K_(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function aS(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}function cS(n,e){return p(this,null,function*(){return _t(n,"POST","/v1/accounts:update",e)})}function uS(n,e){return p(this,null,function*(){return _t(n,"POST","/v1/accounts:signUp",e)})}function lS(n,e){return p(this,null,function*(){return Vs(n,"POST","/v1/accounts:signInWithPassword",nn(n,e))})}function hS(n,e){return p(this,null,function*(){return _t(n,"POST","/v1/accounts:sendOobCode",nn(n,e))})}function dS(n,e){return p(this,null,function*(){return hS(n,e)})}function fS(n,e){return p(this,null,function*(){return Vs(n,"POST","/v1/accounts:signInWithEmailLink",nn(n,e))})}function pS(n,e){return p(this,null,function*(){return Vs(n,"POST","/v1/accounts:signInWithEmailLink",nn(n,e))})}function Qr(n,e){return p(this,null,function*(){return Vs(n,"POST","/v1/accounts:signInWithIdp",nn(n,e))})}function gS(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function _S(n){let e=zr(Wr(n)).link,t=e?zr(Wr(e)).deep_link_id:null,r=zr(Wr(n)).deep_link_id;return(r?zr(Wr(r)).link:null)||r||t||e||n}function yS(n,e){return p(this,null,function*(){return Vs(n,"POST","/v1/accounts:signUp",nn(n,e))})}function Q_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}function Ay(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?ih._fromErrorAndOperation(n,s,e,r):s})}function vS(n,e,t=!1){return p(this,null,function*(){let r=yield nr(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return Xr._forOperation(n,"link",r)})}function IS(n,e,t=!1){return p(this,null,function*(){let{auth:r}=n;if(Oe(r.app))return Promise.reject(en(r));let i="reauthenticate";try{let s=yield nr(n,Ay(r,i,e,n),t);$(s.idToken,r,"internal-error");let o=mh(s.idToken);$(o,r,"internal-error");let{sub:c}=o;return $(n.uid===c,r,"user-mismatch"),Xr._forOperation(n,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&at(r,"user-mismatch"),s}})}function by(n,e,t=!1){return p(this,null,function*(){if(Oe(n.app))return Promise.reject(en(n));let r="signIn",i=yield Ay(n,r,e),s=yield Xr._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function Ih(n,e){return p(this,null,function*(){return by(rn(n),e)})}function wS(n,e,t){var r;$(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),$(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),$(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&($(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&($(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}function Ry(n){return p(this,null,function*(){let e=rn(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function wh(n,e,t){return p(this,null,function*(){let r=rn(n),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&wS(r,i,t),yield ka(r,i,"getOobCode",dS,"EMAIL_PASSWORD_PROVIDER")})}function Eh(n,e,t){return p(this,null,function*(){if(Oe(n.app))return Promise.reject(en(n));let r=rn(n),o=yield ka(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",yS,"EMAIL_PASSWORD_PROVIDER").catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&Ry(n),u}),c=yield Xr._fromIdTokenResponse(r,"signIn",o);return yield r._updateCurrentUser(c.user),c})}function Th(n,e,t){return Oe(n.app)?Promise.reject(en(n)):Ih(ne(n),Ty.credential(e,t)).catch(r=>p(this,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&Ry(n),r}))}function ES(n,e){return p(this,null,function*(){return _t(n,"POST","/v1/accounts:update",e)})}function Ah(r,i){return p(this,arguments,function*(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let s=ne(n),c={idToken:yield s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},u=yield nr(s,ES(s.auth,c));s.displayName=u.displayName||null,s.photoURL=u.photoUrl||null;let h=s.providerData.find(({providerId:f})=>f==="password");h&&(h.displayName=s.displayName,h.photoURL=s.photoURL),yield s._updateTokensIfNecessary(u)})}function bh(n,e){return TS(ne(n),null,e)}function TS(n,e,t){return p(this,null,function*(){let{auth:r}=n,s={idToken:yield n.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);let o=yield nr(n,cS(r,s));yield n._updateTokensIfNecessary(o,!0)})}function Rh(n,e,t,r){return ne(n).onIdTokenChanged(e,t,r)}function Sh(n,e,t){return ne(n).beforeAuthStateChanged(e,t)}function Ph(n,e,t,r){return ne(n).onAuthStateChanged(e,t,r)}function Ch(n){return ne(n).signOut()}function PS(n){return Promise.all(n.map(e=>p(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}function Dh(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}function Nt(){return window}function kS(n){Nt().location.href=n}function Py(){return typeof Nt().WorkerGlobalScope<"u"&&typeof Nt().importScripts=="function"}function DS(){return p(this,null,function*(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function NS(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function OS(){return Py()?self:null}function Ua(n,e){return n.transaction([xa],e?"readwrite":"readonly").objectStore(xa)}function VS(){let n=indexedDB.deleteDatabase(Cy);return new rr(n).toPromise()}function oh(){let n=indexedDB.open(Cy,xS);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(xa,{keyPath:ky})}catch(i){t(i)}}),n.addEventListener("success",()=>p(this,null,function*(){let r=n.result;r.objectStoreNames.contains(xa)?e(r):(r.close(),yield VS(),e(yield oh()))}))})}function Y_(n,e,t){return p(this,null,function*(){let r=Ua(n,!0).put({[ky]:e,value:t});return new rr(r).toPromise()})}function LS(n,e){return p(this,null,function*(){let t=Ua(n,!1).get(e),r=yield new rr(t).toPromise();return r===void 0?null:r.value})}function J_(n,e){let t=Ua(n,!0).delete(e);return new rr(t).toPromise()}function Dy(n,e){return e?Zt(e):($(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}function BS(n){return by(n.auth,new xs(n),n.bypassAuthState)}function $S(n){let{auth:e,user:t}=n;return $(t,e,"internal-error"),IS(t,new xs(n),n.bypassAuthState)}function qS(n){return p(this,null,function*(){let{auth:e,user:t}=n;return $(t,e,"internal-error"),vS(t,new xs(n),n.bypassAuthState)})}function Nh(n,e,t){return p(this,null,function*(){if(Oe(n.app))return Promise.reject(gt(n,"operation-not-supported-in-this-environment"));let r=rn(n);LR(n,e,Ds);let i=Dy(r,t);return new zS(r,"signInViaPopup",e,i).executeNotNull()})}function GS(n,e){return p(this,null,function*(){let t=QS(e),r=KS(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function HS(n,e){Ea.set(n._key(),e)}function KS(n){return Zt(n._redirectPersistence)}function QS(n){return wa(WS,n.config.apiKey,n.name)}function YS(n,e,t=!1){return p(this,null,function*(){if(Oe(n.app))return Promise.reject(en(n));let r=rn(n),i=Dy(r,e),o=yield new ah(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,e)),o})}function X_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Ny({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function XS(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ny(n);default:return!1}}function ZS(t){return p(this,arguments,function*(n,e={}){return _t(n,"GET","/v1/projects",e)})}function n0(n){return p(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield ZS(n);for(let t of e)try{if(r0(t))return}catch{}at(n,"unauthorized-domain")})}function r0(n){let e=Hl(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!t0.test(t))return!1;if(e0.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}function Z_(){let n=Nt().___jsl;if(n!=null&&n.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function s0(n){return new Promise((e,t)=>{var r,i,s;function o(){Z_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Z_(),t(gt(n,"network-request-failed"))},timeout:i0.get()})}if(!((i=(r=Nt().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Nt().gapi)===null||s===void 0)&&s.load)o();else{let c=Iy("iframefcb");return Nt()[c]=()=>{gapi.load?o():t(gt(n,"network-request-failed"))},vy(`${rS()}?onload=${c}`).catch(u=>t(u))}}).catch(e=>{throw Ta=null,e})}function o0(n){return Ta=Ta||s0(n),Ta}function d0(n){let e=n.config;$(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?fh(e,u0):`https://${n.config.authDomain}/${c0}`,r={apiKey:e.apiKey,appName:n.name,v:Pt},i=h0.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${jr(r).slice(1)}`}function f0(n){return p(this,null,function*(){let e=yield o0(n),t=Nt().gapi;return $(t,n,"internal-error"),e.open({where:document.body,url:d0(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:l0,dontclear:!0},r=>new Promise((i,s)=>p(this,null,function*(){yield r.restyle({setHideOnLeave:!1});let o=gt(n,"network-request-failed"),c=Nt().setTimeout(()=>{s(o)},a0.get());function u(){Nt().clearTimeout(c),i(r)}r.ping(u).then(u,()=>{s(o)})})))})}function v0(n,e,t,r=m0,i=g0){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),c="",u=Object.assign(Object.assign({},p0),{width:r.toString(),height:i.toString(),top:s,left:o}),h=_e().toLowerCase();t&&(c=dy(h)?_0:t),ly(h)&&(e=e||y0,u.scrollbars="yes");let f=Object.entries(u).reduce((y,[T,D])=>`${y}${T}=${D},`,"");if(JR(h)&&c!=="_self")return I0(e||"",c),new La(null);let g=window.open(e||"",c,f);$(g,n,"popup-blocked");try{g.focus()}catch{}return new La(g)}function I0(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}function ey(n,e,t,r,i,s){return p(this,null,function*(){$(n.config.authDomain,n,"auth-domain-config-required"),$(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Pt,eventId:i};if(e instanceof Ds){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",h_(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[f,g]of Object.entries(s||{}))o[f]=g}if(e instanceof Ns){let f=e.getScopes().filter(g=>g!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);let c=o;for(let f of Object.keys(c))c[f]===void 0&&delete c[f];let u=yield n._getAppCheckToken(),h=u?`#${T0}=${encodeURIComponent(u)}`:"";return`${A0(n)}?${jr(c).slice(1)}${h}`})}function A0({config:n}){return n.emulator?fh(n,E0):`https://${n.authDomain}/${w0}`}function b0(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function R0(n){et(new Ne("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=r.options;$(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let u={apiKey:o,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yy(n)},h=new eh(r,i,s,u);return sS(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),et(new Ne("auth-internal",e=>{let t=rn(e.getProvider("auth").getImmediate());return(r=>new lh(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),le(ty,ny,b0(n)),le(ty,ny,"esm2017")}function Oh(n=Yt()){let e=Qt(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Fa(n,{popupRedirectResolver:Oy,persistence:[Ba,Sy,kh]}),r=vl("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let o=C0(s.toString());Sh(t,o,()=>o(t.currentUser)),Rh(t,c=>o(c))}}let i=_l("auth");return i&&yh(t,`http://${i}`),t}function k0(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}var sy,oy,Aa,tr,ba,BR,$R,qR,Kl,Ql,Yl,Cs,Ps,Sn,G_,YR,Jl,Pa,Xl,eS,Zl,eh,Ca,Ma,th,nh,iS,wy,rh,Yr,ks,mS,Jr,Da,Ty,Ds,Ns,Os,vh,Xr,ih,Na,Oa,AS,bS,RS,Sy,SS,kh,CS,sh,Cy,xS,xa,ky,rr,MS,FS,US,Ba,IO,wO,xs,Va,jS,zS,WS,Ea,ah,JS,ch,e0,t0,i0,Ta,a0,c0,u0,l0,h0,p0,m0,g0,_0,y0,La,w0,E0,T0,Gl,uh,Oy,ty,ny,lh,S0,P0,ry,C0,xy=W(()=>{"use strict";wn();Ht();Gr();CA();Xn();sy=iy,oy=new dt("auth","Firebase",iy());Aa=new Rt("@firebase/auth");tr=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,tn(t>e,"Short delay should be less than long delay!"),this.isMobile=s_()||c_()}get(){return FR()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};ba=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Xt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Xt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Xt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};BR={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};$R=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],qR=new tr(3e4,6e4);Kl=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(gt(this.auth,"network-request-failed")),qR.get())})}};Ql=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return jR(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};Yl=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>p(this,null,function*(){yield this.iteration()}),t)}iteration(){return p(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};Cs=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ss(this.lastLoginAt),this.creationTime=Ss(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};Ps=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){$(e.idToken,"internal-error"),$(typeof e.idToken<"u","internal-error"),$(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):W_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){$(e.length!==0,"internal-error");let t=W_(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return p(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:($(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return p(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield KR(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new n;return r&&($(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&($(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&($(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Xt("not implemented")}};Sn=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=ea(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Yl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Cs(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return p(this,null,function*(){let t=yield nr(this,this.stsTokenManager.getToken(this.auth,e));return $(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return ph(this,e)}reload(){return gh(this)}_assign(e){this!==e&&($(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){$(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return p(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Sa(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return p(this,null,function*(){if(Oe(this.auth.app))return Promise.reject(en(this.auth));let e=yield this.getIdToken();return yield nr(this,WR(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,c,u,h,f;let g=(r=t.displayName)!==null&&r!==void 0?r:void 0,y=(i=t.email)!==null&&i!==void 0?i:void 0,T=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,D=(o=t.photoURL)!==null&&o!==void 0?o:void 0,N=(c=t.tenantId)!==null&&c!==void 0?c:void 0,k=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,q=(h=t.createdAt)!==null&&h!==void 0?h:void 0,U=(f=t.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:M,emailVerified:j,isAnonymous:X,providerData:G,stsTokenManager:w}=t;$(M&&w,e,"internal-error");let _=Ps.fromJSON(this.name,w);$(typeof M=="string",e,"internal-error"),Rn(g,e.name),Rn(y,e.name),$(typeof j=="boolean",e,"internal-error"),$(typeof X=="boolean",e,"internal-error"),Rn(T,e.name),Rn(D,e.name),Rn(N,e.name),Rn(k,e.name),Rn(q,e.name),Rn(U,e.name);let I=new n({uid:M,auth:e,email:y,emailVerified:j,displayName:g,isAnonymous:X,photoURL:D,phoneNumber:T,tenantId:N,stsTokenManager:_,createdAt:q,lastLoginAt:U});return G&&Array.isArray(G)&&(I.providerData=G.map(E=>Object.assign({},E))),k&&(I._redirectEventId=k),I}static _fromIdTokenResponse(e,t,r=!1){return p(this,null,function*(){let i=new Ps;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Sa(s),s})}static _fromGetAccountInfoResponse(e,t,r){return p(this,null,function*(){let i=t.users[0];$(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?uy(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),c=new Ps;c.updateFromIdToken(r);let u=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Cs(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(u,h),u})}};G_=new Map;YR=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return p(this,null,function*(){return!0})}_set(t,r){return p(this,null,function*(){this.storage[t]=r})}_get(t){return p(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return p(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Jl=YR;Pa=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=wa(this.userKey,i.apiKey,s),this.fullPersistenceKey=wa("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return p(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Ra(this.auth,{idToken:e}).catch(()=>{});return t?Sn._fromGetAccountInfoResponse(this.auth,t,e):null}return Sn._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return p(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return p(this,null,function*(){if(!t.length)return new n(Zt(Jl),e,r);let i=(yield Promise.all(t.map(h=>p(this,null,function*(){if(yield h._isAvailable())return h})))).filter(h=>h),s=i[0]||Zt(Jl),o=wa(r,e.config.apiKey,e.name),c=null;for(let h of t)try{let f=yield h._get(o);if(f){let g;if(typeof f=="string"){let y=yield Ra(e,{idToken:f}).catch(()=>{});if(!y)break;g=yield Sn._fromGetAccountInfoResponse(e,y,f)}else g=Sn._fromJSON(e,f);h!==s&&(c=g),s=h;break}}catch{}let u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new n(s,e,r):(s=u[0],c&&(yield s._set(o,c.toJSON())),yield Promise.all(t.map(h=>p(this,null,function*(){if(h!==s)try{yield h._remove(o)}catch{}}))),new n(s,e,r))})}};Xl=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((o,c)=>{try{let u=e(s);o(u)}catch(u){c(u)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return p(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}})}};eS=6,Zl=class{constructor(e){var t,r,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:eS,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,c;let u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(s=u.containsUppercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};eh=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ca(this),this.idTokenSubscription=new Ca(this),this.beforeStateQueue=new Xl(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=oy,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Zt(t)),this._initializationPromise=this.queue(()=>p(this,null,function*(){var r,i,s;if(!this._deleted&&(this.persistenceManager=yield Pa.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return p(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return p(this,null,function*(){try{let t=yield Ra(this,{idToken:e}),r=yield Sn._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return p(this,null,function*(){var t;if(Oe(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i==null?void 0:i._redirectEventId,u=yield this.tryRedirectSignIn(e);(!o||o===c)&&(u!=null&&u.user)&&(i=u.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return $(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return p(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return p(this,null,function*(){try{yield Sa(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=UR()}_delete(){return p(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return p(this,null,function*(){if(Oe(this.app))return Promise.reject(en(this));let t=e?ne(e):null;return t&&$(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return p(this,null,function*(){if(!this._deleted)return e&&$(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>p(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return p(this,null,function*(){return Oe(this.app)?Promise.reject(en(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Oe(this.app)?Promise.reject(en(this)):this.queue(()=>p(this,null,function*(){yield this.assertedPersistence.setPersistence(Zt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return p(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return p(this,null,function*(){let e=yield ZR(this),t=new Zl(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new dt("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return p(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield QR(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return p(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return p(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Zt(e)||this._popupRedirectResolver;$(t,this,"argument-error"),this.redirectPersistenceManager=yield Pa.create(this,[Zt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return p(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>p(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return p(this,null,function*(){if(e===this.currentUser)return this.queue(()=>p(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if($(c,this,"internal-error"),c.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,r,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}directlySetCurrentUser(e){return p(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return $(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yy(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return p(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return p(this,null,function*(){var e;if(Oe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t!=null&&t.error&&VR(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token})}};Ca=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=d_(t=>this.observer=t)}get next(){return $(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};Ma={loadJS(){return p(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};th=class{constructor(){this.enterprise=new nh}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},nh=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},iS="recaptcha-enterprise",wy="NO_RECAPTCHA",rh=class{constructor(e){this.type=iS,this.auth=rn(e)}verify(e="verify",t=!1){return p(this,null,function*(){function r(s){return p(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,c)=>p(this,null,function*(){zR(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let h=new Ql(u);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,o(h.siteKey)}}).catch(u=>{c(u)})}))})}function i(s,o,c){let u=window.grecaptcha;z_(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(h=>{o(h)}).catch(()=>{o(wy)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new th().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{r(this.auth).then(c=>{if(!t&&z_(window.grecaptcha))i(c,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=nS();u.length!==0&&(u+=c),vy(u).then(()=>{i(c,s,o)}).catch(h=>{o(h)})}}).catch(c=>{o(c)})})})}};Yr=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Xt("not implemented")}_getIdTokenResponse(e){return Xt("not implemented")}_linkToIdToken(e,t){return Xt("not implemented")}_getReauthenticationResolver(e){return Xt("not implemented")}};ks=class n extends Yr{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return p(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ka(e,t,"signInWithPassword",lS,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return fS(e,{email:this._email,oobCode:this._password});default:at(e,"internal-error")}})}_linkToIdToken(e,t){return p(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ka(e,r,"signUpPassword",uS,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return pS(e,{idToken:t,email:this._email,oobCode:this._password});default:at(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};mS="http://localhost",Jr=class n extends Yr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):at("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=ea(t,["providerId","signInMethod"]);if(!r||!i)return null;let o=new n(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){let t=this.buildRequest();return Qr(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,Qr(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,Qr(e,t)}buildRequest(){let e={requestUri:mS,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=jr(t)}return e}};Da=class n{constructor(e){var t,r,i,s,o,c;let u=zr(Wr(e)),h=(t=u.apiKey)!==null&&t!==void 0?t:null,f=(r=u.oobCode)!==null&&r!==void 0?r:null,g=gS((i=u.mode)!==null&&i!==void 0?i:null);$(h&&f&&g,"argument-error"),this.apiKey=h,this.operation=g,this.code=f,this.continueUrl=(s=u.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=u.lang)!==null&&o!==void 0?o:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=_S(e);try{return new n(t)}catch{return null}}};Ty=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return ks._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=Da.parseLink(r);return $(i,"argument-error"),ks._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),Ds=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};Ns=class extends Ds{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}},Os=class n extends Ns{static credentialFromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;return $("providerId"in t&&"signInMethod"in t,"argument-error"),Jr._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return $(e.idToken||e.accessToken,"argument-error"),Jr._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return n.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return n.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:i,pendingToken:s,nonce:o,providerId:c}=e;if(!r&&!i&&!t&&!s||!c)return null;try{return new n(c)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:s})}catch{return null}}};vh=(()=>{class n extends Ns{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return Jr._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:r,oauthAccessToken:i}=t;if(!r&&!i)return null;try{return n.credential(r,i)}catch{return null}}}n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com";return n})();Xr=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return p(this,null,function*(){let s=yield Sn._fromIdTokenResponse(e,r,i),o=Q_(r);return new n({user:s,providerId:o,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return p(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Q_(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};ih=class n extends Ge{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};Na="__sak";Oa=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Na,"1"),this.storage.removeItem(Na),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};AS=1e3,bS=10,RS=(()=>{class n extends Oa{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_y(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((c,u,h)=>{this.notifyListeners(c,h)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!r&&this.localCache[i]===c||this.notifyListeners(i,c)},o=this.storage.getItem(i);XR()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,bS):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},AS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return p(this,null,function*(){yield Wt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return p(this,null,function*(){let r=yield Wt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return p(this,null,function*(){yield Wt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),Sy=RS;SS=(()=>{class n extends Oa{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),kh=SS;CS=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return p(this,null,function*(){let r=t,{eventId:i,eventType:s,data:o}=r.data,c=this.handlersMap[s];if(!(c!=null&&c.size))return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let u=Array.from(c).map(f=>p(this,null,function*(){return f(r.origin,o)})),h=yield PS(u);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:h})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();sh=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return p(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((c,u)=>{let h=Dh("",20);i.port1.start();let f=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(g){let y=g;if(y.data.eventId===h)switch(y.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(y.data.response);break;default:clearTimeout(f),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};Cy="firebaseLocalStorageDb",xS=1,xa="firebaseLocalStorage",ky="fbase_key",rr=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};MS=800,FS=3,US=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return p(this,null,function*(){return this.db?this.db:(this.db=yield oh(),this.db)})}_withRetries(t){return p(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>FS)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return p(this,null,function*(){return Py()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return p(this,null,function*(){this.receiver=CS._getInstance(OS()),this.receiver._subscribe("keyChanged",(t,r)=>p(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>p(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return p(this,null,function*(){var t,r;if(this.activeServiceWorker=yield DS(),!this.activeServiceWorker)return;this.sender=new sh(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return p(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||NS()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return p(this,null,function*(){try{if(!indexedDB)return!1;let t=yield oh();return yield Y_(t,Na,"1"),yield J_(t,Na),!0}catch{}return!1})}_withPendingWrite(t){return p(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return p(this,null,function*(){return this._withPendingWrite(()=>p(this,null,function*(){return yield this._withRetries(i=>Y_(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return p(this,null,function*(){let r=yield this._withRetries(i=>LS(i,t));return this.localCache[t]=r,r})}_remove(t){return p(this,null,function*(){return this._withPendingWrite(()=>p(this,null,function*(){return yield this._withRetries(r=>J_(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return p(this,null,function*(){let t=yield this._withRetries(s=>{let o=Ua(s,!1).getAll();return new rr(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>p(this,null,function*(){return this._poll()}),MS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Ba=US;IO=Iy("rcb"),wO=new tr(3e4,6e4);xs=class extends Yr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Qr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Qr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Qr(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};Va=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>p(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return p(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:c}=e;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(u))}catch(h){this.reject(h)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return BS;case"linkViaPopup":case"linkViaRedirect":return qS;case"reauthViaPopup":case"reauthViaRedirect":return $S;default:at(this.auth,"internal-error")}}resolve(e){tn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){tn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};jS=new tr(2e3,1e4);zS=(()=>{class n extends Va{constructor(t,r,i,s,o){super(t,r,s,o),this.provider=i,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){return p(this,null,function*(){let t=yield this.execute();return $(t,this.auth,"internal-error"),t})}onExecution(){return p(this,null,function*(){tn(this.filter.length===1,"Popup operations only handle one event");let t=Dh();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(gt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(gt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let t=()=>{var r,i;if(!((i=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(gt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,jS.get())};t()}}n.currentPopupAction=null;return n})(),WS="pendingRedirect",Ea=new Map,ah=class n extends Va{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return p(this,null,function*(){let e=Ea.get(this.auth._key());if(!e){try{let r=(yield GS(this.resolver,this.auth))?yield Wt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ea.set(this.auth._key(),e)}return this.bypassAuthState||Ea.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return p(this,null,function*(){if(e.type==="signInViaRedirect")return Wt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Wt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return p(this,null,function*(){})}cleanUp(){}};JS=10*60*1e3,ch=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!XS(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Ny(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(gt(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=JS&&this.cachedEventUids.clear(),this.cachedEventUids.has(X_(e))}saveEventToCache(e){this.cachedEventUids.add(X_(e)),this.lastProcessedEventTime=Date.now()}};e0=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,t0=/^https?/;i0=new tr(3e4,6e4);Ta=null;a0=new tr(5e3,15e3),c0="__/auth/iframe",u0="emulator/auth/iframe",l0={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},h0=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);p0={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},m0=500,g0=600,_0="_blank",y0="http://localhost",La=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};w0="__/auth/handler",E0="emulator/auth/handler",T0=encodeURIComponent("fac");Gl="webStorageSupport",uh=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=kh,this._completeRedirectFn=YS,this._overrideRedirectResult=HS}_openPopup(e,t,r,i){return p(this,null,function*(){var s;tn((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield ey(e,t,r,Hl(),i);return v0(e,o,Dh())})}_openRedirect(e,t,r,i){return p(this,null,function*(){yield this._originValidation(e);let s=yield ey(e,t,r,Hl(),i);return kS(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(tn(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return p(this,null,function*(){let t=yield f0(e),r=new ch(e);return t.register("authEvent",i=>($(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gl,{type:Gl},i=>{var s;let o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[Gl];o!==void 0&&t(!!o),at(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=n0(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return _y()||hy()||_h()}},Oy=uh,ty="@firebase/auth",ny="1.10.1";lh=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return p(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){$(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};S0=5*60,P0=vl("authIdTokenMaxAge")||S0,ry=null,C0=n=>e=>p(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>P0)return;let i=t==null?void 0:t.token;ry!==i&&(ry=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});tS({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=gt("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",k0().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});R0("Browser")});var Vy=W(()=>{"use strict";xy();wn();Ht();Gr();Xn()});var xh=W(()=>{"use strict";Vy()});function pP(n,e){let t=er(Ly,n,e);return t&&new ir(t)}function mP(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ir(r)}}function My(n,...e){return le("angularfire",kt.full,"auth"),yn([_P,gP,{provide:Vh,useFactory:mP(n),multi:!0,deps:[ot,vn,Dt,Jt,[new De,bn],...e]}])}var Ly,ir,sr,Vh,gP,_P,Fy,Uy,By,$y,qy,jy,zy,Wy,Gy,Hy,Ls=W(()=>{"use strict";Kr();he();Ts();ya();En();xh();xh();Ly="auth",ir=class{constructor(e){return e}},sr=class{constructor(){return Tn(Ly)}},Vh=new _n("angularfire2.auth-instances");gP={provide:sr,deps:[[new De,Vh]]},_P={provide:ir,useFactory:pP,deps:[[new De,Vh],pt]};Fy=K(Eh,!0,2),Uy=K(Oh,!0),By=K(Fa,!0),$y=K(Ph,!0),qy=K(wh,!0,2),jy=K(Th,!0,2),zy=K(Nh,!0,2),Wy=K(Ch,!0,2),Gy=K(bh,!0,2),Hy=K(Ah,!0,2)});var Ky,Qy,sn,Lh,Yy=W(()=>{"use strict";Ky=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Qy={};(function(){var n;function e(w,_){function I(){}I.prototype=_.prototype,w.D=_.prototype,w.prototype=new I,w.prototype.constructor=w,w.C=function(E,A,R){for(var v=Array(arguments.length-2),qt=2;qt<arguments.length;qt++)v[qt-2]=arguments[qt];return _.prototype[A].apply(E,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,_,I){I||(I=0);var E=Array(16);if(typeof _=="string")for(var A=0;16>A;++A)E[A]=_.charCodeAt(I++)|_.charCodeAt(I++)<<8|_.charCodeAt(I++)<<16|_.charCodeAt(I++)<<24;else for(A=0;16>A;++A)E[A]=_[I++]|_[I++]<<8|_[I++]<<16|_[I++]<<24;_=w.g[0],I=w.g[1],A=w.g[2];var R=w.g[3],v=_+(R^I&(A^R))+E[0]+3614090360&4294967295;_=I+(v<<7&4294967295|v>>>25),v=R+(A^_&(I^A))+E[1]+3905402710&4294967295,R=_+(v<<12&4294967295|v>>>20),v=A+(I^R&(_^I))+E[2]+606105819&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(_^A&(R^_))+E[3]+3250441966&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(R^I&(A^R))+E[4]+4118548399&4294967295,_=I+(v<<7&4294967295|v>>>25),v=R+(A^_&(I^A))+E[5]+1200080426&4294967295,R=_+(v<<12&4294967295|v>>>20),v=A+(I^R&(_^I))+E[6]+2821735955&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(_^A&(R^_))+E[7]+4249261313&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(R^I&(A^R))+E[8]+1770035416&4294967295,_=I+(v<<7&4294967295|v>>>25),v=R+(A^_&(I^A))+E[9]+2336552879&4294967295,R=_+(v<<12&4294967295|v>>>20),v=A+(I^R&(_^I))+E[10]+4294925233&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(_^A&(R^_))+E[11]+2304563134&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(R^I&(A^R))+E[12]+1804603682&4294967295,_=I+(v<<7&4294967295|v>>>25),v=R+(A^_&(I^A))+E[13]+4254626195&4294967295,R=_+(v<<12&4294967295|v>>>20),v=A+(I^R&(_^I))+E[14]+2792965006&4294967295,A=R+(v<<17&4294967295|v>>>15),v=I+(_^A&(R^_))+E[15]+1236535329&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(A^R&(I^A))+E[1]+4129170786&4294967295,_=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(_^I))+E[6]+3225465664&4294967295,R=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(R^_))+E[11]+643717713&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^_&(A^R))+E[0]+3921069994&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(A^R&(I^A))+E[5]+3593408605&4294967295,_=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(_^I))+E[10]+38016083&4294967295,R=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(R^_))+E[15]+3634488961&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^_&(A^R))+E[4]+3889429448&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(A^R&(I^A))+E[9]+568446438&4294967295,_=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(_^I))+E[14]+3275163606&4294967295,R=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(R^_))+E[3]+4107603335&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^_&(A^R))+E[8]+1163531501&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(A^R&(I^A))+E[13]+2850285829&4294967295,_=I+(v<<5&4294967295|v>>>27),v=R+(I^A&(_^I))+E[2]+4243563512&4294967295,R=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(R^_))+E[7]+1735328473&4294967295,A=R+(v<<14&4294967295|v>>>18),v=I+(R^_&(A^R))+E[12]+2368359562&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(I^A^R)+E[5]+4294588738&4294967295,_=I+(v<<4&4294967295|v>>>28),v=R+(_^I^A)+E[8]+2272392833&4294967295,R=_+(v<<11&4294967295|v>>>21),v=A+(R^_^I)+E[11]+1839030562&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^_)+E[14]+4259657740&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(I^A^R)+E[1]+2763975236&4294967295,_=I+(v<<4&4294967295|v>>>28),v=R+(_^I^A)+E[4]+1272893353&4294967295,R=_+(v<<11&4294967295|v>>>21),v=A+(R^_^I)+E[7]+4139469664&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^_)+E[10]+3200236656&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(I^A^R)+E[13]+681279174&4294967295,_=I+(v<<4&4294967295|v>>>28),v=R+(_^I^A)+E[0]+3936430074&4294967295,R=_+(v<<11&4294967295|v>>>21),v=A+(R^_^I)+E[3]+3572445317&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^_)+E[6]+76029189&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(I^A^R)+E[9]+3654602809&4294967295,_=I+(v<<4&4294967295|v>>>28),v=R+(_^I^A)+E[12]+3873151461&4294967295,R=_+(v<<11&4294967295|v>>>21),v=A+(R^_^I)+E[15]+530742520&4294967295,A=R+(v<<16&4294967295|v>>>16),v=I+(A^R^_)+E[2]+3299628645&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(A^(I|~R))+E[0]+4096336452&4294967295,_=I+(v<<6&4294967295|v>>>26),v=R+(I^(_|~A))+E[7]+1126891415&4294967295,R=_+(v<<10&4294967295|v>>>22),v=A+(_^(R|~I))+E[14]+2878612391&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~_))+E[5]+4237533241&4294967295,I=A+(v<<21&4294967295|v>>>11),v=_+(A^(I|~R))+E[12]+1700485571&4294967295,_=I+(v<<6&4294967295|v>>>26),v=R+(I^(_|~A))+E[3]+2399980690&4294967295,R=_+(v<<10&4294967295|v>>>22),v=A+(_^(R|~I))+E[10]+4293915773&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~_))+E[1]+2240044497&4294967295,I=A+(v<<21&4294967295|v>>>11),v=_+(A^(I|~R))+E[8]+1873313359&4294967295,_=I+(v<<6&4294967295|v>>>26),v=R+(I^(_|~A))+E[15]+4264355552&4294967295,R=_+(v<<10&4294967295|v>>>22),v=A+(_^(R|~I))+E[6]+2734768916&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~_))+E[13]+1309151649&4294967295,I=A+(v<<21&4294967295|v>>>11),v=_+(A^(I|~R))+E[4]+4149444226&4294967295,_=I+(v<<6&4294967295|v>>>26),v=R+(I^(_|~A))+E[11]+3174756917&4294967295,R=_+(v<<10&4294967295|v>>>22),v=A+(_^(R|~I))+E[2]+718787259&4294967295,A=R+(v<<15&4294967295|v>>>17),v=I+(R^(A|~_))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+_&4294967295,w.g[1]=w.g[1]+(A+(v<<21&4294967295|v>>>11))&4294967295,w.g[2]=w.g[2]+A&4294967295,w.g[3]=w.g[3]+R&4294967295}r.prototype.u=function(w,_){_===void 0&&(_=w.length);for(var I=_-this.blockSize,E=this.B,A=this.h,R=0;R<_;){if(A==0)for(;R<=I;)i(this,w,R),R+=this.blockSize;if(typeof w=="string"){for(;R<_;)if(E[A++]=w.charCodeAt(R++),A==this.blockSize){i(this,E),A=0;break}}else for(;R<_;)if(E[A++]=w[R++],A==this.blockSize){i(this,E),A=0;break}}this.h=A,this.o+=_},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var _=1;_<w.length-8;++_)w[_]=0;var I=8*this.o;for(_=w.length-8;_<w.length;++_)w[_]=I&255,I/=256;for(this.u(w),w=Array(16),_=I=0;4>_;++_)for(var E=0;32>E;E+=8)w[I++]=this.g[_]>>>E&255;return w};function s(w,_){var I=c;return Object.prototype.hasOwnProperty.call(I,w)?I[w]:I[w]=_(w)}function o(w,_){this.h=_;for(var I=[],E=!0,A=w.length-1;0<=A;A--){var R=w[A]|0;E&&R==_||(I[A]=R,E=!1)}this.g=I}var c={};function u(w){return-128<=w&&128>w?s(w,function(_){return new o([_|0],0>_?-1:0)}):new o([w|0],0>w?-1:0)}function h(w){if(isNaN(w)||!isFinite(w))return g;if(0>w)return k(h(-w));for(var _=[],I=1,E=0;w>=I;E++)_[E]=w/I|0,I*=4294967296;return new o(_,0)}function f(w,_){if(w.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(w.charAt(0)=="-")return k(f(w.substring(1),_));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(_,8)),E=g,A=0;A<w.length;A+=8){var R=Math.min(8,w.length-A),v=parseInt(w.substring(A,A+R),_);8>R?(R=h(Math.pow(_,R)),E=E.j(R).add(h(v))):(E=E.j(I),E=E.add(h(v)))}return E}var g=u(0),y=u(1),T=u(16777216);n=o.prototype,n.m=function(){if(N(this))return-k(this).m();for(var w=0,_=1,I=0;I<this.g.length;I++){var E=this.i(I);w+=(0<=E?E:4294967296+E)*_,_*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(D(this))return"0";if(N(this))return"-"+k(this).toString(w);for(var _=h(Math.pow(w,6)),I=this,E="";;){var A=j(I,_).g;I=q(I,A.j(_));var R=((0<I.g.length?I.g[0]:I.h)>>>0).toString(w);if(I=A,D(I))return R+E;for(;6>R.length;)R="0"+R;E=R+E}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function D(w){if(w.h!=0)return!1;for(var _=0;_<w.g.length;_++)if(w.g[_]!=0)return!1;return!0}function N(w){return w.h==-1}n.l=function(w){return w=q(this,w),N(w)?-1:D(w)?0:1};function k(w){for(var _=w.g.length,I=[],E=0;E<_;E++)I[E]=~w.g[E];return new o(I,~w.h).add(y)}n.abs=function(){return N(this)?k(this):this},n.add=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0,A=0;A<=_;A++){var R=E+(this.i(A)&65535)+(w.i(A)&65535),v=(R>>>16)+(this.i(A)>>>16)+(w.i(A)>>>16);E=v>>>16,R&=65535,v&=65535,I[A]=v<<16|R}return new o(I,I[I.length-1]&-2147483648?-1:0)};function q(w,_){return w.add(k(_))}n.j=function(w){if(D(this)||D(w))return g;if(N(this))return N(w)?k(this).j(k(w)):k(k(this).j(w));if(N(w))return k(this.j(k(w)));if(0>this.l(T)&&0>w.l(T))return h(this.m()*w.m());for(var _=this.g.length+w.g.length,I=[],E=0;E<2*_;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var A=0;A<w.g.length;A++){var R=this.i(E)>>>16,v=this.i(E)&65535,qt=w.i(A)>>>16,Xi=w.i(A)&65535;I[2*E+2*A]+=v*Xi,U(I,2*E+2*A),I[2*E+2*A+1]+=R*Xi,U(I,2*E+2*A+1),I[2*E+2*A+1]+=v*qt,U(I,2*E+2*A+1),I[2*E+2*A+2]+=R*qt,U(I,2*E+2*A+2)}for(E=0;E<_;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=_;E<2*_;E++)I[E]=0;return new o(I,0)};function U(w,_){for(;(w[_]&65535)!=w[_];)w[_+1]+=w[_]>>>16,w[_]&=65535,_++}function M(w,_){this.g=w,this.h=_}function j(w,_){if(D(_))throw Error("division by zero");if(D(w))return new M(g,g);if(N(w))return _=j(k(w),_),new M(k(_.g),k(_.h));if(N(_))return _=j(w,k(_)),new M(k(_.g),_.h);if(30<w.g.length){if(N(w)||N(_))throw Error("slowDivide_ only works with positive integers.");for(var I=y,E=_;0>=E.l(w);)I=X(I),E=X(E);var A=G(I,1),R=G(E,1);for(E=G(E,2),I=G(I,2);!D(E);){var v=R.add(E);0>=v.l(w)&&(A=A.add(I),R=v),E=G(E,1),I=G(I,1)}return _=q(w,A.j(_)),new M(A,_)}for(A=g;0<=w.l(_);){for(I=Math.max(1,Math.floor(w.m()/_.m())),E=Math.ceil(Math.log(I)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),R=h(I),v=R.j(_);N(v)||0<v.l(w);)I-=E,R=h(I),v=R.j(_);D(R)&&(R=y),A=A.add(R),w=q(w,v)}return new M(A,w)}n.A=function(w){return j(this,w).h},n.and=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)&w.i(E);return new o(I,this.h&w.h)},n.or=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)|w.i(E);return new o(I,this.h|w.h)},n.xor=function(w){for(var _=Math.max(this.g.length,w.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)^w.i(E);return new o(I,this.h^w.h)};function X(w){for(var _=w.g.length+1,I=[],E=0;E<_;E++)I[E]=w.i(E)<<1|w.i(E-1)>>>31;return new o(I,w.h)}function G(w,_){var I=_>>5;_%=32;for(var E=w.g.length-I,A=[],R=0;R<E;R++)A[R]=0<_?w.i(R+I)>>>_|w.i(R+I+1)<<32-_:w.i(R+I);return new o(A,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Lh=Qy.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,sn=Qy.Integer=o}).apply(typeof Ky<"u"?Ky:typeof self<"u"?self:typeof window<"u"?window:{})});var $a,on,Mh,yP,Zr,Fh,Ms,qa,Uh,Bh,$h,Jy=W(()=>{"use strict";$a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},on={};(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof $a=="object"&&$a];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function i(a,l){if(l)e:{var d=r;a=a.split(".");for(var m=0;m<a.length-1;m++){var b=a[m];if(!(b in d))break e;d=d[b]}a=a[a.length-1],m=d[a],l=l(m),l!=m&&l!=null&&e(d,a,{configurable:!0,writable:!0,value:l})}}function s(a,l){a instanceof String&&(a+="");var d=0,m=!1,b={next:function(){if(!m&&d<a.length){var P=d++;return{value:l(P,a[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}i("Array.prototype.values",function(a){return a||function(){return s(this,function(l,d){return d})}});var o=o||{},c=this||self;function u(a){var l=typeof a;return l=l!="object"?l:a?Array.isArray(a)?"array":l:"null",l=="array"||l=="object"&&typeof a.length=="number"}function h(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function f(a,l,d){return a.call.apply(a.bind,arguments)}function g(a,l,d){if(!a)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,m),a.apply(l,b)}}return function(){return a.apply(l,arguments)}}function y(a,l,d){return y=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,y.apply(null,arguments)}function T(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),a.apply(this,m)}}function D(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(m,b,P){for(var V=Array(arguments.length-2),ue=2;ue<arguments.length;ue++)V[ue-2]=arguments[ue];return l.prototype[b].apply(m,V)}}function N(a){let l=a.length;if(0<l){let d=Array(l);for(let m=0;m<l;m++)d[m]=a[m];return d}return[]}function k(a,l){for(let d=1;d<arguments.length;d++){let m=arguments[d];if(u(m)){let b=a.length||0,P=m.length||0;a.length=b+P;for(let V=0;V<P;V++)a[b+V]=m[V]}else a.push(m)}}class q{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function U(a){return/^[\s\xa0]*$/.test(a)}function M(){var a=c.navigator;return a&&(a=a.userAgent)?a:""}function j(a){return j[" "](a),a}j[" "]=function(){};var X=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function G(a,l,d){for(let m in a)l.call(d,a[m],m,a)}function w(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function _(a){let l={};for(let d in a)l[d]=a[d];return l}let I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(a,l){let d,m;for(let b=1;b<arguments.length;b++){m=arguments[b];for(d in m)a[d]=m[d];for(let P=0;P<I.length;P++)d=I[P],Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}}function A(a){var l=1;a=a.split(":");let d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function R(a){c.setTimeout(()=>{throw a},0)}function v(){var a=Lu;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class qt{constructor(){this.h=this.g=null}add(l,d){let m=Xi.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}}var Xi=new q(()=>new KT,a=>a.reset());class KT{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Zi,es=!1,Lu=new qt,rm=()=>{let a=c.Promise.resolve(void 0);Zi=()=>{a.then(QT)}};var QT=()=>{for(var a;a=v();){try{a.h.call(a.g)}catch(d){R(d)}var l=Xi;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}es=!1};function dn(){this.s=this.s,this.C=this.C}dn.prototype.s=!1,dn.prototype.ma=function(){this.s||(this.s=!0,this.N())},dn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Me(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}Me.prototype.h=function(){this.defaultPrevented=!0};var YT=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};c.addEventListener("test",d,l),c.removeEventListener("test",d,l)}catch{}return a}();function ts(a,l){if(Me.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,m=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(X){e:{try{j(l.nodeName);var b=!0;break e}catch{}b=!1}b||(l=null)}}else d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:JT[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&ts.aa.h.call(this)}}D(ts,Me);var JT={2:"touch",3:"pen",4:"mouse"};ts.prototype.h=function(){ts.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var ns="closure_listenable_"+(1e6*Math.random()|0),XT=0;function ZT(a,l,d,m,b){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=b,this.key=++XT,this.da=this.fa=!1}function Mo(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Fo(a){this.src=a,this.g={},this.h=0}Fo.prototype.add=function(a,l,d,m,b){var P=a.toString();a=this.g[P],a||(a=this.g[P]=[],this.h++);var V=Fu(a,l,m,b);return-1<V?(l=a[V],d||(l.fa=!1)):(l=new ZT(l,this.src,P,!!m,b),l.fa=d,a.push(l)),l};function Mu(a,l){var d=l.type;if(d in a.g){var m=a.g[d],b=Array.prototype.indexOf.call(m,l,void 0),P;(P=0<=b)&&Array.prototype.splice.call(m,b,1),P&&(Mo(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Fu(a,l,d,m){for(var b=0;b<a.length;++b){var P=a[b];if(!P.da&&P.listener==l&&P.capture==!!d&&P.ha==m)return b}return-1}var Uu="closure_lm_"+(1e6*Math.random()|0),Bu={};function im(a,l,d,m,b){if(m&&m.once)return om(a,l,d,m,b);if(Array.isArray(l)){for(var P=0;P<l.length;P++)im(a,l[P],d,m,b);return null}return d=zu(d),a&&a[ns]?a.K(l,d,h(m)?!!m.capture:!!m,b):sm(a,l,d,!1,m,b)}function sm(a,l,d,m,b,P){if(!l)throw Error("Invalid event type");var V=h(b)?!!b.capture:!!b,ue=qu(a);if(ue||(a[Uu]=ue=new Fo(a)),d=ue.add(l,d,m,V,P),d.proxy)return d;if(m=eA(),d.proxy=m,m.src=a,m.listener=d,a.addEventListener)YT||(b=V),b===void 0&&(b=!1),a.addEventListener(l.toString(),m,b);else if(a.attachEvent)a.attachEvent(cm(l.toString()),m);else if(a.addListener&&a.removeListener)a.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function eA(){function a(d){return l.call(a.src,a.listener,d)}let l=tA;return a}function om(a,l,d,m,b){if(Array.isArray(l)){for(var P=0;P<l.length;P++)om(a,l[P],d,m,b);return null}return d=zu(d),a&&a[ns]?a.L(l,d,h(m)?!!m.capture:!!m,b):sm(a,l,d,!0,m,b)}function am(a,l,d,m,b){if(Array.isArray(l))for(var P=0;P<l.length;P++)am(a,l[P],d,m,b);else m=h(m)?!!m.capture:!!m,d=zu(d),a&&a[ns]?(a=a.i,l=String(l).toString(),l in a.g&&(P=a.g[l],d=Fu(P,d,m,b),-1<d&&(Mo(P[d]),Array.prototype.splice.call(P,d,1),P.length==0&&(delete a.g[l],a.h--)))):a&&(a=qu(a))&&(l=a.g[l.toString()],a=-1,l&&(a=Fu(l,d,m,b)),(d=-1<a?l[a]:null)&&$u(d))}function $u(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[ns])Mu(l.i,a);else{var d=a.type,m=a.proxy;l.removeEventListener?l.removeEventListener(d,m,a.capture):l.detachEvent?l.detachEvent(cm(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=qu(l))?(Mu(d,a),d.h==0&&(d.src=null,l[Uu]=null)):Mo(a)}}}function cm(a){return a in Bu?Bu[a]:Bu[a]="on"+a}function tA(a,l){if(a.da)a=!0;else{l=new ts(l,this);var d=a.listener,m=a.ha||a.src;a.fa&&$u(a),a=d.call(m,l)}return a}function qu(a){return a=a[Uu],a instanceof Fo?a:null}var ju="__closure_events_fn_"+(1e9*Math.random()>>>0);function zu(a){return typeof a=="function"?a:(a[ju]||(a[ju]=function(l){return a.handleEvent(l)}),a[ju])}function Fe(){dn.call(this),this.i=new Fo(this),this.M=this,this.F=null}D(Fe,dn),Fe.prototype[ns]=!0,Fe.prototype.removeEventListener=function(a,l,d,m){am(this,a,l,d,m)};function ze(a,l){var d,m=a.F;if(m)for(d=[];m;m=m.F)d.push(m);if(a=a.M,m=l.type||l,typeof l=="string")l=new Me(l,a);else if(l instanceof Me)l.target=l.target||a;else{var b=l;l=new Me(m,a),E(l,b)}if(b=!0,d)for(var P=d.length-1;0<=P;P--){var V=l.g=d[P];b=Uo(V,m,!0,l)&&b}if(V=l.g=a,b=Uo(V,m,!0,l)&&b,b=Uo(V,m,!1,l)&&b,d)for(P=0;P<d.length;P++)V=l.g=d[P],b=Uo(V,m,!1,l)&&b}Fe.prototype.N=function(){if(Fe.aa.N.call(this),this.i){var a=this.i,l;for(l in a.g){for(var d=a.g[l],m=0;m<d.length;m++)Mo(d[m]);delete a.g[l],a.h--}}this.F=null},Fe.prototype.K=function(a,l,d,m){return this.i.add(String(a),l,!1,d,m)},Fe.prototype.L=function(a,l,d,m){return this.i.add(String(a),l,!0,d,m)};function Uo(a,l,d,m){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();for(var b=!0,P=0;P<l.length;++P){var V=l[P];if(V&&!V.da&&V.capture==d){var ue=V.listener,ke=V.ha||V.src;V.fa&&Mu(a.i,V),b=ue.call(ke,m)!==!1&&b}}return b&&!m.defaultPrevented}function um(a,l,d){if(typeof a=="function")d&&(a=y(a,d));else if(a&&typeof a.handleEvent=="function")a=y(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:c.setTimeout(a,l||0)}function lm(a){a.g=um(()=>{a.g=null,a.i&&(a.i=!1,lm(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class nA extends dn{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:lm(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rs(a){dn.call(this),this.h=a,this.g={}}D(rs,dn);var hm=[];function dm(a){G(a.g,function(l,d){this.g.hasOwnProperty(d)&&$u(l)},a),a.g={}}rs.prototype.N=function(){rs.aa.N.call(this),dm(this)},rs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Wu=c.JSON.stringify,rA=c.JSON.parse,iA=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function Gu(){}Gu.prototype.h=null;function fm(a){return a.h||(a.h=a.i())}function pm(){}var is={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Hu(){Me.call(this,"d")}D(Hu,Me);function Ku(){Me.call(this,"c")}D(Ku,Me);var zn={},mm=null;function Bo(){return mm=mm||new Fe}zn.La="serverreachability";function gm(a){Me.call(this,zn.La,a)}D(gm,Me);function ss(a){let l=Bo();ze(l,new gm(l))}zn.STAT_EVENT="statevent";function _m(a,l){Me.call(this,zn.STAT_EVENT,a),this.stat=l}D(_m,Me);function We(a){let l=Bo();ze(l,new _m(l,a))}zn.Ma="timingevent";function ym(a,l){Me.call(this,zn.Ma,a),this.size=l}D(ym,Me);function os(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},l)}function as(){this.g=!0}as.prototype.xa=function(){this.g=!1};function sA(a,l,d,m,b,P){a.info(function(){if(a.g)if(P)for(var V="",ue=P.split("&"),ke=0;ke<ue.length;ke++){var re=ue[ke].split("=");if(1<re.length){var Ue=re[0];re=re[1];var Be=Ue.split("_");V=2<=Be.length&&Be[1]=="type"?V+(Ue+"="+re+"&"):V+(Ue+"=redacted&")}}else V=null;else V=P;return"XMLHTTP REQ ("+m+") [attempt "+b+"]: "+l+`
`+d+`
`+V})}function oA(a,l,d,m,b,P,V){a.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+b+"]: "+l+`
`+d+`
`+P+" "+V})}function Mr(a,l,d,m){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+cA(a,d)+(m?" "+m:"")})}function aA(a,l){a.info(function(){return"TIMEOUT: "+l})}as.prototype.info=function(){};function cA(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var m=d[a];if(!(2>m.length)){var b=m[1];if(Array.isArray(b)&&!(1>b.length)){var P=b[0];if(P!="noop"&&P!="stop"&&P!="close")for(var V=1;V<b.length;V++)b[V]=""}}}}return Wu(d)}catch{return l}}var $o={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},vm={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Qu;function qo(){}D(qo,Gu),qo.prototype.g=function(){return new XMLHttpRequest},qo.prototype.i=function(){return{}},Qu=new qo;function fn(a,l,d,m){this.j=a,this.i=l,this.l=d,this.R=m||1,this.U=new rs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Im}function Im(){this.i=null,this.g="",this.h=!1}var wm={},Yu={};function Ju(a,l,d){a.L=1,a.v=Go(jt(l)),a.m=d,a.P=!0,Em(a,null)}function Em(a,l){a.F=Date.now(),jo(a),a.A=jt(a.v);var d=a.A,m=a.R;Array.isArray(m)||(m=[String(m)]),Lm(d.i,"t",m),a.C=0,d=a.j.J,a.h=new Im,a.g=eg(a.j,d?l:null,!a.m),0<a.O&&(a.M=new nA(y(a.Y,a,a.g),a.O)),l=a.U,d=a.g,m=a.ca;var b="readystatechange";Array.isArray(b)||(b&&(hm[0]=b.toString()),b=hm);for(var P=0;P<b.length;P++){var V=im(d,b[P],m||l.handleEvent,!1,l.h||l);if(!V)break;l.g[V.key]=V}l=a.H?_(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),ss(),sA(a.i,a.u,a.A,a.l,a.R,a.m)}fn.prototype.ca=function(a){a=a.target;let l=this.M;l&&zt(a)==3?l.j():this.Y(a)},fn.prototype.Y=function(a){try{if(a==this.g)e:{let Be=zt(this.g);var l=this.g.Ba();let Br=this.g.Z();if(!(3>Be)&&(Be!=3||this.g&&(this.h.h||this.g.oa()||jm(this.g)))){this.J||Be!=4||l==7||(l==8||0>=Br?ss(3):ss(2)),Xu(this);var d=this.g.Z();this.X=d;t:if(Tm(this)){var m=jm(this.g);a="";var b=m.length,P=zt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Wn(this),cs(this);var V="";break t}this.h.i=new c.TextDecoder}for(l=0;l<b;l++)this.h.h=!0,a+=this.h.i.decode(m[l],{stream:!(P&&l==b-1)});m.length=0,this.h.g+=a,this.C=0,V=this.h.g}else V=this.g.oa();if(this.o=d==200,oA(this.i,this.u,this.A,this.l,this.R,Be,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ue,ke=this.g;if((ue=ke.g?ke.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(ue)){var re=ue;break t}}re=null}if(d=re)Mr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Zu(this,d);else{this.o=!1,this.s=3,We(12),Wn(this),cs(this);break e}}if(this.P){d=!0;let ht;for(;!this.J&&this.C<V.length;)if(ht=uA(this,V),ht==Yu){Be==4&&(this.s=4,We(14),d=!1),Mr(this.i,this.l,null,"[Incomplete Response]");break}else if(ht==wm){this.s=4,We(15),Mr(this.i,this.l,V,"[Invalid Chunk]"),d=!1;break}else Mr(this.i,this.l,ht,null),Zu(this,ht);if(Tm(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Be!=4||V.length!=0||this.h.h||(this.s=1,We(16),d=!1),this.o=this.o&&d,!d)Mr(this.i,this.l,V,"[Invalid Chunked Response]"),Wn(this),cs(this);else if(0<V.length&&!this.W){this.W=!0;var Ue=this.j;Ue.g==this&&Ue.ba&&!Ue.M&&(Ue.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),sl(Ue),Ue.M=!0,We(11))}}else Mr(this.i,this.l,V,null),Zu(this,V);Be==4&&Wn(this),this.o&&!this.J&&(Be==4?Ym(this.j,this):(this.o=!1,jo(this)))}else RA(this.g),d==400&&0<V.indexOf("Unknown SID")?(this.s=3,We(12)):(this.s=0,We(13)),Wn(this),cs(this)}}}catch{}finally{}};function Tm(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function uA(a,l){var d=a.C,m=l.indexOf(`
`,d);return m==-1?Yu:(d=Number(l.substring(d,m)),isNaN(d)?wm:(m+=1,m+d>l.length?Yu:(l=l.slice(m,m+d),a.C=m+d,l)))}fn.prototype.cancel=function(){this.J=!0,Wn(this)};function jo(a){a.S=Date.now()+a.I,Am(a,a.I)}function Am(a,l){if(a.B!=null)throw Error("WatchDog timer not null");a.B=os(y(a.ba,a),l)}function Xu(a){a.B&&(c.clearTimeout(a.B),a.B=null)}fn.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(aA(this.i,this.A),this.L!=2&&(ss(),We(17)),Wn(this),this.s=2,cs(this)):Am(this,this.S-a)};function cs(a){a.j.G==0||a.J||Ym(a.j,a)}function Wn(a){Xu(a);var l=a.M;l&&typeof l.ma=="function"&&l.ma(),a.M=null,dm(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function Zu(a,l){try{var d=a.j;if(d.G!=0&&(d.g==a||el(d.h,a))){if(!a.K&&el(d.h,a)&&d.G==3){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var b=m;if(b[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)Jo(d),Qo(d);else break e;il(d),We(18)}}else d.za=b[1],0<d.za-d.T&&37500>b[2]&&d.F&&d.v==0&&!d.C&&(d.C=os(y(d.Za,d),6e3));if(1>=Sm(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Hn(d,11)}else if((a.K||d.g==a)&&Jo(d),!U(l))for(b=d.Da.g.parse(l),l=0;l<b.length;l++){let re=b[l];if(d.T=re[0],re=re[1],d.G==2)if(re[0]=="c"){d.K=re[1],d.ia=re[2];let Ue=re[3];Ue!=null&&(d.la=Ue,d.j.info("VER="+d.la));let Be=re[4];Be!=null&&(d.Aa=Be,d.j.info("SVER="+d.Aa));let Br=re[5];Br!=null&&typeof Br=="number"&&0<Br&&(m=1.5*Br,d.L=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;let ht=a.g;if(ht){let Zo=ht.g?ht.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Zo){var P=m.h;P.g||Zo.indexOf("spdy")==-1&&Zo.indexOf("quic")==-1&&Zo.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(tl(P,P.h),P.h=null))}if(m.D){let ol=ht.g?ht.g.getResponseHeader("X-HTTP-Session-Id"):null;ol&&(m.ya=ol,de(m.I,m.D,ol))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),m=d;var V=a;if(m.qa=Zm(m,m.J?m.ia:null,m.W),V.K){Pm(m.h,V);var ue=V,ke=m.L;ke&&(ue.I=ke),ue.B&&(Xu(ue),jo(ue)),m.g=V}else Km(m);0<d.i.length&&Yo(d)}else re[0]!="stop"&&re[0]!="close"||Hn(d,7);else d.G==3&&(re[0]=="stop"||re[0]=="close"?re[0]=="stop"?Hn(d,7):rl(d):re[0]!="noop"&&d.l&&d.l.ta(re),d.v=0)}}ss(4)}catch{}}var lA=class{constructor(a,l){this.g=a,this.map=l}};function bm(a){this.l=a||10,c.PerformanceNavigationTiming?(a=c.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Rm(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Sm(a){return a.h?1:a.g?a.g.size:0}function el(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function tl(a,l){a.g?a.g.add(l):a.h=l}function Pm(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}bm.prototype.cancel=function(){if(this.i=Cm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Cm(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.D);return l}return N(a.i)}function hA(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var l=[],d=a.length,m=0;m<d;m++)l.push(a[m]);return l}l=[],d=0;for(m in a)l[d++]=a[m];return l}function dA(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(let m in a)l[d++]=m;return l}}}function km(a,l){if(a.forEach&&typeof a.forEach=="function")a.forEach(l,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,l,void 0);else for(var d=dA(a),m=hA(a),b=m.length,P=0;P<b;P++)l.call(void 0,m[P],d&&d[P],a)}var Dm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function fA(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var m=a[d].indexOf("="),b=null;if(0<=m){var P=a[d].substring(0,m);b=a[d].substring(m+1)}else P=a[d];l(P,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function Gn(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof Gn){this.h=a.h,zo(this,a.j),this.o=a.o,this.g=a.g,Wo(this,a.s),this.l=a.l;var l=a.i,d=new hs;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),Nm(this,d),this.m=a.m}else a&&(l=String(a).match(Dm))?(this.h=!1,zo(this,l[1]||"",!0),this.o=us(l[2]||""),this.g=us(l[3]||"",!0),Wo(this,l[4]),this.l=us(l[5]||"",!0),Nm(this,l[6]||"",!0),this.m=us(l[7]||"")):(this.h=!1,this.i=new hs(null,this.h))}Gn.prototype.toString=function(){var a=[],l=this.j;l&&a.push(ls(l,Om,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(ls(l,Om,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(ls(d,d.charAt(0)=="/"?gA:mA,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",ls(d,yA)),a.join("")};function jt(a){return new Gn(a)}function zo(a,l,d){a.j=d?us(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function Wo(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function Nm(a,l,d){l instanceof hs?(a.i=l,vA(a.i,a.h)):(d||(l=ls(l,_A)),a.i=new hs(l,a.h))}function de(a,l,d){a.i.set(l,d)}function Go(a){return de(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function us(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function ls(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,pA),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function pA(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Om=/[#\/\?@]/g,mA=/[#\?:]/g,gA=/[#\?]/g,_A=/[#\?@]/g,yA=/#/g;function hs(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function pn(a){a.g||(a.g=new Map,a.h=0,a.i&&fA(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}n=hs.prototype,n.add=function(a,l){pn(this),this.i=null,a=Fr(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function xm(a,l){pn(a),l=Fr(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function Vm(a,l){return pn(a),l=Fr(a,l),a.g.has(l)}n.forEach=function(a,l){pn(this),this.g.forEach(function(d,m){d.forEach(function(b){a.call(l,b,m,this)},this)},this)},n.na=function(){pn(this);let a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){let b=a[m];for(let P=0;P<b.length;P++)d.push(l[m])}return d},n.V=function(a){pn(this);let l=[];if(typeof a=="string")Vm(this,a)&&(l=l.concat(this.g.get(Fr(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},n.set=function(a,l){return pn(this),this.i=null,a=Fr(this,a),Vm(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},n.get=function(a,l){return a?(a=this.V(a),0<a.length?String(a[0]):l):l};function Lm(a,l,d){xm(a,l),0<d.length&&(a.i=null,a.g.set(Fr(a,l),N(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];let P=encodeURIComponent(String(m)),V=this.V(m);for(m=0;m<V.length;m++){var b=P;V[m]!==""&&(b+="="+encodeURIComponent(String(V[m]))),a.push(b)}}return this.i=a.join("&")};function Fr(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function vA(a,l){l&&!a.j&&(pn(a),a.i=null,a.g.forEach(function(d,m){var b=m.toLowerCase();m!=b&&(xm(this,m),Lm(this,b,d))},a)),a.j=l}function IA(a,l){let d=new as;if(c.Image){let m=new Image;m.onload=T(mn,d,"TestLoadImage: loaded",!0,l,m),m.onerror=T(mn,d,"TestLoadImage: error",!1,l,m),m.onabort=T(mn,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=T(mn,d,"TestLoadImage: timeout",!1,l,m),c.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=a}else l(!1)}function wA(a,l){let d=new as,m=new AbortController,b=setTimeout(()=>{m.abort(),mn(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:m.signal}).then(P=>{clearTimeout(b),P.ok?mn(d,"TestPingServer: ok",!0,l):mn(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(b),mn(d,"TestPingServer: error",!1,l)})}function mn(a,l,d,m,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),m(d)}catch{}}function EA(){this.g=new iA}function TA(a,l,d){let m=d||"";try{km(a,function(b,P){let V=b;h(b)&&(V=Wu(b)),l.push(m+P+"="+encodeURIComponent(V))})}catch(b){throw l.push(m+"type="+encodeURIComponent("_badmap")),b}}function ds(a){this.l=a.Ub||null,this.j=a.eb||!1}D(ds,Gu),ds.prototype.g=function(){return new Ho(this.l,this.j)},ds.prototype.i=function(a){return function(){return a}}({});function Ho(a,l){Fe.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(Ho,Fe),n=Ho.prototype,n.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,ps(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||c).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fs(this)),this.readyState=0},n.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ps(this)),this.g&&(this.readyState=3,ps(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Mm(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function Mm(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}n.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?fs(this):ps(this),this.readyState==3&&Mm(this)}},n.Ra=function(a){this.g&&(this.response=this.responseText=a,fs(this))},n.Qa=function(a){this.g&&(this.response=a,fs(this))},n.ga=function(){this.g&&fs(this)};function fs(a){a.readyState=4,a.l=null,a.j=null,a.v=null,ps(a)}n.setRequestHeader=function(a,l){this.u.append(a,l)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function ps(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Ho.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Fm(a){let l="";return G(a,function(d,m){l+=m,l+=":",l+=d,l+=`\r
`}),l}function nl(a,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=Fm(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):de(a,l,d))}function me(a){Fe.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(me,Fe);var AA=/^https?$/i,bA=["POST","PUT"];n=me.prototype,n.Ha=function(a){this.J=a},n.ea=function(a,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Qu.g(),this.v=this.o?fm(this.o):fm(Qu),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(P){Um(this,P);return}if(a=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var b in m)d.set(b,m[b]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())d.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(P=>P.toLowerCase()=="content-type"),b=c.FormData&&a instanceof c.FormData,!(0<=Array.prototype.indexOf.call(bA,l,void 0))||m||b||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,V]of d)this.g.setRequestHeader(P,V);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qm(this),this.u=!0,this.g.send(a),this.u=!1}catch(P){Um(this,P)}};function Um(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,Bm(a),Ko(a)}function Bm(a){a.A||(a.A=!0,ze(a,"complete"),ze(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,ze(this,"complete"),ze(this,"abort"),Ko(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ko(this,!0)),me.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?$m(this):this.bb())},n.bb=function(){$m(this)};function $m(a){if(a.h&&typeof o<"u"&&(!a.v[1]||zt(a)!=4||a.Z()!=2)){if(a.u&&zt(a)==4)um(a.Ea,0,a);else if(ze(a,"readystatechange"),zt(a)==4){a.h=!1;try{let V=a.Z();e:switch(V){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=V===0){var b=String(a.D).match(Dm)[1]||null;!b&&c.self&&c.self.location&&(b=c.self.location.protocol.slice(0,-1)),m=!AA.test(b?b.toLowerCase():"")}d=m}if(d)ze(a,"complete"),ze(a,"success");else{a.m=6;try{var P=2<zt(a)?a.g.statusText:""}catch{P=""}a.l=P+" ["+a.Z()+"]",Bm(a)}}finally{Ko(a)}}}}function Ko(a,l){if(a.g){qm(a);let d=a.g,m=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||ze(a,"ready");try{d.onreadystatechange=m}catch{}}}function qm(a){a.I&&(c.clearTimeout(a.I),a.I=null)}n.isActive=function(){return!!this.g};function zt(a){return a.g?a.g.readyState:0}n.Z=function(){try{return 2<zt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),rA(l)}};function jm(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function RA(a){let l={};a=(a.g&&2<=zt(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<a.length;m++){if(U(a[m]))continue;var d=A(a[m]);let b=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let P=l[b]||[];l[b]=P,P.push(d)}w(l,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ms(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function zm(a){this.Aa=0,this.i=[],this.j=new as,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ms("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ms("baseRetryDelayMs",5e3,a),this.cb=ms("retryDelaySeedMs",1e4,a),this.Wa=ms("forwardChannelMaxRetries",2,a),this.wa=ms("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new bm(a&&a.concurrentRequestLimit),this.Da=new EA,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=zm.prototype,n.la=8,n.G=1,n.connect=function(a,l,d,m){We(0),this.W=a,this.H=l||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=Zm(this,null,this.W),Yo(this)};function rl(a){if(Wm(a),a.G==3){var l=a.U++,d=jt(a.I);if(de(d,"SID",a.K),de(d,"RID",l),de(d,"TYPE","terminate"),gs(a,d),l=new fn(a,a.j,l),l.L=2,l.v=Go(jt(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=l.v,d=!0),d||(l.g=eg(l.j,null),l.g.ea(l.v)),l.F=Date.now(),jo(l)}Xm(a)}function Qo(a){a.g&&(sl(a),a.g.cancel(),a.g=null)}function Wm(a){Qo(a),a.u&&(c.clearTimeout(a.u),a.u=null),Jo(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&c.clearTimeout(a.s),a.s=null)}function Yo(a){if(!Rm(a.h)&&!a.s){a.s=!0;var l=a.Ga;Zi||rm(),es||(Zi(),es=!0),Lu.add(l,a),a.B=0}}function SA(a,l){return Sm(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=l.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=os(y(a.Ga,a,l),Jm(a,a.B)),a.B++,!0)}n.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let b=new fn(this,this.j,a),P=this.o;if(this.S&&(P?(P=_(P),E(P,this.S)):P=this.S),this.m!==null||this.O||(b.H=P,P=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Hm(this,b,l),d=jt(this.I),de(d,"RID",a),de(d,"CVER",22),this.D&&de(d,"X-HTTP-Session-Id",this.D),gs(this,d),P&&(this.O?l="headers="+encodeURIComponent(String(Fm(P)))+"&"+l:this.m&&nl(d,this.m,P)),tl(this.h,b),this.Ua&&de(d,"TYPE","init"),this.P?(de(d,"$req",l),de(d,"SID","null"),b.T=!0,Ju(b,d,null)):Ju(b,d,l),this.G=2}}else this.G==3&&(a?Gm(this,a):this.i.length==0||Rm(this.h)||Gm(this))};function Gm(a,l){var d;l?d=l.l:d=a.U++;let m=jt(a.I);de(m,"SID",a.K),de(m,"RID",d),de(m,"AID",a.T),gs(a,m),a.m&&a.o&&nl(m,a.m,a.o),d=new fn(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=Hm(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),tl(a.h,d),Ju(d,m,l)}function gs(a,l){a.H&&G(a.H,function(d,m){de(l,m,d)}),a.l&&km({},function(d,m){de(l,m,d)})}function Hm(a,l,d){d=Math.min(a.i.length,d);var m=a.l?y(a.l.Na,a.l,a):null;e:{var b=a.i;let P=-1;for(;;){let V=["count="+d];P==-1?0<d?(P=b[0].g,V.push("ofs="+P)):P=0:V.push("ofs="+P);let ue=!0;for(let ke=0;ke<d;ke++){let re=b[ke].g,Ue=b[ke].map;if(re-=P,0>re)P=Math.max(0,b[ke].g-100),ue=!1;else try{TA(Ue,V,"req"+re+"_")}catch{m&&m(Ue)}}if(ue){m=V.join("&");break e}}}return a=a.i.splice(0,d),l.D=a,m}function Km(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;Zi||rm(),es||(Zi(),es=!0),Lu.add(l,a),a.v=0}}function il(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=os(y(a.Fa,a),Jm(a,a.v)),a.v++,!0)}n.Fa=function(){if(this.u=null,Qm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=os(y(this.ab,this),a)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,We(10),Qo(this),Qm(this))};function sl(a){a.A!=null&&(c.clearTimeout(a.A),a.A=null)}function Qm(a){a.g=new fn(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var l=jt(a.qa);de(l,"RID","rpc"),de(l,"SID",a.K),de(l,"AID",a.T),de(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&de(l,"TO",a.ja),de(l,"TYPE","xmlhttp"),gs(a,l),a.m&&a.o&&nl(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=Go(jt(l)),d.m=null,d.P=!0,Em(d,a)}n.Za=function(){this.C!=null&&(this.C=null,Qo(this),il(this),We(19))};function Jo(a){a.C!=null&&(c.clearTimeout(a.C),a.C=null)}function Ym(a,l){var d=null;if(a.g==l){Jo(a),sl(a),a.g=null;var m=2}else if(el(a.h,l))d=l.D,Pm(a.h,l),m=1;else return;if(a.G!=0){if(l.o)if(m==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var b=a.B;m=Bo(),ze(m,new ym(m,d)),Yo(a)}else Km(a);else if(b=l.s,b==3||b==0&&0<l.X||!(m==1&&SA(a,l)||m==2&&il(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),b){case 1:Hn(a,5);break;case 4:Hn(a,10);break;case 3:Hn(a,6);break;default:Hn(a,2)}}}function Jm(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function Hn(a,l){if(a.j.info("Error code "+l),l==2){var d=y(a.fb,a),m=a.Xa;let b=!m;m=new Gn(m||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||zo(m,"https"),Go(m),b?IA(m.toString(),d):wA(m.toString(),d)}else We(2);a.G=0,a.l&&a.l.sa(l),Xm(a),Wm(a)}n.fb=function(a){a?(this.j.info("Successfully pinged google.com"),We(2)):(this.j.info("Failed to ping google.com"),We(1))};function Xm(a){if(a.G=0,a.ka=[],a.l){let l=Cm(a.h);(l.length!=0||a.i.length!=0)&&(k(a.ka,l),k(a.ka,a.i),a.h.i.length=0,N(a.i),a.i.length=0),a.l.ra()}}function Zm(a,l,d){var m=d instanceof Gn?jt(d):new Gn(d);if(m.g!="")l&&(m.g=l+"."+m.g),Wo(m,m.s);else{var b=c.location;m=b.protocol,l=l?l+"."+b.hostname:b.hostname,b=+b.port;var P=new Gn(null);m&&zo(P,m),l&&(P.g=l),b&&Wo(P,b),d&&(P.l=d),m=P}return d=a.D,l=a.ya,d&&l&&de(m,d,l),de(m,"VER",a.la),gs(a,m),m}function eg(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Ca&&!a.pa?new me(new ds({eb:d})):new me(a.pa),l.Ha(a.J),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function tg(){}n=tg.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Xo(){}Xo.prototype.g=function(a,l){return new Ze(a,l)};function Ze(a,l){Fe.call(this),this.g=new zm(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!U(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!U(l)&&(this.g.D=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new Ur(this)}D(Ze,Fe),Ze.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ze.prototype.close=function(){rl(this.g)},Ze.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=Wu(a),a=d);l.i.push(new lA(l.Ya++,a)),l.G==3&&Yo(l)},Ze.prototype.N=function(){this.g.l=null,delete this.j,rl(this.g),delete this.g,Ze.aa.N.call(this)};function ng(a){Hu.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(let d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}D(ng,Hu);function rg(){Ku.call(this),this.status=1}D(rg,Ku);function Ur(a){this.g=a}D(Ur,tg),Ur.prototype.ua=function(){ze(this.g,"a")},Ur.prototype.ta=function(a){ze(this.g,new ng(a))},Ur.prototype.sa=function(a){ze(this.g,new rg)},Ur.prototype.ra=function(){ze(this.g,"b")},Xo.prototype.createWebChannel=Xo.prototype.g,Ze.prototype.send=Ze.prototype.o,Ze.prototype.open=Ze.prototype.m,Ze.prototype.close=Ze.prototype.close,$h=on.createWebChannelTransport=function(){return new Xo},Bh=on.getStatEventTarget=function(){return Bo()},Uh=on.Event=zn,qa=on.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},$o.NO_ERROR=0,$o.TIMEOUT=8,$o.HTTP_ERROR=6,Ms=on.ErrorCode=$o,vm.COMPLETE="complete",Fh=on.EventType=vm,pm.EventType=is,is.OPEN="a",is.CLOSE="b",is.ERROR="c",is.MESSAGE="d",Fe.prototype.listen=Fe.prototype.K,Zr=on.WebChannel=pm,yP=on.FetchXmlHttpFactory=ds,me.prototype.listenOnce=me.prototype.L,me.prototype.getLastError=me.prototype.Ka,me.prototype.getLastErrorCode=me.prototype.Ba,me.prototype.getStatus=me.prototype.Z,me.prototype.getResponseJson=me.prototype.Oa,me.prototype.getResponseText=me.prototype.oa,me.prototype.send=me.prototype.ea,me.prototype.setWithCredentials=me.prototype.Ha,Mh=on.XhrIo=me}).apply(typeof $a<"u"?$a:typeof self<"u"?self:typeof window<"u"?window:{})});function oi(){return Ir.logLevel}function O(n,...e){if(Ir.logLevel<=Z.DEBUG){let t=e.map(Wf);Ir.debug(`Firestore (${Ui}): ${n}`,...t)}}function He(n,...e){if(Ir.logLevel<=Z.ERROR){let t=e.map(Wf);Ir.error(`Firestore (${Ui}): ${n}`,...t)}}function gi(n,...e){if(Ir.logLevel<=Z.WARN){let t=e.map(Wf);Ir.warn(`Firestore (${Ui}): ${n}`,...t)}}function Wf(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function F(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,dI(n,r,t)}function dI(n,e,t){let r=`FIRESTORE (${Ui}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw He(r),new Error(r)}function B(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||dI(e,i,r)}function Q(n,e){return n}function vP(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function fI(){return new TextEncoder}function H(n,e){return n<e?-1:n>e?1:0}function ed(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return H(r,i);{let s=fI(),o=IP(s.encode(ev(n,t)),s.encode(ev(e,t)));return o!==0?o:H(r,i)}}t+=r>65535?2:1}return H(n.length,e.length)}function ev(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function IP(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return H(n[t],e[t]);return H(n.length,e.length)}function _i(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function pI(n){return n+"\0"}function td(n){return n.fields.find(e=>e.kind===2)}function ar(n){return n.fields.filter(e=>e.kind!==2)}function EP(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=z.fromTimestamp(r===1e9?new J(t+1,0):new J(t,r));return new lt(i,L.empty(),e)}function mI(n){return new lt(n.readTime,n.key,Ks)}function Gf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:H(n.largestBatchId,e.largestBatchId))}function Cr(n){return p(this,null,function*(){if(n.code!==C.FAILED_PRECONDITION||n.message!==gI)throw n;O("LocalStore","Unexpectedly lost primary lease")})}function _I(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function qn(n){return n.name==="IndexedDbTransactionError"}function ur(n){return new S((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Hf(r.target.error);t(i)}})}function Hf(n){let e=vi.M(_e());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return iv||(iv=!0,setTimeout(()=>{throw r},0)),r}}return n}function ou(n){return n==null}function Ys(n){return n===0&&1/n==-1/0}function TP(n){return typeof n=="number"&&Number.isInteger(n)&&!Ys(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function qe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=sv(e)),e=AP(n.get(t),e);return sv(e)}function AP(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case ac:t+="";break;default:t+=s}}return t}function sv(n){return n+ac+""}function Ot(n){let e=n.length;if(B(e>=2,64408,{path:n}),e===2)return B(n.charAt(0)===ac&&n.charAt(1)==="",56145,{path:n}),se.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(ac,s);switch((o<0||o>t)&&F(50515,{path:n}),n.charAt(o+1)){case"":let c=n.substring(s,o),u;i.length===0?u=c:(i+=c,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:F(61167,{path:n})}s=o+2}return new se(r)}function Ka(n,e){return[n,qe(e)]}function yI(n,e,t){return[n,qe(e),t]}function be(n,e){let t=Q(n);return vi.N(t.he,e)}function cv(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function jn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function SI(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ti(n){return n.hasNext()?n.getNext():void 0}function cn(n){if(B(!!n,39018),typeof n=="string"){let e=0,t=YP.exec(n);if(B(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:fe(n.seconds),nanos:fe(n.nanos)}}function fe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function un(n){return typeof n=="string"?Ae.fromBase64String(n):Ae.fromUint8Array(n)}function lu(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[CI])===null||t===void 0?void 0:t.stringValue)===PI}function hu(n){let e=n.mapValue.fields[kI];return lu(e)?hu(e):e}function to(n){let e=cn(n.mapValue.fields[DI].timestampValue);return new J(e.seconds,e.nanos)}function xn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?lu(n)?4:OI(n)?9007199254740991:du(n)?10:11:F(28295,{value:n})}function Lt(n,e){if(n===e)return!0;let t=xn(n);if(t!==xn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return to(n).isEqual(to(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=cn(i.timestampValue),c=cn(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return un(i.bytesValue).isEqual(un(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return fe(i.geoPointValue.latitude)===fe(s.geoPointValue.latitude)&&fe(i.geoPointValue.longitude)===fe(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return fe(i.integerValue)===fe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=fe(i.doubleValue),c=fe(s.doubleValue);return o===c?Ys(o)===Ys(c):isNaN(o)&&isNaN(c)}return!1}(n,e);case 9:return _i(n.arrayValue.values||[],e.arrayValue.values||[],Lt);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(cv(o)!==cv(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!Lt(o[u],c[u])))return!1;return!0}(n,e);default:return F(52216,{left:n})}}function ro(n,e){return(n.values||[]).find(t=>Lt(t,e))!==void 0}function Vn(n,e){if(n===e)return 0;let t=xn(n),r=xn(e);if(t!==r)return H(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return H(n.booleanValue,e.booleanValue);case 2:return function(s,o){let c=fe(s.integerValue||s.doubleValue),u=fe(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(n,e);case 3:return uv(n.timestampValue,e.timestampValue);case 4:return uv(to(n),to(e));case 5:return ed(n.stringValue,e.stringValue);case 6:return function(s,o){let c=un(s),u=un(o);return c.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let c=s.split("/"),u=o.split("/");for(let h=0;h<c.length&&h<u.length;h++){let f=H(c[h],u[h]);if(f!==0)return f}return H(c.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let c=H(fe(s.latitude),fe(o.latitude));return c!==0?c:H(fe(s.longitude),fe(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return lv(n.arrayValue,e.arrayValue);case 10:return function(s,o){var c,u,h,f;let g=s.fields||{},y=o.fields||{},T=(c=g[bi])===null||c===void 0?void 0:c.arrayValue,D=(u=y[bi])===null||u===void 0?void 0:u.arrayValue,N=H(((h=T==null?void 0:T.values)===null||h===void 0?void 0:h.length)||0,((f=D==null?void 0:D.values)===null||f===void 0?void 0:f.length)||0);return N!==0?N:lv(T,D)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===Nn.mapValue&&o===Nn.mapValue)return 0;if(s===Nn.mapValue)return 1;if(o===Nn.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),h=o.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let g=0;g<u.length&&g<f.length;++g){let y=ed(u[g],f[g]);if(y!==0)return y;let T=Vn(c[u[g]],h[f[g]]);if(T!==0)return T}return H(u.length,f.length)}(n.mapValue,e.mapValue);default:throw F(23264,{Pe:t})}}function uv(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return H(n,e);let t=cn(n),r=cn(e),i=H(t.seconds,r.seconds);return i!==0?i:H(t.nanos,r.nanos)}function lv(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Vn(t[i],r[i]);if(s)return s}return H(t.length,r.length)}function Ri(n){return ld(n)}function ld(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=cn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return un(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return L.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=ld(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${ld(t.fields[o])}`;return i+"}"}(n.mapValue):F(61005,{value:n})}function Ja(n){switch(xn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=hu(n);return e?16+Ja(e):16;case 5:return 2*n.stringValue.length;case 6:return un(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+Ja(s),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return jn(r.fields,(s,o)=>{i+=s.length+Ja(o)}),i}(n.mapValue);default:throw F(13486,{value:n})}}function wr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function hd(n){return!!n&&"integerValue"in n}function io(n){return!!n&&"arrayValue"in n}function hv(n){return!!n&&"nullValue"in n}function dv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Xa(n){return!!n&&"mapValue"in n}function du(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Xf])===null||t===void 0?void 0:t.stringValue)===Zf}function Ws(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return jn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ws(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ws(n.arrayValue.values[t]);return e}return Object.assign({},n)}function OI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===NI}function JP(n){return"nullValue"in n?Ya:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?wr(Ai.empty(),L.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?du(n)?xI:{mapValue:{}}:F(35942,{value:n})}function XP(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?wr(Ai.empty(),L.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?xI:"mapValue"in n?du(n)?{mapValue:{}}:Nn:F(61959,{value:n})}function fv(n,e){let t=Vn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function pv(n,e){let t=Vn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}function VI(n){let e=[];return jn(n.fields,(t,r)=>{let i=new Te([t]);if(Xa(r)){let s=VI(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new nt(e)}function mv(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=L.comparator(L.fromName(o.referenceValue),t.key):r=Vn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function gv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Lt(n.position[t],e.position[t]))return!1;return!0}function ZP(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function Si(n){return n.op==="and"}function dd(n){return n.op==="or"}function ep(n){return LI(n)&&Si(n)}function LI(n){for(let e of n.filters)if(e instanceof oe)return!1;return!0}function fd(n){if(n instanceof ee)return n.field.canonicalString()+n.op.toString()+Ri(n.value);if(ep(n))return n.filters.map(e=>fd(e)).join(",");{let e=n.filters.map(t=>fd(t)).join(",");return`${n.op}(${e})`}}function MI(n,e){return n instanceof ee?function(r,i){return i instanceof ee&&r.op===i.op&&r.field.isEqual(i.field)&&Lt(r.value,i.value)}(n,e):n instanceof oe?function(r,i){return i instanceof oe&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,c)=>s&&MI(o,i.filters[c]),!0):!1}(n,e):void F(19439)}function FI(n,e){let t=n.filters.concat(e);return oe.create(t,n.op)}function UI(n){return n instanceof ee?function(t){return`${t.field.canonicalString()} ${t.op} ${Ri(t.value)}`}(n):n instanceof oe?function(t){return t.op.toString()+" {"+t.getFilters().map(UI).join(" ,")+"}"}(n):"Filter"}function BI(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>L.fromName(r.referenceValue))}function wd(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Id(n,e,t,r,i,s,o)}function Tr(n){let e=Q(n);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>fd(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),ou(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ri(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ri(r)).join(",")),e.Ie=t}return e.Ie}function Eo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ZP(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!MI(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!gv(n.startAt,e.startAt)&&gv(n.endAt,e.endAt)}function gc(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function _c(n,e){return n.filters.filter(t=>t instanceof ee&&t.field.isEqual(e))}function _v(n,e,t){let r=Ya,i=!0;for(let s of _c(n,e)){let o=Ya,c=!0;switch(s.op){case"<":case"<=":o=JP(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=Ya}fv({value:r,inclusive:i},{value:o,inclusive:c})<0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];fv({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function yv(n,e,t){let r=Nn,i=!0;for(let s of _c(n,e)){let o=Nn,c=!0;switch(s.op){case">=":case">":o=XP(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=Nn}pv({value:r,inclusive:i},{value:o,inclusive:c})>0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];pv({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function eC(n,e,t,r,i,s,o,c){return new Ft(n,e,t,r,i,s,o,c)}function To(n){return new Ft(n)}function vv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function tp(n){return n.collectionGroup!==null}function fi(n){let e=Q(n);if(e.Ee===null){e.Ee=[];let t=new Set;for(let s of e.explicitOrderBy)e.Ee.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new ce(Te.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ee.push(new Er(s,r))}),t.has(Te.keyField().canonicalString())||e.Ee.push(new Er(Te.keyField(),r))}return e.Ee}function ut(n){let e=Q(n);return e.de||(e.de=tC(e,fi(n))),e.de}function tC(n,e){if(n.limitType==="F")return wd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Er(i.field,s)});let t=n.endAt?new Mt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Mt(n.startAt.position,n.startAt.inclusive):null;return wd(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Ed(n,e){let t=n.filters.concat([e]);return new Ft(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function yc(n,e,t){return new Ft(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function fu(n,e){return Eo(ut(n),ut(e))&&n.limitType===e.limitType}function $I(n){return`${Tr(ut(n))}|lt:${n.limitType}`}function ai(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>UI(i)).join(", ")}]`),ou(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Ri(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Ri(i)).join(",")),`Target(${r})`}(ut(n))}; limitType=${n.limitType})`}function Ao(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):L.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of fi(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,c,u){let h=mv(o,c,u);return o.inclusive?h<=0:h<0}(r.startAt,fi(r),i)||r.endAt&&!function(o,c,u){let h=mv(o,c,u);return o.inclusive?h>=0:h>0}(r.endAt,fi(r),i))}(n,e)}function nC(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function qI(n){return(e,t)=>{let r=!1;for(let i of fi(n)){let s=rC(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function rC(n,e,t){let r=n.field.isKeyField()?L.comparator(e.key,t.key):function(s,o,c){let u=o.data.field(s),h=c.data.field(s);return u!==null&&h!==null?Vn(u,h):F(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F(19790,{direction:n.dir})}}function rt(){return iC}function qs(...n){let e=jI;for(let t of n)e=e.insert(t.key,t);return e}function zI(n){let e=jI;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function xt(){return Gs()}function WI(){return Gs()}function Gs(){return new It(n=>n.toString(),(n,e)=>n.isEqual(e))}function Y(...n){let e=oC;for(let t of n)e=e.add(t);return e}function cC(){return aC}function np(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ys(e)?"-0":e}}function GI(n){return{integerValue:""+n}}function uC(n,e){return TP(e)?GI(e):np(n,e)}function lC(n,e,t){return n instanceof Ln?function(i,s){let o={fields:{[CI]:{stringValue:PI},[DI]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&lu(s)&&(s=hu(s)),s&&(o.fields[kI]=s),{mapValue:o}}(t,e):n instanceof Mn?KI(n,e):n instanceof Fn?QI(n,e):function(i,s){let o=HI(i,s),c=Iv(o)+Iv(i.Re);return hd(o)&&hd(i.Re)?GI(c):np(i.serializer,c)}(n,e)}function hC(n,e,t){return n instanceof Mn?KI(n,e):n instanceof Fn?QI(n,e):t}function HI(n,e){return n instanceof Ar?function(r){return hd(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}function KI(n,e){let t=YI(e);for(let r of n.elements)t.some(i=>Lt(i,r))||t.push(r);return{arrayValue:{values:t}}}function QI(n,e){let t=YI(e);for(let r of n.elements)t=t.filter(i=>!Lt(i,r));return{arrayValue:{values:t}}}function Iv(n){return fe(n.integerValue||n.doubleValue)}function YI(n){return io(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function dC(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Mn&&i instanceof Mn||r instanceof Fn&&i instanceof Fn?_i(r.elements,i.elements,Lt):r instanceof Ar&&i instanceof Ar?Lt(r.Re,i.Re):r instanceof Ln&&i instanceof Ln}(n.transform,e.transform)}function Za(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}function JI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ki(n.key,Je.none()):new Un(n.key,n.data,Je.none());{let t=n.data,r=Ke.empty(),i=new ce(Te.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new wt(n.key,r,new nt(i.toArray()),Je.none())}}function fC(n,e,t){n instanceof Un?function(i,s,o){let c=i.value.clone(),u=Ev(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):n instanceof wt?function(i,s,o){if(!Za(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=Ev(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(XI(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Hs(n,e,t,r){return n instanceof Un?function(s,o,c,u){if(!Za(s.precondition,o))return c;let h=s.value.clone(),f=Tv(s.fieldTransforms,u,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(n,e,t,r):n instanceof wt?function(s,o,c,u){if(!Za(s.precondition,o))return c;let h=Tv(s.fieldTransforms,u,o),f=o.data;return f.setAll(XI(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(n,e,t,r):function(s,o,c){return Za(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(n,e,t)}function pC(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=HI(r.transform,i||null);s!=null&&(t===null&&(t=Ke.empty()),t.set(r.field,s))}return t||null}function wv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&_i(r,i,(s,o)=>dC(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}function XI(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Ev(n,e,t){let r=new Map;B(n.length===t.length,32656,{Ve:t.length,me:n.length});for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,c=e.data.field(s.field);r.set(s.field,hC(o,c,t[i]))}return r}function Tv(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,lC(s,o,e))}return r}function mC(n){switch(n){case C.OK:return F(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return F(15467,{code:n})}}function ZI(n){if(n===void 0)return He("GRPC error has no .code"),C.UNKNOWN;switch(n){case Ie.OK:return C.OK;case Ie.CANCELLED:return C.CANCELLED;case Ie.UNKNOWN:return C.UNKNOWN;case Ie.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case Ie.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case Ie.INTERNAL:return C.INTERNAL;case Ie.UNAVAILABLE:return C.UNAVAILABLE;case Ie.UNAUTHENTICATED:return C.UNAUTHENTICATED;case Ie.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case Ie.NOT_FOUND:return C.NOT_FOUND;case Ie.ALREADY_EXISTS:return C.ALREADY_EXISTS;case Ie.PERMISSION_DENIED:return C.PERMISSION_DENIED;case Ie.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case Ie.ABORTED:return C.ABORTED;case Ie.OUT_OF_RANGE:return C.OUT_OF_RANGE;case Ie.UNIMPLEMENTED:return C.UNIMPLEMENTED;case Ie.DATA_LOSS:return C.DATA_LOSS;default:return F(39323,{code:n})}}function bv(n){let e=fI().encode(n),t=new Lh;return t.update(e),new Uint8Array(t.digest())}function Rv(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new sn([t,r],0),new sn([i,s],0)]}function ja(){return new pe(L.comparator)}function Sv(){return new pe(L.comparator)}function Cd(n,e){return n.useProto3Json||ou(e)?e:{value:e}}function Di(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ew(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function IC(n,e){return Di(n,e.toTimestamp())}function Qe(n){return B(!!n,49232),z.fromTimestamp(function(t){let r=cn(t);return new J(r.seconds,r.nanos)}(n))}function rp(n,e){return kd(n,e).canonicalString()}function kd(n,e){let t=function(i){return new se(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function tw(n){let e=se.fromString(n);return B(lw(e),10190,{key:e.toString()}),e}function bc(n,e){return rp(n.databaseId,e.path)}function vr(n,e){let t=tw(e);if(t.get(1)!==n.databaseId.projectId)throw new x(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(iw(t))}function nw(n,e){return rp(n.databaseId,e)}function rw(n){let e=tw(n);return e.length===4?se.emptyPath():iw(e)}function Dd(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function iw(n){return B(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Pv(n,e,t){return{name:bc(n,e),fields:t.value.mapValue.fields}}function wC(n,e,t){let r=vr(n,e.name),i=Qe(e.updateTime),s=e.createTime?Qe(e.createTime):z.min(),o=new Ke({mapValue:{fields:e.fields}}),c=xe.newFoundDocument(r,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function EC(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:F(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(B(f===void 0||typeof f=="string",58123),Ae.fromBase64String(f||"")):(B(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ae.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(h){let f=h.code===void 0?C.UNKNOWN:ZI(h.code);return new x(f,h.message||"")}(o);t=new Tc(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=vr(n,r.document.name),s=Qe(r.document.updateTime),o=r.document.createTime?Qe(r.document.createTime):z.min(),c=new Ke({mapValue:{fields:r.document.fields}}),u=xe.newFoundDocument(i,s,o,c),h=r.targetIds||[],f=r.removedTargetIds||[];t=new pi(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=vr(n,r.document),s=r.readTime?Qe(r.readTime):z.min(),o=xe.newNoDocument(i,s),c=r.removedTargetIds||[];t=new pi([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=vr(n,r.document),s=r.removedTargetIds||[];t=new pi([],s,i,null)}else{if(!("filter"in e))return F(11601,{Vt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new bd(i,s),c=r.targetId;t=new Ec(c,o)}}return t}function Rc(n,e){let t;if(e instanceof Un)t={update:Pv(n,e.key,e.value)};else if(e instanceof ki)t={delete:bc(n,e.key)};else if(e instanceof wt)t={update:Pv(n,e.key,e.data),updateMask:PC(e.fieldMask)};else{if(!(e instanceof Ic))return F(16599,{ft:e.type});t={verify:bc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let c=o.transform;if(c instanceof Ln)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Mn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Fn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Ar)return{fieldPath:o.field.canonicalString(),increment:c.Re};throw F(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:IC(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:F(27497)}(n,e.precondition)),t}function Nd(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Je.updateTime(Qe(s.updateTime)):s.exists!==void 0?Je.exists(s.exists):Je.none()}(e.currentDocument):Je.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,c){let u=null;if("setToServerValue"in c)B(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),u=new Ln;else if("appendMissingElements"in c){let f=c.appendMissingElements.values||[];u=new Mn(f)}else if("removeAllFromArray"in c){let f=c.removeAllFromArray.values||[];u=new Fn(f)}else"increment"in c?u=new Ar(o,c.increment):F(16584,{proto:c});let h=Te.fromServerFormat(c.fieldPath);return new vc(h,u)}(n,i)):[];if(e.update){e.update.name;let i=vr(n,e.update.name),s=new Ke({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let h=u.fieldPaths||[];return new nt(h.map(f=>Te.fromServerFormat(f)))}(e.updateMask);return new wt(i,s,o,t,r)}return new Un(i,s,t,r)}if(e.delete){let i=vr(n,e.delete);return new ki(i,t)}if(e.verify){let i=vr(n,e.verify);return new Ic(i,t)}return F(1463,{proto:e})}function TC(n,e){return n&&n.length>0?(B(e!==void 0,14353),n.map(t=>function(i,s){let o=i.updateTime?Qe(i.updateTime):Qe(s);return o.isEqual(z.min())&&(o=Qe(s)),new Td(o,i.transformResults||[])}(t,e))):[]}function sw(n,e){return{documents:[nw(n,e.path)]}}function ow(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=nw(n,i);let s=function(h){if(h.length!==0)return uw(oe.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(f=>function(y){return{field:ci(y.field),direction:bC(y.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=Cd(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{gt:t,parent:i}}function aw(n){let e=rw(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){B(r===1,65062);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(g){let y=cw(g);return y instanceof oe&&ep(y)?y.getFilters():[y]}(t.where));let o=[];t.orderBy&&(o=function(g){return g.map(y=>function(D){return new Er(ui(D.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(D.direction))}(y))}(t.orderBy));let c=null;t.limit&&(c=function(g){let y;return y=typeof g=="object"?g.value:g,ou(y)?null:y}(t.limit));let u=null;t.startAt&&(u=function(g){let y=!!g.before,T=g.values||[];return new Mt(T,y)}(t.startAt));let h=null;return t.endAt&&(h=function(g){let y=!g.before,T=g.values||[];return new Mt(T,y)}(t.endAt)),eC(e,i,o,s,c,"F",u,h)}function AC(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function cw(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=ui(t.unaryFilter.field);return ee.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=ui(t.unaryFilter.field);return ee.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ui(t.unaryFilter.field);return ee.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ui(t.unaryFilter.field);return ee.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}}(n):n.fieldFilter!==void 0?function(t){return ee.create(ui(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return oe.create(t.compositeFilter.filters.map(r=>cw(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return F(1026)}}(t.compositeFilter.op))}(n):F(30097,{filter:n})}function bC(n){return _C[n]}function RC(n){return yC[n]}function SC(n){return vC[n]}function ci(n){return{fieldPath:n.canonicalString()}}function ui(n){return Te.fromServerFormat(n.fieldPath)}function uw(n){return n instanceof ee?function(t){if(t.op==="=="){if(dv(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NAN"}};if(hv(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(dv(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NOT_NAN"}};if(hv(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ci(t.field),op:RC(t.op),value:t.value}}}(n):n instanceof oe?function(t){let r=t.getFilters().map(i=>uw(i));return r.length===1?r[0]:{compositeFilter:{op:SC(t.op),filters:r}}}(n):F(54877,{filter:n})}function PC(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function lw(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function CC(n,e){let t;if(e.document)t=wC(n.wt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=L.fromSegments(e.noDocument.path),i=Rr(e.noDocument.readTime);t=xe.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return F(56709);{let r=L.fromSegments(e.unknownDocument.path),i=Rr(e.unknownDocument.version);t=xe.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new J(i[0],i[1]);return z.fromTimestamp(s)}(e.readTime)),t}function Cv(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Pc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:bc(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Di(s,o.version.toTimestamp()),createTime:Di(s,o.createTime.toTimestamp())}}(n.wt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:br(e.version)};else{if(!e.isUnknownDocument())return F(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:br(e.version)}}return r}function Pc(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function br(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Rr(n){let e=new J(n.seconds,n.nanoseconds);return z.fromTimestamp(e)}function lr(n,e){let t=(e.baseMutations||[]).map(s=>Nd(n.wt,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Nd(n.wt,s)),i=J.fromMillis(e.localWriteTimeMs);return new so(e.batchId,i,t,r)}function js(n){let e=Rr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Rr(n.lastLimboFreeSnapshotVersion):z.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){let o=s.documents.length;return B(o===1,1966,{count:o}),ut(To(rw(s.documents[0])))}(n.query):function(s){return ut(aw(s))}(n.query),new Ni(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ae.fromBase64String(n.resumeToken))}function hw(n,e){let t=br(e.snapshotVersion),r=br(e.lastLimboFreeSnapshotVersion),i;i=gc(e.target)?sw(n.wt,e.target):ow(n.wt,e.target).gt;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Tr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function dw(n){let e=aw({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yc(e,e.limit,"L"):e}function qh(n,e){return new oo(e.largestBatchId,Nd(n.wt,e.overlayMutation))}function kv(n,e){let t=e.path.lastSegment();return[n,qe(e.path.popLast()),t]}function Dv(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:br(r.readTime),documentKey:qe(r.documentKey.path),largestBatchId:r.largestBatchId}}function Nv(n){return be(n,au)}function Ov(n){return be(n,cu)}function Fs(n){return be(n,uu)}function kC(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function xv(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=kC(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}function Pn(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Vv(n.arrayValue,e.arrayValue),t!==0?t:(t=Vv(n.directionalValue,e.directionalValue),t!==0?t:L.comparator(n.documentKey,e.documentKey)))}function Vv(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function fw(n){var e,t;if(B(n instanceof ee||n instanceof oe,20012),n instanceof ee){if(n instanceof mc){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ee.create(n.field,"==",s)))||[];return oe.create(i,"or")}return n}let r=n.filters.map(i=>fw(i));return oe.create(r,n.op)}function DC(n){if(n.getFilters().length===0)return[];let e=Bd(fw(n));return B(pw(e),7391),Fd(e)||Ud(e)?[e]:e.getFilters()}function Fd(n){return n instanceof ee}function Ud(n){return n instanceof oe&&ep(n)}function pw(n){return Fd(n)||Ud(n)||function(t){if(t instanceof oe&&dd(t)){for(let r of t.getFilters())if(!Fd(r)&&!Ud(r))return!1;return!0}return!1}(n)}function Bd(n){if(B(n instanceof ee||n instanceof oe,34018),n instanceof ee)return n;if(n.filters.length===1)return Bd(n.filters[0]);let e=n.filters.map(r=>Bd(r)),t=oe.create(e,n.op);return t=Dc(t),pw(t)?t:(B(t instanceof oe,64498),B(Si(t),40251),B(t.filters.length>1,57927),t.filters.reduce((r,i)=>ip(r,i)))}function ip(n,e){let t;return B(n instanceof ee||n instanceof oe,38388),B(e instanceof ee||e instanceof oe,25473),t=n instanceof ee?e instanceof ee?function(i,s){return oe.create([i,s],"and")}(n,e):Lv(n,e):e instanceof ee?Lv(e,n):function(i,s){if(B(i.filters.length>0&&s.filters.length>0,48005),Si(i)&&Si(s))return FI(i,s.getFilters());let o=dd(i)?i:s,c=dd(i)?s:i,u=o.filters.map(h=>ip(h,c));return oe.create(u,"or")}(n,e),Dc(t)}function Lv(n,e){if(Si(e))return FI(e,n.getFilters());{let t=e.filters.map(r=>ip(n,r));return oe.create(t,"or")}}function Dc(n){if(B(n instanceof ee||n instanceof oe,11850),n instanceof ee)return n;let e=n.getFilters();if(e.length===1)return Dc(e[0]);if(LI(n))return n;let t=e.map(i=>Dc(i)),r=[];return t.forEach(i=>{i instanceof ee?r.push(i):i instanceof oe&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:oe.create(r,n.op)}function Fv(n){return be(n,Zs)}function ri(n){return be(n,hc)}function Us(n){return be(n,Qf)}function ii(n){return be(n,lc)}function Uv(n){B(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Gf(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new lt(e.readTime,e.documentKey,t)}function gw(n,e,t){let r=n.store(yt),i=n.store(Ii),s=[],o=IDBKeyRange.only(t.batchId),c=0,u=r.te({range:o},(f,g,y)=>(c++,y.delete()));s.push(u.next(()=>{B(c===1,47070,{batchId:t.batchId})}));let h=[];for(let f of t.mutations){let g=yI(e,f.key.path,t.batchId);s.push(i.delete(g)),h.push(f.key)}return S.waitFor(s).next(()=>h)}function Nc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw F(14731);e=n.noDocument}return JSON.stringify(e).length}function _w(n,e,t){let r=Ka(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return li(n).te({range:s,ee:!0},(c,u,h)=>{let[f,g,y]=c;f===e&&g===i&&(o=!0),h.done()}).next(()=>o)}function Cn(n){return be(n,yt)}function li(n){return be(n,Ii)}function yw(n){return be(n,Js)}function si(n){return be(n,wi)}function $v(n){return be(n,yr)}function Dn(n){return be(n,Ei)}function jv([n,e],[t,r]){let i=H(n,t);return i===0?H(e,r):i}function Iw(n,e){return new Wd(n,e)}function Wa(n,e){return Dn(n).put(function(r,i){return{targetId:0,path:qe(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}function ww(n){return new Hd(n)}function zv(n){return be(n,Xs)}function or(n){return be(n,cc)}function Bs(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Wv(n,e){let t=e.documentKey.path.toArray();return[n,Pc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Gv(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=H(t[s],r[s]),i)return i;return i=H(t.length,r.length),i||(i=H(t[t.length-2],r[r.length-2]),i||H(t[t.length-1],r[r.length-1]))}function Hv(n){n.createObjectStore(Ei,{keyPath:DP}).createIndex(Kf,NP,{unique:!0}),n.createObjectStore(wi,{keyPath:"targetId"}).createIndex(II,kP,{unique:!0}),n.createObjectStore(yr)}function $s(n){return be(n,wo)}function Ga(n){return be(n,Ti)}function OC(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function Ew(n,e,t,r){return new uf(n,e,t,r)}function Tw(n,e){return p(this,null,function*(){let t=Q(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Fs(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],c=[],u=Y();for(let h of i){o.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}for(let h of s){c.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next(h=>({Ms:h,removedBatchIds:o,addedBatchIds:c}))})})})}function VC(n,e){let t=Q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.Cs.newChangeBuffer({trackRemovals:!0});return function(c,u,h,f){let g=h.batch,y=g.keys(),T=S.resolve();return y.forEach(D=>{T=T.next(()=>f.getEntry(u,D)).next(N=>{let k=h.docVersions.get(D);B(k!==null,48541),N.version.compareTo(k)<0&&(g.applyToRemoteDocument(N,h),N.isValidDocument()&&(N.setReadTime(h.commitVersion),f.addEntry(N)))})}),T.next(()=>c.mutationQueue.removeMutationBatch(u,g))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let u=Y();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(u=u.add(c.batch.mutations[h].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Aw(n){let e=Q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.ai.getLastRemoteSnapshotVersion(t))}function LC(n,e){let t=Q(n),r=e.snapshotVersion,i=t.Ss;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.Cs.newChangeBuffer({trackRemovals:!0});i=t.Ss;let c=[];e.targetChanges.forEach((f,g)=>{let y=i.get(g);if(!y)return;c.push(t.ai.removeMatchingKeys(s,f.removedDocuments,g).next(()=>t.ai.addMatchingKeys(s,f.addedDocuments,g)));let T=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(g)!==null?T=T.withResumeToken(Ae.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):f.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(f.resumeToken,r)),i=i.insert(g,T),function(N,k,q){return N.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=xC?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(y,T,f)&&c.push(t.ai.updateTargetData(s,T))});let u=rt(),h=Y();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(MC(s,o,e.documentUpdates).next(f=>{u=f.xs,h=f.Os})),!r.isEqual(z.min())){let f=t.ai.getLastRemoteSnapshotVersion(s).next(g=>t.ai.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(f)}return S.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,h)).next(()=>u)}).then(s=>(t.Ss=i,s))}function MC(n,e,t){let r=Y(),i=Y();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=rt();return t.forEach((c,u)=>{let h=s.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(z.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):O(sp,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)}),{xs:o,Os:i}})}function FC(n,e){let t=Q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=_r),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function UC(n,e){let t=Q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.ai.getTargetData(r,e).next(s=>s?(i=s,S.resolve(i)):t.ai.allocateTargetId(r).next(o=>(i=new Ni(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.ai.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Ss.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ss=t.Ss.insert(r.targetId,r),t.Ds.set(e,r.targetId)),r})}function lf(n,e,t){return p(this,null,function*(){let r=Q(n),i=r.Ss.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!qn(o))throw o;O(sp,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ss=r.Ss.remove(e),r.Ds.delete(i.target)})}function Kv(n,e,t){let r=Q(n),i=z.min(),s=Y();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,f){let g=Q(u),y=g.Ds.get(f);return y!==void 0?S.resolve(g.Ss.get(y)):g.ai.getTargetData(h,f)}(r,o,ut(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.ai.getMatchingKeysForTargetId(o,c.targetId).next(u=>{s=u})}).next(()=>r.bs.getDocumentsMatchingQuery(o,e,t?i:z.min(),t?s:Y())).next(c=>(BC(r,nC(e),c),{documents:c,Ns:s})))}function BC(n,e,t){let r=n.vs.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.vs.set(e,r)}function df(){return Ha===null?Ha=function(){return 268435456+Math.round(2147483648*Math.random())}():Ha++,"0x"+Ha.toString(16)}function qC(){return typeof window<"u"?window:null}function ec(){return typeof document<"u"?document:null}function pu(n){return new Pd(n,!0)}function mu(n){return p(this,null,function*(){if(kr(n))for(let e of n.ua)yield e(!0)})}function bo(n){return p(this,null,function*(){for(let e of n.ua)yield e(!1)})}function bw(n,e){let t=Q(n);t._a.has(e.targetId)||(t._a.set(e.targetId,e),up(t)?cp(t):Bi(t).b_()&&ap(t,e))}function op(n,e){let t=Q(n),r=Bi(t);t._a.delete(e),r.b_()&&Rw(t,e),t._a.size===0&&(r.b_()?r.v_():kr(t)&&t.la.set("Unknown"))}function ap(n,e){if(n.ha.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Bi(n).U_(e)}function Rw(n,e){n.ha.Ke(e),Bi(n).K_(e)}function cp(n){n.ha=new Sd({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>n._a.get(e)||null,Pt:()=>n.datastore.serializer.databaseId}),Bi(n).start(),n.la.ta()}function up(n){return kr(n)&&!Bi(n).w_()&&n._a.size>0}function kr(n){return Q(n).aa.size===0}function Sw(n){n.ha=void 0}function jC(n){return p(this,null,function*(){n.la.set("Online")})}function zC(n){return p(this,null,function*(){n._a.forEach((e,t)=>{ap(n,e)})})}function WC(n,e){return p(this,null,function*(){Sw(n),up(n)?(n.la.ia(e),cp(n)):n.la.set("Unknown")})}function GC(n,e,t){return p(this,null,function*(){if(n.la.set("Online"),e instanceof Tc&&e.state===2&&e.cause)try{yield function(i,s){return p(this,null,function*(){let o=s.cause;for(let c of s.targetIds)i._a.has(c)&&(yield i.remoteSyncer.rejectListen(c,o),i._a.delete(c),i.ha.removeTarget(c))})}(n,e)}catch(r){O(Sr,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Wc(n,r)}else if(e instanceof pi?n.ha.Xe(e):e instanceof Ec?n.ha.ot(e):n.ha.nt(e),!t.isEqual(z.min()))try{let r=yield Aw(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let c=s.ha.It(o);return c.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let f=s._a.get(h);f&&s._a.set(h,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,h)=>{let f=s._a.get(u);if(!f)return;s._a.set(u,f.withResumeToken(Ae.EMPTY_BYTE_STRING,f.snapshotVersion)),Rw(s,u);let g=new Ni(f.target,u,h,f.sequenceNumber);ap(s,g)}),s.remoteSyncer.applyRemoteEvent(c)}(n,t))}catch(r){O(Sr,"Failed to raise snapshot:",r),yield Wc(n,r)}})}function Wc(n,e,t){return p(this,null,function*(){if(!qn(e))throw e;n.aa.add(1),yield bo(n),n.la.set("Offline"),t||(t=()=>Aw(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){O(Sr,"Retrying IndexedDB access"),yield t(),n.aa.delete(1),yield mu(n)}))})}function Pw(n,e){return e().catch(t=>Wc(n,t,e))}function Ro(n){return p(this,null,function*(){let e=Q(n),t=Bn(e),r=e.oa.length>0?e.oa[e.oa.length-1].batchId:_r;for(;HC(e);)try{let i=yield FC(e.localStore,r);if(i===null){e.oa.length===0&&t.v_();break}r=i.batchId,KC(e,i)}catch(i){yield Wc(e,i)}Cw(e)&&kw(e)})}function HC(n){return kr(n)&&n.oa.length<10}function KC(n,e){n.oa.push(e);let t=Bn(n);t.b_()&&t.W_&&t.G_(e.mutations)}function Cw(n){return kr(n)&&!Bn(n).w_()&&n.oa.length>0}function kw(n){Bn(n).start()}function QC(n){return p(this,null,function*(){Bn(n).H_()})}function YC(n){return p(this,null,function*(){let e=Bn(n);for(let t of n.oa)e.G_(t.mutations)})}function JC(n,e,t){return p(this,null,function*(){let r=n.oa.shift(),i=Ad.from(r,e,t);yield Pw(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Ro(n)})}function XC(n,e){return p(this,null,function*(){e&&Bn(n).W_&&(yield function(r,i){return p(this,null,function*(){if(function(o){return mC(o)&&o!==C.ABORTED}(i.code)){let s=r.oa.shift();Bn(r).D_(),yield Pw(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Ro(r)}})}(n,e)),Cw(n)&&kw(n)})}function Jv(n,e){return p(this,null,function*(){let t=Q(n);t.asyncQueue.verifyOperationInProgress(),O(Sr,"RemoteStore received new credentials");let r=kr(t);t.aa.add(3),yield bo(t),r&&t.la.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.aa.delete(3),yield mu(t)})}function ZC(n,e){return p(this,null,function*(){let t=Q(n);e?(t.aa.delete(2),yield mu(t)):e||(t.aa.add(2),yield bo(t),t.la.set("Unknown"))})}function Bi(n){return n.Pa||(n.Pa=function(t,r,i){let s=Q(t);return s.Y_(),new gf(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{jo:jC.bind(null,n),Jo:zC.bind(null,n),Zo:WC.bind(null,n),Q_:GC.bind(null,n)}),n.ua.push(e=>p(this,null,function*(){e?(n.Pa.D_(),up(n)?cp(n):n.la.set("Unknown")):(yield n.Pa.stop(),Sw(n))}))),n.Pa}function Bn(n){return n.Ta||(n.Ta=function(t,r,i){let s=Q(t);return s.Y_(),new _f(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{jo:()=>Promise.resolve(),Jo:QC.bind(null,n),Zo:XC.bind(null,n),z_:YC.bind(null,n),j_:JC.bind(null,n)}),n.ua.push(e=>p(this,null,function*(){e?(n.Ta.D_(),yield Ro(n)):(yield n.Ta.stop(),n.oa.length>0&&(O(Sr,`Stopping write stream with ${n.oa.length} pending writes`),n.oa=[]))}))),n.Ta}function lp(n,e){if(He("AsyncQueue",`${e}: ${n}`),qn(n))return new x(C.UNAVAILABLE,`${e}: ${n}`);throw n}function Xv(){return new It(n=>$I(n),fu)}function hp(n,e){return p(this,null,function*(){let t=Q(n),r=3,i=e.query,s=t.queries.get(i);s?!s.Va()&&e.ma()&&(r=2):(s=new Tf,r=e.ma()?0:1);try{switch(r){case 0:s.Aa=yield t.onListen(i,!0);break;case 1:s.Aa=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let c=lp(o,`Initialization of query '${ai(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.Ra.push(e),e.ga(t.onlineState),s.Aa&&e.pa(s.Aa)&&fp(t)})}function dp(n,e){return p(this,null,function*(){let t=Q(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.Ra.indexOf(e);o>=0&&(s.Ra.splice(o,1),s.Ra.length===0?i=e.ma()?0:1:!s.Va()&&e.ma()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function ek(n,e){let t=Q(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.Ra)c.pa(i)&&(r=!0);o.Aa=i}}r&&fp(t)}function tk(n,e,t){let r=Q(n),i=r.queries.get(e);if(i)for(let s of i.Ra)s.onError(t);r.queries.delete(e)}function fp(n){n.fa.forEach(e=>{e.next()})}function nk(n,e,t=!0){return p(this,null,function*(){let r=Lw(n),i,s=r.ru.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.eu()):i=yield Dw(r,e,t,!0),i})}function rk(n,e){return p(this,null,function*(){let t=Lw(n);yield Dw(t,e,!0,!1)})}function Dw(n,e,t,r){return p(this,null,function*(){let i=yield UC(n.localStore,ut(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),c;return r&&(c=yield ik(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&bw(n.remoteStore,i),c})}function ik(n,e,t,r,i){return p(this,null,function*(){n.Pu=(g,y,T)=>function(N,k,q,U){return p(this,null,function*(){let M=k.view.Ga(q);M.ys&&(M=yield Kv(N.localStore,k.query,!1).then(({documents:w})=>k.view.Ga(w,M)));let j=U&&U.targetChanges.get(k.targetId),X=U&&U.targetMismatches.get(k.targetId)!=null,G=k.view.applyChanges(M,N.isPrimaryClient,j,X);return tI(N,k.targetId,G.Ya),G.snapshot})}(n,g,y,T);let s=yield Kv(n.localStore,e,!0),o=new Rf(e,s.Ns),c=o.Ga(s.documents),u=ao.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=o.applyChanges(c,n.isPrimaryClient,u);tI(n,t,h.Ya);let f=new Sf(e,t,o);return n.ru.set(e,f),n.iu.has(t)?n.iu.get(t).push(e):n.iu.set(t,[e]),h.snapshot})}function sk(n,e,t){return p(this,null,function*(){let r=Q(n),i=r.ru.get(e),s=r.iu.get(i.targetId);if(s.length>1)return r.iu.set(i.targetId,s.filter(o=>!fu(o,e))),void r.ru.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield lf(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&op(r.remoteStore,i.targetId),kf(r,i.targetId)}).catch(Cr))):(kf(r,i.targetId),yield lf(r.localStore,i.targetId,!0))})}function ok(n,e){return p(this,null,function*(){let t=Q(n),r=t.ru.get(e),i=t.iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),op(t.remoteStore,r.targetId))})}function ak(n,e,t){return p(this,null,function*(){let r=Mw(n);try{let i=yield function(o,c){let u=Q(o),h=J.now(),f=c.reduce((T,D)=>T.add(D.key),Y()),g,y;return u.persistence.runTransaction("Locally write mutations","readwrite",T=>{let D=rt(),N=Y();return u.Cs.getEntries(T,f).next(k=>{D=k,D.forEach((q,U)=>{U.isValidDocument()||(N=N.add(q))})}).next(()=>u.localDocuments.getOverlayedDocuments(T,D)).next(k=>{g=k;let q=[];for(let U of c){let M=pC(U,g.get(U.key).overlayedDocument);M!=null&&q.push(new wt(U.key,M,VI(M.value.mapValue),Je.exists(!0)))}return u.mutationQueue.addMutationBatch(T,h,q,c)}).next(k=>{y=k;let q=k.applyToLocalDocumentSet(g,N);return u.documentOverlayCache.saveOverlays(T,k.batchId,q)})}).then(()=>({batchId:y.batchId,changes:zI(g)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,c,u){let h=o.uu[o.currentUser.toKey()];h||(h=new pe(H)),h=h.insert(c,u),o.uu[o.currentUser.toKey()]=h}(r,i.batchId,t),yield So(r,i.changes),yield Ro(r.remoteStore)}catch(i){let s=lp(i,"Failed to persist write");t.reject(s)}})}function Nw(n,e){return p(this,null,function*(){let t=Q(n);try{let r=yield LC(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t._u.get(s);o&&(B(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.tu=!0:i.modifiedDocuments.size>0?B(o.tu,14607):i.removedDocuments.size>0&&(B(o.tu,42227),o.tu=!1))}),yield So(t,r,e)}catch(r){yield Cr(r)}})}function eI(n,e,t){let r=Q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.ru.forEach((s,o)=>{let c=o.view.ga(e);c.snapshot&&i.push(c.snapshot)}),function(o,c){let u=Q(o);u.onlineState=c;let h=!1;u.queries.forEach((f,g)=>{for(let y of g.Ra)y.ga(c)&&(h=!0)}),h&&fp(u)}(r.eventManager,e),i.length&&r.nu.Q_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function ck(n,e,t){return p(this,null,function*(){let r=Q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r._u.get(e),s=i&&i.key;if(s){let o=new pe(L.comparator);o=o.insert(s,xe.newNoDocument(s,z.min()));let c=Y().add(s),u=new wc(z.min(),new Map,new pe(H),o,c);yield Nw(r,u),r.ou=r.ou.remove(s),r._u.delete(e),mp(r)}else yield lf(r.localStore,e,!1).then(()=>kf(r,e,t)).catch(Cr)})}function uk(n,e){return p(this,null,function*(){let t=Q(n),r=e.batch.batchId;try{let i=yield VC(t.localStore,e);xw(t,r,null),Ow(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield So(t,i)}catch(i){yield Cr(i)}})}function lk(n,e,t){return p(this,null,function*(){let r=Q(n);try{let i=yield function(o,c){let u=Q(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return u.mutationQueue.lookupMutationBatch(h,c).next(g=>(B(g!==null,37113),f=g.keys(),u.mutationQueue.removeMutationBatch(h,g))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>u.localDocuments.getDocuments(h,f))})}(r.localStore,e);xw(r,e,t),Ow(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield So(r,i)}catch(i){yield Cr(i)}})}function Ow(n,e){(n.cu.get(e)||[]).forEach(t=>{t.resolve()}),n.cu.delete(e)}function xw(n,e,t){let r=Q(n),i=r.uu[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.uu[r.currentUser.toKey()]=i}}function kf(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.iu.get(e))n.ru.delete(r),t&&n.nu.Tu(r,t);n.iu.delete(e),n.isPrimaryClient&&n.au.Ur(e).forEach(r=>{n.au.containsKey(r)||Vw(n,r)})}function Vw(n,e){n.su.delete(e.path.canonicalString());let t=n.ou.get(e);t!==null&&(op(n.remoteStore,t),n.ou=n.ou.remove(e),n._u.delete(t),mp(n))}function tI(n,e,t){for(let r of t)r instanceof Kc?(n.au.addReference(r.key,e),hk(n,r)):r instanceof Qc?(O(pp,"Document no longer in limbo: "+r.key),n.au.removeReference(r.key,e),n.au.containsKey(r.key)||Vw(n,r.key)):F(19791,{Iu:r})}function hk(n,e){let t=e.key,r=t.path.canonicalString();n.ou.get(t)||n.su.has(r)||(O(pp,"New document in limbo: "+t),n.su.add(r),mp(n))}function mp(n){for(;n.su.size>0&&n.ou.size<n.maxConcurrentLimboResolutions;){let e=n.su.values().next().value;n.su.delete(e);let t=new L(se.fromString(e)),r=n.lu.next();n._u.set(r,new Pf(t)),n.ou=n.ou.insert(t,r),bw(n.remoteStore,new Ni(ut(To(t.path)),r,"TargetPurposeLimboResolution",vt.le))}}function So(n,e,t){return p(this,null,function*(){let r=Q(n),i=[],s=[],o=[];r.ru.isEmpty()||(r.ru.forEach((c,u)=>{o.push(r.Pu(u,e,t).then(h=>{var f;if((h||t)&&r.isPrimaryClient){let g=h?!h.fromCache:(f=t==null?void 0:t.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(u.targetId,g?"current":"not-current")}if(h){i.push(h);let g=af.Ps(u.targetId,h);s.push(g)}}))}),yield Promise.all(o),r.nu.Q_(i),yield function(u,h){return p(this,null,function*(){let f=Q(u);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(h,y=>S.forEach(y.ls,T=>f.persistence.referenceDelegate.addReference(g,y.targetId,T)).next(()=>S.forEach(y.hs,T=>f.persistence.referenceDelegate.removeReference(g,y.targetId,T)))))}catch(g){if(!qn(g))throw g;O(sp,"Failed to update sequence numbers: "+g)}for(let g of h){let y=g.targetId;if(!g.fromCache){let T=f.Ss.get(y),D=T.snapshotVersion,N=T.withLastLimboFreeSnapshotVersion(D);f.Ss=f.Ss.insert(y,N)}}})}(r.localStore,s))})}function dk(n,e){return p(this,null,function*(){let t=Q(n);if(!t.currentUser.isEqual(e)){O(pp,"User change. New user:",e.toKey());let r=yield Tw(t.localStore,e);t.currentUser=e,function(s,o){s.cu.forEach(c=>{c.forEach(u=>{u.reject(new x(C.CANCELLED,o))})}),s.cu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield So(t,r.Ms)}})}function fk(n,e){let t=Q(n),r=t._u.get(e);if(r&&r.tu)return Y().add(r.key);{let i=Y(),s=t.iu.get(e);if(!s)return i;for(let o of s){let c=t.ru.get(o);i=i.unionWith(c.view.Wa)}return i}}function Lw(n){let e=Q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Nw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fk.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ck.bind(null,e),e.nu.Q_=ek.bind(null,e.eventManager),e.nu.Tu=tk.bind(null,e.eventManager),e}function Mw(n){let e=Q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=uk.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=lk.bind(null,e),e}function Hh(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),O($n,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>p(this,null,function*(){r.isEqual(i)||(yield Tw(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function nI(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield pk(n);O($n,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Jv(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Jv(e.remoteStore,i)),n._onlineComponents=e})}function pk(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O($n,"Using user provided OfflineComponentProvider");try{yield Hh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===C.FAILED_PRECONDITION||i.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;gi("Error using user provided cache. Falling back to memory cache: "+t),yield Hh(n,new gp)}}else O($n,"Using default OfflineComponentProvider"),yield Hh(n,new Df(void 0));return n._offlineComponents})}function Uw(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(O($n,"Using user provided OnlineComponentProvider"),yield nI(n,n._uninitializedComponentsProvider._online)):(O($n,"Using default OnlineComponentProvider"),yield nI(n,new Fw))),n._onlineComponents})}function mk(n){return Uw(n).then(e=>e.syncEngine)}function Yc(n){return p(this,null,function*(){let e=yield Uw(n),t=e.eventManager;return t.onListen=nk.bind(null,e.syncEngine),t.onUnlisten=sk.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=rk.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=ok.bind(null,e.syncEngine),t})}function gk(n,e,t={}){let r=new ct;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,c,u,h){let f=new fo({next:y=>{f.yu(),o.enqueueAndForget(()=>dp(s,g));let T=y.docs.has(c);!T&&y.fromCache?h.reject(new x(C.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&y.fromCache&&u&&u.source==="server"?h.reject(new x(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new ho(To(c.path),f,{includeMetadataChanges:!0,Fa:!0});return hp(s,g)}(yield Yc(n),n.asyncQueue,e,t,r)})),r.promise}function _k(n,e,t={}){let r=new ct;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,c,u,h){let f=new fo({next:y=>{f.yu(),o.enqueueAndForget(()=>dp(s,g)),y.fromCache&&u.source==="server"?h.reject(new x(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new ho(c,f,{includeMetadataChanges:!0,Fa:!0});return hp(s,g)}(yield Yc(n),n.asyncQueue,e,t,r)})),r.promise}function Bw(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}function $w(n,e,t){if(!t)throw new x(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function yk(n,e,t,r){if(e===!0&&r===!0)throw new x(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function iI(n){if(!L.isDocumentKey(n))throw new x(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function sI(n){if(L.isDocumentKey(n))throw new x(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function gu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":F(12329,{type:typeof n})}function Xe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=gu(n);throw new x(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function vk(n,e){if(e<=0)throw new x(C.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function jw(n,e,t,r={}){var i;let s=(n=Xe(n,Vi))._getSettings(),o=Object.assign(Object.assign({},s),{emulatorOptions:n._getEmulatorOptions()}),c=`${e}:${t}`;s.host!==qw&&s.host!==c&&gi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u=Object.assign(Object.assign({},s),{host:c,ssl:!1,emulatorOptions:r});if(!ft(u,o)&&(n._setSettings(u),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Ee.MOCK_USER;else{h=da(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new x(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Ee(g)}n._authCredentials=new Qh(new tc(h,f))}}function zw(n,e,...t){if(n=ne(n),$w("collection","path",e),n instanceof Vi){let r=se.fromString(e,...t);return sI(r),new On(n,null,r)}{if(!(n instanceof je||n instanceof On))throw new x(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return sI(r),new On(n.firestore,null,r)}}function _p(n,e,...t){if(n=ne(n),arguments.length===1&&(e=rc.newId()),$w("doc","path",e),n instanceof Vi){let r=se.fromString(e,...t);return iI(r),new je(n,null,new L(r))}{if(!(n instanceof je||n instanceof On))throw new x(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return iI(r),new je(n.firestore,n instanceof On?n.converter:null,new L(r))}}function cI(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function uI(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}function Ww(n,e,t){t||(t=no);let r=Qt(n,"firestore");if(r.isInitialized(t)){let i=r.getImmediate({identifier:t}),s=r.getOptions(t);if(ft(s,e))return i;throw new x(C.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new x(C.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<vw)throw new x(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function Gw(n,e){let t=typeof n=="object"?n:Yt(),r=typeof n=="string"?n:e||no,i=Qt(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=ha("firestore");s&&jw(i,...s)}return i}function _u(n){if(n._terminated)throw new x(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Ik(n),n._firestoreClient}function Ik(n){var e,t,r;let i=n._freezeSettings(),s=function(c,u,h,f){return new ud(c,u,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Bw(f.experimentalLongPollingOptions),f.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Of(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(c){let u=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(u),_online:u}}(n._componentsProvider))}function Hw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{oc:n})}}function Po(n){let e=n._freezeSettings(),t=pu(n._databaseId);return new Lf(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Kw(n,e,t,r,i,s={}){let o=n.dc(s.merge||s.mergeFields?2:0,e,t,i);yp("Data must be an object, but it was:",o,r);let c=Yw(r,o),u,h;if(s.merge)u=new nt(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let y=Ff(e,g,t);if(!o.contains(y))throw new x(C.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);Xw(f,y)||f.push(y)}u=new nt(f),h=o.fieldTransforms.filter(g=>u.covers(g.field))}else u=null,h=o.fieldTransforms;return new xf(new Ke(c),u,h)}function Ek(n,e,t,r){let i=n.dc(1,e,t);yp("Data must be an object, but it was:",i,r);let s=[],o=Ke.empty();jn(r,(u,h)=>{let f=vp(e,u,t);h=ne(h);let g=i.hc(f);if(h instanceof eu)s.push(f);else{let y=Co(h,g);y!=null&&(s.push(f),o.set(f,y))}});let c=new nt(s);return new Zc(o,c,i.fieldTransforms)}function Tk(n,e,t,r,i,s){let o=n.dc(1,e,t),c=[Ff(e,r,t)],u=[i];if(s.length%2!=0)throw new x(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<s.length;y+=2)c.push(Ff(e,s[y])),u.push(s[y+1]);let h=[],f=Ke.empty();for(let y=c.length-1;y>=0;--y)if(!Xw(h,c[y])){let T=c[y],D=u[y];D=ne(D);let N=o.hc(T);if(D instanceof eu)h.push(T);else{let k=Co(D,N);k!=null&&(h.push(T),f.set(T,k))}}let g=new nt(h);return new Zc(f,g,o.fieldTransforms)}function Qw(n,e,t,r=!1){return Co(t,n.dc(r?4:3,e))}function Co(n,e){if(Jw(n=ne(n)))return yp("Unsupported field value:",e,n),Yw(n,e);if(n instanceof Mi)return function(r,i){if(!Hw(i.oc))throw i.Tc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Tc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.cc&&e.oc!==4)throw e.Tc("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let c of r){let u=Co(c,i.Pc(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return uC(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=J.fromDate(r);return{timestampValue:Di(i.serializer,s)}}if(r instanceof J){let s=new J(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Di(i.serializer,s)}}if(r instanceof mo)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof po)return{bytesValue:ew(i.serializer,r._byteString)};if(r instanceof je){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Tc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:rp(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof go)return function(o,c){return{mapValue:{fields:{[Xf]:{stringValue:Zf},[bi]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw c.Tc("VectorValues must only contain numeric values.");return np(c.serializer,h)})}}}}}}(r,i);throw i.Tc(`Unsupported field value: ${gu(r)}`)}(n,e)}function Yw(n,e){let t={};return SI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):jn(n,(r,i)=>{let s=Co(i,e.uc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Jw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof J||n instanceof mo||n instanceof po||n instanceof je||n instanceof Mi||n instanceof go)}function yp(n,e,t){if(!Jw(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=gu(t);throw r==="an object"?e.Tc(n+" a custom object"):e.Tc(n+" "+r)}}function Ff(n,e,t){if((e=ne(e))instanceof Li)return e._internalPath;if(typeof e=="string")return vp(n,e);throw tu("Field path arguments must be of type string or ",n,!1,void 0,t)}function vp(n,e,t){if(e.search(Ak)>=0)throw tu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Li(...e.split("."))._internalPath}catch{throw tu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function tu(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new x(C.INVALID_ARGUMENT,c+n+u)}function Xw(n,e){return n.some(t=>t.isEqual(e))}function yu(n,e){return typeof e=="string"?vp(n,e):e instanceof Li?e._internalPath:e._delegate._internalPath}function Zw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function eE(n,e,...t){let r=[];e instanceof yo&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof Fi).length,c=s.filter(u=>u instanceof vo).length;if(o>1||o>0&&c>0)throw new x(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}function tE(n,e,t){let r=e,i=yu("where",n);return vo._create(i,r,t)}function nE(...n){return n.forEach(e=>dE("or",e)),Fi._create("or",n)}function rE(...n){return n.forEach(e=>dE("and",e)),Fi._create("and",n)}function iE(n,e="asc"){let t=e,r=yu("orderBy",n);return Bf._create(r,t)}function sE(n){return vk("limit",n),$f._create("limit",n,"F")}function oE(...n){return nu._create("startAt",n,!0)}function aE(...n){return nu._create("startAfter",n,!1)}function cE(...n){return ru._create("endBefore",n,!1)}function uE(...n){return ru._create("endAt",n,!0)}function lE(n,e,t,r){if(t[0]=ne(t[0]),t[0]instanceof _o)return function(s,o,c,u,h){if(!u)throw new x(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let g of fi(s))if(g.field.isKeyField())f.push(wr(o,u.key));else{let y=u.data.field(g.field);if(lu(y))throw new x(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(y===null){let T=g.field.canonicalString();throw new x(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${T}' (used as the orderBy) does not exist.`)}f.push(y)}return new Mt(f,h)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Po(n.firestore);return function(o,c,u,h,f,g){let y=o.explicitOrderBy;if(f.length>y.length)throw new x(C.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let T=[];for(let D=0;D<f.length;D++){let N=f[D];if(y[D].field.isKeyField()){if(typeof N!="string")throw new x(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof N}`);if(!tp(o)&&N.indexOf("/")!==-1)throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${N}' contains a slash.`);let k=o.path.child(se.fromString(N));if(!L.isDocumentKey(k))throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);let q=new L(k);T.push(wr(c,q))}else{let k=Qw(u,h,N);T.push(k)}}return new Mt(T,g)}(n._query,n.firestore._databaseId,i,e,t,r)}}function lI(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new x(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!tp(e)&&t.indexOf("/")!==-1)throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(se.fromString(t));if(!L.isDocumentKey(r))throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return wr(n,new L(r))}if(t instanceof je)return wr(n,t._key);throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${gu(t)}.`)}function hI(n,e){if(!Array.isArray(n)||n.length===0)throw new x(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function hE(n,e){let t=function(i,s){for(let o of i)for(let c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new x(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function dE(n,e){if(!(e instanceof vo||e instanceof Fi))throw new x(C.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function fE(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}function bk(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:n})}}function pE(n){n=Xe(n,je);let e=Xe(n.firestore,Tt);return gk(_u(e),n._key).then(t=>IE(e,n,t))}function mE(n){n=Xe(n,Et);let e=Xe(n.firestore,Tt),t=_u(e),r=new Io(e);return Zw(n._query),_k(t,n._query).then(i=>new su(e,r,n,i))}function gE(n,e,t){n=Xe(n,je);let r=Xe(n.firestore,Tt),i=fE(n.converter,e,t);return vu(r,[Kw(Po(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Je.none())])}function _E(n,e,t,...r){n=Xe(n,je);let i=Xe(n.firestore,Tt),s=Po(i),o;return o=typeof(e=ne(e))=="string"||e instanceof Li?Tk(s,"updateDoc",n._key,e,t,r):Ek(s,"updateDoc",n._key,e),vu(i,[o.toMutation(n._key,Je.exists(!0))])}function yE(n){return vu(Xe(n.firestore,Tt),[new ki(n._key,Je.none())])}function vE(n,e){let t=Xe(n.firestore,Tt),r=_p(n),i=fE(n.converter,e);return vu(t,[Kw(Po(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Je.exists(!1))]).then(()=>r)}function Ip(n,...e){var t,r,i;n=ne(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||uI(e[o])||(s=e[o],o++);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(uI(e[o])){let g=e[o];e[o]=(t=g.next)===null||t===void 0?void 0:t.bind(g),e[o+1]=(r=g.error)===null||r===void 0?void 0:r.bind(g),e[o+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let u,h,f;if(n instanceof je)h=Xe(n.firestore,Tt),f=To(n._key.path),u={next:g=>{e[o]&&e[o](IE(h,n,g))},error:e[o+1],complete:e[o+2]};else{let g=Xe(n,Et);h=Xe(g.firestore,Tt),f=g._query;let y=new Io(h);u={next:T=>{e[o]&&e[o](new su(h,y,g,T))},error:e[o+1],complete:e[o+2]},Zw(n._query)}return function(y,T,D,N){let k=new fo(N),q=new ho(T,k,D);return y.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return hp(yield Yc(y),q)})),()=>{k.yu(),y.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return dp(yield Yc(y),q)}))}}(_u(h),f,c,u)}function vu(n,e){return function(r,i){let s=new ct;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return ak(yield mk(r),i,s)})),s.promise}(_u(n),e)}function IE(n,e,t){let r=t.docs.get(e._key),i=new Io(n);return new iu(n,i,e._key,r,new mr(t.hasPendingWrites,t.fromCache),e.converter)}function wE(n){return new jf(n)}function Rk(n){return new zf(n==null?void 0:n.forceOwnership)}function Re(){return new Mf("serverTimestamp")}var Xy,Zy,Ee,Ui,Ir,C,x,ct,tc,Kh,Qh,Yh,Jh,Xh,nc,Zh,rc,tv,nv,J,z,rv,ic,se,wP,Te,L,Ks,yi,di,Qs,lt,gI,sc,S,tt,oc,vi,nd,gr,rd,iv,zs,id,sd,vt,_r,ac,cr,wo,ei,Js,bP,yt,ov,fr,av,RP,Ii,cc,SP,Qa,PP,vI,CP,Xs,od,wi,II,kP,Ei,DP,Kf,NP,uc,yr,Zs,OP,Ti,xP,au,VP,cu,LP,Qf,MP,ad,FP,lc,UP,wI,BP,hc,$P,EI,qP,uu,jP,cd,zP,TI,WP,Yf,GP,AI,HP,bI,RI,Jf,KP,QP,eo,pe,hi,Vt,ce,dc,nt,fc,Ae,YP,PI,CI,kI,DI,ud,no,Ai,Xf,NI,Nn,Zf,bi,Ya,xI,Ke,xe,Mt,Er,pc,ee,oe,pd,md,gd,_d,mc,yd,vd,Id,Ft,It,iC,jI,sC,oC,aC,Pi,Ln,Mn,Fn,Ar,vc,Td,Je,Ci,Un,wt,ki,Ic,so,Ad,oo,bd,Ie,te,Av,gC,Rd,pr,wc,ao,pi,Ec,Tc,Ac,Sd,_C,yC,vC,Pd,Ni,Sc,Od,Cc,xd,an,ni,Vd,Ld,Md,hr,dr,kc,$d,co,Mv,za,qd,Bv,mw,Ye,Oc,Oi,jd,qv,vw,zd,xc,Wd,Gd,Vc,Hd,Kd,Qd,Lc,Yd,Jd,Xd,uo,we,Zd,ef,tf,nf,lo,rf,Mc,Fc,sf,kn,jh,zh,Wh,NC,of,af,cf,Uc,sp,xC,uf,Bc,$c,hf,Qv,qc,Ha,Gh,$C,ff,pf,$e,mf,jc,Yv,zc,gf,_f,yf,vf,If,Sr,wf,Ef,Gc,Hc,xi,Tf,Af,bf,Zv,ho,Kc,Qc,Rf,pp,Sf,Pf,Cf,gp,Df,Nf,Fw,fo,$n,Of,rI,qw,oI,Jc,Vi,Et,je,On,aI,Xc,Tt,po,Li,Mi,mo,go,wk,xf,Zc,Vf,Lf,eu,Mf,Ak,_o,Uf,yo,Pr,vo,Fi,Bf,$f,nu,ru,qf,mr,iu,mi,su,Io,jf,zf,EE=W(()=>{"use strict";wn();Xn();Gr();Ht();Yy();Jy();Xy="@firebase/firestore",Zy="4.7.11";Ee=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ee.UNAUTHENTICATED=new Ee(null),Ee.GOOGLE_CREDENTIALS=new Ee("google-credentials-uid"),Ee.FIRST_PARTY=new Ee("first-party-uid"),Ee.MOCK_USER=new Ee("mock-user");Ui="11.6.1";Ir=new Rt("@firebase/firestore");C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends Ge{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};ct=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};tc=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Kh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ee.UNAUTHENTICATED))}shutdown(){}},Qh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Yh=class{constructor(e){this.t=e,this.currentUser=Ee.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){B(this.o===void 0,42304);let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new ct;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ct,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>p(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},c=u=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ct)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(B(typeof r.accessToken=="string",31837,{l:r}),new tc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return B(e===null||typeof e=="string",2055,{h:e}),new Ee(e)}},Jh=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Ee.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Xh=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Jh(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Ee.FIRST_PARTY))}shutdown(){}invalidateToken(){}},nc=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Zh=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Oe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){B(this.o===void 0,3512);let r=s=>{s.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,O("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new nc(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(B(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new nc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};rc=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=vP(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};tv=-62135596800,nv=1e6,J=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*nv);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<tv)throw new x(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/nv}_compareTo(e){return this.seconds===e.seconds?H(this.nanoseconds,e.nanoseconds):H(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-tv;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};z=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new J(0,0))}static max(){return new n(new J(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};rv="__name__",ic=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&F(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&F(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return H(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):ed(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return sn.fromString(e.substring(4,e.length-2))}},se=class n extends ic{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new x(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},wP=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Te=class n extends ic{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return wP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===rv}static keyField(){return new n([rv])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new x(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new x(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new x(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(r+=c,i++):(s(),i++)}if(s(),o)throw new x(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};L=class n{constructor(e){this.path=e}static fromPath(e){return new n(se.fromString(e))}static fromName(e){return new n(se.fromString(e).popFirst(5))}static empty(){return new n(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new se(e.slice()))}};Ks=-1,yi=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};yi.UNKNOWN_ID=-1;di=class{constructor(e,t){this.fieldPath=e,this.kind=t}},Qs=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,lt.min())}};lt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(z.min(),L.empty(),Ks)}static max(){return new n(z.max(),L.empty(),Ks)}};gI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",sc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};S=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next(f=>{o[h]=f,++c,c===s&&r(o)},f=>i(f))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};tt="SimpleDb",oc=class n{static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new gr(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new ct,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new gr(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{let i=Hf(r.target.error);this.S.reject(new gr(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(O(tt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new rd(t)}},vi=class n{static delete(e){return O(tt,"Removing database:",e),ur(ua().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!qr())return!1;if(n.F())return!0;let e=_e(),t=n.M(e),r=0<t&&t<10,i=_I(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.B=r,this.L=null,n.M(_e())===12.2&&He("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(e){return p(this,null,function*(){return this.db||(O(tt,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new gr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new x(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new x(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new gr(e,o))},i.onupgradeneeded=s=>{O(tt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${o.version}`);this.B.q(o,i.transaction,s.oldVersion,this.version).next(()=>{O(tt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",t=>{let r=t.target;this.L=r.version},{passive:!0})),this.$&&(this.db.onversionchange=t=>this.$(t)),this.db})}U(e){this.$=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return p(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.k(e);let c=oc.open(this.db,e,s?"readonly":"readwrite",r),u=i(c).next(h=>(c.v(),h)).catch(h=>(c.abort(h),S.reject(h))).toPromise();return u.catch(()=>{}),yield c.D,u}catch(c){let u=c,h=u.name!=="FirebaseError"&&o<3;if(O(tt,"Transaction failed with error:",u.message,"Retrying:",h),this.close(),!h)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};nd=class{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return ur(this.K.delete())}},gr=class extends x{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};rd=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(O(tt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(O(tt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ur(r)}add(e){return O(tt,"ADD",this.store.name,e,e),ur(this.store.add(e))}get(e){return ur(this.store.get(e)).next(t=>(t===void 0&&(t=null),O(tt,"GET",this.store.name,e,t),t))}delete(e){return O(tt,"DELETE",this.store.name,e),ur(this.store.delete(e))}count(){return O(tt,"COUNT",this.store.name),ur(this.store.count())}J(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new S((o,c)=>{s.onerror=u=>{c(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.Y(s,(c,u)=>{o.push(u)}).next(()=>o)}}Z(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new S((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}X(e,t){O(tt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.ee=!1;let i=this.cursor(r);return this.Y(i,(s,o,c)=>c.delete())}te(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.Y(i,t)}ne(e){let t=this.cursor({});return new S((r,i)=>{t.onerror=s=>{let o=Hf(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():r()}):r()}})}Y(e,t){let r=[];return new S((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let c=o.target.result;if(!c)return void i();let u=new nd(c),h=t(c.primaryKey,c.value,u);if(h instanceof S){let f=h.catch(g=>(u.done(),S.reject(g)));r.push(f)}u.isDone?i():u.j===null?c.continue():c.continue(u.j)}}).next(()=>S.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.ee?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};iv=!1;zs="IndexBackfiller",id=class{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ie(e){O(zs,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>p(this,null,function*(){this.task=null;try{let t=yield this.re.se();O(zs,`Documents written: ${t}`)}catch(t){qn(t)?O(zs,"Ignoring IndexedDB error during index backfill: ",t):yield Cr(t)}yield this.ie(6e4)}))}},sd=class{constructor(e,t){this.localStore=e,this.persistence=t}se(e=50){return p(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.oe(t,e))})}oe(e,t){let r=new Set,i=t,s=!0;return S.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return O(zs,`Processing collection: ${o}`),this._e(e,o,i).next(c=>{i-=c,r.add(o)});s=!1})).next(()=>t-i)}_e(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ae(i,s)).next(c=>(O(zs,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}ae(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=mI(s);Gf(o,r)>0&&(r=o)}),new lt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};vt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ue(i),this.ce=i=>r.writeSequenceNumber(i))}ue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ce&&this.ce(t),t}}n.le=-1;return n})(),_r=-1;ac="";cr="remoteDocuments",wo="owner",ei="owner",Js="mutationQueues",bP="userId",yt="mutations",ov="batchId",fr="userMutationsIndex",av=["userId","batchId"];RP={},Ii="documentMutations",cc="remoteDocumentsV14",SP=["prefixPath","collectionGroup","readTime","documentId"],Qa="documentKeyIndex",PP=["prefixPath","collectionGroup","documentId"],vI="collectionGroupIndex",CP=["collectionGroup","readTime","prefixPath","documentId"],Xs="remoteDocumentGlobal",od="remoteDocumentGlobalKey",wi="targets",II="queryTargetsIndex",kP=["canonicalId","targetId"],Ei="targetDocuments",DP=["targetId","path"],Kf="documentTargetsIndex",NP=["path","targetId"],uc="targetGlobalKey",yr="targetGlobal",Zs="collectionParents",OP=["collectionId","parent"],Ti="clientMetadata",xP="clientId",au="bundles",VP="bundleId",cu="namedQueries",LP="name",Qf="indexConfiguration",MP="indexId",ad="collectionGroupIndex",FP="collectionGroup",lc="indexState",UP=["indexId","uid"],wI="sequenceNumberIndex",BP=["uid","sequenceNumber"],hc="indexEntries",$P=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],EI="documentKeyIndex",qP=["indexId","uid","orderedDocumentKey"],uu="documentOverlays",jP=["userId","collectionPath","documentId"],cd="collectionPathOverlayIndex",zP=["userId","collectionPath","largestBatchId"],TI="collectionGroupOverlayIndex",WP=["userId","collectionGroup","largestBatchId"],Yf="globals",GP="name",AI=[Js,yt,Ii,cr,wi,wo,yr,Ei,Ti,Xs,Zs,au,cu],HP=[...AI,uu],bI=[Js,yt,Ii,cc,wi,wo,yr,Ei,Ti,Xs,Zs,au,cu,uu],RI=bI,Jf=[...RI,Qf,lc,hc],KP=Jf,QP=[...Jf,Yf];eo=class extends sc{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}};pe=class n{constructor(e,t){this.comparator=e,this.root=t||Vt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Vt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hi(this.root,e,this.comparator,!1)}getReverseIterator(){return new hi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hi(this.root,e,this.comparator,!0)}},hi=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Vt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r!=null?r:n.RED,this.left=i!=null?i:n.EMPTY,this.right=s!=null?s:n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e!=null?e:this.key,t!=null?t:this.value,r!=null?r:this.color,i!=null?i:this.left,s!=null?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw F(27949);return e+(this.isRed()?0:1)}};Vt.EMPTY=null,Vt.RED=!0,Vt.BLACK=!1;Vt.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new Vt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};ce=class n{constructor(e){this.comparator=e,this.data=new pe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new dc(this.data.getIterator())}getIteratorFrom(e){return new dc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},dc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};nt=class n{constructor(e){this.fields=e,e.sort(Te.comparator)}static empty(){return new n([])}unionWith(e){let t=new ce(Te.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return _i(this.fields,e.fields,(t,r)=>t.isEqual(r))}};fc=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};Ae=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new fc("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return H(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ae.EMPTY_BYTE_STRING=new Ae("");YP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);PI="server_timestamp",CI="__type__",kI="__previous_value__",DI="__local_write_time__";ud=class{constructor(e,t,r,i,s,o,c,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h}},no="(default)",Ai=class n{constructor(e,t){this.projectId=e,this.database=t||no}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===no}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};Xf="__type__",NI="__max__",Nn={mapValue:{fields:{__type__:{stringValue:NI}}}},Zf="__vector__",bi="value",Ya={nullValue:"NULL_VALUE"};xI={mapValue:{fields:{[Xf]:{stringValue:Zf},[bi]:{arrayValue:{}}}}};Ke=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Xa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ws(t)}setAll(e){let t=Te.emptyPath(),r={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=c.popLast()}o?r[c.lastSegment()]=Ws(o):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Xa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Lt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Xa(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){jn(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Ws(this.value))}};xe=class n{constructor(e,t,r,i,s,o,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new n(e,0,z.min(),z.min(),z.min(),Ke.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,z.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,z.min(),z.min(),Ke.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,z.min(),z.min(),Ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};Mt=class{constructor(e,t){this.position=e,this.inclusive=t}};Er=class{constructor(e,t="asc"){this.field=e,this.dir=t}};pc=class{},ee=class n extends pc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new pd(e,t,r):t==="array-contains"?new _d(e,r):t==="in"?new mc(e,r):t==="not-in"?new yd(e,r):t==="array-contains-any"?new vd(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new md(e,r):new gd(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Vn(t,this.value)):t!==null&&xn(this.value)===xn(t)&&this.matchesComparison(Vn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},oe=class n extends pc{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new n(e,t)}matches(e){return Si(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}};pd=class extends ee{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},md=class extends ee{constructor(e,t){super(e,"in",t),this.keys=BI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},gd=class extends ee{constructor(e,t){super(e,"not-in",t),this.keys=BI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};_d=class extends ee{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return io(t)&&ro(t.arrayValue,this.value)}},mc=class extends ee{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ro(this.value.arrayValue,t)}},yd=class extends ee{constructor(e,t){super(e,"not-in",t)}matches(e){if(ro(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ro(this.value.arrayValue,t)}},vd=class extends ee{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!io(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ro(this.value.arrayValue,r))}};Id=class{constructor(e,t=null,r=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.Ie=null}};Ft=class{constructor(e,t=null,r=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}};It=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){jn(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return SI(this.inner)}size(){return this.innerSize}};iC=new pe(L.comparator);jI=new pe(L.comparator);sC=new pe(L.comparator),oC=new ce(L.comparator);aC=new ce(H);Pi=class{constructor(){this._=void 0}};Ln=class extends Pi{},Mn=class extends Pi{constructor(e){super(),this.elements=e}};Fn=class extends Pi{constructor(e){super(),this.elements=e}};Ar=class extends Pi{constructor(e,t){super(),this.serializer=e,this.Re=t}};vc=class{constructor(e,t){this.field=e,this.transform=t}};Td=class{constructor(e,t){this.version=e,this.transformResults=t}},Je=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};Ci=class{};Un=class extends Ci{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},wt=class extends Ci{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};ki=class extends Ci{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ic=class extends Ci{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};so=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&fC(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Hs(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Hs(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=WI();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=JI(o,c);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(z.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Y())}isEqual(e){return this.batchId===e.batchId&&_i(this.mutations,e.mutations,(t,r)=>wv(t,r))&&_i(this.baseMutations,e.baseMutations,(t,r)=>wv(t,r))}},Ad=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){B(e.mutations.length===r.length,58842,{fe:e.mutations.length,ge:r.length});let i=function(){return sC}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};oo=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};bd=class{constructor(e,t){this.count=e,this.unchangedNames=t}};(te=Ie||(Ie={}))[te.OK=0]="OK",te[te.CANCELLED=1]="CANCELLED",te[te.UNKNOWN=2]="UNKNOWN",te[te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",te[te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",te[te.NOT_FOUND=5]="NOT_FOUND",te[te.ALREADY_EXISTS=6]="ALREADY_EXISTS",te[te.PERMISSION_DENIED=7]="PERMISSION_DENIED",te[te.UNAUTHENTICATED=16]="UNAUTHENTICATED",te[te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",te[te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",te[te.ABORTED=10]="ABORTED",te[te.OUT_OF_RANGE=11]="OUT_OF_RANGE",te[te.UNIMPLEMENTED=12]="UNIMPLEMENTED",te[te.INTERNAL=13]="INTERNAL",te[te.UNAVAILABLE=14]="UNAVAILABLE",te[te.DATA_LOSS=15]="DATA_LOSS";Av=null;gC=new sn([4294967295,4294967295],0);Rd=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new pr(`Invalid padding: ${t}`);if(r<0)throw new pr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new pr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new pr(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=sn.fromNumber(this.pe)}we(e,t,r){let i=e.add(t.multiply(sn.fromNumber(r)));return i.compare(gC)===1&&(i=new sn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;let t=bv(e),[r,i]=Rv(t);for(let s=0;s<this.hashCount;s++){let o=this.we(r,i,s);if(!this.be(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(c=>o.insert(c)),o}insert(e){if(this.pe===0)return;let t=bv(e),[r,i]=Rv(t);for(let s=0;s<this.hashCount;s++){let o=this.we(r,i,s);this.Se(o)}}Se(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},pr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};wc=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,ao.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(z.min(),i,new pe(H),rt(),Y())}},ao=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Y(),Y(),Y())}};pi=class{constructor(e,t,r,i){this.De=e,this.removedTargetIds=t,this.key=r,this.ve=i}},Ec=class{constructor(e,t){this.targetId=e,this.Ce=t}},Tc=class{constructor(e,t,r=Ae.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Ac=class{constructor(){this.Fe=0,this.Me=Sv(),this.xe=Ae.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=Y(),t=Y(),r=Y();return this.Me.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:F(38017,{changeType:s})}}),new ao(this.xe,this.Oe,e,t,r)}Qe(){this.Ne=!1,this.Me=Sv()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,B(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}},Sd=class{constructor(e){this.ze=e,this.je=new Map,this.He=rt(),this.Je=ja(),this.Ye=ja(),this.Ze=new pe(H)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let r=this.rt(t);switch(e.state){case 0:this.it(t)&&r.ke(e.resumeToken);break;case 1:r.We(),r.Be||r.Qe(),r.ke(e.resumeToken);break;case 2:r.We(),r.Be||this.removeTarget(t);break;case 3:this.it(t)&&(r.Ge(),r.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),r.ke(e.resumeToken));break;default:F(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((r,i)=>{this.it(i)&&t(i)})}ot(e){let t=e.targetId,r=e.Ce.count,i=this._t(t);if(i){let s=i.target;if(gc(s))if(r===0){let o=new L(s.path);this.tt(t,o,xe.newNoDocument(o,z.min()))}else B(r===1,20013,{expectedCount:r});else{let o=this.ut(t);if(o!==r){let c=this.ct(e),u=c?this.lt(c,e,o):1;if(u!==0){this.st(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,h)}Av==null||Av.ht(function(f,g,y,T,D){var N,k,q,U,M,j;let X={localCacheCount:f,existenceFilterCount:g.count,databaseId:y.database,projectId:y.projectId},G=g.unchangedNames;return G&&(X.bloomFilter={applied:D===0,hashCount:(N=G==null?void 0:G.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(U=(q=(k=G==null?void 0:G.bits)===null||k===void 0?void 0:k.bitmap)===null||q===void 0?void 0:q.length)!==null&&U!==void 0?U:0,padding:(j=(M=G==null?void 0:G.bits)===null||M===void 0?void 0:M.padding)!==null&&j!==void 0?j:0,mightContain:w=>{var _;return(_=T==null?void 0:T.mightContain(w))!==null&&_!==void 0&&_}}),X}(o,e.Ce,this.ze.Pt(),c,u))}}}}ct(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,c;try{o=un(r).toUint8Array()}catch(u){if(u instanceof fc)return gi("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Rd(o,i,s)}catch(u){return gi(u instanceof pr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.pe===0?null:c}lt(e,t,r){return t.Ce.count===r-this.Tt(e,t.targetId)?0:2}Tt(e,t){let r=this.ze.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.ze.Pt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.tt(t,s,null),i++)}),i}It(e){let t=new Map;this.je.forEach((s,o)=>{let c=this._t(o);if(c){if(s.current&&gc(c.target)){let u=new L(c.target.path);this.Et(u).has(o)||this.dt(o,u)||this.tt(o,u,xe.newNoDocument(u,e))}s.Le&&(t.set(o,s.qe()),s.Qe())}});let r=Y();this.Ye.forEach((s,o)=>{let c=!0;o.forEachWhile(u=>{let h=this._t(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.He.forEach((s,o)=>o.setReadTime(e));let i=new wc(e,t,this.Ze,this.He,r);return this.He=rt(),this.Je=ja(),this.Ye=ja(),this.Ze=new pe(H),i}et(e,t){if(!this.it(e))return;let r=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,r),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,r){if(!this.it(e))return;let i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),r&&(this.He=this.He.insert(t,r))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new Ac,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new ce(H),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new ce(H),this.Je=this.Je.insert(e,t)),t}it(e){let t=this._t(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new Ac),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}};_C={asc:"ASCENDING",desc:"DESCENDING"},yC={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vC={and:"AND",or:"OR"},Pd=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};Ni=class n{constructor(e,t,r,i,s=z.min(),o=z.min(),c=Ae.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};Sc=class{constructor(e){this.wt=e}};Od=class{getBundleMetadata(e,t){return Nv(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Rr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return Nv(e).put(function(i){return{bundleId:i.id,createTime:br(Qe(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return Ov(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:dw(s.bundledQuery),readTime:Rr(s.readTime)}}(r)})}saveNamedQuery(e,t){return Ov(e).put(function(i){return{name:i.name,readTime:br(Qe(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};Cc=class n{constructor(e,t){this.serializer=e,this.userId=t}static bt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Fs(e).get(kv(this.userId,t)).next(r=>r?qh(this.serializer,r):null)}getOverlays(e,t){let r=xt();return S.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let c=new oo(t,o);i.push(this.St(e,c))}),S.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(qe(o.getCollectionPath())));let s=[];return i.forEach(o=>{let c=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Fs(e).X(cd,c))}),S.waitFor(s)}getOverlaysForCollection(e,t,r){let i=xt(),s=qe(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Fs(e).J(cd,o).next(c=>{for(let u of c){let h=qh(this.serializer,u);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=xt(),o,c=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Fs(e).te({index:TI,range:c},(u,h,f)=>{let g=qh(this.serializer,h);s.size()<i||g.largestBatchId===o?(s.set(g.getKey(),g),o=g.largestBatchId):f.done()}).next(()=>s)}St(e,t){return Fs(e).put(function(i,s,o){let[c,u,h]=kv(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Rc(i.wt,o.mutation)}}(this.serializer,this.userId,t))}};xd=class{Dt(e){return be(e,Yf)}getSessionToken(e){return this.Dt(e).get("sessionToken").next(t=>{let r=t==null?void 0:t.value;return r?Ae.fromUint8Array(r):Ae.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}};an=class{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(fe(e.integerValue));else if("doubleValue"in e){let r=fe(e.doubleValue);isNaN(r)?this.Mt(t,13):(this.Mt(t,15),Ys(r)?t.xt(0):t.xt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Mt(t,20),typeof r=="string"&&(r=cn(r)),t.Ot(`${r.seconds||""}`),t.xt(r.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(un(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Mt(t,45),t.xt(r.latitude||0),t.xt(r.longitude||0)}else"mapValue"in e?OI(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):du(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):F(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let r=e.fields||{};this.Mt(t,55);for(let i of Object.keys(r))this.Nt(i,t),this.Ct(r[i],t)}qt(e,t){var r,i;let s=e.fields||{};this.Mt(t,53);let o=bi,c=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Mt(t,15),t.xt(fe(c)),this.Nt(o,t),this.Ct(s[o],t)}$t(e,t){let r=e.values||[];this.Mt(t,50);for(let i of r)this.Ct(i,t)}kt(e,t){this.Mt(t,37),L.fromName(e).path.forEach(r=>{this.Mt(t,60),this.Kt(r,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}};an.Wt=new an;ni=255;Vd=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.zt(r.value),r=t.next();this.jt()}Ht(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Yt()}Zt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.zt(r);else if(r<2048)this.zt(960|r>>>6),this.zt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.zt(480|r>>>12),this.zt(128|63&r>>>6),this.zt(128|63&r);else{let i=t.codePointAt(0);this.zt(240|i>>>18),this.zt(128|63&i>>>12),this.zt(128|63&i>>>6),this.zt(128|63&i)}}this.jt()}Xt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{let i=t.codePointAt(0);this.Jt(240|i>>>18),this.Jt(128|63&i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i)}}this.Yt()}en(e){let t=this.tn(e),r=xv(t);this.nn(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}rn(e){let t=this.tn(e),r=xv(t);this.nn(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}sn(){this._n(ni),this._n(255)}an(){this.un(ni),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}zt(e){let t=255&e;t===0?(this._n(0),this._n(255)):t===ni?(this._n(ni),this._n(0)):this._n(t)}Jt(e){let t=255&e;t===0?(this.un(0),this.un(255)):t===ni?(this.un(ni),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Ld=class{constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}},Md=class{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}},hr=class{constructor(){this.ln=new Vd,this.hn=new Ld(this.ln),this.Pn=new Md(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return e===0?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}};dr=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}In(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};kc=class{constructor(e){this.En=new ce((t,r)=>Te.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.An=[];for(let t of e.filters){let r=t;r.isInequality()?this.En=this.En.add(r):this.An.push(r)}}get Rn(){return this.En.size>1}Vn(e){if(B(e.collectionGroup===this.collectionId,49279),this.Rn)return!1;let t=td(e);if(t!==void 0&&!this.mn(t))return!1;let r=ar(e),i=new Set,s=0,o=0;for(;s<r.length&&this.mn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.En.size>0){let c=this.En.getIterator().getNext();if(!i.has(c.field.canonicalString())){let u=r[s];if(!this.fn(c,u)||!this.gn(this.dn[o++],u))return!1}++s}for(;s<r.length;++s){let c=r[s];if(o>=this.dn.length||!this.gn(this.dn[o++],c))return!1}return!0}pn(){if(this.Rn)return null;let e=new ce(Te.comparator),t=[];for(let r of this.An)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new di(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new di(r.field,0))}for(let r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new di(r.field,r.dir==="asc"?0:1)));return new yi(yi.UNKNOWN_ID,this.collectionId,t,Qs.empty())}mn(e){for(let t of this.An)if(this.fn(t,e))return!0;return!1}fn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}gn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};$d=class{constructor(){this.yn=new co}addToCollectionParentIndex(e,t){return this.yn.add(t),S.resolve()}getCollectionParents(e,t){return S.resolve(this.yn.getEntries(t))}addFieldIndex(e,t){return S.resolve()}deleteFieldIndex(e,t){return S.resolve()}deleteAllFieldIndexes(e){return S.resolve()}createTargetIndexes(e,t){return S.resolve()}getDocumentsMatchingTarget(e,t){return S.resolve(null)}getIndexType(e,t){return S.resolve(0)}getFieldIndexes(e,t){return S.resolve([])}getNextCollectionGroupToUpdate(e){return S.resolve(null)}getMinOffset(e,t){return S.resolve(lt.min())}getMinOffsetFromCollectionGroup(e,t){return S.resolve(lt.min())}updateCollectionGroup(e,t,r){return S.resolve()}updateIndexEntries(e,t){return S.resolve()}},co=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ce(se.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ce(se.comparator)).toArray()}};Mv="IndexedDbIndexManager",za=new Uint8Array(0),qd=class{constructor(e,t){this.databaseId=t,this.wn=new co,this.bn=new It(r=>Tr(r),(r,i)=>Eo(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.wn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.wn.add(t)});let s={collectionId:r,parent:qe(i)};return Fv(e).put(s)}return S.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[pI(t),""],!1,!0);return Fv(e).J(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Ot(o.parent))}return r})}addFieldIndex(e,t){let r=Us(e),i=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=ii(e);return s.next(c=>{o.put(Dv(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Us(e),i=ii(e),s=ri(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Us(e),r=ri(e),i=ii(e);return t.X().next(()=>r.X()).next(()=>i.X())}createTargetIndexes(e,t){return S.forEach(this.Sn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new kc(r).pn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=ri(e),i=!0,s=new Map;return S.forEach(this.Sn(t),o=>this.Dn(e,o).next(c=>{i&&(i=!!c),s.set(o,c)})).next(()=>{if(i){let o=Y(),c=[];return S.forEach(s,(u,h)=>{O(Mv,`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(u)} to execute ${Tr(t)}`);let f=function(M,j){let X=td(j);if(X===void 0)return null;for(let G of _c(M,X.fieldPath))switch(G.op){case"array-contains-any":return G.value.arrayValue.values||[];case"array-contains":return[G.value]}return null}(h,u),g=function(M,j){let X=new Map;for(let G of ar(j))for(let w of _c(M,G.fieldPath))switch(w.op){case"==":case"in":X.set(G.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return X.set(G.fieldPath.canonicalString(),w.value),Array.from(X.values())}return null}(h,u),y=function(M,j){let X=[],G=!0;for(let w of ar(j)){let _=w.kind===0?_v(M,w.fieldPath,M.startAt):yv(M,w.fieldPath,M.startAt);X.push(_.value),G&&(G=_.inclusive)}return new Mt(X,G)}(h,u),T=function(M,j){let X=[],G=!0;for(let w of ar(j)){let _=w.kind===0?yv(M,w.fieldPath,M.endAt):_v(M,w.fieldPath,M.endAt);X.push(_.value),G&&(G=_.inclusive)}return new Mt(X,G)}(h,u),D=this.vn(u,h,y),N=this.vn(u,h,T),k=this.Cn(u,h,g),q=this.Fn(u.indexId,f,D,y.inclusive,N,T.inclusive,k);return S.forEach(q,U=>r.Z(U,t.limit).next(M=>{M.forEach(j=>{let X=L.fromSegments(j.documentKey);o.has(X)||(o=o.add(X),c.push(X))})}))}).next(()=>c)}return S.resolve(null)})}Sn(e){let t=this.bn.get(e);return t||(e.filters.length===0?t=[e]:t=DC(oe.create(e.filters,"and")).map(r=>wd(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.bn.set(e,t),t)}Fn(e,t,r,i,s,o,c){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),h=u/(t!=null?t.length:1),f=[];for(let g=0;g<u;++g){let y=t?this.Mn(t[g/h]):za,T=this.xn(e,y,r[g%h],i),D=this.On(e,y,s[g%h],o),N=c.map(k=>this.xn(e,y,k,!0));f.push(...this.createRange(T,D,N))}return f}xn(e,t,r,i){let s=new dr(e,L.empty(),t,r);return i?s:s.In()}On(e,t,r,i){let s=new dr(e,L.empty(),t,r);return i?s.In():s}Dn(e,t){let r=new kc(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let c of s)r.Vn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let r=2,i=this.Sn(t);return S.forEach(i,s=>this.Dn(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let h=new ce(Te.comparator),f=!1;for(let g of u.filters)for(let y of g.getFlattenedFilters())y.field.isKeyField()||(y.op==="array-contains"||y.op==="array-contains-any"?f=!0:h=h.add(y.field));for(let g of u.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}Nn(e,t){let r=new hr;for(let i of ar(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Tn(i.kind);an.Wt.vt(s,o)}return r.cn()}Mn(e){let t=new hr;return an.Wt.vt(e,t.Tn(0)),t.cn()}Bn(e,t){let r=new hr;return an.Wt.vt(wr(this.databaseId,t),r.Tn(function(s){let o=ar(s);return o.length===0?0:o[o.length-1].kind}(e))),r.cn()}Cn(e,t,r){if(r===null)return[];let i=[];i.push(new hr);let s=0;for(let o of ar(e)){let c=r[s++];for(let u of i)if(this.Ln(t,o.fieldPath)&&io(c))i=this.kn(i,o,c);else{let h=u.Tn(o.kind);an.Wt.vt(c,h)}}return this.qn(i)}vn(e,t,r){return this.Cn(e,t,r.position)}qn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].cn();return t}kn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let c of i){let u=new hr;u.seed(c.cn()),an.Wt.vt(o,u.Tn(t.kind)),s.push(u)}return s}Ln(e,t){return!!e.filters.find(r=>r instanceof ee&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Us(e),i=ii(e);return(t?r.J(ad,IDBKeyRange.bound(t,t)):r.J()).next(s=>{let o=[];return S.forEach(s,c=>i.get([c.indexId,this.uid]).next(u=>{o.push(function(f,g){let y=g?new Qs(g.sequenceNumber,new lt(Rr(g.readTime),new L(Ot(g.documentKey)),g.largestBatchId)):Qs.empty(),T=f.fields.map(([D,N])=>new di(Te.fromServerFormat(D),N));return new yi(f.indexId,f.collectionGroup,T,y)}(c,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:H(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Us(e),s=ii(e);return this.Qn(e).next(o=>i.J(ad,IDBKeyRange.bound(t,t)).next(c=>S.forEach(c,u=>s.put(Dv(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return S.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?S.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(c=>(r.set(i.collectionGroup,c),S.forEach(c,u=>this.$n(e,i,u).next(h=>{let f=this.Un(s,u);return h.isEqual(f)?S.resolve():this.Kn(e,s,u,h,f)}))))})}Wn(e,t,r,i){return ri(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Bn(r,t.key),documentKey:t.key.path.toArray()})}Gn(e,t,r,i){return ri(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Bn(r,t.key),t.key.path.toArray()])}$n(e,t,r){let i=ri(e),s=new ce(Pn);return i.te({index:EI,range:IDBKeyRange.only([r.indexId,this.uid,this.Bn(r,t)])},(o,c)=>{s=s.add(new dr(r.indexId,t,c.arrayValue,c.directionalValue))}).next(()=>s)}Un(e,t){let r=new ce(Pn),i=this.Nn(t,e);if(i==null)return r;let s=td(t);if(s!=null){let o=e.data.field(s.fieldPath);if(io(o))for(let c of o.arrayValue.values||[])r=r.add(new dr(t.indexId,e.key,this.Mn(c),i))}else r=r.add(new dr(t.indexId,e.key,za,i));return r}Kn(e,t,r,i,s){O(Mv,"Updating index entries for document '%s'",t.key);let o=[];return function(u,h,f,g,y){let T=u.getIterator(),D=h.getIterator(),N=ti(T),k=ti(D);for(;N||k;){let q=!1,U=!1;if(N&&k){let M=f(N,k);M<0?U=!0:M>0&&(q=!0)}else N!=null?U=!0:q=!0;q?(g(k),k=ti(D)):U?(y(N),N=ti(T)):(N=ti(T),k=ti(D))}}(i,s,Pn,c=>{o.push(this.Wn(e,t,r,c))},c=>{o.push(this.Gn(e,t,r,c))}),S.waitFor(o)}Qn(e){let t=1;return ii(e).te({index:wI,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,c)=>Pn(o,c)).filter((o,c,u)=>!c||Pn(o,u[c-1])!==0);let i=[];i.push(e);for(let o of r){let c=Pn(o,e),u=Pn(o,t);if(c===0)i[0]=e.In();else if(c>0&&u<0)i.push(o),i.push(o.In());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.zn(i[o],i[o+1]))return[];let c=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,za,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,za,[]];s.push(IDBKeyRange.bound(c,u))}return s}zn(e,t){return Pn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Uv)}getMinOffset(e,t){return S.mapArray(this.Sn(t),r=>this.Dn(e,r).next(i=>i||F(44426))).next(Uv)}};Bv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},mw=41943040,Ye=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};Ye.DEFAULT_COLLECTION_PERCENTILE=10,Ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ye.DEFAULT=new Ye(mw,Ye.DEFAULT_COLLECTION_PERCENTILE,Ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ye.DISABLED=new Ye(-1,0,0);Oc=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.jn={}}static bt(e,t,r,i){B(e.uid!=="",64387);let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Cn(e).te({index:fr,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=li(e),o=Cn(e);return o.add({}).next(c=>{B(typeof c=="number",49019);let u=new so(c,t,r,i),h=function(T,D,N){let k=N.baseMutations.map(U=>Rc(T.wt,U)),q=N.mutations.map(U=>Rc(T.wt,U));return{userId:D,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:k,mutations:q}}(this.serializer,this.userId,u),f=[],g=new ce((y,T)=>H(y.canonicalString(),T.canonicalString()));for(let y of i){let T=yI(this.userId,y.key.path,c);g=g.add(y.key.path.popLast()),f.push(o.put(h)),f.push(s.put(T,RP))}return g.forEach(y=>{f.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.jn[c]=u.keys()}),S.waitFor(f).next(()=>u)})}lookupMutationBatch(e,t){return Cn(e).get(t).next(r=>r?(B(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),lr(this.serializer,r)):null)}Hn(e,t){return this.jn[t]?S.resolve(this.jn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.jn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Cn(e).te({index:fr,range:i},(o,c,u)=>{c.userId===this.userId&&(B(c.batchId>=r,47524,{Jn:r}),s=lr(this.serializer,c)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=_r;return Cn(e).te({index:fr,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,_r],[this.userId,Number.POSITIVE_INFINITY]);return Cn(e).J(fr,t).next(r=>r.map(i=>lr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Ka(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return li(e).te({range:i},(o,c,u)=>{let[h,f,g]=o,y=Ot(f);if(h===this.userId&&t.path.isEqual(y))return Cn(e).get(g).next(T=>{if(!T)throw F(61480,{Yn:o,batchId:g});B(T.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:T.userId,batchId:g}),s.push(lr(this.serializer,T))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ce(H),i=[];return t.forEach(s=>{let o=Ka(this.userId,s.path),c=IDBKeyRange.lowerBound(o),u=li(e).te({range:c},(h,f,g)=>{let[y,T,D]=h,N=Ot(T);y===this.userId&&s.path.isEqual(N)?r=r.add(D):g.done()});i.push(u)}),S.waitFor(i).next(()=>this.Zn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Ka(this.userId,r),o=IDBKeyRange.lowerBound(s),c=new ce(H);return li(e).te({range:o},(u,h,f)=>{let[g,y,T]=u,D=Ot(y);g===this.userId&&r.isPrefixOf(D)?D.length===i&&(c=c.add(T)):f.done()}).next(()=>this.Zn(e,c))}Zn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Cn(e).get(s).next(o=>{if(o===null)throw F(35274,{batchId:s});B(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),r.push(lr(this.serializer,o))}))}),S.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return gw(e.he,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Xn(t.batchId)}),S.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Xn(e){delete this.jn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return S.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return li(e).te({range:r},(s,o,c)=>{if(s[0]===this.userId){let u=Ot(s[1]);i.push(u)}else c.done()}).next(()=>{B(i.length===0,56720,{er:i.map(s=>s.canonicalString())})})})}containsKey(e,t){return _w(e,this.userId,t)}tr(e){return yw(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:_r,lastStreamToken:""})}};Oi=class n{constructor(e){this.nr=e}next(){return this.nr+=2,this.nr}static rr(){return new n(0)}static ir(){return new n(-1)}};jd=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.sr(e).next(t=>{let r=new Oi(t.highestTargetId);return t.highestTargetId=r.next(),this._r(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.sr(e).next(t=>z.fromTimestamp(new J(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.sr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.sr(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this._r(e,i)))}addTargetData(e,t){return this.ar(e,t).next(()=>this.sr(e).next(r=>(r.targetCount+=1,this.ur(t,r),this._r(e,r))))}updateTargetData(e,t){return this.ar(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>si(e).delete(t.targetId)).next(()=>this.sr(e)).next(r=>(B(r.targetCount>0,8065),r.targetCount-=1,this._r(e,r)))}removeTargets(e,t,r){let i=0,s=[];return si(e).te((o,c)=>{let u=js(c);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>S.waitFor(s)).next(()=>i)}forEachTarget(e,t){return si(e).te((r,i)=>{let s=js(i);t(s)})}sr(e){return $v(e).get(uc).next(t=>(B(t!==null,2888),t))}_r(e,t){return $v(e).put(uc,t)}ar(e,t){return si(e).put(hw(this.serializer,t))}ur(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.sr(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Tr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return si(e).te({range:i,index:II},(o,c,u)=>{let h=js(c);Eo(t,h.target)&&(s=h,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Dn(e);return t.forEach(o=>{let c=qe(o.path);i.push(s.put({targetId:r,path:c})),i.push(this.referenceDelegate.addReference(e,r,o))}),S.waitFor(i)}removeMatchingKeys(e,t,r){let i=Dn(e);return S.forEach(t,s=>{let o=qe(s.path);return S.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Dn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Dn(e),s=Y();return i.te({range:r,ee:!0},(o,c,u)=>{let h=Ot(o[1]),f=new L(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){let r=qe(t.path),i=IDBKeyRange.bound([r],[pI(r)],!1,!0),s=0;return Dn(e).te({index:Kf,ee:!0,range:i},([o,c],u,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}Rt(e,t){return si(e).get(t).next(r=>r?js(r):null)}};qv="LruGarbageCollector",vw=1048576;zd=class{constructor(e){this.cr=e,this.buffer=new ce(jv),this.lr=0}hr(){return++this.lr}Pr(e){let t=[e,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();jv(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},xc=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Tr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return this.Tr!==null}Ir(e){O(qv,`Garbage collection scheduled in ${e}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>p(this,null,function*(){this.Tr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){qn(t)?O(qv,"Ignoring IndexedDB error during garbage collection: ",t):yield Cr(t)}yield this.Ir(3e5)}))}},Wd=class{constructor(e,t){this.Er=e,this.params=t}calculateTargetCount(e,t){return this.Er.dr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return S.resolve(vt.le);let r=new zd(t);return this.Er.forEachTarget(e,i=>r.Pr(i.sequenceNumber)).next(()=>this.Er.Ar(e,i=>r.Pr(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Er.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Er.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Bv)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bv):this.Rr(e,t))}getCacheSize(e){return this.Er.getCacheSize(e)}Rr(e,t){let r,i,s,o,c,u,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,o=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(r=g,c=Date.now(),this.removeTargets(e,r,t))).next(g=>(s=g,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(g=>(h=Date.now(),oi()<=Z.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(c-o)+`ms
	Removed ${s} targets in `+(u-c)+`ms
	Removed ${g} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};Gd=class{constructor(e,t){this.db=e,this.garbageCollector=Iw(this,t)}dr(e){let t=this.Vr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Vr(e){let t=0;return this.Ar(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ar(e,t){return this.mr(e,(r,i)=>t(i))}addReference(e,t,r){return Wa(e,r)}removeReference(e,t,r){return Wa(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Wa(e,t)}gr(e,t){return function(i,s){let o=!1;return yw(i).ne(c=>_w(i,c,s).next(u=>(u&&(o=!0),S.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.mr(e,(o,c)=>{if(c<=t){let u=this.gr(e,o).next(h=>{if(!h)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,z.min()),Dn(e).delete(function(g){return[0,qe(g.path)]}(o))))});i.push(u)}}).next(()=>S.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Wa(e,t)}mr(e,t){let r=Dn(e),i,s=vt.le;return r.te({index:Kf},([o,c],{path:u,sequenceNumber:h})=>{o===0?(s!==vt.le&&t(new L(Ot(i)),s),s=h,i=u):s=vt.le}).next(()=>{s!==vt.le&&t(new L(Ot(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};Vc=class{constructor(){this.changes=new It(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?S.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};Hd=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return or(e).put(r)}removeEntry(e,t,r){return or(e).delete(function(s,o){let c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Pc(o),c[c.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.pr(e,r)))}getEntry(e,t){let r=xe.newInvalidDocument(t);return or(e).te({index:Qa,range:IDBKeyRange.only(Bs(t))},(i,s)=>{r=this.yr(t,s)}).next(()=>r)}wr(e,t){let r={size:0,document:xe.newInvalidDocument(t)};return or(e).te({index:Qa,range:IDBKeyRange.only(Bs(t))},(i,s)=>{r={document:this.yr(t,s),size:Nc(s)}}).next(()=>r)}getEntries(e,t){let r=rt();return this.br(e,t,(i,s)=>{let o=this.yr(i,s);r=r.insert(i,o)}).next(()=>r)}Sr(e,t){let r=rt(),i=new pe(L.comparator);return this.br(e,t,(s,o)=>{let c=this.yr(s,o);r=r.insert(s,c),i=i.insert(s,Nc(o))}).next(()=>({documents:r,Dr:i}))}br(e,t,r){if(t.isEmpty())return S.resolve();let i=new ce(Gv);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(Bs(i.first()),Bs(i.last())),o=i.getIterator(),c=o.getNext();return or(e).te({index:Qa,range:s},(u,h,f)=>{let g=L.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;c&&Gv(c,g)<0;)r(c,null),c=o.getNext();c&&c.isEqual(g)&&(r(c,h),c=o.hasNext()?o.getNext():null),c?f.H(Bs(c)):f.done()}).next(()=>{for(;c;)r(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,c=[o.popLast().toArray(),o.lastSegment(),Pc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return or(e).J(IDBKeyRange.bound(c,u,!0)).next(h=>{s==null||s.incrementDocumentReadCount(h.length);let f=rt();for(let g of h){let y=this.yr(L.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);y.isFoundDocument()&&(Ao(t,y)||i.has(y.key))&&(f=f.insert(y.key,y))}return f})}getAllFromCollectionGroup(e,t,r,i){let s=rt(),o=Wv(t,r),c=Wv(t,lt.max());return or(e).te({index:vI,range:IDBKeyRange.bound(o,c,!0)},(u,h,f)=>{let g=this.yr(L.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Kd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return zv(e).get(od).next(t=>(B(!!t,20021),t))}pr(e,t){return zv(e).put(od,t)}yr(e,t){if(t){let r=CC(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(z.min())))return r}return xe.newInvalidDocument(e)}};Kd=class extends Vc{constructor(e,t){super(),this.vr=e,this.trackRemovals=t,this.Cr=new It(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new ce((s,o)=>H(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let c=this.Cr.get(s);if(t.push(this.vr.removeEntry(e,s,c.readTime)),o.isValidDocument()){let u=Cv(this.vr.serializer,o);i=i.add(s.path.popLast());let h=Nc(u);r+=h-c.size,t.push(this.vr.addEntry(e,s,u))}else if(r-=c.size,this.trackRemovals){let u=Cv(this.vr.serializer,o.convertToNoDocument(z.min()));t.push(this.vr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.vr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.vr.updateMetadata(e,r)),S.waitFor(t)}getFromCache(e,t){return this.vr.wr(e,t).next(r=>(this.Cr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.vr.Sr(e,t).next(({documents:r,Dr:i})=>(i.forEach((s,o)=>{this.Cr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};Qd=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};Lc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Hs(r.mutation,i,nt.empty(),J.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Y()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Y()){let i=xt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=qs();return s.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=xt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Y()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,r,i){let s=rt(),o=Gs(),c=function(){return Gs()}();return t.forEach((u,h)=>{let f=r.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof wt)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Hs(f.mutation,h,f.mutation.getFieldMask(),J.now())):o.set(h.key,nt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var g;return c.set(h,new Qd(f,(g=o.get(h))!==null&&g!==void 0?g:null))}),c))}recalculateAndSaveOverlays(e,t){let r=Gs(),i=new pe((o,c)=>o-c),s=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let c of o)c.keys().forEach(u=>{let h=t.get(u);if(h===null)return;let f=r.get(u)||nt.empty();f=c.applyToLocalView(h,f),r.set(u,f);let g=(i.get(c.batchId)||Y()).add(u);i=i.insert(c.batchId,g)})}).next(()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),h=u.key,f=u.value,g=WI();f.forEach(y=>{if(!s.has(y)){let T=JI(t.get(y),r.get(y));T!==null&&g.set(y,T),s=s.add(y)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,g))}return S.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return L.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):tp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):S.resolve(xt()),c=Ks,u=s;return o.next(h=>S.forEach(h,(f,g)=>(c<g.largestBatchId&&(c=g.largestBatchId),s.get(f)?S.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{u=u.insert(f,y)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,u,h,Y())).next(f=>({batchId:c,changes:zI(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(r=>{let i=qs();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=qs();return this.indexManager.getCollectionParents(e,s).next(c=>S.forEach(c,u=>{let h=function(g,y){return new Ft(y,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next(f=>{f.forEach((g,y)=>{o=o.insert(g,y)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,xe.newInvalidDocument(f)))});let c=qs();return o.forEach((u,h)=>{let f=s.get(u);f!==void 0&&Hs(f.mutation,h,nt.empty(),J.now()),Ao(t,h)&&(c=c.insert(u,h))}),c})}};Yd=class{constructor(e){this.serializer=e,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(e,t){return S.resolve(this.Fr.get(t))}saveBundleMetadata(e,t){return this.Fr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Qe(i.createTime)}}(t)),S.resolve()}getNamedQuery(e,t){return S.resolve(this.Mr.get(t))}saveNamedQuery(e,t){return this.Mr.set(t.name,function(i){return{name:i.name,query:dw(i.bundledQuery),readTime:Qe(i.readTime)}}(t)),S.resolve()}};Jd=class{constructor(){this.overlays=new pe(L.comparator),this.Or=new Map}getOverlay(e,t){return S.resolve(this.overlays.get(t))}getOverlays(e,t){let r=xt();return S.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.St(e,t,s)}),S.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Or.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Or.delete(r)),S.resolve()}getOverlaysForCollection(e,t,r){let i=xt(),s=t.length+1,o=new L(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return S.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new pe((h,f)=>h-f),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let f=s.get(h.largestBatchId);f===null&&(f=xt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let c=xt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,f)=>c.set(h,f)),!(c.size()>=i)););return S.resolve(c)}St(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Or.get(i.largestBatchId).delete(r.key);this.Or.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new oo(t,r));let s=this.Or.get(t);s===void 0&&(s=Y(),this.Or.set(t,s)),this.Or.set(t,s.add(r.key))}};Xd=class{constructor(){this.sessionToken=Ae.EMPTY_BYTE_STRING}getSessionToken(e){return S.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,S.resolve()}};uo=class{constructor(){this.Nr=new ce(we.Br),this.Lr=new ce(we.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(e,t){let r=new we(e,t);this.Nr=this.Nr.add(r),this.Lr=this.Lr.add(r)}qr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Qr(new we(e,t))}$r(e,t){e.forEach(r=>this.removeReference(r,t))}Ur(e){let t=new L(new se([])),r=new we(t,e),i=new we(t,e+1),s=[];return this.Lr.forEachInRange([r,i],o=>{this.Qr(o),s.push(o.key)}),s}Kr(){this.Nr.forEach(e=>this.Qr(e))}Qr(e){this.Nr=this.Nr.delete(e),this.Lr=this.Lr.delete(e)}Wr(e){let t=new L(new se([])),r=new we(t,e),i=new we(t,e+1),s=Y();return this.Lr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new we(e,0),r=this.Nr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},we=class{constructor(e,t){this.key=e,this.Gr=t}static Br(e,t){return L.comparator(e.key,t.key)||H(e.Gr,t.Gr)}static kr(e,t){return H(e.Gr,t.Gr)||L.comparator(e.key,t.key)}};Zd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Jn=1,this.zr=new ce(we.Br)}checkEmpty(e){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new so(s,t,r,i);this.mutationQueue.push(o);for(let c of i)this.zr=this.zr.add(new we(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return S.resolve(o)}lookupMutationBatch(e,t){return S.resolve(this.jr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Hr(r),s=i<0?0:i;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?_r:this.Jn-1)}getAllMutationBatches(e){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new we(t,0),i=new we(t,Number.POSITIVE_INFINITY),s=[];return this.zr.forEachInRange([r,i],o=>{let c=this.jr(o.Gr);s.push(c)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ce(H);return t.forEach(i=>{let s=new we(i,0),o=new we(i,Number.POSITIVE_INFINITY);this.zr.forEachInRange([s,o],c=>{r=r.add(c.Gr)})}),S.resolve(this.Jr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;L.isDocumentKey(s)||(s=s.child(""));let o=new we(new L(s),0),c=new ce(H);return this.zr.forEachWhile(u=>{let h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(c=c.add(u.Gr)),!0)},o),S.resolve(this.Jr(c))}Jr(e){let t=[];return e.forEach(r=>{let i=this.jr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){B(this.Yr(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.zr;return S.forEach(t.mutations,i=>{let s=new we(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.zr=r})}Xn(e){}containsKey(e,t){let r=new we(t,0),i=this.zr.firstAfterOrEqual(r);return S.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,S.resolve()}Yr(e,t){return this.Hr(e)}Hr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}jr(e){let t=this.Hr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};ef=class{constructor(e){this.Zr=e,this.docs=function(){return new pe(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Zr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return S.resolve(r?r.document.mutableCopy():xe.newInvalidDocument(t))}getEntries(e,t){let r=rt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():xe.newInvalidDocument(i))}),S.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=rt(),o=t.path,c=new L(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:h,value:{document:f}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Gf(mI(f),r)<=0||(i.has(f.key)||Ao(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(e,t,r,i){F(9500)}Xr(e,t){return S.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new tf(this)}getSize(e){return S.resolve(this.size)}},tf=class extends Vc{constructor(e){super(),this.vr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.vr.addEntry(e,i)):this.vr.removeEntry(r)}),S.waitFor(t)}getFromCache(e,t){return this.vr.getEntry(e,t)}getAllFromCache(e,t){return this.vr.getEntries(e,t)}};nf=class{constructor(e){this.persistence=e,this.ei=new It(t=>Tr(t),Eo),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.ti=0,this.ni=new uo,this.targetCount=0,this.ri=Oi.rr()}forEachTarget(e,t){return this.ei.forEach((r,i)=>t(i)),S.resolve()}getLastRemoteSnapshotVersion(e){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return S.resolve(this.ti)}allocateTargetId(e){return this.highestTargetId=this.ri.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ti&&(this.ti=t),S.resolve()}ar(e){this.ei.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ri=new Oi(t),this.highestTargetId=t),e.sequenceNumber>this.ti&&(this.ti=e.sequenceNumber)}addTargetData(e,t){return this.ar(t),this.targetCount+=1,S.resolve()}updateTargetData(e,t){return this.ar(t),S.resolve()}removeTargetData(e,t){return this.ei.delete(t.target),this.ni.Ur(t.targetId),this.targetCount-=1,S.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ei.forEach((o,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.ei.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),S.waitFor(s).next(()=>i)}getTargetCount(e){return S.resolve(this.targetCount)}getTargetData(e,t){let r=this.ei.get(t)||null;return S.resolve(r)}addMatchingKeys(e,t,r){return this.ni.qr(t,r),S.resolve()}removeMatchingKeys(e,t,r){this.ni.$r(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),S.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.ni.Ur(t),S.resolve()}getMatchingKeysForTargetId(e,t){let r=this.ni.Wr(t);return S.resolve(r)}containsKey(e,t){return S.resolve(this.ni.containsKey(t))}};lo=class{constructor(e,t){this.ii={},this.overlays={},this.si=new vt(0),this.oi=!1,this.oi=!0,this._i=new Xd,this.referenceDelegate=e(this),this.ai=new nf(this),this.indexManager=new $d,this.remoteDocumentCache=function(i){return new ef(i)}(r=>this.referenceDelegate.ui(r)),this.serializer=new Sc(t),this.ci=new Yd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Jd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ii[e.toKey()];return r||(r=new Zd(t,this.referenceDelegate),this.ii[e.toKey()]=r),r}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);let i=new rf(this.si.next());return this.referenceDelegate.li(),r(i).next(s=>this.referenceDelegate.hi(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Pi(e,t){return S.or(Object.values(this.ii).map(r=>()=>r.containsKey(e,t)))}},rf=class extends sc{constructor(e){super(),this.currentSequenceNumber=e}},Mc=class n{constructor(e){this.persistence=e,this.Ti=new uo,this.Ii=null}static Ei(e){return new n(e)}get di(){if(this.Ii)return this.Ii;throw F(60996)}addReference(e,t,r){return this.Ti.addReference(r,t),this.di.delete(r.toString()),S.resolve()}removeReference(e,t,r){return this.Ti.removeReference(r,t),this.di.add(r.toString()),S.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),S.resolve()}removeTarget(e,t){this.Ti.Ur(t.targetId).forEach(i=>this.di.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.di.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}li(){this.Ii=new Set}hi(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.di,r=>{let i=L.fromPath(r);return this.Ai(e,i).next(s=>{s||t.removeEntry(i,z.min())})}).next(()=>(this.Ii=null,t.apply(e)))}updateLimboDocument(e,t){return this.Ai(e,t).next(r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())})}ui(e){return 0}Ai(e,t){return S.or([()=>S.resolve(this.Ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Pi(e,t)])}},Fc=class n{constructor(e,t){this.persistence=e,this.Ri=new It(r=>qe(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=Iw(this,t)}static Ei(e,t){return new n(e,t)}li(){}hi(e){return S.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.Vr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Vr(e){let t=0;return this.Ar(e,r=>{t++}).next(()=>t)}Ar(e,t){return S.forEach(this.Ri,(r,i)=>this.gr(e,r,i).next(s=>s?S.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.Xr(e,o=>this.gr(e,o,t).next(c=>{c||(r++,s.removeEntry(o,z.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.Ri.set(t,e.currentSequenceNumber),S.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.Ri.set(r,e.currentSequenceNumber),S.resolve()}removeReference(e,t,r){return this.Ri.set(r,e.currentSequenceNumber),S.resolve()}updateLimboDocument(e,t){return this.Ri.set(t,e.currentSequenceNumber),S.resolve()}ui(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ja(e.data.value)),t}gr(e,t,r){return S.or([()=>this.persistence.Pi(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.Ri.get(t);return S.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};sf=class{constructor(e){this.serializer=e}q(e,t,r,i){let s=new oc("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore(wo)}(e),function(u){u.createObjectStore(Js,{keyPath:bP}),u.createObjectStore(yt,{keyPath:ov,autoIncrement:!0}).createIndex(fr,av,{unique:!0}),u.createObjectStore(Ii)}(e),Hv(e),function(u){u.createObjectStore(cr)}(e));let o=S.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore(Ei),u.deleteObjectStore(wi),u.deleteObjectStore(yr)}(e),Hv(e)),o=o.next(()=>function(u){let h=u.store(yr),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return h.put(uc,f)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,h){return h.store(yt).J().next(g=>{u.deleteObjectStore(yt),u.createObjectStore(yt,{keyPath:ov,autoIncrement:!0}).createIndex(fr,av,{unique:!0});let y=h.store(yt),T=g.map(D=>y.put(D));return S.waitFor(T)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore(Ti,{keyPath:xP})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Vi(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore(Xs)}(e),this.mi(s)))),r<7&&i>=7&&(o=o.next(()=>this.fi(s))),r<8&&i>=8&&(o=o.next(()=>this.gi(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.pi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore(au,{keyPath:VP})})(e),function(u){u.createObjectStore(cu,{keyPath:LP})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let h=u.createObjectStore(uu,{keyPath:jP});h.createIndex(cd,zP,{unique:!1}),h.createIndex(TI,WP,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let h=u.createObjectStore(cc,{keyPath:SP});h.createIndex(Qa,PP),h.createIndex(vI,CP)}(e)).next(()=>this.yi(e,s)).next(()=>e.deleteObjectStore(cr))),r<14&&i>=14&&(o=o.next(()=>this.wi(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore(Qf,{keyPath:MP,autoIncrement:!0}).createIndex(ad,FP,{unique:!1}),u.createObjectStore(lc,{keyPath:UP}).createIndex(wI,BP,{unique:!1}),u.createObjectStore(hc,{keyPath:$P}).createIndex(EI,qP,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(lc).clear()}).next(()=>{t.objectStore(hc).clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore(Yf,{keyPath:GP})})(e)})),o}mi(e){let t=0;return e.store(cr).te((r,i)=>{t+=Nc(i)}).next(()=>{let r={byteSize:t};return e.store(Xs).put(od,r)})}Vi(e){let t=e.store(Js),r=e.store(yt);return t.J().next(i=>S.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,_r],[s.userId,s.lastAcknowledgedBatchId]);return r.J(fr,o).next(c=>S.forEach(c,u=>{B(u.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});let h=lr(this.serializer,u);return gw(e,s.userId,h).next(()=>{})}))}))}fi(e){let t=e.store(Ei),r=e.store(cr);return e.store(yr).get(uc).next(i=>{let s=[];return r.te((o,c)=>{let u=new se(o),h=function(g){return[0,qe(g)]}(u);s.push(t.get(h).next(f=>f?S.resolve():(g=>t.put({targetId:0,path:qe(g),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>S.waitFor(s))})}gi(e,t){e.createObjectStore(Zs,{keyPath:OP});let r=t.store(Zs),i=new co,s=o=>{if(i.add(o)){let c=o.lastSegment(),u=o.popLast();return r.put({collectionId:c,parent:qe(u)})}};return t.store(cr).te({ee:!0},(o,c)=>{let u=new se(o);return s(u.popLast())}).next(()=>t.store(Ii).te({ee:!0},([o,c,u],h)=>{let f=Ot(c);return s(f.popLast())}))}pi(e){let t=e.store(wi);return t.te((r,i)=>{let s=js(i),o=hw(this.serializer,s);return t.put(o)})}yi(e,t){let r=t.store(cr),i=[];return r.te((s,o)=>{let c=t.store(cc),u=function(g){return g.document?new L(se.fromString(g.document.name).popFirst(5)):g.noDocument?L.fromSegments(g.noDocument.path):g.unknownDocument?L.fromSegments(g.unknownDocument.path):F(36783)}(o).path.toArray(),h={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(c.put(h))}).next(()=>S.waitFor(i))}wi(e,t){let r=t.store(yt),i=ww(this.serializer),s=new lo(Mc.Ei,this.serializer.wt);return r.J().next(o=>{let c=new Map;return o.forEach(u=>{var h;let f=(h=c.get(u.userId))!==null&&h!==void 0?h:Y();lr(this.serializer,u).keys().forEach(g=>f=f.add(g)),c.set(u.userId,f)}),S.forEach(c,(u,h)=>{let f=new Ee(h),g=Cc.bt(this.serializer,f),y=s.getIndexManager(f),T=Oc.bt(f,this.serializer,y,s.referenceDelegate);return new Lc(i,T,g,y).recalculateAndSaveOverlaysForDocumentKeys(new eo(t,vt.le),u).next()})})}};kn="IndexedDbPersistence",jh=18e5,zh=5e3,Wh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",NC="main",of=class n{constructor(e,t,r,i,s,o,c,u,h,f,g=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.bi=s,this.window=o,this.document=c,this.Si=h,this.Di=f,this.Ci=g,this.si=null,this.oi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fi=null,this.inForeground=!1,this.Mi=null,this.xi=null,this.Oi=Number.NEGATIVE_INFINITY,this.Ni=y=>Promise.resolve(),!n.C())throw new x(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Gd(this,i),this.Bi=t+NC,this.serializer=new Sc(u),this.Li=new vi(this.Bi,this.Ci,new sf(this.serializer)),this._i=new xd,this.ai=new jd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=ww(this.serializer),this.ci=new Od,this.window&&this.window.localStorage?this.ki=this.window.localStorage:(this.ki=null,f===!1&&He(kn,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.qi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(C.FAILED_PRECONDITION,Wh);return this.Qi(),this.$i(),this.Ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ai.getHighestSequenceNumber(e))}).then(e=>{this.si=new vt(e,this.Si)}).then(()=>{this.oi=!0}).catch(e=>(this.Li&&this.Li.close(),Promise.reject(e)))}Ki(e){return this.Ni=t=>p(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Li.U(t=>p(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.bi.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.qi())})))}qi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ga(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Wi(e).next(t=>{t||(this.isPrimary=!1,this.bi.enqueueRetryable(()=>this.Ni(!1)))})}).next(()=>this.Gi(e)).next(t=>this.isPrimary&&!t?this.zi(e).next(()=>!1):!!t&&this.ji(e).next(()=>!0))).catch(e=>{if(qn(e))return O(kn,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return O(kn,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.bi.enqueueRetryable(()=>this.Ni(e)),this.isPrimary=e})}Wi(e){return $s(e).get(ei).next(t=>S.resolve(this.Hi(t)))}Ji(e){return Ga(e).delete(this.clientId)}Yi(){return p(this,null,function*(){if(this.isPrimary&&!this.Zi(this.Oi,jh)){this.Oi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=be(t,Ti);return r.J().next(i=>{let s=this.Xi(i,jh),o=i.filter(c=>s.indexOf(c)===-1);return S.forEach(o,c=>r.delete(c.clientId)).next(()=>o)})}).catch(()=>[]);if(this.ki)for(let t of e)this.ki.removeItem(this.es(t.clientId))}})}Ui(){this.xi=this.bi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.qi().then(()=>this.Yi()).then(()=>this.Ui()))}Hi(e){return!!e&&e.ownerId===this.clientId}Gi(e){return this.Di?S.resolve(!0):$s(e).get(ei).next(t=>{if(t!==null&&this.Zi(t.leaseTimestampMs,zh)&&!this.ts(t.ownerId)){if(this.Hi(t)&&this.networkEnabled)return!0;if(!this.Hi(t)){if(!t.allowTabSynchronization)throw new x(C.FAILED_PRECONDITION,Wh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ga(e).J().next(r=>this.Xi(r,zh).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,c=this.networkEnabled===i.networkEnabled;if(s||o&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&O(kn,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return p(this,null,function*(){this.oi=!1,this.ns(),this.xi&&(this.xi.cancel(),this.xi=null),this.rs(),this.ss(),yield this.Li.runTransaction("shutdown","readwrite",[wo,Ti],e=>{let t=new eo(e,vt.le);return this.zi(t).next(()=>this.Ji(t))}),this.Li.close(),this._s()})}Xi(e,t){return e.filter(r=>this.Zi(r.updateTimeMs,t)&&!this.ts(r.clientId))}us(){return this.runTransaction("getActiveClients","readonly",e=>Ga(e).J().next(t=>this.Xi(t,jh).map(r=>r.clientId)))}get started(){return this.oi}getGlobalsCache(){return this._i}getMutationQueue(e,t){return Oc.bt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new qd(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return Cc.bt(this.serializer,e)}getBundleCache(){return this.ci}runTransaction(e,t,r){O(kn,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===17?QP:u===16?KP:u===15?Jf:u===14?RI:u===13?bI:u===12?HP:u===11?AI:void F(60245)}(this.Ci),o;return this.Li.runTransaction(e,i,s,c=>(o=new eo(c,this.si?this.si.next():vt.le),t==="readwrite-primary"?this.Wi(o).next(u=>!!u||this.Gi(o)).next(u=>{if(!u)throw He(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.bi.enqueueRetryable(()=>this.Ni(!1)),new x(C.FAILED_PRECONDITION,gI);return r(o)}).next(u=>this.ji(o).next(()=>u)):this.cs(o).next(()=>r(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}cs(e){return $s(e).get(ei).next(t=>{if(t!==null&&this.Zi(t.leaseTimestampMs,zh)&&!this.ts(t.ownerId)&&!this.Hi(t)&&!(this.Di||this.allowTabSynchronization&&t.allowTabSynchronization))throw new x(C.FAILED_PRECONDITION,Wh)})}ji(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return $s(e).put(ei,t)}static C(){return vi.C()}zi(e){let t=$s(e);return t.get(ei).next(r=>this.Hi(r)?(O(kn,"Releasing primary lease."),t.delete(ei)):S.resolve())}Zi(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(He(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Qi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Mi=()=>{this.bi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.qi()))},this.document.addEventListener("visibilitychange",this.Mi),this.inForeground=this.document.visibilityState==="visible")}rs(){this.Mi&&(this.document.removeEventListener("visibilitychange",this.Mi),this.Mi=null)}$i(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Fi=()=>{this.ns();let t=/(?:Version|Mobile)\/1[456]/;Il()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.bi.enterRestrictedMode(!0),this.bi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Fi))}ss(){this.Fi&&(this.window.removeEventListener("pagehide",this.Fi),this.Fi=null)}ts(e){var t;try{let r=((t=this.ki)===null||t===void 0?void 0:t.getItem(this.es(e)))!==null;return O(kn,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return He(kn,"Failed to get zombied client id.",r),!1}}ns(){if(this.ki)try{this.ki.setItem(this.es(this.clientId),String(Date.now()))}catch(e){He("Failed to set zombie client id.",e)}}_s(){if(this.ki)try{this.ki.removeItem(this.es(this.clientId))}catch{}}es(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};af=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ls=r,this.hs=i}static Ps(e,t){let r=Y(),i=Y();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};cf=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};Uc=class{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=function(){return Il()?8:_I(_e())>0?6:4}()}initialize(e,t){this.As=e,this.indexManager=t,this.Ts=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Rs(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Vs(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new cf;return this.fs(e,t,o).next(c=>{if(s.result=c,this.Is)return this.gs(e,t,o,c.size)})}).next(()=>s.result)}gs(e,t,r,i){return r.documentReadCount<this.Es?(oi()<=Z.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",ai(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),S.resolve()):(oi()<=Z.DEBUG&&O("QueryEngine","Query:",ai(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ds*i?(oi()<=Z.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",ai(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ut(t))):S.resolve())}Rs(e,t){if(vv(t))return S.resolve(null);let r=ut(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=yc(t,null,"F"),r=ut(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Y(...s);return this.As.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,r).next(u=>{let h=this.ps(t,c);return this.ys(t,h,o,u.readTime)?this.Rs(e,yc(t,null,"F")):this.ws(e,h,t,u)}))})))}Vs(e,t,r,i){return vv(t)||i.isEqual(z.min())?S.resolve(null):this.As.getDocuments(e,r).next(s=>{let o=this.ps(t,s);return this.ys(t,o,r,i)?S.resolve(null):(oi()<=Z.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ai(t)),this.ws(e,o,t,EP(i,Ks)).next(c=>c))})}ps(e,t){let r=new ce(qI(e));return t.forEach((i,s)=>{Ao(e,s)&&(r=r.add(s))}),r}ys(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}fs(e,t,r){return oi()<=Z.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",ai(t)),this.As.getDocumentsMatchingQuery(e,t,lt.min(),r)}ws(e,t,r,i){return this.As.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};sp="LocalStore",xC=3e8,uf=class{constructor(e,t,r,i){this.persistence=e,this.bs=t,this.serializer=i,this.Ss=new pe(H),this.Ds=new It(s=>Tr(s),Eo),this.vs=new Map,this.Cs=e.getRemoteDocumentCache(),this.ai=e.getTargetCache(),this.ci=e.getBundleCache(),this.Fs(r)}Fs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Lc(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ss))}};Bc=class{constructor(){this.activeTargetIds=cC()}$s(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Qs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},$c=class{constructor(){this.So=new Bc,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.So.$s(e),this.Do[e]||"not-current"}updateQueryState(e,t,r){this.Do[e]=t}removeLocalQueryTarget(e){this.So.Us(e)}isLocalQueryTarget(e){return this.So.activeTargetIds.has(e)}clearQueryState(e){delete this.Do[e]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(e){return this.So.activeTargetIds.has(e)}start(){return this.So=new Bc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};hf=class{vo(e){}shutdown(){}};Qv="ConnectivityMonitor",qc=class{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(e){this.Oo.push(e)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){O(Qv,"Network connectivity changed: AVAILABLE");for(let e of this.Oo)e(0)}xo(){O(Qv,"Network connectivity changed: UNAVAILABLE");for(let e of this.Oo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};Ha=null;Gh="RestConnection",$C={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},ff=class{get Bo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Lo=t+"://"+e.host,this.ko=`projects/${r}/databases/${i}`,this.qo=this.databaseId.database===no?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Qo(e,t,r,i,s){let o=df(),c=this.$o(e,t.toUriEncodedString());O(Gh,`Sending RPC '${e}' ${o}:`,c,r);let u={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};return this.Uo(u,i,s),this.Ko(e,c,u,r).then(h=>(O(Gh,`Received RPC '${e}' ${o}: `,h),h),h=>{throw gi(Gh,`RPC '${e}' ${o} failed with error: `,h,"url: ",c,"request:",r),h})}Wo(e,t,r,i,s,o){return this.Qo(e,t,r,i,s)}Uo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ui}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}$o(e,t){let r=$C[e];return`${this.Lo}/v1/${t}:${r}`}terminate(){}};pf=class{constructor(e){this.Go=e.Go,this.zo=e.zo}jo(e){this.Ho=e}Jo(e){this.Yo=e}Zo(e){this.Xo=e}onMessage(e){this.e_=e}close(){this.zo()}send(e){this.Go(e)}t_(){this.Ho()}n_(){this.Yo()}r_(e){this.Xo(e)}i_(e){this.e_(e)}};$e="WebChannelConnection",mf=class extends ff{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ko(e,t,r,i){let s=df();return new Promise((o,c)=>{let u=new Mh;u.setWithCredentials(!0),u.listenOnce(Fh.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Ms.NO_ERROR:let f=u.getResponseJson();O($e,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),o(f);break;case Ms.TIMEOUT:O($e,`RPC '${e}' ${s} timed out`),c(new x(C.DEADLINE_EXCEEDED,"Request time out"));break;case Ms.HTTP_ERROR:let g=u.getStatus();if(O($e,`RPC '${e}' ${s} failed with status:`,g,"response text:",u.getResponseText()),g>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);let T=y==null?void 0:y.error;if(T&&T.status&&T.message){let D=function(k){let q=k.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(q)>=0?q:C.UNKNOWN}(T.status);c(new x(D,T.message))}else c(new x(C.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new x(C.UNAVAILABLE,"Connection failed."));break;default:F(9055,{s_:e,streamId:s,o_:u.getLastErrorCode(),__:u.getLastError()})}}finally{O($e,`RPC '${e}' ${s} completed.`)}});let h=JSON.stringify(i);O($e,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",h,r,15)})}a_(e,t,r){let i=df(),s=[this.Lo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=$h(),c=Bh(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Uo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let f=s.join("");O($e,`Creating RPC '${e}' stream ${i}: ${f}`,u);let g=o.createWebChannel(f,u),y=!1,T=!1,D=new pf({Go:k=>{T?O($e,`Not sending because RPC '${e}' stream ${i} is closed:`,k):(y||(O($e,`Opening RPC '${e}' stream ${i} transport.`),g.open(),y=!0),O($e,`RPC '${e}' stream ${i} sending:`,k),g.send(k))},zo:()=>g.close()}),N=(k,q,U)=>{k.listen(q,M=>{try{U(M)}catch(j){setTimeout(()=>{throw j},0)}})};return N(g,Zr.EventType.OPEN,()=>{T||(O($e,`RPC '${e}' stream ${i} transport opened.`),D.t_())}),N(g,Zr.EventType.CLOSE,()=>{T||(T=!0,O($e,`RPC '${e}' stream ${i} transport closed`),D.r_())}),N(g,Zr.EventType.ERROR,k=>{T||(T=!0,gi($e,`RPC '${e}' stream ${i} transport errored. Name:`,k.name,"Message:",k.message),D.r_(new x(C.UNAVAILABLE,"The operation could not be completed")))}),N(g,Zr.EventType.MESSAGE,k=>{var q;if(!T){let U=k.data[0];B(!!U,16349);let M=U,j=(M==null?void 0:M.error)||((q=M[0])===null||q===void 0?void 0:q.error);if(j){O($e,`RPC '${e}' stream ${i} received error:`,j);let X=j.status,G=function(I){let E=Ie[I];if(E!==void 0)return ZI(E)}(X),w=j.message;G===void 0&&(G=C.INTERNAL,w="Unknown error status: "+X+" with message "+j.message),T=!0,D.r_(new x(G,w)),g.close()}else O($e,`RPC '${e}' stream ${i} received:`,U),D.i_(U)}}),N(c,Uh.STAT_EVENT,k=>{k.stat===qa.PROXY?O($e,`RPC '${e}' stream ${i} detected buffering proxy`):k.stat===qa.NOPROXY&&O($e,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{D.n_()},0),D}};jc=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.bi=e,this.timerId=t,this.u_=r,this.c_=i,this.l_=s,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(e){this.cancel();let t=Math.floor(this.h_+this.d_()),r=Math.max(0,Date.now()-this.T_),i=Math.max(0,t-r);i>0&&O("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.h_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,i,()=>(this.T_=Date.now(),e())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){this.P_!==null&&(this.P_.skipDelay(),this.P_=null)}cancel(){this.P_!==null&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}};Yv="PersistentStream",zc=class{constructor(e,t,r,i,s,o,c,u){this.bi=e,this.R_=r,this.V_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new jc(e,t)}w_(){return this.state===1||this.state===5||this.b_()}b_(){return this.state===2||this.state===3}start(){this.p_=0,this.state!==4?this.auth():this.S_()}stop(){return p(this,null,function*(){this.w_()&&(yield this.close(0))})}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&this.f_===null&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(e){this.M_(),this.stream.send(e)}C_(){return p(this,null,function*(){if(this.b_())return this.close(0)})}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}close(e,t){return p(this,null,function*(){this.M_(),this.x_(),this.y_.cancel(),this.m_++,e!==4?this.y_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(He(t.toString()),He("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.O_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Zo(t)})}O_(){}auth(){this.state=1;let e=this.N_(this.m_),t=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.m_===t&&this.B_(r,i)},r=>{e(()=>{let i=new x(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.L_(i)})})}B_(e,t){let r=this.N_(this.m_);this.stream=this.k_(e,t),this.stream.jo(()=>{r(()=>this.listener.jo())}),this.stream.Jo(()=>{r(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(i=>{r(()=>this.L_(i))}),this.stream.onMessage(i=>{r(()=>++this.p_==1?this.q_(i):this.onNext(i))})}S_(){this.state=5,this.y_.E_(()=>p(this,null,function*(){this.state=0,this.start()}))}L_(e){return O(Yv,`close with error: ${e}`),this.stream=null,this.close(4,e)}N_(e){return t=>{this.bi.enqueueAndForget(()=>this.m_===e?t():(O(Yv,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},gf=class extends zc{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}k_(e,t){return this.connection.a_("Listen",e,t)}q_(e){return this.onNext(e)}onNext(e){this.y_.reset();let t=EC(this.serializer,e),r=function(s){if(!("targetChange"in s))return z.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?z.min():o.readTime?Qe(o.readTime):z.min()}(e);return this.listener.Q_(t,r)}U_(e){let t={};t.database=Dd(this.serializer),t.addTarget=function(s,o){let c,u=o.target;if(c=gc(u)?{documents:sw(s,u)}:{query:ow(s,u).gt},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=ew(s,o.resumeToken);let h=Cd(s,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(z.min())>0){c.readTime=Di(s,o.snapshotVersion.toTimestamp());let h=Cd(s,o.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);let r=AC(this.serializer,e);r&&(t.labels=r),this.F_(t)}K_(e){let t={};t.database=Dd(this.serializer),t.removeTarget=e,this.F_(t)}},_f=class extends zc{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(e,t){return this.connection.a_("Write",e,t)}q_(e){return B(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,B(!e.writeResults||e.writeResults.length===0,55816),this.listener.z_()}onNext(e){B(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.y_.reset();let t=TC(e.writeResults,e.commitTime),r=Qe(e.commitTime);return this.listener.j_(r,t)}H_(){let e={};e.database=Dd(this.serializer),this.F_(e)}G_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Rc(this.serializer,r))};this.F_(t)}};yf=class{},vf=class extends yf{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.J_=!1}Y_(){if(this.J_)throw new x(C.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(e,t,r,i){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Qo(e,kd(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(C.UNKNOWN,s.toString())})}Wo(e,t,r,i,s){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Wo(e,kd(t,r),i,o,c,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new x(C.UNKNOWN,o.toString())})}terminate(){this.J_=!0,this.connection.terminate()}},If=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){this.Z_===0&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(e){this.state==="Online"?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.na("Offline")))}set(e){this.sa(),this.Z_=0,e==="Online"&&(this.ea=!1),this.na(e)}na(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ra(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(He(t),this.ea=!1):O("OnlineStateTracker",t)}sa(){this.X_!==null&&(this.X_.cancel(),this.X_=null)}};Sr="RemoteStore",wf=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=s,this.ca.vo(o=>{r.enqueueAndForget(()=>p(this,null,function*(){kr(this)&&(O(Sr,"Restarting streams for network reachability change."),yield function(u){return p(this,null,function*(){let h=Q(u);h.aa.add(4),yield bo(h),h.la.set("Unknown"),h.aa.delete(4),yield mu(h)})}(this))}))}),this.la=new If(r,i)}};Ef=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ct,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,c=new n(e,t,o,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};Gc=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=qs(),this.sortedSet=new pe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};Hc=class{constructor(){this.Ia=new pe(L.comparator)}track(e){let t=e.doc.key,r=this.Ia.get(t);r?e.type!==0&&r.type===3?this.Ia=this.Ia.insert(t,e):e.type===3&&r.type!==1?this.Ia=this.Ia.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Ia=this.Ia.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Ia=this.Ia.remove(t):e.type===1&&r.type===2?this.Ia=this.Ia.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):F(63341,{Vt:e,Ea:r}):this.Ia=this.Ia.insert(t,e)}da(){let e=[];return this.Ia.inorderTraversal((t,r)=>{e.push(r)}),e}},xi=class n{constructor(e,t,r,i,s,o,c,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new n(e,t,Gc.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};Tf=class{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(e=>e.ma())}},Af=class{constructor(){this.queries=Xv(),this.onlineState="Unknown",this.fa=new Set}terminate(){(function(t,r){let i=Q(t),s=i.queries;i.queries=Xv(),s.forEach((o,c)=>{for(let u of c.Ra)u.onError(r)})})(this,new x(C.ABORTED,"Firestore shutting down"))}};(Zv=bf||(bf={})).ya="default",Zv.Cache="cache";ho=class{constructor(e,t,r){this.query=e,this.wa=t,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=r||{}}pa(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new xi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ba?this.Da(e)&&(this.wa.next(e),t=!0):this.va(e,this.onlineState)&&(this.Ca(e),t=!0),this.Sa=e,t}onError(e){this.wa.error(e)}ga(e){this.onlineState=e;let t=!1;return this.Sa&&!this.ba&&this.va(this.Sa,e)&&(this.Ca(this.Sa),t=!0),t}va(e,t){if(!e.fromCache||!this.ma())return!0;let r=t!=="Offline";return(!this.options.Fa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Da(e){if(e.docChanges.length>0)return!0;let t=this.Sa&&this.Sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Ca(e){e=xi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ba=!0,this.wa.next(e)}ma(){return this.options.source!==bf.Cache}};Kc=class{constructor(e){this.key=e}},Qc=class{constructor(e){this.key=e}},Rf=class{constructor(e,t){this.query=e,this.qa=t,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=Y(),this.mutatedKeys=Y(),this.Ua=qI(e),this.Ka=new Gc(this.Ua)}get Wa(){return this.qa}Ga(e,t){let r=t?t.za:new Hc,i=t?t.Ka:this.Ka,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,g)=>{let y=i.get(f),T=Ao(this.query,g)?g:null,D=!!y&&this.mutatedKeys.has(y.key),N=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations),k=!1;y&&T?y.data.isEqual(T.data)?D!==N&&(r.track({type:3,doc:T}),k=!0):this.ja(y,T)||(r.track({type:2,doc:T}),k=!0,(u&&this.Ua(T,u)>0||h&&this.Ua(T,h)<0)&&(c=!0)):!y&&T?(r.track({type:0,doc:T}),k=!0):y&&!T&&(r.track({type:1,doc:y}),k=!0,(u||h)&&(c=!0)),k&&(T?(o=o.add(T),s=N?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{Ka:o,za:r,ys:c,mutatedKeys:s}}ja(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ka;this.Ka=e.Ka,this.mutatedKeys=e.mutatedKeys;let o=e.za.da();o.sort((f,g)=>function(T,D){let N=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Vt:k})}};return N(T)-N(D)}(f.type,g.type)||this.Ua(f.doc,g.doc)),this.Ha(r),i=i!=null&&i;let c=t&&!i?this.Ja():[],u=this.$a.size===0&&this.current&&!i?1:0,h=u!==this.Qa;return this.Qa=u,o.length!==0||h?{snapshot:new xi(this.query,e.Ka,s,o,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ya:c}:{Ya:c}}ga(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new Hc,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(e){return!this.qa.has(e)&&!!this.Ka.has(e)&&!this.Ka.get(e).hasLocalMutations}Ha(e){e&&(e.addedDocuments.forEach(t=>this.qa=this.qa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qa=this.qa.delete(t)),this.current=e.current)}Ja(){if(!this.current)return[];let e=this.$a;this.$a=Y(),this.Ka.forEach(r=>{this.Za(r.key)&&(this.$a=this.$a.add(r.key))});let t=[];return e.forEach(r=>{this.$a.has(r)||t.push(new Qc(r))}),this.$a.forEach(r=>{e.has(r)||t.push(new Kc(r))}),t}Xa(e){this.qa=e.Ns,this.$a=Y();let t=this.Ga(e.documents);return this.applyChanges(t,!0)}eu(){return xi.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,this.Qa===0,this.hasCachedResults)}},pp="SyncEngine",Sf=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Pf=class{constructor(e){this.key=e,this.tu=!1}},Cf=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.nu={},this.ru=new It(c=>$I(c),fu),this.iu=new Map,this.su=new Set,this.ou=new pe(L.comparator),this._u=new Map,this.au=new uo,this.uu={},this.cu=new Map,this.lu=Oi.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return this.hu===!0}};gp=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=pu(t.databaseInfo.databaseId),this.sharedClientState=this.Au(t),this.persistence=this.Ru(t),yield this.persistence.start(),this.localStore=this.Vu(t),this.gcScheduler=this.mu(t,this.localStore),this.indexBackfillerScheduler=this.fu(t,this.localStore)})}mu(t,r){return null}fu(t,r){return null}Vu(t){return Ew(this.persistence,new Uc,t.initialUser,this.serializer)}Ru(t){return new lo(Mc.Ei,this.serializer)}Au(t){return new $c}terminate(){return p(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Df=class extends gp{constructor(e){super(),this.cacheSizeBytes=e}mu(e,t){B(this.persistence.referenceDelegate instanceof Fc,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new xc(r,e.asyncQueue,t)}Ru(e){let t=this.cacheSizeBytes!==void 0?Ye.withCacheSize(this.cacheSizeBytes):Ye.DEFAULT;return new lo(r=>Fc.Ei(r,t),this.serializer)}},Nf=class n extends gp{constructor(e,t,r){super(),this.gu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return p(this,null,function*(){yield Wt(n.prototype,this,"initialize").call(this,e),yield this.gu.initialize(this,e),yield Mw(this.gu.syncEngine),yield Ro(this.gu.remoteStore),yield this.persistence.Ki(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}Vu(e){return Ew(this.persistence,new Uc,e.initialUser,this.serializer)}mu(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new xc(r,e.asyncQueue,t)}fu(e,t){let r=new sd(t,this.persistence);return new id(e.asyncQueue,r)}Ru(e){let t=OC(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Ye.withCacheSize(this.cacheSizeBytes):Ye.DEFAULT;return new of(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,qC(),ec(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Au(e){return new $c}},Fw=(()=>{class n{initialize(t,r){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>eI(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=dk.bind(null,this.syncEngine),yield ZC(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Af}()}createDatastore(t){let r=pu(t.databaseInfo.databaseId),i=function(o){return new mf(o)}(t.databaseInfo);return function(o,c,u,h){return new vf(o,c,u,h)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,o,c,u){return new wf(i,s,o,c,u)}(this.localStore,this.datastore,t.asyncQueue,r=>eI(this.syncEngine,r,0),function(){return qc.C()?new qc:new hf}())}createSyncEngine(t,r){return function(s,o,c,u,h,f,g){let y=new Cf(s,o,c,u,h,f);return g&&(y.hu=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return p(this,null,function*(){var t,r;yield function(s){return p(this,null,function*(){let o=Q(s);O(Sr,"RemoteStore shutting down."),o.aa.add(5),yield bo(o),o.ca.shutdown(),o.la.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();fo=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.pu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.pu(this.observer.error,e):He("Uncaught Error in snapshot listener:",e.toString()))}yu(){this.muted=!0}pu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};$n="FirestoreClient",Of=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ee.UNAUTHENTICATED,this.clientId=rc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>p(this,null,function*(){O($n,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(O($n,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ct;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=lp(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};rI=new Map;qw="firestore.googleapis.com",oI=!0,Jc=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new x(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=qw,this.ssl=oI}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:oI;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=mw;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<vw)throw new x(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}yk("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Bw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Vi=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Kh;switch(r.type){case"firstParty":return new Xh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new x(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return p(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=rI.get(t);r&&(O("ComponentProvider","Removing Datastore"),rI.delete(t),r.terminate())}(this),Promise.resolve()}};Et=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},je=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new On(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},On=class n extends Et{constructor(e,t,r){super(e,t,To(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new je(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};aI="AsyncQueue",Xc=class{constructor(e=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new jc(this,"async_queue_retry"),this.ju=()=>{let r=ec();r&&O(aI,"Visibility state changed to "+r.visibilityState),this.y_.A_()},this.Hu=e;let t=ec();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ju(),this.Yu(e)}enterRestrictedMode(e){if(!this.$u){this.$u=!0,this.Gu=e||!1;let t=ec();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.ju)}}enqueue(e){if(this.Ju(),this.$u)return new Promise(()=>{});let t=new ct;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qu.push(e),this.Zu()))}Zu(){return p(this,null,function*(){if(this.Qu.length!==0){try{yield this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(e){if(!qn(e))throw e;O(aI,"Operation failed with retryable error: "+e)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}})}Yu(e){let t=this.Hu.then(()=>(this.Wu=!0,e().catch(r=>{throw this.Ku=r,this.Wu=!1,He("INTERNAL UNHANDLED ERROR: ",cI(r)),r}).then(r=>(this.Wu=!1,r))));return this.Hu=t,t}enqueueAfterDelay(e,t,r){this.Ju(),this.zu.indexOf(e)>-1&&(t=0);let i=Ef.createAndSchedule(this,e,t,r,s=>this.Xu(s));return this.Uu.push(i),i}Ju(){this.Ku&&F(47125,{ec:cI(this.Ku)})}verifyOperationInProgress(){}tc(){return p(this,null,function*(){let e;do e=this.Hu,yield e;while(e!==this.Hu)})}nc(e){for(let t of this.Uu)if(t.timerId===e)return!0;return!1}rc(e){return this.tc().then(()=>{this.Uu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Uu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.tc()})}sc(e){this.zu.push(e)}Xu(e){let t=this.Uu.indexOf(e);this.Uu.splice(t,1)}};Tt=class extends Vi{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Xc,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}_terminate(){return p(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Xc(e),this._firestoreClient=void 0,yield e}})}};po=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ae.fromBase64String(e))}catch(t){throw new x(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ae.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};Li=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Te(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};Mi=class{constructor(e){this._methodName=e}};mo=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return H(this._lat,e._lat)||H(this._long,e._long)}};go=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};wk=/^__.*__$/,xf=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new wt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Un(e,this.data,t,this.fieldTransforms)}},Zc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new wt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};Vf=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this._c(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ac({path:r,cc:!1});return i.lc(e),i}hc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ac({path:r,cc:!1});return i._c(),i}Pc(e){return this.ac({path:void 0,cc:!0})}Tc(e){return tu(e,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}_c(){if(this.path)for(let e=0;e<this.path.length;e++)this.lc(this.path.get(e))}lc(e){if(e.length===0)throw this.Tc("Document fields must not be empty");if(Hw(this.oc)&&wk.test(e))throw this.Tc('Document fields cannot begin and end with "__"')}},Lf=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||pu(e)}dc(e,t,r,i=!1){return new Vf({oc:e,methodName:t,Ec:r,path:Te.emptyPath(),cc:!1,Ic:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};eu=class n extends Mi{_toFieldTransform(e){if(e.oc!==2)throw e.oc===1?e.Tc(`${this._methodName}() can only appear at the top level of your update data`):e.Tc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}},Mf=class n extends Mi{_toFieldTransform(e){return new vc(e.path,new Ln)}isEqual(e){return e instanceof n}};Ak=new RegExp("[~\\*/\\[\\]]");_o=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new je(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Uf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(yu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Uf=class extends _o{data(){return super.data()}};yo=class{},Pr=class extends yo{};vo=class n extends Pr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return hE(e._query,t),new Et(e.firestore,e.converter,Ed(e._query,t))}_parse(e){let t=Po(e.firestore);return function(s,o,c,u,h,f,g){let y;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new x(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){hI(g,f);let D=[];for(let N of g)D.push(lI(u,s,N));y={arrayValue:{values:D}}}else y=lI(u,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||hI(g,f),y=Qw(c,o,g,f==="in"||f==="not-in");return ee.create(h,f,y)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};Fi=class n extends yo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:oe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,c=s.getFlattenedFilters();for(let u of c)hE(o,u),o=Ed(o,u)}(e._query,t),new Et(e.firestore,e.converter,Ed(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};Bf=class n extends Pr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new x(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new x(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Er(s,o)}(e._query,this._field,this._direction);return new Et(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Ft(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};$f=class n extends Pr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Et(e.firestore,e.converter,yc(e._query,this._limit,this._limitType))}};nu=class n extends Pr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=lE(e,this.type,this._docOrFields,this._inclusive);return new Et(e.firestore,e.converter,function(i,s){return new Ft(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};ru=class n extends Pr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=lE(e,this.type,this._docOrFields,this._inclusive);return new Et(e.firestore,e.converter,function(i,s){return new Ft(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};qf=class{convertValue(e,t="none"){switch(xn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(un(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw F(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return jn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[bi].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>fe(o.doubleValue));return new go(s)}convertGeoPoint(e){return new mo(fe(e.latitude),fe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=hu(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(to(e));default:return null}}convertTimestamp(e){let t=cn(e);return new J(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=se.fromString(e);B(lw(r),9688,{name:e});let i=new Ai(r.get(1),r.get(3)),s=new L(r.popFirst(5));return i.isEqual(t)||He(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};mr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},iu=class extends _o{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new mi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(yu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},mi=class extends iu{data(e={}){return super.data(e)}},su=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new mr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new mi(this._firestore,this._userDataWriter,r.key,r,new mr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>{let u=new mi(i._firestore,i._userDataWriter,c.doc.key,c.doc,new mr(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let u=new mi(i._firestore,i._userDataWriter,c.doc.key,c.doc,new mr(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:bk(c.type),doc:u,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};Io=class extends qf{constructor(e){super(),this.firestore=e}convertBytes(e){return new po(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new je(this.firestore,null,t)}};jf=class{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=Rk(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}};zf=class{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Fw.provider,this._offlineComponentProvider={build:t=>new Nf(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}};(function(e,t=!0){(function(i){Ui=i})(Pt),et(new Ne("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),c=new Tt(new Yh(r.getProvider("auth-internal")),new Zh(o,r.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new x(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ai(h.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),le(Xy,Zy,e),le(Xy,Zy,"esm2017")})()});var Dr=W(()=>{"use strict";EE()});function wp(n,e){return e===void 0&&(e=Ck),new _s(function(t){var r=Ip(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function TE(n){return wp(n,{includeMetadataChanges:!0})}function AE(n,e){return e===void 0&&(e={}),TE(n).pipe(Pe(function(t){return Ep(t,e)}))}function Ep(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Iu(Iu({},r),(t={},t[e.idField]=n.id,t))}function bE(n){return wp(n,{includeMetadataChanges:!0}).pipe(Pe(function(e){return e.docs}))}function RE(n,e){return e===void 0&&(e={}),bE(n).pipe(Pe(function(t){return t.map(function(r){return Ep(r,e)})}))}var Iu,Ck,SE=W(()=>{"use strict";Dr();ys();ug();Iu=function(){return Iu=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Iu.apply(this,arguments)};Ck={includeMetadataChanges:!1};});function kk(n,e){let t=er(PE,n,e);return t&&new Nr(t)}function Dk(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Nr(r)}}function CE(n,...e){return le("angularfire",kt.full,"fst"),yn([Ok,Nk,{provide:Ap,useFactory:Dk(n),multi:!0,deps:[ot,vn,Dt,Jt,[new De,sr],[new De,bn],...e]}])}var Nr,PE,Tp,Ap,Nk,Ok,wu,kE,bp,DE,ln,NE,hn,Rp,Sp,Or,Eu,OE,xE,Pp,VE,Cp,ko,kp,Dp,Np,Op,Tu,Do=W(()=>{"use strict";Kr();he();Ts();ya();Ls();En();SE();Dr();Dr();Nr=class{constructor(e){return e}},PE="firestore",Tp=class{constructor(){return Tn(PE)}},Ap=new _n("angularfire2.firestore-instances");Nk={provide:Tp,deps:[[new De,Ap]]},Ok={provide:Nr,useFactory:kk,deps:[[new De,Ap],pt]};wu=K(RE,!0),kE=K(AE,!0),bp=K(vE,!0,2),DE=K(rE,!0,2),ln=K(zw,!0,2),NE=K(yE,!0,2),hn=K(_p,!0,2),Rp=K(uE,!0,2),Sp=K(cE,!0,2),Or=K(pE,!0),Eu=K(mE,!0),OE=K(Gw,!0),xE=K(Ww,!0),Pp=K(sE,!0,2),VE=K(nE,!0,2),Cp=K(iE,!0,2),ko=K(eE,!0,2),kp=K(gE,!0,2),Dp=K(aE,!0,2),Np=K(oE,!0,2),Op=K(_E,!0,2),Tu=K(tE,!0,2)});function xp(n){return"storage/"+n}function $p(){let n="An unknown error occurred, please check the error payload for server response.";return new ge(ye.UNKNOWN,n)}function Lk(n){return new ge(ye.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function Mk(n){return new ge(ye.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Fk(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ge(ye.UNAUTHENTICATED,n)}function Uk(){return new ge(ye.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Bk(n){return new ge(ye.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function $k(){return new ge(ye.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function qk(){return new ge(ye.CANCELED,"User canceled the upload/download.")}function jk(n){return new ge(ye.INVALID_URL,"Invalid URL '"+n+"'.")}function zk(n){return new ge(ye.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function Wk(){return new ge(ye.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+zE+"' property when initializing the app?")}function Gk(){return new ge(ye.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Hk(){return new ge(ye.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Kk(n){return new ge(ye.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Vp(n){return new ge(ye.INVALID_ARGUMENT,n)}function WE(){return new ge(ye.APP_DELETED,"The Firebase app was deleted.")}function Qk(n){return new ge(ye.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Oo(n,e){return new ge(ye.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function No(n){throw new ge(ye.INTERNAL_ERROR,"Internal error: "+n)}function Yk(n,e,t){let r=1,i=null,s=null,o=!1,c=0;function u(){return c===2}let h=!1;function f(...k){h||(h=!0,e.apply(null,k))}function g(k){i=setTimeout(()=>{i=null,n(T,u())},k)}function y(){s&&clearTimeout(s)}function T(k,...q){if(h){y();return}if(k){y(),f.call(null,k,...q);return}if(u()||o){y(),f.call(null,k,...q);return}r<64&&(r*=2);let M;c===1?(c=2,M=0):M=(r+Math.random())*1e3,g(M)}let D=!1;function N(k){D||(D=!0,y(),!h&&(i!==null?(k||(c=2),clearTimeout(i),g(0)):k||(c=1)))}return g(0),s=setTimeout(()=>{o=!0,N(!0)},t),N}function Jk(n){n(!1)}function Xk(n){return n!==void 0}function Zk(n){return typeof n=="object"&&!Array.isArray(n)}function qp(n){return typeof n=="string"||n instanceof String}function LE(n){return jp()&&n instanceof Blob}function jp(){return typeof Blob<"u"}function Mp(n,e,t,r){if(r<e)throw Vp(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Vp(`Invalid value for '${n}'. Expected ${t} or less.`)}function zi(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function GE(n){let e=encodeURIComponent,t="?";for(let r in n)if(n.hasOwnProperty(r)){let i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}function eD(n,e){let t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||i||s}function tD(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function nD(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e!=null?e:"AppManager")}function rD(n,e){e&&(n["X-Firebase-GMPID"]=e)}function iD(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function sD(n,e,t,r,i,s,o=!0){let c=GE(n.urlParams),u=n.url+c,h=Object.assign({},n.headers);return rD(h,e),tD(h,t),nD(h,s),iD(h,r),new Fp(u,n.method,h,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}function oD(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function aD(...n){let e=oD();if(e!==void 0){let t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(jp())return new Blob(n);throw new ge(ye.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function cD(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}function uD(n){if(typeof atob>"u")throw Kk("base-64");return atob(n)}function lD(n,e){switch(n){case Ut.RAW:return new xo(HE(e));case Ut.BASE64:case Ut.BASE64URL:return new xo(KE(n,e));case Ut.DATA_URL:return new xo(dD(e),fD(e))}throw $p()}function HE(n){let e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{let s=r,o=n.charCodeAt(++t);r=65536|(s&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function hD(n){let e;try{e=decodeURIComponent(n)}catch{throw Oo(Ut.DATA_URL,"Malformed data URL.")}return HE(e)}function KE(n,e){switch(n){case Ut.BASE64:{let i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw Oo(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Ut.BASE64URL:{let i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw Oo(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=uD(e)}catch(i){throw i.message.includes("polyfill")?i:Oo(n,"Invalid character found")}let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}function dD(n){let e=new bu(n);return e.base64?KE(Ut.BASE64,e.rest):hD(e.rest)}function fD(n){return new bu(n).contentType}function pD(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}function zp(n){let e;try{e=JSON.parse(n)}catch{return null}return Zk(e)?e:null}function mD(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function gD(n,e){let t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function QE(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}function _D(n,e){return e}function yD(n){return!qp(n)||n.length<2?n:QE(n)}function Wp(){if(Au)return Au;let n=[];n.push(new Ve("bucket")),n.push(new Ve("generation")),n.push(new Ve("metageneration")),n.push(new Ve("name","fullPath",!0));function e(s,o){return yD(o)}let t=new Ve("name");t.xform=e,n.push(t);function r(s,o){return o!==void 0?Number(o):o}let i=new Ve("size");return i.xform=r,n.push(i),n.push(new Ve("timeCreated")),n.push(new Ve("updated")),n.push(new Ve("md5Hash",null,!0)),n.push(new Ve("cacheControl",null,!0)),n.push(new Ve("contentDisposition",null,!0)),n.push(new Ve("contentEncoding",null,!0)),n.push(new Ve("contentLanguage",null,!0)),n.push(new Ve("contentType",null,!0)),n.push(new Ve("metadata","customMetadata",!0)),Au=n,Au}function vD(n,e){function t(){let r=n.bucket,i=n.fullPath,s=new it(r,i);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function ID(n,e,t){let r={};r.type="file";let i=t.length;for(let s=0;s<i;s++){let o=t[s];r[o.local]=o.xform(r,e[o.server])}return vD(r,n),r}function YE(n,e,t){let r=zp(e);return r===null?null:ID(n,r,t)}function wD(n,e,t,r){let i=zp(e);if(i===null||!qp(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(h=>{let f=n.bucket,g=n.fullPath,y="/b/"+o(f)+"/o/"+o(g),T=zi(y,t,r),D=GE({alt:"media",token:h});return T+D})[0]}function ED(n,e){let t={},r=e.length;for(let i=0;i<r;i++){let s=e[i];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}function TD(n,e,t){let r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[ME])for(let i of t[ME]){let s=i.replace(/\/$/,""),o=n._makeStorageReference(new it(e,s));r.prefixes.push(o)}if(t[FE])for(let i of t[FE]){let s=n._makeStorageReference(new it(e,i.name));r.items.push(s)}return r}function AD(n,e,t){let r=zp(t);return r===null?null:TD(n,e,r)}function Gp(n){if(!n)throw $p()}function JE(n,e){function t(r,i){let s=YE(n,i,e);return Gp(s!==null),s}return t}function bD(n,e){function t(r,i){let s=AD(n,e,i);return Gp(s!==null),s}return t}function RD(n,e){function t(r,i){let s=YE(n,i,e);return Gp(s!==null),wD(s,i,n.host,n._protocol)}return t}function Hp(n){function e(t,r){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=Uk():i=Fk():t.getStatus()===402?i=Mk(n.bucket):t.getStatus()===403?i=Bk(n.path):i=r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}return e}function Kp(n){let e=Hp(n);function t(r,i){let s=e(r,i);return r.getStatus()===404&&(s=Lk(n.path)),s.serverResponse=i.serverResponse,s}return t}function SD(n,e,t){let r=e.fullServerUrl(),i=zi(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,c=new xr(i,s,JE(n,t),o);return c.errorHandler=Kp(e),c}function PD(n,e,t,r,i){let s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",t&&t.length>0&&(s.delimiter=t),r&&(s.pageToken=r),i&&(s.maxResults=i);let o=e.bucketOnlyServerUrl(),c=zi(o,n.host,n._protocol),u="GET",h=n.maxOperationRetryTime,f=new xr(c,u,bD(n,e.bucket),h);return f.urlParams=s,f.errorHandler=Hp(e),f}function CD(n,e,t){let r=e.fullServerUrl(),i=zi(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,c=new xr(i,s,RD(n,t),o);return c.errorHandler=Kp(e),c}function kD(n,e){let t=e.fullServerUrl(),r=zi(t,n.host,n._protocol),i="DELETE",s=n.maxOperationRetryTime;function o(u,h){}let c=new xr(r,i,o,s);return c.successCodes=[200,204],c.errorHandler=Kp(e),c}function DD(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function ND(n,e,t){let r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=DD(null,e)),r}function OD(n,e,t,r,i){let s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function c(){let M="";for(let j=0;j<2;j++)M=M+Math.random().toString().slice(2);return M}let u=c();o["Content-Type"]="multipart/related; boundary="+u;let h=ND(e,r,i),f=ED(h,t),g="--"+u+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+f+`\r
--`+u+`\r
Content-Type: `+h.contentType+`\r
\r
`,y=`\r
--`+u+"--",T=Ru.getBlob(g,r,y);if(T===null)throw Gk();let D={name:h.fullPath},N=zi(s,n.host,n._protocol),k="POST",q=n.maxUploadRetryTime,U=new xr(N,k,JE(n,t),q);return U.urlParams=D,U.headers=o,U.body=T.uploadData(),U.errorHandler=Hp(e),U}function Lo(){return UE?UE():new Bp}function xD(n,e,t){n._throwIfRoot("uploadBytes");let r=OD(n.storage,n._location,Wp(),new Ru(e,!0),t);return n.storage.makeRequestWithTokens(r,Lo).then(i=>({metadata:i,ref:n}))}function VD(n){let e={prefixes:[],items:[]};return XE(n,e).then(()=>e)}function XE(n,e,t){return p(this,null,function*(){let i=yield LD(n,{pageToken:t});e.prefixes.push(...i.prefixes),e.items.push(...i.items),i.nextPageToken!=null&&(yield XE(n,e,i.nextPageToken))})}function LD(n,e){e!=null&&typeof e.maxResults=="number"&&Mp("options.maxResults",1,1e3,e.maxResults);let t=e||{},r=PD(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,Lo)}function MD(n){n._throwIfRoot("getMetadata");let e=SD(n.storage,n._location,Wp());return n.storage.makeRequestWithTokens(e,Lo)}function FD(n){n._throwIfRoot("getDownloadURL");let e=CD(n.storage,n._location,Wp());return n.storage.makeRequestWithTokens(e,Lo).then(t=>{if(t===null)throw Hk();return t})}function UD(n){n._throwIfRoot("deleteObject");let e=kD(n.storage,n._location);return n.storage.makeRequestWithTokens(e,Lo)}function BD(n,e){let t=gD(n._location.path,e),r=new it(n._location.bucket,t);return new ji(n.storage,r)}function $D(n){return/^[A-Za-z]+:\/\//.test(n)}function qD(n,e){return new ji(n,e)}function ZE(n,e){if(n instanceof Vo){let t=n;if(t._bucket==null)throw Wk();let r=new ji(t,t._bucket);return e!=null?ZE(r,e):r}else return e!==void 0?BD(n,e):n}function jD(n,e){if(e&&$D(e)){if(n instanceof Vo)return qD(n,e);throw Vp("To use ref(service, url), the first argument must be a Storage instance.")}else return ZE(n,e)}function BE(n,e){let t=e==null?void 0:e[zE];return t==null?null:it.makeFromBucketSpec(t,n)}function zD(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:da(i,n.app.options.projectId))}function tT(n,e,t){return n=ne(n),xD(n,e,t)}function nT(n){return n=ne(n),MD(n)}function rT(n){return n=ne(n),VD(n)}function iT(n){return n=ne(n),FD(n)}function sT(n){return n=ne(n),UD(n)}function oT(n,e){return n=ne(n),jD(n,e)}function aT(n=Yt(),e){n=ne(n);let r=Qt(n,eT).getImmediate({identifier:e}),i=ha("storage");return i&&cT(r,...i),r}function cT(n,e,t,r={}){zD(n,e,t,r)}function WD(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new Vo(t,r,i,e,Pt)}function GD(){et(new Ne(eT,WD,"PUBLIC").setMultipleInstances(!0)),le($E,qE,""),le($E,qE,"esm2017")}var jE,zE,xk,Vk,ge,ye,it,Lp,qi,Fp,$i,Ut,xo,bu,Ru,Ve,Au,ME,FE,xr,O1,UE,Up,Bp,ji,Vo,$E,qE,eT,uT=W(()=>{"use strict";wn();Ht();Xn();jE="firebasestorage.googleapis.com",zE="storageBucket",xk=2*60*1e3,Vk=10*60*1e3;ge=class n extends Ge{constructor(e,t,r=0){super(xp(e),`Firebase Storage: ${t} (${xp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return xp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},ye=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(ye||{});it=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(r.path==="")return r;throw zk(e)}static makeFromUrl(e,t){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(j){j.path.charAt(j.path.length-1)==="/"&&(j.path_=j.path_.slice(0,-1))}let o="(/(.*))?$",c=new RegExp("^gs://"+i+o,"i"),u={bucket:1,path:3};function h(j){j.path_=decodeURIComponent(j.path)}let f="v[A-Za-z0-9_]+",g=t.replace(/[.]/g,"\\."),y="(/([^?#]*).*)?$",T=new RegExp(`^https?://${g}/${f}/b/${i}/o${y}`,"i"),D={bucket:1,path:3},N=t===jE?"(?:storage.googleapis.com|storage.cloud.google.com)":t,k="([^?#]*)",q=new RegExp(`^https?://${N}/${i}/${k}`,"i"),M=[{regex:c,indices:u,postModify:s},{regex:T,indices:D,postModify:h},{regex:q,indices:{bucket:1,path:2},postModify:h}];for(let j=0;j<M.length;j++){let X=M[j],G=X.regex.exec(e);if(G){let w=G[X.indices.bucket],_=G[X.indices.path];_||(_=""),r=new n(w,_),X.postModify(r);break}}if(r==null)throw jk(e);return r}},Lp=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};qi=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(qi||{});Fp=class{constructor(e,t,r,i,s,o,c,u,h,f,g,y=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=u,this.timeout_=h,this.progressCallback_=f,this.connectionFactory_=g,this.retry=y,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((T,D)=>{this.resolve_=T,this.reject_=D,this.start_()})}start_(){let e=(r,i)=>{if(i){r(!1,new $i(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=c=>{let u=c.loaded,h=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,h)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let c=s.getErrorCode()===qi.NO_ERROR,u=s.getStatus();if(!c||eD(u,this.additionalRetryCodes_)&&this.retry){let f=s.getErrorCode()===qi.ABORT;r(!1,new $i(!1,null,f));return}let h=this.successCodes_.indexOf(u)!==-1;r(!0,new $i(h,s))})},t=(r,i)=>{let s=this.resolve_,o=this.reject_,c=i.connection;if(i.wasSuccessCode)try{let u=this.callback_(c,c.getResponse());Xk(u)?s(u):s()}catch(u){o(u)}else if(c!==null){let u=$p();u.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,u)):o(u)}else if(i.canceled){let u=this.appDelete_?WE():qk();o(u)}else{let u=$k();o(u)}};this.canceled_?t(!1,new $i(!1,null,!0)):this.backoffId_=Yk(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Jk(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},$i=class{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}};Ut={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},xo=class{constructor(e,t){this.data=e,this.contentType=t||null}};bu=class{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(t===null)throw Oo(Ut.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=t[1]||null;r!=null&&(this.base64=pD(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}};Ru=class n{constructor(e,t){let r=0,i="";LE(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(LE(this.data_)){let r=this.data_,i=cD(r,e,t);return i===null?null:new n(i)}else{let r=new Uint8Array(this.data_.buffer,e,t-e);return new n(r,!0)}}static getBlob(...e){if(jp()){let t=e.map(r=>r instanceof n?r.data_:r);return new n(aD.apply(null,t))}else{let t=e.map(o=>qp(o)?lD(Ut.RAW,o).data:o.data_),r=0;t.forEach(o=>{r+=o.byteLength});let i=new Uint8Array(r),s=0;return t.forEach(o=>{for(let c=0;c<o.length;c++)i[s++]=o[c]}),new n(i,!0)}}uploadData(){return this.data_}};Ve=class{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||_D}},Au=null;ME="prefixes",FE="items";xr=class{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};O1=256*1024;UE=null,Up=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=qi.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=qi.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=qi.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i){if(this.sent_)throw No("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw No("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw No("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw No("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw No("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},Bp=class extends Up{initXhr(){this.xhr_.responseType="text"}};ji=class n{constructor(e,t){this._service=e,t instanceof it?this._location=t:this._location=it.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new it(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return QE(this._location.path)}get storage(){return this._service}get parent(){let e=mD(this._location.path);if(e===null)return null;let t=new it(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw Qk(e)}};Vo=class{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=jE,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=xk,this._maxUploadRetryTime=Vk,this._requests=new Set,i!=null?this._bucket=it.makeFromBucketSpec(i,this._host):this._bucket=BE(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=it.makeFromBucketSpec(this._url,e):this._bucket=BE(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Mp("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Mp("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return p(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return p(this,null,function*(){if(Oe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ji(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new Lp(WE());{let o=sD(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return p(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()})}},$E="@firebase/storage",qE="0.13.7";eT="storage";GD()});var Qp=W(()=>{"use strict";uT()});function HD(n,e){let t=er(lT,n,e);return t&&new Vr(t)}function KD(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Vr(r)}}function hT(n,...e){return le("angularfire",kt.full,"gcs"),yn([YD,QD,{provide:Jp,useFactory:KD(n),multi:!0,deps:[ot,vn,Dt,Jt,[new De,sr],[new De,bn],...e]}])}var Vr,lT,Yp,Jp,QD,YD,dT,Xp,fT,pT,mT,Wi,gT,Su=W(()=>{"use strict";Kr();he();Ts();ya();Ls();En();Qp();Qp();Vr=class{constructor(e){return e}},lT="storage",Yp=class{constructor(){return Tn(lT)}},Jp=new _n("angularfire2.storage-instances");QD={provide:Yp,deps:[[new De,Jp]]},YD={provide:Vr,useFactory:HD,deps:[[new De,Jp],pt]};dT=K(sT,!0,2),Xp=K(iT,!0),fT=K(nT,!0),pT=K(aT,!0),mT=K(rT,!0),Wi=K(oT,!0,2),gT=K(tT,!0)});var _T,yT=W(()=>{"use strict";LA();_T=[{path:"auth",loadChildren:()=>import("./chunk-SHWLGJF2.js").then(n=>n.AuthRoutes),canMatch:[vs],data:{authStatusMustBe:!1}},{path:"",loadChildren:()=>import("./chunk-DUN7O2SI.js").then(n=>n.TabsRoutes),canMatch:[vs],data:{authStatusMustBe:!0}},{path:"cart",loadComponent:()=>import("./chunk-SVYDM6RI.js").then(n=>n.CartPage),canMatch:[vs],data:{authStatusMustBe:!0}},{path:"checkout",loadChildren:()=>import("./chunk-SV6U4NID.js").then(n=>n.CheckoutRoutes),canMatch:[vs],data:{authStatusMustBe:!0}},{path:"search",loadComponent:()=>import("./chunk-NT3JPCJX.js").then(n=>n.SearchPage)},{path:"conversation/:conversationId",loadComponent:()=>import("./chunk-WNZR5KSQ.js").then(n=>n.ConversationPage)}]});var vT,IT=W(()=>{"use strict";Vg();he();vT=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=gg({type:e,selectors:[["app-root"]],decls:2,vars:1,consts:[[3,"animated"]],template:function(i,s){i&1&&(vg(0,"ion-app"),wg(1,"ion-router-outlet",0),Ig()),i&2&&(mg(),yg("animated",!1))},dependencies:[Og,Ng],encapsulation:2});let n=e;return n})()});var wT,ET=W(()=>{"use strict";wT={production:!1,firebase:{apiKey:"AIzaSyAVCQrk9BinjVxO-eEHD4gKwb6UMOahJso",authDomain:"beatmarket-uoc.firebaseapp.com",projectId:"beatmarket-uoc",storageBucket:"beatmarket-uoc.firebasestorage.app",messagingSenderId:"61948068505",appId:"1:61948068505:web:39e9c0e8f5f7d4c56aee08"}}});var Bt,TT,Pu,$t,Gi=W(()=>{"use strict";he();Do();he();Bt=(n,e)=>p(void 0,null,function*(){return yield At(n,()=>new Promise((t,r)=>{e().then(t).catch(r)}))}),TT=n=>["where","or","and"].includes(n.type),Pu=n=>{let e=[];return Array.from(n).forEach(t=>{if("or"in t){let i=Pu(t.or).filter(TT);e.push(VE(...i))}else if("and"in t){let i=Pu(t.and).filter(TT);e.push(DE(...i))}else e.push(Tu(t.field,t.operator,t.value))}),e},$t=(()=>{let e=class e{constructor(){this.firestore=ie(Nr),this.injector=ie(ta)}getById(r,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(i&&!i.collection)throw new Error("You must specify the collection");try{let s=hn(this.firestore,`${i==null?void 0:i.collection}/${r}`);s=i!=null&&i.converter?s.withConverter(i.converter):s;let o=yield Or(s);return o.exists()?Se(ae({},o.data()),{_id:o.id}):null}catch(s){throw this.getErrorMessage(s)}}))})}getById$(r,i){return At(this.injector,()=>{if(!(i!=null&&i.collection))throw new Error("You must specify the collection");try{let s=hn(this.firestore,`${i==null?void 0:i.collection}/${r}`);return s=i!=null&&i.converter?s.withConverter(i.converter):s,kE(s)}catch(s){throw this.getErrorMessage(s)}})}getByField(r,i,s){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(s!=null&&s.collection))throw new Error("You must specify the collection");try{let o=ln(this.firestore,s==null?void 0:s.collection);o=s!=null&&s.converter?o.withConverter(s.converter):o;let c=ko(o,Tu(r,"==",i)),u=yield Eu(c);return u.empty?null:u.docs.map(h=>Se(ae({},h.data()),{_id:h.id}))}catch(o){throw this.getErrorMessage(o)}}))})}getByField$(r,i,s){return At(this.injector,()=>{if(!(s!=null&&s.collection))throw new Error("You must specify the collection");try{let o=ln(this.firestore,s==null?void 0:s.collection);o=s!=null&&s.converter?o.withConverter(s.converter):o;let c=ko(o,Tu(r,"==",i));return wu(c,{idField:"_id"})}catch(o){throw this.getErrorMessage(o)}})}getCollection(r){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(r!=null&&r.collection))throw new Error("You must provide the collection.");try{let i=ln(this.firestore,r.collection);return i=r!=null&&r.converter?i.withConverter(r.converter):i,(yield Eu(i)).docs.map(s=>Se(ae({},s.data()),{_id:s.id}))}catch(i){throw this.getErrorMessage(i)}}))})}getCollection$(r){return At(this.injector,()=>{if(!(r!=null&&r.collection))throw new Error("You must provide the collection.");try{let i=ln(this.firestore,r.collection);return i=r!=null&&r.converter?i.withConverter(r.converter):i,wu(i,{idField:"_id"})}catch(i){throw this.getErrorMessage(i)}})}create(r,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let s=Re(),o=Se(ae({},r),{createdAt:s,updatedAt:s}),c;if(r._id)c=hn(this.firestore,`${i.collection}/${r._id}`),c=i!=null&&i.converter?c.withConverter(i.converter):c,yield kp(c,o);else{let h=ln(this.firestore,i.collection);h=i!=null&&i.converter?h.withConverter(i.converter):h,c=yield bp(h,r)}let u=(yield Or(c)).data();return Se(ae({},u),{_id:c.id})}catch(s){throw this.getErrorMessage(s)}}))})}createInSubcollection(r,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let s;if(r._id)s=hn(this.firestore,`${i.collection}/${r._id}`),s=i!=null&&i.converter?s.withConverter(i.converter):s,yield kp(s,r);else{let c=ln(this.firestore,i.collection);c=i!=null&&i.converter?c.withConverter(i.converter):c,s=yield bp(c,r)}let o=(yield Or(s)).data();return Se(ae({},o),{_id:s.id})}catch(s){throw this.getErrorMessage(s)}}))})}updateInSubcollection(r,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let s=hn(this.firestore,`${i.collection}`);s=i!=null&&i.converter?s.withConverter(i.converter):s,yield Op(s,r);let o=(yield Or(s)).data();return Se(ae({},o),{_id:s.id})}catch(s){throw this.getErrorMessage(s)}}))})}update(r,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!(i!=null&&i.collection))throw new Error("You must provide the collection.");try{let o=hn(this.firestore,i.collection,r._id);o=i!=null&&i.converter?o.withConverter(i.converter):o;let s=r,{_id:c}=s,u=ig(s,["_id"]);return yield Op(o,Se(ae({},u),{updatedAt:Re()})),this.getById(r._id,i)}catch(o){throw this.getErrorMessage(o)}}))})}remove(r,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(i&&!i.collection)throw new Error("You must provide the collection.");try{let s=hn(this.firestore,`${i==null?void 0:i.collection}/${r}`);return(yield Or(s)).exists()?(yield NE(s),!0):(console.error(`Document with uid ${r} does not exist.`),!1)}catch(s){throw this.getErrorMessage(s)}}))})}exists(r,i){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(i&&!i.collection)throw new Error("You must provide the collection.");try{let s=hn(this.firestore,`${i==null?void 0:i.collection}/${r}`);return(yield Or(s)).exists()}catch(s){throw this.getErrorMessage(s)}}))})}query(r){return p(this,null,function*(){return yield Bt(this.injector,()=>p(this,null,function*(){if(!r.collection)throw new Error("You must provide the collection.");if(!r.queryConstraints)throw new Error("You must provide the query constraints.");try{let i=ln(this.firestore,r.collection);i=r!=null&&r.converter?i.withConverter(r.converter):i;let s=[],{filters:o,orderBy:c,limit:u,startAt:h,startAfter:f,endAt:g,endBefore:y}=r.queryConstraints;o!=null&&o.length&&s.push(...Pu(o)),c&&s.push(Cp(c.field,c.direction||"asc")),u!==void 0&&s.push(Pp(u)),h!==void 0&&s.push(Np(h)),f!==void 0&&s.push(Dp(f)),g!==void 0&&s.push(Rp(g)),y!==void 0&&s.push(Sp(y));let T=ko(i,...s);return(yield Eu(T)).docs.map(N=>Se(ae({},N.data()),{_id:N.id}))}catch(i){throw this.getErrorMessage(i)}}))})}query$(r){return At(this.injector,()=>{if(!r.collection)throw new Error("You must provide the collection.");if(!r.queryConstraints)throw new Error("You must provide the query constraints.");try{let i=ln(this.firestore,r.collection);i=r!=null&&r.converter?i.withConverter(r.converter):i;let s=[],{filters:o,orderBy:c,limit:u,startAt:h,startAfter:f,endAt:g,endBefore:y}=r.queryConstraints;o!=null&&o.length&&s.push(...Pu(o)),c&&s.push(Cp(c.field,c.direction||"asc")),u!==void 0&&s.push(Pp(u)),h!==void 0&&s.push(Np(h)),f!==void 0&&s.push(Dp(f)),g!==void 0&&s.push(Rp(g)),y!==void 0&&s.push(Sp(y));let T=ko(i,...s);return wu(T,{idField:"_id"})}catch(i){throw this.getErrorMessage(i)}})}getErrorMessage(r){return console.error(r),"Database error"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})()});var Hi,Zp=W(()=>{"use strict";oa();Hi=class n{constructor(e={}){this._id="",this.title="",this.description="",this.mainImageURL="",this.imagesURLs=[],this.user={userId:"",username:"",profilePictureURL:""},this.price=0,this.isActive=!0,this.finishedAt=null,this.article={category:bt.None,condition:sa.None,characteristics:{category:bt.None}},Object.assign(this,ae({},e))}static Build(e={}){return new n(e)}toJSON(){let e=Object.assign(this);delete e._id;try{return JSON.stringify(e)}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});function Le(n){return typeof n=="string"||typeof n=="number"||n instanceof Date}function Ce(n){return typeof n=="object"&&n!==null&&"_methodName"in n}function st(n){return typeof n=="object"&&n!==null&&"toDate"in n&&typeof n.toDate=="function"}var Ki=W(()=>{"use strict"});var Cu,AT=W(()=>{"use strict";Dr();oa();Zp();UA();Ki();Cu=class{toFirestore(e){var s;let t=e.article,r=bt.None,i={category:bt.None};if(Wg(t)){r=t.category;let o=t.characteristics;Hg(o,r)?i={type:o.type,brand:o.brand,model:o.model,color:o.color,fabricationYear:o.fabricationYear,serialNumber:o.serialNumber,instrumentLevel:o.instrumentLevel}:Kg(o,r)?i={author:o.author,theme:o.theme,edition:o.edition,publisher:o.publisher,year:o.year,pages:o.pages,language:o.language,isbn:o.isbn,series:o.series,volume:o.volume}:Qg(o,r)?i={format:o.format,recordingTitle:o.recordingTitle,artist:o.artist,genre:o.genre,year:o.year,duration:o.duration,label:o.label,catalogNumber:o.catalogNumber,isrc:o.isrc,barcode:o.barcode,releaseDate:o.releaseDate,releaseCountry:o.releaseCountry,releaseFormat:o.releaseFormat,trackCount:o.trackCount}:Yg(o,r)?i={type:o.type,name:o.name,brand:o.brand,associatedInstrument:o.associatedInstrument}:Jg(o,r)?i={type:o.type,name:o.name,brand:o.brand,model:o.model,color:o.color,fabricationYear:o.fabricationYear,serialNumber:o.serialNumber,accessories:o.accessories,warranty:o.warranty,warrantyDuration:o.warrantyDuration,warrantyType:o.warrantyType}:Xg(o,r)&&(i={description:o.description})}return{title:e.title,description:e.description,mainImageURL:e.mainImageURL,imagesURLs:e.imagesURLs,user:e.user,price:e.price,isActive:e.isActive,finishedAt:Le(e.finishedAt)?J.fromDate(new Date(e.finishedAt)):Ce(e.finishedAt)?e.finishedAt:null,article:{category:r,condition:(s=e.article.condition)!=null?s:"",characteristics:ae({},i)},createdAt:Le(e.createdAt)?J.fromDate(new Date(e.createdAt)):Ce(e.createdAt)?e.createdAt:Re(),updatedAt:Le(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Ce(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){let r=e.data(t);return Hi.Build({_id:e.id,title:r.title,description:r.description,mainImageURL:r.mainImageURL,imagesURLs:r.imagesURLs,user:r.user,price:r.price,isActive:r.isActive,finishedAt:st(r.finishedAt)?r.finishedAt.toDate():null,article:{category:r.article.category,condition:r.article.condition,characteristics:r.article.characteristics},createdAt:st(r.createdAt)?r.createdAt.toDate():null,updatedAt:st(r.updatedAt)?r.updatedAt.toDate():null})}}});var bT,RT=W(()=>{"use strict";he();Gi();Zp();AT();he();bT=(()=>{let e=class e{constructor(){this.firestore=ie($t),this.postConverter=new Cu}getPostById(r){return p(this,null,function*(){try{return yield this.firestore.getById(r,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}})}getPostById$(r){try{return this.firestore.getById$(r,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}}getPostsByUserId(r){return p(this,null,function*(){try{return yield this.firestore.getByField("userId",r,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}})}getPostsByUserId$(r){try{return this.firestore.getByField$("userId",r,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}}getPostsByUsername(r){return p(this,null,function*(){try{return yield this.firestore.getByField("username",r,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}})}getPostsByUsername$(r){try{return this.firestore.getByField$("username",r,{collection:"posts",converter:this.postConverter})}catch(i){throw console.error(i),i}}getAllPosts(){return p(this,null,function*(){try{return this.firestore.getCollection({collection:"posts",converter:this.postConverter})}catch(r){throw console.error(r),r}})}getAllPosts$(){try{return this.firestore.getCollection$({collection:"posts",converter:this.postConverter})}catch(r){throw console.error(r),r}}queryPosts(r){return p(this,null,function*(){try{return this.firestore.query({collection:"posts",converter:this.postConverter,queryConstraints:r})}catch(i){throw console.error(i),i}})}queryPosts$(r){try{return this.firestore.query$({collection:"posts",converter:this.postConverter,queryConstraints:r})}catch(i){throw console.error(i),i}}savePost(r){return p(this,null,function*(){try{let i=Hi.Build(r),s;return(s=yield this.firestore.create(i,{collection:"posts",converter:this.postConverter}))?s:null}catch(i){throw i}})}updatePost(r){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(r,{collection:"posts",converter:this.postConverter}))?i:null}catch(i){throw i}})}deletePost(r){return p(this,null,function*(){try{return yield this.firestore.remove(r)}catch(i){throw i}})}postExists(r){return p(this,null,function*(){try{return yield this.firestore.exists(r)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})()});var Qi,em=W(()=>{"use strict";Qi=class n{constructor(e={}){this._id="",this.userId="",this.items=[],Object.assign(this,ae({},e))}static Build(e={}){return new n(e)}toJSON(){let e=Object.assign(this);delete e._id;try{return JSON.stringify(e)}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});var ku,ST=W(()=>{"use strict";Dr();em();Ki();ku=class{toFirestore(e){return{userId:e.userId,items:e.items,createdAt:Le(e.createdAt)?J.fromDate(new Date(e.createdAt)):Ce(e.createdAt)?e.createdAt:Re(),updatedAt:Le(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Ce(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){var i,s;let r=e.data(t);return Qi.Build({_id:e.id,userId:(i=r.userId)!=null?i:"",items:(s=r.items)!=null?s:[],createdAt:st(r.createdAt)?r.createdAt.toDate():null,updatedAt:st(r.updatedAt)?r.updatedAt.toDate():null})}}});var PT,CT=W(()=>{"use strict";he();ys();Gi();em();ST();he();PT=(()=>{let e=class e{constructor(){this.firestore=ie($t),this.cartConverter=new ku}getCartById(r){return p(this,null,function*(){try{return yield this.firestore.getById(r,{collection:"carts",converter:this.cartConverter})}catch(i){throw console.error(i),i}})}getCartById$(r){try{return this.firestore.getById$(r,{collection:"carts",converter:this.cartConverter})}catch(i){throw console.error(i),i}}getCartByUserId(r){return p(this,null,function*(){try{let i=yield this.firestore.getByField("userId",r,{collection:"carts",converter:this.cartConverter});return i&&i.length>0?i[0]:null}catch(i){throw console.error(i),i}})}getCartByUserId$(r){try{return this.firestore.getByField$("userId",r,{collection:"carts",converter:this.cartConverter}).pipe(Pe(i=>i&&i.length>0?i[0]:null))}catch(i){throw console.error(i),i}}getAllCarts(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"carts",converter:this.cartConverter})}catch(r){throw console.error(r),r}})}getAllCarts$(){try{return this.firestore.getCollection$({collection:"carts",converter:this.cartConverter})}catch(r){throw console.error(r),r}}saveCart(r){return p(this,null,function*(){try{let i=Qi.Build(r),s;return(s=yield this.firestore.create(i,{collection:"carts",converter:this.cartConverter}))?s:null}catch(i){throw i}})}updateCart(r){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(r,{collection:"carts",converter:this.cartConverter}))?i:null}catch(i){console.error(i)}return null})}deleteCart(r){return p(this,null,function*(){try{return yield this.firestore.remove(r)}catch(i){throw i}})}cartExists(r){return p(this,null,function*(){try{return yield this.firestore.exists(r)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})()});var Du,Nu,kT=W(()=>{"use strict";Do();Mg();oa();Ki();Du=class{toFirestore(e){return{email:e.email,username:e.username,profilePictureURL:e.profilePictureURL,name:e.name,address:e.address,roles:Array.isArray(e.roles)?e.roles.map(t=>t.toString()):e.roles,bio:e.bio,fcmToken:e.fcmToken,createdAt:Le(e.createdAt)?J.fromDate(new Date(e.createdAt)):Ce(e.createdAt)?e.createdAt:Re(),updatedAt:Le(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Ce(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){var i,s,o,c,u,h,f;let r=e.data(t);return na.Build({_id:e.id,email:(i=r.email)!=null?i:"",username:(s=r.username)!=null?s:"",profilePictureURL:(o=r.profilePictureURL)!=null?o:"",name:(c=r.name)!=null?c:{first:"",last:""},address:(u=r.address)!=null?u:{line1:"",city:"",country:"",zipcode:""},roles:((h=r.roles)!=null?h:[]).map(g=>g),bio:(f=r.bio)!=null?f:"",fcmToken:r.fcmToken,createdAt:st(r.createdAt)?r.createdAt.toDate():null,updatedAt:st(r.updatedAt)?r.updatedAt.toDate():null})}},Nu=class{toFirestore(e){var t,r,i;return{title:typeof e.title=="string"?e.title:"",category:(r=(t=e==null?void 0:e.category)==null?void 0:t.toString())!=null?r:bt.None,price:typeof e.price=="number"?e.price:0,mainImageURL:(i=e==null?void 0:e.mainImageURL)!=null?i:""}}fromFirestore(e,t){var o,c,u,h;let r=e.data(t),i=(o=r==null?void 0:r.category)!=null?o:"",s=Object.values(bt).includes(i)?i:bt.None;return{_id:e.id,title:(c=r==null?void 0:r.title)!=null?c:"",category:s,price:(u=r==null?void 0:r.price)!=null?u:0,mainImageURL:(h=r==null?void 0:r.mainImageURL)!=null?h:""}}}});var DT,NT=W(()=>{"use strict";he();ys();Gi();Mg();kT();he();DT=(()=>{let e=class e{constructor(){this.firestore=ie($t),this.userConverter=new Du,this.activePostConverter=new Nu}getUserById(r,i=!0){return p(this,null,function*(){try{let s=yield this.firestore.getById(r,{collection:"users",converter:this.userConverter});if(!s)return null;if(!i||!this.firestore.getCollection)return s;let o=yield this.firestore.getCollection({collection:`users/${r}/activePosts`,converter:this.activePostConverter});return s.activePosts=o!=null?o:[],s}catch(s){throw console.error(s),s}})}getUserById$(r,i=!0){try{let s=this.firestore.getById$(r,{collection:"users",converter:this.userConverter});if(!i||!this.firestore.getCollection$)return s;let o=this.firestore.getCollection$({collection:`users/${r}/activePosts`,converter:this.activePostConverter});return Gt([s,o]).pipe(Pe(([c,u])=>c?(c.activePosts=u!=null?u:[],c):null))}catch(s){throw console.error(s),s}}getUserByEmail(r,i=!0){return p(this,null,function*(){try{let s=null,o=yield this.firestore.getByField("email",r,{collection:"users",converter:this.userConverter});if(o&&o.length>0&&(s=o[0]),!i||!this.firestore.getCollection)return s;let c=yield this.firestore.getCollection({collection:`users/${s==null?void 0:s._id}/activePosts`,converter:this.activePostConverter});return s&&(s.activePosts=c!=null?c:[]),s}catch(s){throw console.error(s),s}})}getUserByEmail$(r,i=!0){try{let s=this.firestore.getByField$("email",r,{collection:"users",converter:this.userConverter}).pipe(Pe(o=>o&&o.length>0?o[0]:null));return!i||!this.firestore.getCollection$?s:s.pipe(Qn(o=>!o||!this.firestore.getCollection$?Kn(null):this.firestore.getCollection$({collection:`users/${o._id}/activePosts`,converter:this.activePostConverter}).pipe(Pe(c=>(o.activePosts=c!=null?c:[],o)))))}catch(s){throw console.error(s),s}}getUserByUsername(r){return p(this,null,function*(){try{let i=yield this.firestore.getByField("username",r,{collection:"users",converter:this.userConverter});return i&&i.length>0?i[0]:null}catch(i){throw console.error(i),i}})}getUserByUsername$(r){try{return this.firestore.getByField$("username",r,{collection:"users"}).pipe(Pe(i=>i&&i.length>0?i[0]:null))}catch(i){throw console.error(i),i}}getAllUsers(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"users",converter:this.userConverter})}catch(r){throw console.error(r),r}})}getAllUsers$(){try{return this.firestore.getCollection$({collection:"users",converter:this.userConverter})}catch(r){throw console.error(r),r}}saveUser(r){return p(this,null,function*(){try{let i=na.Build(r),s;return(s=yield this.firestore.create(i,{collection:"users",converter:this.userConverter}))?s:null}catch(i){throw i}})}updateUser(r){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(r,{collection:"users",converter:this.userConverter}))?i:null}catch(i){throw i}})}saveActivePost(s){return p(this,arguments,function*({userId:r,activePostData:i}){try{let o;return(o=yield this.firestore.createInSubcollection(i,{collection:`users/${r}/activePosts`,converter:this.activePostConverter}))?o:null}catch(o){throw o}})}userExists(r){return p(this,null,function*(){return yield this.firestore.exists(r)})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})()});var Yi,tm=W(()=>{"use strict";oa();Yi=class n{constructor(e={}){this._id="",this.postData={postId:"",title:"",articleCondition:sa.None,price:0,mainImageURL:""},this.buyerData={userId:"",username:"",profilePictureURL:""},this.sellerData={userId:"",username:"",profilePictureURL:""},this.paymentData={cardName:"",cardNumber:"",expirationMonth:"",expirationYear:"",cvc:""},Object.assign(this,ae({},e))}static Build(e={}){return new n(e)}toJSON(){let e=Object.assign(this);delete e._id;try{return JSON.stringify(e)}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});var Ou,OT=W(()=>{"use strict";Dr();tm();Ki();Ou=class{toFirestore(e){return{postData:e.postData,buyerData:e.buyerData,sellerData:e.sellerData,paymentData:e.paymentData,createdAt:Le(e.createdAt)?J.fromDate(new Date(e.createdAt)):Ce(e.createdAt)?e.createdAt:Re(),updatedAt:Le(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Ce(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){let r=e.data(t);return Yi.Build({_id:e.id,postData:{postId:r.postData.postId,title:r.postData.title,articleCondition:r.postData.articleCondition,price:r.postData.price,mainImageURL:r.postData.mainImageURL},buyerData:{userId:r.buyerData.userId,username:r.buyerData.username,profilePictureURL:r.buyerData.profilePictureURL},sellerData:{userId:r.sellerData.userId,username:r.sellerData.username,profilePictureURL:r.sellerData.profilePictureURL},paymentData:{cardName:r.paymentData.cardName,cardNumber:r.paymentData.cardNumber,expirationMonth:r.paymentData.expirationMonth,expirationYear:r.paymentData.expirationYear,cvc:r.paymentData.cvc},createdAt:r.createdAt.toDate(),updatedAt:r.updatedAt.toDate()})}}});var xT,VT=W(()=>{"use strict";he();Gi();tm();OT();he();xT=(()=>{let e=class e{constructor(){this.firestore=ie($t),this.saleConverter=new Ou}getSaleById(r){return p(this,null,function*(){try{return yield this.firestore.getById(r,{collection:"sales"})}catch(i){throw console.error(i),i}})}getSaleById$(r){try{return this.firestore.getById$(r,{collection:"sales"})}catch(i){throw console.error(i),i}}getSalesByBuyerId(r){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.userId",operator:"==",value:r}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesByBuyerId$(r){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.userId",operator:"==",value:r}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getSalesByBuyerUsername(r){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.username",operator:"==",value:r}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesByBuyerUsername$(r){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"buyerData.username",operator:"==",value:r}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getSalesBySellerId(r){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.userId",operator:"==",value:r}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesBySellerId$(r){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.userId",operator:"==",value:r}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getSalesBySellerUsername(r){return p(this,null,function*(){try{return yield this.firestore.query({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.username",operator:"==",value:r}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}})}getSalesBySellerUsername$(r){try{return this.firestore.query$({collection:"sales",converter:this.saleConverter,queryConstraints:{filters:[{field:"sellerData.username",operator:"==",value:r}],orderBy:{field:"createdAt",direction:"desc"}}})}catch(i){throw console.error(i),i}}getAllSales(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"sales",converter:this.saleConverter})}catch(r){throw console.error(r),r}})}getAllSales$(){try{return this.firestore.getCollection$({collection:"sales",converter:this.saleConverter})}catch(r){throw console.error(r),r}}saveSale(r){return p(this,null,function*(){try{let i=Yi.Build(r),s;return(s=yield this.firestore.create(i,{collection:"sales",converter:this.saleConverter}))?s:null}catch(i){throw i}})}updateSale(r){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(r,{collection:"sales",converter:this.saleConverter}))?i:null}catch(i){throw i}})}deleteSale(r){return p(this,null,function*(){try{return yield this.firestore.remove(r)}catch(i){throw i}})}saleExists(r){return p(this,null,function*(){try{return yield this.firestore.exists(r)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})()});var Ji,nm=W(()=>{"use strict";Ji=class n{constructor(e={}){this._id="",this.relatedPost={postId:"",title:"",price:0,isActive:!0,mainImageURL:""},this.participants={buyer:{userId:"",username:"",profilePictureURL:""},seller:{userId:"",username:"",profilePictureURL:""}},this.messages=[],Object.assign(this,ae({},e))}static Build(e={}){return new n(e)}toJSON(){let e=Object.assign(this);delete e._id;try{let t=JSON.stringify(e);return console.log({jsonStr:t}),t}catch(t){console.error(`Error stringifying object ${e}: ${t}`)}return""}fromJSON(e){try{return JSON.parse(e)}catch(t){console.error(`Error parsing json ${e}: ${t}`)}return null}}});var xu,Vu,LT=W(()=>{"use strict";Do();nm();Ki();xu=class{toFirestore(e){return{relatedPost:e.relatedPost,participants:Ce(e.participants)?e.participants:{buyer:{userId:e.participants.buyer.userId,username:e.participants.buyer.username,profilePictureURL:e.participants.buyer.profilePictureURL},seller:{userId:e.participants.seller.userId,username:e.participants.seller.username,profilePictureURL:e.participants.seller.profilePictureURL}},createdAt:Le(e.createdAt)?J.fromDate(new Date(e.createdAt)):Ce(e.createdAt)?e.createdAt:Re(),updatedAt:Le(e.updatedAt)?J.fromDate(new Date(e.updatedAt)):Ce(e.updatedAt)?e.updatedAt:Re()}}fromFirestore(e,t){let r=e.data(t);return Ji.Build({_id:e.id,relatedPost:r.relatedPost,participants:{buyer:{userId:r.participants.buyer.userId,username:r.participants.buyer.username,profilePictureURL:r.participants.buyer.profilePictureURL},seller:{userId:r.participants.seller.userId,username:r.participants.seller.username,profilePictureURL:r.participants.seller.profilePictureURL}},createdAt:st(r.createdAt)?r.createdAt.toDate():null,updatedAt:st(r.updatedAt)?r.updatedAt.toDate():null})}},Vu=class{toFirestore(e){return{text:e.text,timestamp:Le(e.timestamp)?J.fromDate(new Date(e.timestamp)):Ce(e.timestamp)?e.timestamp:Re(),senderId:e.senderId,recipientId:e.recipientId}}fromFirestore(e,t){let r=e.data(t);return{_id:e.id,text:r.text,timestamp:r.timestamp.toDate(),senderId:r.senderId,recipientId:r.recipientId}}}});var MT,FT=W(()=>{"use strict";he();Gi();nm();LT();ys();he();MT=(()=>{let e=class e{constructor(){this.firestore=ie($t),this.conversationConverter=new xu,this.messageConverter=new Vu}getConversationById(r){return p(this,null,function*(){try{let i=yield this.firestore.getById(r,{collection:"conversations",converter:this.conversationConverter});if(!i)return null;let s=yield this.firestore.getCollection({collection:`conversations/${r}/messages`,converter:this.messageConverter});return i.messages=s!=null?s:[],i}catch(i){throw console.error(i),i}})}getConversationById$(r){try{let i=this.firestore.getById$(r,{collection:"conversations",converter:this.conversationConverter}),s=this.firestore.query$({collection:`conversations/${r}/messages`,converter:this.messageConverter,queryConstraints:{orderBy:{field:"timestamp",direction:"desc"}}});return Gt([i,s]).pipe(Pe(([o,c])=>o?Se(ae({},o),{messages:c!=null?c:[]}):null),ll((o,c)=>(o==null?void 0:o.messages.length)===(c==null?void 0:c.messages.length)))}catch(i){throw console.error(i),i}}getConversationsByBuyerId(r){return p(this,null,function*(){try{let i=yield this.firestore.getByField("participants.buyer.userId",r,{collection:"conversations",converter:this.conversationConverter});if(!this.firestore.getCollection||i===null)return i;for(let s of i)s.messages=yield this.firestore.getCollection({collection:`conversations/${s._id}/messages`,converter:this.messageConverter});return i}catch(i){throw console.error(i),i}})}getConversationsByBuyerId$(r){try{return this.firestore.getByField$("participants.buyer.userId",r,{collection:"conversations",converter:this.conversationConverter}).pipe(Qn(s=>{if(!s||s.length===0)return Kn(null);let o=s.map(c=>this.firestore.getCollection$({collection:`conversations/${c._id}/messages`,converter:this.messageConverter}).pipe(Pe(u=>Se(ae({},c),{messages:u!=null?u:[]}))));return Gt(o)}))}catch(i){throw console.error(i),i}}getConversationsBySellerId(r){return p(this,null,function*(){try{let i=yield this.firestore.getByField("participants.seller.userId",r,{collection:"conversations",converter:this.conversationConverter});if(i===null)return i;for(let s of i)s.messages=yield this.firestore.getCollection({collection:`conversations/${s._id}/messages`,converter:this.messageConverter});return i}catch(i){throw console.error(i),i}})}getConversationsBySellerId$(r){try{return this.firestore.getByField$("participants.seller.userId",r,{collection:"conversations",converter:this.conversationConverter}).pipe(Qn(s=>{if(!s||s.length===0)return Kn(null);let o=s.map(c=>this.firestore.getCollection$({collection:`conversations/${c._id}/messages`,converter:this.messageConverter}).pipe(Pe(h=>Se(ae({},c),{messages:h!=null?h:[]}))));return Gt(o)}))}catch(i){throw console.error(i),i}}getConversationsByParticipantId(r){return p(this,null,function*(){var i,s;try{let o=(i=yield this.firestore.getByField("participants.buyer.userId",r,{collection:"conversations",converter:this.conversationConverter}))!=null?i:[],c=(s=yield this.firestore.getByField("participants.seller.userId",r,{collection:"conversations",converter:this.conversationConverter}))!=null?s:[];for(let u of o)u.messages=yield this.firestore.getCollection({collection:`conversations/${u._id}/messages`,converter:this.messageConverter});for(let u of c)u.messages=yield this.firestore.getCollection({collection:`conversations/${u._id}/messages`,converter:this.messageConverter});return o.concat(c)}catch(o){throw console.error(o),o}})}getConversationsByParticipantId$(r){try{let i=this.firestore.getByField$("participants.buyer.userId",r,{collection:"conversations",converter:this.conversationConverter}),s=this.firestore.getByField$("participants.seller.userId",r,{collection:"conversations",converter:this.conversationConverter});return Gt([i,s]).pipe(Pe(([o,c])=>(o!=null?o:[]).concat(c!=null?c:[])),Qn(o=>{if(!o||o.length===0)return Kn(null);let c=o.map(u=>this.firestore.getCollection$({collection:`conversations/${u._id}/messages`,converter:this.messageConverter}).pipe(Pe(h=>Se(ae({},u),{messages:h!=null?h:[]}))));return Gt(c)}))}catch(i){throw console.error(i),i}}getConversationsByPostId(r){return p(this,null,function*(){var i;try{let s=(i=yield this.firestore.getByField("relatedPost.postId",r,{collection:"conversations",converter:this.conversationConverter}))!=null?i:[];for(let o of s)o.messages=yield this.firestore.getCollection({collection:`conversations/${o._id}/messages`,converter:this.messageConverter});return s}catch(s){throw console.error(s),s}})}getConversationsByPostId$(r){try{return this.firestore.getByField$("relatedPost.postId",r,{collection:"conversations",converter:this.conversationConverter}).pipe(Qn(s=>{if(!s||s.length===0)return Kn(null);let o=s.map(c=>this.firestore.getCollection$({collection:`conversations/${c._id}/messages`,converter:this.messageConverter}).pipe(Pe(u=>Se(ae({},c),{messages:u!=null?u:[]}))));return Gt(o)}))}catch(i){throw console.error(i),i}}getAllConversations(){return p(this,null,function*(){try{return yield this.firestore.getCollection({collection:"conversations",converter:this.conversationConverter})}catch(r){throw console.error(r),r}})}getAllConversations$(){try{return this.firestore.getCollection$({collection:"conversations",converter:this.conversationConverter})}catch(r){throw console.error(r),r}}queryConversations(r){return p(this,null,function*(){try{return this.firestore.query({collection:"conversations",converter:this.conversationConverter,queryConstraints:r})}catch(i){throw console.error(i),i}})}queryConversations$(r){try{return this.firestore.query$({collection:"conversations",converter:this.conversationConverter,queryConstraints:r})}catch(i){throw console.error(i),i}}saveConversation(r){return p(this,null,function*(){try{let i=Ji.Build(r),s;return(s=yield this.firestore.create(i,{collection:"conversations",converter:this.conversationConverter}))?s:null}catch(i){throw i}})}updateConversation(r){return p(this,null,function*(){try{let i;return(i=yield this.firestore.update(r,{collection:"conversations",converter:this.conversationConverter}))?i:null}catch(i){throw i}})}saveMessage(s){return p(this,arguments,function*({conversationId:r,messageData:i}){try{let o;return(o=yield this.firestore.createInSubcollection(i,{collection:`conversations/${r}/messages`,converter:this.messageConverter}))?o:null}catch(o){throw o}})}deleteConversation(r){return p(this,null,function*(){try{return yield this.firestore.remove(r)}catch(i){throw i}})}conversationExists(r){return p(this,null,function*(){try{return yield this.firestore.exists(r)}catch(i){throw i}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})()});var UT,BT=W(()=>{"use strict";he();Ls();dl();he();UT=(()=>{var e;let t=class t{constructor(){sg(this,e);this.firebaseAuth=ie(ir),this.userRepository=ie($r),og(this,e,fg(null)),$y(this.firebaseAuth,i=>p(this,null,function*(){al(this,e).set(i)}))}get authInstance(){return this.firebaseAuth}get firebaseUser(){return al(this,e).asReadonly()}registerWithEmail(i){return p(this,null,function*(){try{let s=yield Fy(this.authInstance,i.email,i.password).then(o=>o.user);return yield Hy(s,{displayName:i.username}),{uid:s.uid}}catch(s){throw this.getErrorMessage(s.code||s.message)}})}registerWithProvider(i){return p(this,null,function*(){return yield this.loginWithProvider(i)})}loginWithEmail(i,s){return p(this,null,function*(){try{return{uid:(yield jy(this.authInstance,i,s).then(c=>c.user)).uid}}catch(o){throw this.getErrorMessage(o.code||o.message)}})}loginWithProvider(i){return p(this,null,function*(){try{let s=i==="google"?new vh:new Os("apple.com"),o=yield zy(this.authInstance,s).then(c=>c.user);return this.userRepository.getUserById(o.uid)}catch(s){throw this.getErrorMessage(s.code||s.message)}})}logout(){return p(this,null,function*(){try{yield Wy(this.authInstance)}catch(i){throw i}})}resetPassword(i){return p(this,null,function*(){try{console.log("resetting password"),yield qy(this.authInstance,i)}catch(s){throw s}})}updatePassword(i){return p(this,null,function*(){try{let s=yield this.firebaseUser();if(!s)return;yield Gy(s,i)}catch(s){throw s}})}getErrorMessage(i){return console.error(i),"Las credenciales son incorrectas."}};e=new WeakMap,t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=ve({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})()});var $T,qT=W(()=>{"use strict";Su();he();Su();$T=(()=>{let e=class e{constructor(r){this.storage=r}upload(o,c){return p(this,arguments,function*(r,i,s={}){let u=Wi(this.storage,r);return yield gT(u,i,s),yield Xp(u)})}delete(r){return p(this,null,function*(){let i=Wi(this.storage,r);yield dT(i)})}getDownloadURL(r){return p(this,null,function*(){let i=Wi(this.storage,r);return yield Xp(i)})}getMetadata(r){return p(this,null,function*(){let i=Wi(this.storage,r);return yield fT(i)})}list(r){return p(this,null,function*(){let i=Wi(this.storage,r);return(yield mT(i)).items.map(o=>o.name)})}};e.\u0275fac=function(i){return new(i||e)(lg(Vr))},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})()});var jT=W(()=>{"use strict"});var Lr,zT=W(()=>{"use strict";fl();jT();Lr=Ug("PushNotifications",{})});var WT,GT=W(()=>{"use strict";he();zT();fl();jg();dl();kg();xA();he();WT=(()=>{let e=class e{constructor(){this.authService=ie(ia),this.userRepository=ie($r),this.cache=ie($g),this.router=ie(Rg)}initPushNotifications(){ra.isNativePlatform()&&(Lr.requestPermissions().then(r=>p(this,null,function*(){r.receive==="granted"?(console.log("Push notifications permissions granted!"),Lr.register()):console.warn(`Error in permissions request: ${r}`)})),Lr.addListener("registration",r=>p(this,null,function*(){if((yield this.cache.get("fcmToken"))!==r.value){console.log(`Push registration success, token: ${r.value}`),this.cache.set("fcmToken",r.value);let s=this.authService.currentUser();s&&(yield this.userRepository.updateUser({_id:s._id,fcmToken:r.value}))}})),Lr.addListener("registrationError",r=>{console.error("Error on push notifications registration: "+JSON.stringify(r))}),Lr.addListener("pushNotificationReceived",r=>{console.log("Push received: "+JSON.stringify(r))}),Lr.addListener("pushNotificationActionPerformed",r=>{var s,o,c;console.log("Push action performed: "+JSON.stringify(r));let i=(s=r.notification.data)==null?void 0:s.type;switch(i){case"sale":let u=(o=r.notification.data)==null?void 0:o.postId;u&&this.router.navigate([`/tabs/post-detail/${u}`]);break;case"message":let h=(c=r.notification.data)==null?void 0:c.conversationId;h&&this.router.navigate([`/tabs/conversation/${h}`]);break;default:console.warn(`Unhandled push notification type: ${i}`);break}}))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ve({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})()});var XD=PA(HT=>{he();kA();kg();Vg();Ts();Ls();Do();Su();yT();IT();ET();he();OA();fl();jg();FA();RT();MA();CT();dl();NT();$A();VT();BA();FT();BT();NA();qT();VA();GT();Ag(vT,{providers:[{provide:bg,useClass:Dg},xg(),Pg(_T,Cg(Sg)),k_(()=>{let n=D_(wT.firebase);return ra.isNativePlatform()&&(xE(n,{localCache:wE()}),By(n,{persistence:Ba})),n}),My(()=>Uy()),CE(()=>OE()),hT(()=>pT()),hg(Bg.forRoot()),{provide:Fg,useClass:UT},{provide:$r,useClass:DT},{provide:Gg,useClass:bT},{provide:zg,useClass:PT},{provide:e_,useClass:xT},{provide:Zg,useClass:MT},{provide:qg,useClass:$T},_g(()=>p(HT,null,function*(){let n=ie(ia),e=ie(WT);yield n.init(),e.initPushNotifications()}))]})});export default XD();
