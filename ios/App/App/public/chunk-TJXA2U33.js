import{a as U,b as se}from"./chunk-UIHM3IIJ.js";import{a as ht,b as xt,c as vt,d as Lt}from"./chunk-375QIGGA.js";import{a as ft,b as Mt,c as gt,d as It}from"./chunk-VVI7QVF5.js";import{D as ut,E as pt,F as dt,M as _t,a as H,b as et,d as tt,f as it,g as nt,l as ot,n as at,r as rt,t as lt,u as st,v as ct,y as mt}from"./chunk-QCXXS2IP.js";import{a as Ct,b as Ut}from"./chunk-3FWRLNF5.js";import"./chunk-6NUGH5FF.js";import{f as Q,g as He,h as q,j as Ke,k as Ye,n as We,o as Nt,t as Xe,u as Ot}from"./chunk-VQCHUAXV.js";import{b as Je,e as kt}from"./chunk-K5TY53DO.js";import"./chunk-4XKNA7IF.js";import"./chunk-4FRKXPG4.js";import"./chunk-E4HNE3PW.js";import"./chunk-P2UHFIXP.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-GTZXGHKK.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import{Aa as Ze,Ba as $e,Ca as Qe,Q as ke,S as Ne,_ as Oe,aa as Me,ba as Ie,c as w,d as Se,da as Ue,e as we,i as De,j as Ee,k as Re,ka as Le,l as Fe,la as ze,oa as qe,q as Ve,s as Te,u as Pe,v as Ae,va as Be,wa as je,xa as Ge}from"./chunk-BQ2OOKCX.js";import{$ as m,Ab as xe,Ca as D,Cb as At,D as b,Da as x,Ea as u,Kb as ve,L as C,Lb as be,M as h,Ma as ae,Na as _e,Pb as ye,Qa as c,Ra as re,Sa as fe,V as O,W as M,Y as g,Ya as le,_ as ue,ea as ie,fa as $,hb as I,ia as pe,ib as ge,jb as Ce,ka as _,m as N,n as Vt,nb as R,qa as y,s as G,sa as p,ta as de,ua as ne,v as Tt,va as oe,w as Pt,wa as l,xa as r,ya as S,z as Z,zb as he}from"./chunk-DHHGUDQP.js";import"./chunk-OHMQXWFK.js";import"./chunk-S6VCIYOJ.js";import"./chunk-25CU3KXX.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as z,f as A,j as B,k as j,o as v}from"./chunk-FIPIWZQS.js";var Y,K,bt=A(()=>{"use strict";R();He();K=class{constructor(){j(this,Y,b(Q))}validate(){return o=>v(this,null,function*(){return(yield B(this,Y).getUserByEmail(o.value.toLowerCase(),!1))?{emailExists:!0}:null})}};Y=new WeakMap});var W,J,yt=A(()=>{"use strict";R();He();J=class{constructor(){j(this,W,b(Q))}validate(){return o=>v(this,null,function*(){return(yield B(this,W).getUserByUsername(o.value))?{usernameExists:!0}:null})}};W=new WeakMap});var X,St=A(()=>{"use strict";R();At();Ut();Tt();se();X=class{constructor(){this.http=b(xe),this.API_KEY=Ct.zipcodeStack.apiKey,this.lastZipCode=null,this.lastCountry=null,this.lastResult=null,this.cityResult=g(null)}validate(){return o=>v(this,null,function*(){var d,f,E,F,T,L;let n=o.parent;if(!n)return null;let e=o.value,i=(d=n.get("country"))==null?void 0:d.value;if(!e||!i)return null;if(e===this.lastZipCode&&i===this.lastCountry)return this.lastResult;let a=(f=U.find(V=>V.nameES.toUpperCase()===i.toUpperCase()))==null?void 0:f.iso2;if(!a)return{zipValidationFailed:!0};let s=new he().set("apikey",this.API_KEY).set("codes",e).set("country",a);try{let V=yield N(this.http.get("https://api.zipcodestack.com/v1/search",{params:s})),P=(E=V==null?void 0:V.results)!=null?E:[];if(!(P&&!Array.isArray(P)&&((F=P[e])==null?void 0:F.length)>0))return this.cityResult.set(null),this.setCache(e,i,{invalidZipCode:!0}),{invalidZipCode:!0};let k=(L=(T=P[e][0])==null?void 0:T.city)!=null?L:null;return this.cityResult.set(k),this.setCache(e,i,null),null}catch{return this.cityResult.set(null),this.setCache(e,i,{zipValidationFailed:!0}),{zipValidationFailed:!0}}})}setCache(o,n,e){this.lastZipCode=o,this.lastCountry=n,this.lastResult=e}}});function jt(t,o){t&1&&S(0,"ion-icon",12)}function Gt(t,o){if(t&1&&_(0,jt,1,0,"ion-icon",12),t&2){let n,e=u(2);p(!((n=e.registerForm.get("emailData.email"))!=null&&n.pending)&&((n=e.registerForm.get("emailData.email"))!=null&&n.invalid)?0:-1)}}function Zt(t,o){t&1&&(l(0,"ion-text",13),c(1,"El email es obligatorio"),r())}function $t(t,o){t&1&&(l(0,"ion-text",13),c(1,"El email es inv\xE1lido"),r())}function Qt(t,o){if(t&1&&_(0,Zt,2,0,"ion-text",13)(1,$t,2,0,"ion-text",13),t&2){let n,e,i=u(2);p(!((n=i.registerForm.get("emailData.email"))==null||n.errors==null)&&n.errors.required?0:-1),m(),p(!((e=i.registerForm.get("emailData.email"))==null||e.errors==null)&&e.errors.email||!((e=i.registerForm.get("emailData.email"))==null||e.errors==null)&&e.errors.emailExists?1:-1)}}function Ht(t,o){if(t&1){let n=D();l(0,"div",1)(1,"div",8)(2,"ion-label",9),c(3,"Email"),r(),l(4,"ion-input",10),x("ionFocus",function(){C(n);let i=u();return h(i.controlFocus.emit("email"))})("ionBlur",function(){C(n);let i=u();return h(i.controlBlur.emit("email"))}),S(5,"ion-icon",11),_(6,Gt,1,1),r(),_(7,Qt,2,2),r()()}if(t&2){let n,e=u();m(6),p(e.submitAttempts().email()?6:-1),m(),p(e.submitAttempts().email()&&((n=e.registerForm.get("emailData.email"))!=null&&n.errors)?7:-1)}}function Kt(t,o){t&1&&(l(0,"ion-text",13),c(1,"El nombre de usuario es obligatorio"),r())}function Yt(t,o){t&1&&(l(0,"ion-text",13),c(1,"El nombre de usuario es demasiado corto"),r())}function Jt(t,o){t&1&&(l(0,"ion-text",13),c(1,"Ese nombre de usuario ya est\xE1 en uso"),r())}function Wt(t,o){if(t&1&&_(0,Kt,2,0,"ion-text",13)(1,Yt,2,0,"ion-text",13)(2,Jt,2,0,"ion-text",13),t&2){let n,e,i,a=u(2);p(!((n=a.registerForm.get("userData.username"))==null||n.errors==null)&&n.errors.required?0:-1),m(),p(!((e=a.registerForm.get("userData.username"))==null||e.errors==null)&&e.errors.minlength?1:-1),m(),p(!((i=a.registerForm.get("userData.username"))==null||i.errors==null)&&i.errors.usernameExists?2:-1)}}function Xt(t,o){t&1&&(l(0,"ion-text",13),c(1,"La contrase\xF1a es obligatoria"),r())}function ei(t,o){t&1&&(l(0,"ion-text",13),c(1,"La contrase\xF1a debe tener al menos 6 caracteres, una letra y un n\xFAmero"),r())}function ti(t,o){if(t&1&&_(0,Xt,2,0,"ion-text",13)(1,ei,2,0,"ion-text",13),t&2){let n,e,i=u(2);p(!((n=i.registerForm.get("userData.password"))==null||n.errors==null)&&n.errors.required?0:-1),m(),p(!((e=i.registerForm.get("userData.password"))==null||e.errors==null)&&e.errors.pattern?1:-1)}}function ii(t,o){if(t&1){let n=D();l(0,"div",2)(1,"div",8)(2,"ion-label",9),c(3,"Nombre de usuario"),r(),l(4,"ion-input",14),x("ionFocus",function(){C(n);let i=u();return h(i.controlFocus.emit("userData"))}),S(5,"ion-icon",15),r(),_(6,Wt,3,3),r(),l(7,"div",8)(8,"ion-label",9),c(9,"Contrase\xF1a"),r(),l(10,"ion-input",16),x("ionFocus",function(){C(n);let i=u();return h(i.controlFocus.emit("userData"))}),S(11,"ion-icon",17)(12,"ion-input-password-toggle",18),r(),_(13,ti,2,2),r(),l(14,"div",19)(15,"ion-label",9),c(16,"Avatar (opcional)"),r(),l(17,"ion-avatar",20),x("click",function(){C(n);let i=u();return h(i.uploadAvatar.emit())}),S(18,"img",21),r()()()}if(t&2){let n,e,i=u();m(6),p(i.submitAttempts().userData()&&((n=i.registerForm.get("userData.username"))!=null&&n.errors)?6:-1),m(4),y("clearOnEdit",!1),m(3),p(i.submitAttempts().userData()&&((e=i.registerForm.get("userData.password"))!=null&&e.errors)?13:-1),m(5),y("src",i.avatarDataURL()||"../../../../../../assets/user-avatar-default-shade.svg",ue)}}function ni(t,o){t&1&&(l(0,"ion-text",13),c(1,"El nombre es obligatorio"),r())}function oi(t,o){if(t&1&&_(0,ni,2,0,"ion-text",13),t&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.firstName"))==null||n.errors==null)&&n.errors.required?0:-1)}}function ai(t,o){t&1&&(l(0,"ion-text",13),c(1,"Los apellidos son obligatorios"),r())}function ri(t,o){if(t&1&&_(0,ai,2,0,"ion-text",13),t&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.lastName"))==null||n.errors==null)&&n.errors.required?0:-1)}}function li(t,o){if(t&1&&(l(0,"ion-select-option",29),c(1),r()),t&2){let n=o.$implicit;y("value",n.nameES),m(),re(n.nameES)}}function si(t,o){t&1&&(l(0,"ion-text",13),c(1,"El c\xF3digo postal es obligatorio"),r())}function ci(t,o){t&1&&(l(0,"ion-text",13),c(1,"El c\xF3digo postal es demasiado corto"),r())}function mi(t,o){if(t&1&&_(0,si,2,0,"ion-text",13)(1,ci,2,0,"ion-text",13),t&2){let n,e,i=u(2);p(!((n=i.registerForm.get("personalData.zipcode"))==null||n.errors==null)&&n.errors.required?0:-1),m(),p(!((e=i.registerForm.get("personalData.zipcode"))==null||e.errors==null)&&e.errors.minlength?1:-1)}}function ui(t,o){t&1&&(l(0,"ion-text",13),c(1,"El c\xF3digo postal no es v\xE1lido"),r())}function pi(t,o){t&1&&(l(0,"ion-text",13),c(1,"La ciudad es obligatoria"),r())}function di(t,o){if(t&1&&_(0,pi,2,0,"ion-text",13),t&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.city"))==null||n.errors==null)&&n.errors.required?0:-1)}}function _i(t,o){t&1&&(l(0,"ion-text",13),c(1,"La direcci\xF3n es obligatoria"),r())}function fi(t,o){if(t&1&&_(0,_i,2,0,"ion-text",13),t&2){let n,e=u(2);p(!((n=e.registerForm.get("personalData.address"))==null||n.errors==null)&&n.errors.required?0:-1)}}function gi(t,o){if(t&1){let n=D();l(0,"div",3)(1,"div",8)(2,"ion-label",22),c(3,"Nombre"),r(),l(4,"ion-input",23),x("ionFocus",function(){C(n);let i=u();return h(i.controlFocus.emit("personalData"))}),S(5,"ion-icon",24),r(),_(6,oi,1,1),r(),l(7,"div",8)(8,"ion-label",9),c(9,"Apellidos"),r(),l(10,"ion-input",25),x("ionFocus",function(){C(n);let i=u();return h(i.controlFocus.emit("personalData"))}),S(11,"ion-icon",24),r(),_(12,ri,1,1),r(),l(13,"div",26)(14,"ion-label",9),c(15,"Pa\xEDs"),r(),l(16,"ion-select",27),x("ionChange",function(i){C(n);let a=u();return h(a.onCountryChange(i))}),S(17,"ion-icon",28),ne(18,li,2,2,"ion-select-option",29,Bt),r()(),l(20,"div",30)(21,"div",31)(22,"ion-label",9),c(23,"C\xF3digo postal"),r(),l(24,"ion-input",32),x("ionFocus",function(){C(n);let i=u();return h(i.controlFocus.emit("personalData"))}),S(25,"ion-icon",33),r(),_(26,mi,2,2)(27,ui,2,0,"ion-text",13),r(),l(28,"div",34)(29,"ion-label",9),c(30,"Ciudad"),r(),l(31,"ion-input",35),S(32,"ion-icon",36),r(),_(33,di,1,1),r()(),l(34,"div",8)(35,"ion-label",9),c(36,"Direcci\xF3n"),r(),l(37,"ion-input",37),x("ionFocus",function(){C(n);let i=u();return h(i.controlFocus.emit("personalData"))}),S(38,"ion-icon",38),r(),_(39,fi,1,1),r()()}if(t&2){let n,e,i,a,s,d,f=u();m(6),p(f.submitAttempts().personalData()&&((n=f.registerForm.get("personalData.firstName"))!=null&&n.errors)?6:-1),m(6),p(f.submitAttempts().personalData()&&((e=f.registerForm.get("personalData.lastName"))!=null&&e.errors)?12:-1),m(4),y("interfaceOptions",le(7,zt)),m(2),oe(f.countries),m(8),p(f.submitAttempts().personalData()&&((i=f.registerForm.get("personalData.zipcode"))!=null&&i.errors)?26:-1),m(),p(!((a=f.registerForm.get("personalData.zipcode"))==null||a.errors==null)&&a.errors.invalidZipCode||!((a=f.registerForm.get("personalData.zipcode"))==null||a.errors==null)&&a.errors.zipValidationFailed?27:-1),m(6),p(f.submitAttempts().personalData()&&((s=f.registerForm.get("personalData.city"))!=null&&s.errors)?33:-1),m(6),p(f.submitAttempts().personalData()&&((d=f.registerForm.get("personalData.address"))!=null&&d.errors)?39:-1)}}function Ci(t,o){if(t&1){let n=D();l(0,"div",41)(1,"ion-checkbox",44),x("ionChange",function(i){C(n);let a=u(2);return h(a.onRoleChange(i))}),c(2),r()()}if(t&2){let n=o.$implicit;m(),y("value",n),m(),fe(" ",n," ")}}function hi(t,o){if(t&1){let n=D();l(0,"div",4)(1,"div",8)(2,"ion-label",9),c(3,"Roles (opcional)"),r(),l(4,"ion-text",39),c(5,"Elige los roles que m\xE1s se identifiquen con tu actividad musical"),r(),l(6,"div",40),ne(7,Ci,3,2,"div",41,de),r()(),l(9,"div",42)(10,"ion-label",9),c(11,"Biograf\xEDa (opcional)"),r(),l(12,"ion-textarea",43),x("ionFocus",function(){C(n);let i=u();return h(i.controlFocus.emit("otherData"))}),r()()()}if(t&2){let n=u();m(7),oe(n.roles)}}function xi(t,o){t&1&&S(0,"ion-spinner",46)}function vi(t,o){if(t&1){let n=D();l(0,"div",6)(1,"ion-button",45),x("click",function(){C(n);let i=u();return h(i.nextStep.emit())}),c(2," Continuar "),_(3,xi,1,0,"ion-spinner",46),r(),l(4,"ion-text"),c(5,"\xBFYa tienes cuenta? "),l(6,"a",47),c(7,"Ingresar"),r()()()}if(t&2){let n=u();m(),y("disabled",n.loadingStates().email()),m(2),p(n.loadingStates().email()?3:-1),m(3),y("routerLink",le(3,qt))}}function bi(t,o){t&1&&S(0,"ion-spinner",46)}function yi(t,o){if(t&1){let n=D();l(0,"ion-button",48),x("click",function(){C(n);let i=u();return h(i.nextStep.emit())}),c(1," Continuar "),_(2,bi,1,0,"ion-spinner",46),r()}if(t&2){let n=u();y("disabled",n.loadingStates().userData()),m(2),p(n.loadingStates().userData()?2:-1)}}function Si(t,o){t&1&&S(0,"ion-spinner",46)}function wi(t,o){if(t&1){let n=D();l(0,"ion-button",48),x("click",function(){C(n);let i=u();return h(i.nextStep.emit())}),c(1," Continuar "),_(2,Si,1,0,"ion-spinner",46),r()}if(t&2){let n=u();y("disabled",n.loadingStates().personalData()),m(2),p(n.loadingStates().personalData()?2:-1)}}function Di(t,o){if(t&1&&(l(0,"ion-text",13),c(1),r()),t&2){let n=u(2);m(),re(n.authProviderErrorMessage())}}function Ei(t,o){t&1&&S(0,"ion-spinner",46)}function Ri(t,o){if(t&1){let n=D();_(0,Di,2,1,"ion-text",13),l(1,"ion-button",48),x("click",function(){C(n);let i=u();return h(i.formSubmit.emit())}),c(2," Finalizar "),_(3,Ei,1,0,"ion-spinner",46),r()}if(t&2){let n=u();p(n.submitAttempts().register()&&n.authProviderErrorMessage()?0:-1),m(),y("disabled",n.loadingStates().register()),m(2),p(n.loadingStates().register()?3:-1)}}var zt,qt,Bt,ee,wt=A(()=>{"use strict";R();ye();Ae();Qe();bt();yt();St();et();_t();se();Ye();R();Ae();zt=()=>({cssClass:"custom-action-sheet"}),qt=()=>["/auth/login"],Bt=(t,o)=>o.iso2;ee=(()=>{let o=class o{constructor(){this.fb=b(Te),this.emailValidator=new K,this.usernameValidator=new J,this.zipcodeValidator=new X,this.formReady=g(!1),this.step=M(1),this.nextStep=O(),this.formSubmit=O(),this.submitAttempts=M({email:g(!1),userData:g(!1),personalData:g(!1),register:g(!1)}),this.loadingStates=M({email:g(!1),userData:g(!1),personalData:g(!1),register:g(!1)}),this.controlFocus=O(),this.controlBlur=O(),this.uploadAvatar=O(),this.authProviderErrorMessage=M(""),this.formattedDate=g(new Date().toLocaleDateString("es-ES")),this.avatarDataURL=M(""),this.countries=U,this.roles=[q.Amateur,q.Professional,q.Collector,q.Student],H({atOutline:it,personCircleOutline:ut,keyOutline:st,checkmarkCircleOutline:ot,closeCircleOutline:at,calendarOutline:nt,globeOutline:rt,pinOutline:dt,mailOutline:mt,homeOutline:lt,locationOutline:ct,personOutline:pt}),ge(()=>{if(!this.formReady())return;let e=this.zipcodeValidator.cityResult(),i=this.registerForm.get("personalData.city");e&&i&&i.setValue(e)})}ngOnInit(){this.initForm(),this.formReady.set(!0)}initForm(){this.registerForm=this.fb.group({emailData:this.fb.group({email:this.fb.control("",{validators:[w.required,w.email],asyncValidators:[this.emailValidator.validate()],updateOn:"blur"})}),userData:this.fb.group({username:this.fb.control("",{validators:[w.required,w.minLength(4)],asyncValidators:[this.usernameValidator.validate()],updateOn:"blur"}),password:this.fb.control("",{validators:[w.required,w.pattern(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/)],updateOn:"blur"})}),personalData:this.fb.group({firstName:this.fb.control("",{validators:[w.required],updateOn:"blur"}),lastName:this.fb.control("",{validators:[w.required],updateOn:"blur"}),address:this.fb.control("",{validators:[w.required],updateOn:"blur"}),country:this.fb.control("Espa\xF1a",{validators:[w.required],updateOn:"blur"}),zipcode:this.fb.control("",{validators:[w.required,w.minLength(3)],asyncValidators:[this.zipcodeValidator.validate()],updateOn:"blur"}),city:this.fb.control("",{validators:[w.required],updateOn:"blur"})}),otherData:this.fb.group({roles:this.fb.array([]),bio:this.fb.control("")})})}onRoleChange(e){let i=this.registerForm.get("otherData.roles");if(e.detail.checked)i.push(this.fb.control(e.detail.value));else{let a=i.controls.findIndex(s=>s.value===e.detail.value);a>=0&&i.removeAt(a)}}onCountryChange(e){return v(this,null,function*(){let i=e.detail.value,a=this.registerForm.get("personalData.country"),s=this.registerForm.get("personalData.zipcode");a==null||a.setValue(i),s==null||s.updateValueAndValidity()})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=$({type:o,selectors:[["app-register-form"]],inputs:{step:[1,"step"],submitAttempts:[1,"submitAttempts"],loadingStates:[1,"loadingStates"],authProviderErrorMessage:[1,"authProviderErrorMessage"],avatarDataURL:[1,"avatarDataURL"]},outputs:{nextStep:"nextStep",formSubmit:"formSubmit",controlFocus:"controlFocus",controlBlur:"controlBlur",uploadAvatar:"uploadAvatar"},decls:10,vars:3,consts:[[3,"formGroup"],["formGroupName","emailData",1,"inputs-container"],["formGroupName","userData",1,"inputs-container"],["formGroupName","personalData",1,"inputs-container"],["formGroupName","otherData",1,"inputs-container"],[1,"buttons-container"],[1,"button-subtitle-container"],["type","button",3,"disabled"],[1,"input-wrapper"],["color","light",1,"custom"],["formControlName","email","type","email",1,"custom",3,"ionFocus","ionBlur"],["slot","start","name","at-outline"],["slot","end","color","danger","name","close-circle-outline"],["color","danger",1,"error-text"],["formControlName","username","type","text",1,"custom",3,"ionFocus"],["name","person-circle-outline","slot","start"],["formControlName","password","type","password",1,"custom",3,"ionFocus","clearOnEdit"],["slot","start","name","key-outline"],["slot","end","color","light"],[1,"input-wrapper-row"],["slot","start",3,"click"],["alt","Avatar de usuario por defecto",3,"src"],[1,"custom"],["formControlName","firstName","type","text",1,"custom",3,"ionFocus"],["slot","start","name","person-outline"],["formControlName","lastName","type","text",1,"custom",3,"ionFocus"],[1,"input-wrapper","country-input-wrapper"],["formControlName","country","aria-label","Country","interface","action-sheet",1,"custom","select-input",3,"ionChange","interfaceOptions"],["slot","start","name","globe-outline"],["color","light",3,"value"],[1,"zipcode-city-container"],[1,"input-wrapper","zipcode-input"],["formControlName","zipcode","type","text","maxlength","5","inputmode","numeric",1,"custom",3,"ionFocus"],["name","mail-outline","slot","start"],[1,"input-wrapper","city-input"],["formControlName","city","type","text",1,"custom"],["slot","start","name","location-outline"],["formControlName","address","type","text",1,"custom",3,"ionFocus"],["slot","start","name","home-outline"],[1,"roles-subtitle"],[1,"checkboxes-container"],[1,"checkbox-wrapper"],[1,"input-wrapper","bio-wrapper"],["formControlName","bio",1,"custom",3,"ionFocus"],["labelPlacement","end","color","light",3,"ionChange","value"],[3,"click","disabled"],["name","crescent"],[1,"inline-link",3,"routerLink"],["type","button",3,"click","disabled"]],template:function(i,a){if(i&1&&(l(0,"form",0),_(1,Ht,8,2,"div",1)(2,ii,19,4,"div",2)(3,gi,40,8,"div",3)(4,hi,13,0,"div",4),r(),l(5,"div",5),_(6,vi,8,4,"div",6)(7,yi,3,2,"ion-button",7)(8,wi,3,2,"ion-button",7)(9,Ri,4,3),r()),i&2){let s,d;y("formGroup",a.registerForm),m(),p((s=a.step())===1?1:s===2?2:s===3?3:s===4?4:-1),m(5),p((d=a.step())===1?6:d===2?7:d===3?8:d===4?9:-1)}},dependencies:[ze,be,$e,Be,Ne,je,qe,ke,Ge,Ie,Ue,Ze,Le,Pe,De,Se,we,Ve,Ee,Fe,Re],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1 0 0;justify-content:space-between;gap:3rem}ion-datetime-button.custom[_ngcontent-%COMP%]{min-height:3rem}ion-datetime-button[_ngcontent-%COMP%]::part(native){background-color:var(--ion-color-dark-tint);display:flex;flex-direction:row;align-items:center;align-self:stretch;gap:.5rem}.zipcode-city-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:1rem}.zipcode-city-container[_ngcontent-%COMP%]   .zipcode-input[_ngcontent-%COMP%]{width:40%;min-height:8rem}.zipcode-city-container[_ngcontent-%COMP%]   .city-input[_ngcontent-%COMP%]{width:55%}.country-input-wrapper[_ngcontent-%COMP%]{width:100%}.roles-subtitle[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--ion-color-light-shade);font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.checkboxes-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem}.checkbox-wrapper[_ngcontent-%COMP%]{display:flex;width:8rem}.bio-wrapper[_ngcontent-%COMP%]{margin-top:1rem}.buttons-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.buttons-container[_ngcontent-%COMP%]:has(ion-button.ios){margin-bottom:24px}.buttons-container[_ngcontent-%COMP%]   .button-subtitle-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}.custom-action-sheet[_ngcontent-%COMP%]{--button-color: var(--ion-color-light);--button-background-hover: var(--ion-color-light-tint);--button-color-activated: var(--ion-color-light-shade)}"]});let t=o;return t})()});var Dt,Et=A(()=>{"use strict";se();R();Dt=(()=>{let o=class o{transform(e,...i){let a=U.find(s=>s.nameES.toUpperCase()===e.toUpperCase());return a?a.iso2:""}};o.\u0275fac=function(i){return new(i||o)},o.\u0275pipe=pe({name:"countryNameToCode",type:o,pure:!0}),o.\u0275prov=Z({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})()});var Rt,Ft=A(()=>{"use strict";R();Lt();Ye();Ot();Nt();Mt();Et();R();Rt=(()=>{let o=class o{constructor(){this.authService=b(Xe),this.cartService=b(ft),this.cache=b(We),this.countryNameToCodePipe=b(Dt),this.profilePictureDataURL=g(null),this.loading=g(!1),this.errorMessage=g(""),this.registerState=I(()=>{var e;return{profilePictureDataURL:(e=this.profilePictureDataURL())!=null?e:"",loading:this.loading(),errorMessage:this.errorMessage()}}),this.getAvatarData=()=>v(this,null,function*(){try{let e=yield vt.getPhoto({quality:80,allowEditing:!1,resultType:xt.DataUrl,source:ht.Prompt});this.profilePictureDataURL.set(e.dataUrl)}catch(e){console.error(`Error al seleccionar avatar: ${e}`)}}),this.setAvatarDataNotNative=e=>{var d;let i=e.target;if(!((d=i.files)!=null&&d.length))return;let a=i.files[0],s=new FileReader;s.onload=()=>{let f=s.result;this.profilePictureDataURL.set(f)},s.readAsDataURL(a)},this.removeProfilePicture=()=>v(this,null,function*(){this.profilePictureDataURL.set(null)}),this.registerUser=e=>v(this,null,function*(){var i,a,s,d,f,E,F,T,L,V,P,te;this.loading.set(!0);try{let k=yield this.cache.get("fcmToken"),me=yield this.authService.register({method:"email",userData:{email:(i=e.email)!=null?i:"",username:(a=e.username)!=null?a:"",password:(s=e.password)!=null?s:"",name:{first:(d=e.firstName)!=null?d:"",last:(f=e.lastName)!=null?f:""},address:{line1:(E=e.address)!=null?E:"",city:(F=e.city)!=null?F:"",country:(T=e.country)!=null?T:"",countryCode:this.countryNameToCodePipe.transform(e.country),zipcode:(L=e.zipcode)!=null?L:""},roles:(V=e.roles)!=null?V:[],bio:(P=e.bio)!=null?P:"",fcmToken:k,profilePictureDataURL:(te=this.profilePictureDataURL())!=null?te:""}});Ke(me)&&(yield this.cartService.createCart(me._id)),this.loading.set(!1),this.errorMessage.set("")}catch(k){console.error(k),this.loading.set(!1),this.errorMessage.set(k)}})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=Z({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})()});function Vi(t,o){t&1&&(l(0,"h1"),c(1,"\xBFCu\xE1l es tu email?"),r(),l(2,"h4"),c(3,"Introduce el email con el que quieres iniciar sesi\xF3n en BeatMarket"),r())}function Ti(t,o){t&1&&(l(0,"h1"),c(1,"Rellena tus datos de usuario"),r())}function Pi(t,o){t&1&&(l(0,"h1"),c(1,"Rellena tus datos personales"),r())}function Ai(t,o){t&1&&(l(0,"h1"),c(1,"Cu\xE9ntanos sobre ti"),r())}var Fi,On,ki=A(()=>{R();Vt();Pt();Qe();et();_t();wt();Ft();kt();ye();It();R();Fi=["fileInput"];On=(()=>{let o=class o{constructor(){this.router=b(ve),this.registerService=b(Rt),this.registerFormComponent=ie(ee),this.step=g(1),this.totalSteps=4,this.progressBarValue=I(()=>this.step()/this.totalSteps),this.errorMessage=I(()=>this.registerService.registerState().errorMessage),this.profilePictureDataURL=I(()=>this.registerService.registerState().profilePictureDataURL),this.submitAttempts={email:g(!1),userData:g(!1),personalData:g(!1),register:g(!1)},this.loadingStates={email:g(!1),userData:g(!1),personalData:g(!1),register:Ce(()=>this.registerService.registerState().loading)},this.nextStep=()=>{var e,i,a;if(this.step()===1){this.submitAttempts.email.set(!0),this.handleNextStepEmail((e=this.registerFormComponent())==null?void 0:e.registerForm);return}if(this.step()===2){this.submitAttempts.userData.set(!0),this.handleNextStepUserData((i=this.registerFormComponent())==null?void 0:i.registerForm);return}if(this.step()===3){this.submitAttempts.personalData.set(!0),this.handleNextStepPersonalData((a=this.registerFormComponent())==null?void 0:a.registerForm);return}},this.prevStep=()=>{this.step.set(this.step()-1)},this.fileInput=ie("fileInput"),this.onAvatarUpload=()=>v(this,null,function*(){var e;Je.isNativePlatform()?yield this.registerService.getAvatarData():(e=this.fileInput())==null||e.nativeElement.click()}),this.handleFileInput=e=>{this.registerService.setAvatarDataNotNative(e)},this.handleNextStepEmail=e=>v(this,null,function*(){var a;let i=e==null?void 0:e.get("emailData.email");if(i&&(i==null||i.updateValueAndValidity(),i.pending&&(this.loadingStates.email.set(!0),yield N(i.statusChanges.pipe(G(s=>s!=="PENDING"))),this.loadingStates.email.set(!1)),(a=e==null?void 0:e.get("emailData"))!=null&&a.valid)){this.step.set(this.step()+1);return}}),this.handleNextStepUserData=e=>v(this,null,function*(){var s;let i=e==null?void 0:e.get("userData.username"),a=e==null?void 0:e.get("userData.password");!i||!a||(i==null||i.updateValueAndValidity(),a==null||a.updateValueAndValidity(),i.pending&&(this.loadingStates.userData.set(!0),yield N(i.statusChanges.pipe(G(d=>d!=="PENDING"))),this.loadingStates.userData.set(!1)),(s=e==null?void 0:e.get("userData"))!=null&&s.valid&&this.step.set(this.step()+1))}),this.handleNextStepPersonalData=e=>v(this,null,function*(){var F;let i=e==null?void 0:e.get("personalData.firstName"),a=e==null?void 0:e.get("personalData.lastName"),s=e==null?void 0:e.get("personalData.address"),d=e==null?void 0:e.get("personalData.city"),f=e==null?void 0:e.get("personalData.zipcode"),E=e==null?void 0:e.get("personalData.country");!i||!a||!s||!d||!f||!E||(i==null||i.updateValueAndValidity(),a==null||a.updateValueAndValidity(),s==null||s.updateValueAndValidity(),d==null||d.updateValueAndValidity(),E==null||E.updateValueAndValidity(),i.pending&&(this.loadingStates.personalData.set(!0),yield N(i.statusChanges.pipe(G(T=>T!=="PENDING"))),this.loadingStates.personalData.set(!1)),(F=e==null?void 0:e.get("personalData"))!=null&&F.valid&&this.step.set(this.step()+1))}),H({arrowBackOutline:tt})}ionViewDidLeave(){this.registerService.removeProfilePicture()}onControlFocus(e){this.submitAttempts.email.set(!1),this.submitAttempts.userData.set(!1),this.submitAttempts.personalData.set(!1),this.submitAttempts.register.set(!1)}handleRegister(){return v(this,null,function*(){var i;let e=(i=this.registerFormComponent())==null?void 0:i.registerForm;yield this.registerService.registerUser(z(z(z(z({},e==null?void 0:e.value.emailData),e==null?void 0:e.value.userData),e==null?void 0:e.value.personalData),e==null?void 0:e.value.otherData)),this.errorMessage()||this.router.navigate(["/auth/welcome"])})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=$({type:o,selectors:[["app-register"]],viewQuery:function(i,a){i&1&&(ae(a.registerFormComponent,ee,5),ae(a.fileInput,Fi,5)),i&2&&_e(2)},decls:13,vars:12,consts:[["fileInput",""],["type","arrow-back","title","Registro",3,"backPressed","showSearch","showCart","showProgressBar","progressBarValue","backActionType"],[3,"fullscreen"],[1,"container"],[1,"title-form-container"],[1,"title-container"],[3,"controlFocus","uploadAvatar","nextStep","formSubmit","step","submitAttempts","loadingStates","avatarDataURL","authProviderErrorMessage"],["type","file","accept","image/*","hidden","",3,"change"]],template:function(i,a){if(i&1){let s=D();l(0,"ion-header")(1,"app-toolbar",1),x("backPressed",function(){return C(s),h(a.prevStep())}),r()(),l(2,"ion-content",2)(3,"div",3)(4,"div",4)(5,"div",5),_(6,Vi,4,0)(7,Ti,2,0,"h1")(8,Pi,2,0,"h1")(9,Ai,2,0,"h1"),r(),l(10,"app-register-form",6),x("controlFocus",function(f){return C(s),h(a.onControlFocus(f))})("uploadAvatar",function(){return C(s),h(a.onAvatarUpload())})("nextStep",function(){return C(s),h(a.nextStep())})("formSubmit",function(){return C(s),h(a.handleRegister())}),r(),l(11,"input",7,0),x("change",function(f){return C(s),h(a.handleFileInput(f))}),r()()()()}if(i&2){let s;m(),y("showSearch",!1)("showCart",!1)("showProgressBar",!0)("progressBarValue",a.progressBarValue())("backActionType",a.step()===1?"default":"emit"),m(),y("fullscreen",!0),m(4),p((s=a.step())===1?6:s===2?7:s===3?8:s===4?9:-1),m(4),y("step",a.step())("submitAttempts",a.submitAttempts)("loadingStates",a.loadingStates)("avatarDataURL",a.profilePictureDataURL())("authProviderErrorMessage",a.errorMessage())}},dependencies:[gt,Oe,Me,ee],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;min-height:100%;gap:1rem}.title-form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;gap:1.5rem}.title-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-light)}"]});let t=o;return t})()});ki();export{On as RegisterPage};
