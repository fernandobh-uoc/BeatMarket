import{a as he,b as Ee}from"./chunk-SZG4CGCH.js";import"./chunk-SWFIUNRV.js";import{D as fe,a as x,b as pe,c as de,k as ge}from"./chunk-D4UN2WVJ.js";import"./chunk-26KUR5UJ.js";import{a as me,b as Se,p as ue,q as Me,v as ce,w as xe}from"./chunk-GIZGGZ62.js";import{$ as oe,Ba as le,R as ee,Z as te,aa as ie,c as T,ca as ne,d as J,e as K,i as W,j as X,ka as re,l as Y,na as se,s as Z,t as M,u as $,v as O,wa as ae}from"./chunk-XVXSUTZI.js";import{Aa as v,B as R,F as c,Fa as _,Ga as L,Ib as Q,Jb as z,Nb as H,Oa as N,Pa as B,Sa as u,Ta as U,X as I,Y as C,_ as f,_a as k,ba as a,ga as j,ha as y,jb as S,kb as D,lb as q,ma as h,pb as b,sa as p,ua as g,xb as G,ya as r,za as n,zb as ye}from"./chunk-LBGYGD76.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{f as P,k as A,m as V,o as F}from"./chunk-FIPIWZQS.js";function Le(e,t){e&1&&(r(0,"ion-text",4),u(1,"Introduce un email o un nombre de usuario"),n())}function ke(e,t){e&1&&(r(0,"ion-label",6),u(1,"\xBFOlvidaste la contrase\xF1a?"),n()),e&2&&p("routerLink",k(1,Ie))}function Te(e,t){e&1&&(r(0,"ion-text",4),u(1,"Introduce una contrase\xF1a"),n())}function Oe(e,t){if(e&1&&(r(0,"ion-text",13),u(1),n()),e&2){let w=L(2);a(),U(w.authErrorMessage())}}function Ae(e,t){if(e&1&&h(0,Te,2,0,"ion-text",4)(1,Oe,2,1,"ion-text",13),e&2){let w,i=L();g(!((w=i.loginForm.get("password"))==null||w.errors==null)&&w.errors.required?0:-1),a(),g(i.authErrorMessage()?1:-1)}}function Ve(e,t){e&1&&v(0,"ion-spinner",11)}var Pe,Ie,E,we=P(()=>{"use strict";b();O();H();le();pe();fe();b();O();Pe=()=>["/auth/register"],Ie=()=>["/auth/password-reset"];E=(()=>{var t,be;let i=class i{constructor(){A(this,t);this.fb=c(Z),this.submitAttempt=C(!1),this.loading=C(!1),this.forgotPasswordVisible=C(!1),this.authErrorMessage=C(""),this.controlFocus=I(),this.formSubmit=I(),x({closeCircleOutline:ge})}ngOnInit(){V(this,t,be).call(this)}};t=new WeakSet,be=function(){this.loginForm=this.fb.group({emailOrUsername:["",{validators:[T.required],updateOn:"blur"}],password:["",{validators:[T.required],updateOn:"blur"}]})},i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=y({type:i,selectors:[["app-login-form"]],inputs:{submitAttempt:[1,"submitAttempt"],loading:[1,"loading"],forgotPasswordVisible:[1,"forgotPasswordVisible"],authErrorMessage:[1,"authErrorMessage"]},outputs:{controlFocus:"controlFocus",formSubmit:"formSubmit"},decls:22,vars:8,consts:[[3,"formGroup"],[1,"input-wrapper"],["color","light",1,"custom"],["formControlName","emailOrUsername","type","email",1,"custom",3,"ionFocus"],["color","danger",1,"error-text"],[1,"password-labels-wrapper"],[1,"custom","link","forgot-password",3,"routerLink"],["formControlName","password","type","password",1,"custom",3,"ionFocus"],["slot","end","color","light"],[1,"button-subtitle-container"],[3,"click","disabled"],["name","crescent"],[1,"inline-link",3,"routerLink"],["color","danger",1,"error-text","auth-error"]],template:function(l,o){if(l&1&&(r(0,"form",0)(1,"div",1)(2,"ion-label",2),u(3,"Email o nombre de usuario"),n(),r(4,"ion-input",3),_("ionFocus",function(){return o.controlFocus.emit("emailOrUsername")}),n(),h(5,Le,2,0,"ion-text",4),n(),r(6,"div",1)(7,"div",5)(8,"ion-label",2),u(9,"Contrase\xF1a"),n(),h(10,ke,2,2,"ion-label",6),n(),r(11,"ion-input",7),_("ionFocus",function(){return o.controlFocus.emit("password")}),v(12,"ion-input-password-toggle",8),n(),h(13,Ae,2,2),n()(),r(14,"div",9)(15,"ion-button",10),_("click",function(){return o.formSubmit.emit(o.loginForm.value)}),u(16," Ingresar "),h(17,Ve,1,0,"ion-spinner",11),n(),r(18,"ion-text"),u(19,"\xBFNo tienes cuenta? "),r(20,"a",12),u(21,"Reg\xEDstrate"),n()()()),l&2){let d;p("formGroup",o.loginForm),a(5),g(o.submitAttempt()&&(!((d=o.loginForm.get("emailOrUsername"))==null||d.errors==null)&&d.errors.required)?5:-1),a(5),g(o.forgotPasswordVisible()?10:-1),a(3),g(o.submitAttempt()?13:-1),a(2),p("disabled",o.loading()),a(2),g(o.loading()?17:-1),a(3),p("routerLink",k(7,Pe))}},dependencies:[re,z,se,ne,ae,ie,ee,M,W,J,K,$,X,Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1;justify-content:space-between}form[_ngcontent-%COMP%]{margin-top:4rem}.link[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer}.password-labels-wrapper[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center}.password-labels-wrapper[_ngcontent-%COMP%]   .forgot-password[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem);text-decoration:underline;cursor:pointer}.button-subtitle-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}.auth-error[_ngcontent-%COMP%]{margin-top:1rem}"]});let e=i;return e})()});var Fe,Ce=P(()=>{"use strict";b();Se();xe();Me();b();Fe=(()=>{let t=class t{constructor(){this.authService=c(ce),this.userRepository=c(me),this.cache=c(ue),this.loading=f(!1),this.errorMessage=f(""),this.loginState=S(()=>({loading:this.loading(),errorMessage:this.errorMessage()}))}login(m){return F(this,arguments,function*({emailOrUsername:i,password:s}){this.loading.set(!0),this.errorMessage.set("");let l=i,o=null,d=yield this.cache.get("fcmToken");try{if(o=yield this.userRepository.getUserByEmail(i),!o){if(o=yield this.userRepository.getUserByUsername(i),!o){this.errorMessage.set("Ese usuario no existe."),this.loading.set(!1);return}l=o.email}yield this.authService.login({method:"email",credentials:{email:l,password:s}}),yield this.userRepository.updateUser({_id:o._id,fcmToken:d}),this.errorMessage.set(""),this.loading.set(!1)}catch(ve){this.loading.set(!1),this.errorMessage.set(ve)}})}resetPassword(){return F(this,null,function*(){})}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=R({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})()});var ct,Re=P(()=>{b();ye();O();H();le();we();pe();fe();Ce();Ee();b();ct=(()=>{let t=class t{constructor(){this.router=c(Q),this.loginService=c(Fe),this.loginFormComponent=j(E),this.submitAttempt=f(!1),this.loading=S(()=>this.loginService.loginState().loading),this.errorMessage=q(()=>{var i;return(i=this.loginService.loginState().errorMessage)!=null?i:""}),this.forgotPasswordVisible=f(!1),x({arrowBackOutline:de}),D(()=>{this.errorMessage()&&this.forgotPasswordVisible.set(!0)})}onControlFocus(i){this.submitAttempt.set(!1),this.errorMessage.set("")}login(m){return F(this,arguments,function*({emailOrUsername:i,password:s}){var l,o;this.submitAttempt.set(!0),this.errorMessage.set(""),(o=(l=this.loginFormComponent())==null?void 0:l.loginForm)!=null&&o.valid&&(yield this.loginService.login({emailOrUsername:i,password:s}),this.errorMessage()||this.router.navigate(["/tabs"]))})}};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=y({type:t,selectors:[["app-login"]],viewQuery:function(s,m){s&1&&N(m.loginFormComponent,E,5),s&2&&B()},decls:5,vars:7,consts:[["type","arrow-back","title","Ingresar",3,"showSearch","showCart"],[3,"fullscreen"],[1,"container"],[3,"controlFocus","formSubmit","authErrorMessage","submitAttempt","loading","forgotPasswordVisible"]],template:function(s,m){s&1&&(r(0,"ion-header"),v(1,"app-toolbar",0),n(),r(2,"ion-content",1)(3,"div",2)(4,"app-login-form",3),_("controlFocus",function(o){return m.onControlFocus(o)})("formSubmit",function(o){return m.login(o)}),n()()()),s&2&&(a(),p("showSearch",!1)("showCart",!1),a(),p("fullscreen",!0),a(2),p("authErrorMessage",m.errorMessage())("submitAttempt",m.submitAttempt())("loading",m.loading())("forgotPasswordVisible",m.forgotPasswordVisible()))},dependencies:[he,oe,E,te,G,M],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;min-height:100%;gap:1rem}"]});let e=t;return e})()});Re();export{ct as LoginPage};
