import{a as ce,b as Pe}from"./chunk-PVNJ44BD.js";import{c as x,d as ye}from"./chunk-GUENO4VH.js";import"./chunk-FBV753BW.js";import{a as d,d as Ce}from"./chunk-CC7RULIL.js";import{a as le,b as we}from"./chunk-EJ3JXVBZ.js";import"./chunk-6NUGH5FF.js";import{h as C,k as he,t as se,u as ve}from"./chunk-VQCHUAXV.js";import"./chunk-K5TY53DO.js";import"./chunk-4XKNA7IF.js";import"./chunk-4FRKXPG4.js";import"./chunk-E4HNE3PW.js";import"./chunk-P2UHFIXP.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-GTZXGHKK.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import{Ca as ae,U as Y,V as Z,W,X as ee,Y as te,_ as ne,aa as re,la as ie,oa as oe}from"./chunk-BQ2OOKCX.js";import{$ as l,$a as N,D as y,Ea as I,Ib as J,Lb as K,Ma as U,Na as B,Pa as Q,Pb as X,Qa as h,Ra as k,Sa as V,W as z,Y as L,Za as $,_a as R,ab as G,ea as q,fa as _,hb as u,ia as F,ka as O,kb as E,nb as v,qa as P,sa as S,ua as D,va as H,wa as a,xa as i,ya as p,z as j}from"./chunk-DHHGUDQP.js";import"./chunk-OHMQXWFK.js";import"./chunk-S6VCIYOJ.js";import"./chunk-25CU3KXX.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{f as w,o as b}from"./chunk-FIPIWZQS.js";var de,me=w(()=>{"use strict";v();de=(()=>{let t=class t{transform(n,e=100){return n?n.split(" ").length>e?n.split(" ").splice(0,e).join(" ")+"...":n:""}};t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=F({name:"truncateTextLines",type:t,pure:!0});let r=t;return r})()});function Me(r,t){if(r&1&&(a(0,"ion-card",1),p(1,"div",2),a(2,"div",3)(3,"ion-card-header")(4,"ion-card-title",4),h(5),i(),a(6,"ion-card-subtitle",5),h(7),R(8,"truncateTextLines"),i()(),a(9,"ion-card-content",6),h(10),R(11,"formatCurrency"),i()()()),r&2){let g,n,e=t.$implicit;P("routerLink",$(12,_e,"/tabs/post-detail/"+e._id)),l(),Q("background-image: url('",e.mainImageURL,"')"),l(4),k(e.article==null?null:e.article.category),l(2),k(G(8,7,(g=e.title)!==null&&g!==void 0?g:"",2)),l(3),V(" ",N(11,10,(n=e.price)!==null&&n!==void 0?n:0)," ")}}var _e,xe,pe,ue=w(()=>{"use strict";v();ae();me();Pe();X();v();_e=r=>[r],xe=(r,t)=>t._id;pe=(()=>{let t=class t{constructor(){this.posts=z([])}ngOnInit(){}};t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=_({type:t,selectors:[["app-post-cards-row"]],inputs:{posts:[1,"posts"]},decls:3,vars:0,consts:[[1,"cards-row"],[1,"card",3,"routerLink"],[1,"card-image"],[1,"card-content-wrapper"],[1,"card-title"],[1,"card-subtitle"],[1,"card-price"]],template:function(e,o){e&1&&(a(0,"div",0),D(1,Me,12,14,"ion-card",1,xe),i()),e&2&&(l(),H(o.posts()))},dependencies:[K,Z,ee,te,W,Y,de,ce],styles:[".cards-row[_ngcontent-%COMP%]{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;justify-content:flex-start}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:0 0 auto;width:40dvw;height:35dvh;min-height:fit-content;margin-right:1rem;scroll-snap-align:start;cursor:pointer}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]{background-position:center;background-size:cover;background-repeat:no-repeat;height:40%}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]{height:60%;display:flex;flex:1 1 auto;flex-direction:column;justify-content:space-between}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{color:var(--ion-color-medium-tint);text-transform:uppercase;font-size:var(--label-large-size, .875rem);font-style:normal;font-weight:var(--label-large-weight-prominent, 600);line-height:var(--label-large-line-height, 1.25rem);letter-spacing:var(--label-large-letter-spacing, .00625rem)}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]   .card-subtitle[_ngcontent-%COMP%]{color:var(--ion-color-light);font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.cards-row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-content-wrapper[_ngcontent-%COMP%]   .card-price[_ngcontent-%COMP%]{color:var(--ion-color-light);font-size:var(--body-large-size, 1rem);font-style:normal;font-weight:var(--body-large-weight-prominent, 600);line-height:var(--body-large-line-height, 1.5rem);letter-spacing:var(--body-large-tracking, .03125rem)}.cards-row[_ngcontent-%COMP%]::-webkit-scrollbar, .cards-row[_ngcontent-%COMP%]::-webkit-scrollbar-button, .cards-row[_ngcontent-%COMP%]::-webkit-scrollbar-track{display:none}"]});let r=t;return r})()});var ge,fe=w(()=>{"use strict";v();Ce();he();we();ve();v();ge=(()=>{let t=class t{constructor(){this.authService=y(se),this.postRepository=y(le),this.userRoles=u(()=>{var n,e;return(e=(n=this.authService.currentUser())==null?void 0:n.roles)!=null?e:[]}),this.latestPosts=E({request:()=>{var n,e;return(e=(n=this.authService.currentUser())==null?void 0:n._id)!=null?e:""},loader:e=>b(this,[e],function*({request:n}){var o;if(!n)return[];try{let c=yield this.postRepository.queryPosts({filters:[{field:"user.userId",operator:"!=",value:n},{field:"isActive",operator:"==",value:!0}],orderBy:{field:"createdAt",direction:"desc"},limit:10});return c!=null?c:[]}catch(c){return this.errorMessage.set((o=c==null?void 0:c.message)!=null?o:"Unknown error"),[]}})}),this.recommendedPosts=E({request:()=>{var n,e;return(e=(n=this.authService.currentUser())==null?void 0:n._id)!=null?e:""},loader:e=>b(this,[e],function*({request:n}){var o,c;if(!n)return[];try{let f={},m=new Set,A=Object.values(d).filter(s=>s!==d.None);this.userRoles().includes(C.Amateur)&&[...A.filter(s=>s!==d.Professional)].forEach(s=>m.add(s)),this.userRoles().includes(C.Professional)&&[...A.filter(s=>s!==d.Recordings)].forEach(s=>m.add(s)),this.userRoles().includes(C.Collector)&&(m.add(d.Recordings),m.add(d.Other)),this.userRoles().includes(C.Student)&&(m.add(d.Instruments),m.add(d.Accessories),m.add(d.Books)),m.size>0&&(f.filters=[{and:[{field:"user.userId",operator:"!=",value:(o=this.authService.currentUser())==null?void 0:o._id},{or:Array.from(m).map(s=>({field:"article.category",operator:"==",value:s}))}]}]),f.limit=10;let M=yield this.postRepository.queryPosts(f);return M!=null?M:[]}catch(f){return this.errorMessage.set((c=f==null?void 0:f.message)!=null?c:"Unknown error"),[]}})}),this.errorMessage=L(""),this.homeState=u(()=>{var n,e;return{latestPosts:(n=this.latestPosts.value())!=null?n:[],recommendedPosts:(e=this.recommendedPosts.value())!=null?e:[],loading:this.latestPosts.isLoading()||this.recommendedPosts.isLoading(),errorMessage:this.errorMessage()}})}reloadResources(){this.latestPosts.reload(),this.recommendedPosts.reload()}};t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=j({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})()});function be(r,t){r&1&&(a(0,"div",5),p(1,"ion-spinner",7),i())}function Oe(r,t){if(r&1&&p(0,"app-post-cards-row",6),r&2){let g=I();P("posts",g.latestPosts())}}function Se(r,t){r&1&&(a(0,"div",5),p(1,"ion-spinner",7),i())}function Ie(r,t){if(r&1&&p(0,"app-post-cards-row",6),r&2){let g=I();P("posts",g.recommendedPosts())}}var We,ke=w(()=>{v();ae();X();ye();ue();fe();v();We=(()=>{let t=class t{constructor(){this.route=y(J),this.homeService=y(ge),this.latestPosts=u(()=>this.homeService.homeState().latestPosts),this.recommendedPosts=u(()=>this.homeService.homeState().recommendedPosts),this.loading=u(()=>this.homeService.homeState().loading),this.errorMessage=u(()=>this.homeService.homeState().errorMessage),this.toolbar=q(x)}ionViewDidEnter(){this.homeService.reloadResources()}ionViewDidLeave(){var n;(n=this.toolbar())==null||n.searchActive.set(!1)}};t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=_({type:t,selectors:[["app-home"]],viewQuery:function(e,o){e&1&&U(o.toolbar,x,5),e&2&&B()},decls:14,vars:3,consts:[["type","menu","title","Inicio"],[3,"fullscreen"],[1,"container"],[1,"title-cards-row-container"],[1,"title-cards-row"],[1,"loading-spinner-container"],[3,"posts"],["name","crescent"]],template:function(e,o){e&1&&(a(0,"ion-header"),p(1,"app-toolbar",0),i(),a(2,"ion-content",1)(3,"div",2)(4,"div",3)(5,"ion-text",4),h(6,"\xDAltimos anuncios"),i(),O(7,be,2,0,"div",5)(8,Oe,1,1,"app-post-cards-row",6),i(),a(9,"div",3)(10,"ion-text",4),h(11,"Anuncios destacados"),i(),O(12,Se,2,0,"div",5)(13,Ie,1,1,"app-post-cards-row",6),i()()()),e&2&&(l(2),P("fullscreen",!0),l(5),S(o.loading()?7:8),l(5),S(o.loading()?12:13))},dependencies:[ie,oe,pe,x,re,ne],styles:[".container[_ngcontent-%COMP%]{margin-top:2rem;display:flex;flex-direction:column;justify-content:flex-start;gap:3rem}.container[_ngcontent-%COMP%]   .loading-spinner-container[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:flex-start;align-items:center;padding-left:1rem;min-height:15.25rem}.container[_ngcontent-%COMP%]   .title-cards-row-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.container[_ngcontent-%COMP%]   .title-cards-row[_ngcontent-%COMP%]{font-size:var(--headline-small-size, 1.5rem);font-style:normal;font-weight:var(--headline-small-weight, 400);line-height:var(--headline-small-line-height, 2rem);letter-spacing:var(--headline-small-tracking, 0rem)}"]});let r=t;return r})()});ke();export{We as HomePage};
