import{e as he,f as Ee}from"./chunk-2GV3WWDM.js";import{F as fe,a as S,b as de,d as pe,m as ge}from"./chunk-QZLDCAKT.js";import"./chunk-7QGFDW3N.js";import"./chunk-CVZVN4BI.js";import"./chunk-6RPMLJXL.js";import"./chunk-ZDSPE5PQ.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-ZSFULLTW.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import"./chunk-5WOL6UCU.js";import"./chunk-UCDHUJSY.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import"./chunk-7JRGKQWZ.js";import{f as me,g as Me,s as ce,t as Se,y as ue,z as xe}from"./chunk-WI56WTX3.js";import{Ca as le,S as ee,_ as te,aa as oe,ba as ie,c as T,d as J,da as ne,e as K,i as W,j as X,l as Y,la as re,oa as se,s as Z,t as M,u as $,v as O,xa as ae}from"./chunk-IBFAPW3Z.js";import{$ as a,D as d,Da as f,Ea as L,Gb as Q,Hb as z,Lb as H,Ma as j,Na as N,Qa as u,Ra as D,V as P,W as F,Y as h,Ya as I,ea as R,fa as v,hb as y,ib as U,jb as q,ka as _,nb as b,qa as c,sa as g,vb as G,wa as s,xa as n,xb as ye,ya as k,z as B}from"./chunk-S4NGLO4I.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{f as E,k as A,m as V,o as C}from"./chunk-FIPIWZQS.js";function Le(e,o){e&1&&(s(0,"ion-text",4),u(1,"Introduce un email o un nombre de usuario"),n())}function Ie(e,o){e&1&&(s(0,"ion-label",6),u(1,"\xBFOlvidaste la contrase\xF1a?"),n()),e&2&&c("routerLink",I(1,ke))}function Te(e,o){e&1&&(s(0,"ion-text",4),u(1,"Introduce una contrase\xF1a"),n())}function Oe(e,o){if(e&1&&(s(0,"ion-text",13),u(1),n()),e&2){let w=L(2);a(),D(w.authErrorMessage())}}function Ae(e,o){if(e&1&&_(0,Te,2,0,"ion-text",4)(1,Oe,2,1,"ion-text",13),e&2){let w,t=L();g(!((w=t.loginForm.get("password"))==null||w.errors==null)&&w.errors.required?0:-1),a(),g(t.authErrorMessage()?1:-1)}}function Ve(e,o){e&1&&k(0,"ion-spinner",11)}var Pe,ke,x,we=E(()=>{"use strict";b();O();H();le();de();fe();b();O();Pe=()=>["/auth/register"],ke=()=>["/auth/password-reset"];x=(()=>{var o,be;let t=class t{constructor(){A(this,o);this.fb=d(Z),this.submitAttempted=F(!1),this.loading=F(!1),this.forgotPasswordVisible=F(!1),this.authErrorMessage=F(""),this.controlFocus=P(),this.formSubmit=P(),S({closeCircleOutline:ge})}ngOnInit(){V(this,o,be).call(this)}};o=new WeakSet,be=function(){this.loginForm=this.fb.group({emailOrUsername:["",{validators:[T.required],updateOn:"blur"}],password:["",{validators:[T.required],updateOn:"blur"}]})},t.\u0275fac=function(l){return new(l||t)},t.\u0275cmp=v({type:t,selectors:[["app-login-form"]],inputs:{submitAttempted:[1,"submitAttempted"],loading:[1,"loading"],forgotPasswordVisible:[1,"forgotPasswordVisible"],authErrorMessage:[1,"authErrorMessage"]},outputs:{controlFocus:"controlFocus",formSubmit:"formSubmit"},decls:22,vars:9,consts:[[3,"formGroup"],[1,"input-wrapper"],["color","light",1,"custom"],["formControlName","emailOrUsername","type","email",1,"custom",3,"ionFocus"],["color","danger",1,"error-text"],[1,"password-labels-wrapper"],[1,"custom","link","forgot-password",3,"routerLink"],["formControlName","password","type","password",1,"custom",3,"ionFocus","clearOnEdit"],["slot","end","color","light"],[1,"button-subtitle-container"],[3,"click","disabled"],["name","crescent"],[1,"inline-link",3,"routerLink"],["color","danger",1,"error-text","auth-error"]],template:function(l,i){if(l&1&&(s(0,"form",0)(1,"div",1)(2,"ion-label",2),u(3,"Email o nombre de usuario"),n(),s(4,"ion-input",3),f("ionFocus",function(){return i.controlFocus.emit("emailOrUsername")}),n(),_(5,Le,2,0,"ion-text",4),n(),s(6,"div",1)(7,"div",5)(8,"ion-label",2),u(9,"Contrase\xF1a"),n(),_(10,Ie,2,2,"ion-label",6),n(),s(11,"ion-input",7),f("ionFocus",function(){return i.controlFocus.emit("password")}),k(12,"ion-input-password-toggle",8),n(),_(13,Ae,2,2),n()(),s(14,"div",9)(15,"ion-button",10),f("click",function(){return i.formSubmit.emit(i.loginForm.value)}),u(16," Ingresar "),_(17,Ve,1,0,"ion-spinner",11),n(),s(18,"ion-text"),u(19,"\xBFNo tienes cuenta? "),s(20,"a",12),u(21,"Reg\xEDstrate"),n()()()),l&2){let p;c("formGroup",i.loginForm),a(5),g(i.submitAttempted()&&(!((p=i.loginForm.get("emailOrUsername"))==null||p.errors==null)&&p.errors.required)?5:-1),a(5),g(i.forgotPasswordVisible()?10:-1),a(),c("clearOnEdit",!1),a(2),g(i.submitAttempted()?13:-1),a(2),c("disabled",i.loading()),a(2),g(i.loading()?17:-1),a(3),c("routerLink",I(8,Pe))}},dependencies:[re,z,se,ne,ae,ie,ee,M,W,J,K,$,X,Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1;justify-content:space-between;gap:1rem}form[_ngcontent-%COMP%]{margin-top:4rem}.link[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer}.password-labels-wrapper[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center}.password-labels-wrapper[_ngcontent-%COMP%]   .forgot-password[_ngcontent-%COMP%]{font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem);text-decoration:underline;cursor:pointer}.button-subtitle-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}.button-subtitle-container[_ngcontent-%COMP%]:has(ion-button.ios){margin-bottom:24px}.auth-error[_ngcontent-%COMP%]{margin-top:1rem}"]});let e=t;return e})()});var Be,Ce,Fe=E(()=>{"use strict";b();Me();xe();Se();b();Be="Credenciales incorrectas.",Ce=(()=>{let o=class o{constructor(){this.authService=d(ue),this.userRepository=d(me),this.cache=d(ce),this.loading=h(!1),this.errorMessage=h(""),this.loginState=y(()=>({loading:this.loading(),errorMessage:this.errorMessage()}))}login(m){return C(this,arguments,function*({emailOrUsername:t,password:r}){this.loading.set(!0),this.errorMessage.set("");let l=t,i=null,p=yield this.cache.get("fcmToken");try{if(i=yield this.userRepository.getUserByEmail(t),!i){if(i=yield this.userRepository.getUserByUsername(t),!i)throw new Error("Credenciales incorrectas.");l=i.email}yield this.authService.login({method:"email",credentials:{email:l,password:r}}),yield this.userRepository.updateUser({_id:i._id,fcmToken:p}),this.errorMessage.set(""),this.loading.set(!1)}catch(ve){console.warn(ve),this.errorMessage.set(Be),this.loading.set(!1)}})}resetPassword(){return C(this,null,function*(){})}};o.\u0275fac=function(r){return new(r||o)},o.\u0275prov=B({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})()});var dt,Re=E(()=>{b();ye();O();H();le();we();de();fe();Fe();Ee();b();dt=(()=>{let o=class o{constructor(){this.router=d(Q),this.loginService=d(Ce),this.loading=y(()=>this.loginService.loginState().loading),this.errorMessage=q(()=>{var t;return(t=this.loginService.loginState().errorMessage)!=null?t:""}),this.loginFormComponent=R(x),this.submitAttempted=h(!1),this.forgotPasswordVisible=h(!1),S({arrowBackOutline:pe}),U(()=>{this.errorMessage()&&this.forgotPasswordVisible.set(!0)})}onControlFocus(t){this.submitAttempted.set(!1),this.errorMessage.set("")}onBackPressed(){this.router.navigate(["/auth/landing"])}ionViewDidLeave(){var t,r;(r=(t=this.loginFormComponent())==null?void 0:t.loginForm)==null||r.reset()}login(m){return C(this,arguments,function*({emailOrUsername:t,password:r}){var l,i;this.submitAttempted.set(!0),this.errorMessage.set(""),(i=(l=this.loginFormComponent())==null?void 0:l.loginForm)!=null&&i.valid&&(yield this.loginService.login({emailOrUsername:t,password:r}),this.errorMessage()||this.router.navigate(["/tabs"]))})}};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=v({type:o,selectors:[["app-login"]],viewQuery:function(r,m){r&1&&j(m.loginFormComponent,x,5),r&2&&N()},decls:5,vars:7,consts:[["type","arrow-back","title","Ingresar","backActionType","emit",3,"backPressed","showSearch","showCart"],[3,"fullscreen"],[1,"container"],[3,"controlFocus","formSubmit","authErrorMessage","submitAttempted","loading","forgotPasswordVisible"]],template:function(r,m){r&1&&(s(0,"ion-header")(1,"app-toolbar",0),f("backPressed",function(){return m.onBackPressed()}),n()(),s(2,"ion-content",1)(3,"div",2)(4,"app-login-form",3),f("controlFocus",function(i){return m.onControlFocus(i)})("formSubmit",function(i){return m.login(i)}),n()()()),r&2&&(a(),c("showSearch",!1)("showCart",!1),a(),c("fullscreen",!0),a(2),c("authErrorMessage",m.errorMessage())("submitAttempted",m.submitAttempted())("loading",m.loading())("forgotPasswordVisible",m.forgotPasswordVisible()))},dependencies:[he,oe,x,te,G,M],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;min-height:100%;gap:1rem}"]});let e=o;return e})()});Re();export{dt as LoginPage};
