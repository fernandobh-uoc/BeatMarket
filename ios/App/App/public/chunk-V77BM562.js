import{e as fe,f as Re}from"./chunk-SYKTDXP7.js";import"./chunk-QCXXS2IP.js";import"./chunk-7QGFDW3N.js";import"./chunk-CVZVN4BI.js";import"./chunk-6RPMLJXL.js";import"./chunk-ZDSPE5PQ.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-ZSFULLTW.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import"./chunk-5WOL6UCU.js";import"./chunk-UCDHUJSY.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import{A as se,B as Le,F as ae,G as ce,H as ue,K as le,M as U,N as Ie,e as ie,q as oe,y as E,z as Me}from"./chunk-42PVXCFM.js";import"./chunk-XSD52R3U.js";import{t as he,u as De}from"./chunk-VQCHUAXV.js";import{b as de,c as pe,e as ge}from"./chunk-K5TY53DO.js";import{Ca as xe,S as Z,_ as ee,aa as te,la as ne,oa as re,t as Q,v as Ne}from"./chunk-BQ2OOKCX.js";import{$ as A,Ca as z,D as y,Da as Y,Ea as D,Kb as W,L as J,M as q,Pb as Ee,Qa as R,Y as f,fa as X,hb as m,ka as L,nb as P,qa as _,sa as I,vb as K,wa as k,xa as S,xb as Pe,ya as T,z as G}from"./chunk-DHHGUDQP.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{f as v,o as u}from"./chunk-FIPIWZQS.js";function ke(e,t){let r={};for(let n in e)e.hasOwnProperty(n)&&(r[n]=t(e[n]));return r}function N(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>N(t));if(typeof e=="function"||typeof e=="object")return ke(e,t=>N(t));throw new Error("Data cannot be encoded in JSON: "+e)}function w(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case Ue:case Fe:{let t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>w(t)):typeof e=="function"||typeof e=="object"?ke(e,t=>w(t)):e}function $e(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function x(e,t){let r=$e(e),n=r,i;try{let o=t&&t.error;if(o){let a=o.status;if(typeof a=="string"){if(!me[a])return new p("internal","internal");r=me[a],n=a}let s=o.message;typeof s=="string"&&(n=s),i=o.details,i!==void 0&&(i=w(i))}}catch{}return r==="ok"?null:new p(r,n,i)}function Ve(e){let t=null;return{promise:new Promise((r,n)=>{t=setTimeout(()=>{n(new p("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}function Be(e,t,r){e.emulatorOrigin=`http://${t}:${r}`}function He(e,t,r){let n=i=>Je(e,t,i,r||{});return n.stream=(i,o)=>Xe(e,t,i,o),n}function Ge(e,t,r,n){return u(this,null,function*(){r["Content-Type"]="application/json";let i;try{i=yield n(e,{method:"POST",body:JSON.stringify(t),headers:r})}catch{return{status:0,json:null}}let o=null;try{o=yield i.json()}catch{}return{status:i.status,json:o}})}function Se(e,t){return u(this,null,function*(){let r={},n=yield e.contextProvider.getContext(t.limitedUseAppCheckTokens);return n.authToken&&(r.Authorization="Bearer "+n.authToken),n.messagingToken&&(r["Firebase-Instance-ID-Token"]=n.messagingToken),n.appCheckToken!==null&&(r["X-Firebase-AppCheck"]=n.appCheckToken),r})}function Je(e,t,r,n){let i=e._url(t);return qe(e,i,r,n)}function qe(e,t,r,n){return u(this,null,function*(){r=N(r);let i={data:r},o=yield Se(e,n),a=n.timeout||7e4,s=Ve(a),d=yield Promise.race([Ge(t,i,o,e.fetchImpl),s.promise,e.cancelAllRequests]);if(s.cancel(),!d)throw new p("cancelled","Firebase Functions instance was deleted.");let l=x(d.status,d.json);if(l)throw l;if(!d.json)throw new p("internal","Response is not valid JSON object.");let c=d.json.data;if(typeof c>"u"&&(c=d.json.result),typeof c>"u")throw new p("internal","Response is missing data field.");return{data:w(c)}})}function Xe(e,t,r,n){let i=e._url(t);return ze(e,i,r,n||{})}function ze(e,t,r,n){return u(this,null,function*(){var i;r=N(r);let o={data:r},a=yield Se(e,n);a["Content-Type"]="application/json",a.Accept="text/event-stream";let s;try{s=yield e.fetchImpl(t,{method:"POST",body:JSON.stringify(o),headers:a,signal:n==null?void 0:n.signal})}catch(g){if(g instanceof Error&&g.name==="AbortError"){let O=new p("cancelled","Request was cancelled.");return{data:Promise.reject(O),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(O)}}}}}}let C=x(0,null);return{data:Promise.reject(C),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(C)}}}}}}let d,l,c=new Promise((g,C)=>{d=g,l=C});(i=n==null?void 0:n.signal)===null||i===void 0||i.addEventListener("abort",()=>{let g=new p("cancelled","Request was cancelled.");l(g)});let h=s.body.getReader(),b=Ye(h,d,l,n==null?void 0:n.signal);return{stream:{[Symbol.asyncIterator](){let g=b.getReader();return{next(){return u(this,null,function*(){let{value:O,done:Te}=yield g.read();return{value:O,done:Te}})},return(){return u(this,null,function*(){return yield g.cancel(),{done:!0,value:void 0}})}}}},data:c}})}function Ye(e,t,r,n){let i=(a,s)=>{let d=a.match(je);if(!d)return;let l=d[1];try{let c=JSON.parse(l);if("result"in c){t(w(c.result));return}if("message"in c){s.enqueue(w(c.message));return}if("error"in c){let h=x(0,c);s.error(h),r(h);return}}catch(c){if(c instanceof p){s.error(c),r(c);return}}},o=new TextDecoder;return new ReadableStream({start(a){let s="";return d();function d(){return u(this,null,function*(){if(n!=null&&n.aborted){let l=new p("cancelled","Request was cancelled");return a.error(l),r(l),Promise.resolve()}try{let{value:l,done:c}=yield e.read();if(c){s.trim()&&i(s.trim(),a),a.close();return}if(n!=null&&n.aborted){let b=new p("cancelled","Request was cancelled");a.error(b),r(b),yield e.cancel();return}s+=o.decode(l,{stream:!0});let h=s.split(`
`);s=h.pop()||"";for(let b of h)b.trim()&&i(b.trim(),a);return d()}catch(l){let c=l instanceof p?l:x(0,null);a.error(c),r(c)}})}},cancel(){return e.cancel()}})}function Ze(e){let t=(r,{instanceIdentifier:n})=>{let i=r.getProvider("app").getImmediate(),o=r.getProvider(Ke),a=r.getProvider(Qe),s=r.getProvider(We);return new j(i,o,a,s,n)};ae(new se(V,t,"PUBLIC").setMultipleInstances(!0)),U(be,ve,e),U(be,ve,"esm2017")}function B(e=le(),t=$){let n=ce(E(e),V).getImmediate({identifier:t}),i=ie("functions");return i&&et(n,...i),n}function et(e,t,r){Be(E(e),t,r)}function H(e,t,r){return He(E(e),t,r)}var Ue,Fe,V,me,p,F,$,je,j,be,ve,Ke,We,Qe,we=v(()=>{"use strict";Ie();Me();Le();Ue="type.googleapis.com/google.protobuf.Int64Value",Fe="type.googleapis.com/google.protobuf.UInt64Value";V="functions";me={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},p=class e extends oe{constructor(t,r,n){super(`${V}/${t}`,r||""),this.details=n,Object.setPrototypeOf(this,e.prototype)}};F=class{constructor(t,r,n,i){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,ue(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=r.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||r.get().then(o=>this.auth=o,()=>{}),this.messaging||n.get().then(o=>this.messaging=o,()=>{}),this.appCheck||i==null||i.get().then(o=>this.appCheck=o,()=>{})}getAuthToken(){return u(this,null,function*(){if(this.auth)try{let t=yield this.auth.getToken();return t==null?void 0:t.accessToken}catch{return}})}getMessagingToken(){return u(this,null,function*(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return yield this.messaging.getToken()}catch{return}})}getAppCheckToken(t){return u(this,null,function*(){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let r=t?yield this.appCheck.getLimitedUseToken():yield this.appCheck.getToken();return r.error?null:r.token}return null})}getContext(t){return u(this,null,function*(){let r=yield this.getAuthToken(),n=yield this.getMessagingToken(),i=yield this.getAppCheckToken(t);return{authToken:r,messagingToken:n,appCheckToken:i}})}};$="us-central1",je=/^data: (.*?)(?:\n|$)/;j=class{constructor(t,r,n,i,o=$,a=(...s)=>fetch(...s)){this.app=t,this.fetchImpl=a,this.emulatorOrigin=null,this.contextProvider=new F(t,r,n,i),this.cancelAllRequests=new Promise(s=>{this.deleteService=()=>Promise.resolve(s())});try{let s=new URL(o);this.customDomain=s.origin+(s.pathname==="/"?"":s.pathname),this.region=$}catch{this.customDomain=null,this.region=o}}_delete(){return this.deleteService()}_url(t){let r=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${r}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${r}.cloudfunctions.net/${t}`}};be="@firebase/functions",ve="0.12.3";Ke="auth-internal",We="app-check-internal",Qe="messaging-internal";Ze()});var ye=v(()=>{"use strict";we()});var Ae,Ce=v(()=>{"use strict";P();ye();De();P();Ae=(()=>{let t=class t{constructor(){this.authService=y(he),this.accountActive=f(!1),this.onboardingLink=f(null),this.loadingAccountStatus=f(!0),this.loadingOnboardingLink=f(!1),this.errorMessage=f(""),this.stripeState=m(()=>({accountActive:this.accountActive(),onboardingLink:this.onboardingLink(),loading:{accountStatus:this.loadingAccountStatus(),onboardingLink:this.loadingOnboardingLink()},errorMessage:this.errorMessage()}))}getStripeAccountStatus(){return u(this,null,function*(){var n;this.loadingAccountStatus.set(!0);try{let i=B(),a=yield H(i,"checkStripeAccountStatus")();this.loadingAccountStatus.set(!1),this.errorMessage.set(""),this.accountActive.set((n=a.data)==null?void 0:n.isActive)}catch(i){console.error("Stripe account check failed:",i),this.errorMessage.set("Error al comprobar el estado de la cuenta de Stripe"),this.loadingAccountStatus.set(!1)}})}getStripeOnboardingLink(){return u(this,null,function*(){if(!this.onboardingLink()){this.loadingOnboardingLink.set(!0);try{let n=B(),o=yield H(n,"generateStripeOnboardingLink")();this.errorMessage.set(""),this.onboardingLink.set(o.data.url)}catch(n){console.error("Stripe account check failed:",n),this.errorMessage.set("Error al generar el enlace de activaci\xF3n de Stripe")}this.loadingOnboardingLink.set(!1)}})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=G({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})()});var Oe=v(()=>{"use strict"});var M,_e=v(()=>{"use strict";ge();Oe();M=pe("Browser",{web:()=>import("./chunk-JAATUI6W.js").then(e=>new e.BrowserWeb)})});function nt(e,t){e&1&&(k(0,"div",4),T(1,"ion-spinner",5),S())}function rt(e,t){e&1&&T(0,"ion-spinner",5)}function it(e,t){if(e&1){let r=z();k(0,"div",6)(1,"ion-text",7),R(2,"Para poder publicar anuncios y recibir pagos de los compradores, debes activar tu cuenta de Stripe."),S()(),k(3,"div",8)(4,"ion-button",9),Y("click",function(){J(r);let i=D();return q(i.goToStripe())}),R(5," Activar cuenta de Stripe "),L(6,rt,1,0,"ion-spinner",5),S()()}if(e&2){let r=D();A(4),_("disabled",r.loadingOnboardingLink()),A(2),I(r.loadingOnboardingLink()?6:-1)}}var Mt,ot=v(()=>{P();Pe();Ne();xe();Ee();Ce();Re();ge();_e();P();Mt=(()=>{let t=class t{constructor(){this.router=y(W),this.stripeService=y(Ae),this.redirectTo=f(""),this.accountActive=m(()=>this.stripeService.stripeState().accountActive),this.stripeOnboardingUrl=m(()=>this.stripeService.stripeState().onboardingLink),this.loadingAccountStatus=m(()=>this.stripeService.stripeState().loading.accountStatus),this.loadingOnboardingLink=m(()=>this.stripeService.stripeState().loading.onboardingLink),this.errorMessage=m(()=>this.stripeService.stripeState().errorMessage)}goToStripe(){let n=this.stripeOnboardingUrl();n&&(de.isNativePlatform()?M.open({url:n}):window.open(n,"_blank"))}ionViewDidEnter(){return u(this,null,function*(){if(yield this.stripeService.getStripeAccountStatus(),this.accountActive()){this.router.navigate(["/tabs/sell/publish"]);return}this.stripeOnboardingUrl()||(yield this.stripeService.getStripeOnboardingLink(),console.log({url:this.stripeOnboardingUrl()}))})}ngOnInit(){return u(this,null,function*(){M.addListener("browserFinished",()=>u(this,null,function*(){console.log("browserFinished"),yield this.stripeService.getStripeAccountStatus();let n=this.accountActive();console.log({isActive:n}),n&&this.router.navigate(["/tabs/sell/publish"])}))})}ngOnDestroy(){return u(this,null,function*(){M.removeAllListeners()})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=X({type:t,selectors:[["app-setup"]],decls:6,vars:3,consts:[[3,"translucent"],["title","Vender"],[3,"fullscreen"],[1,"container"],[1,"loading-spinner-container"],["name","crescent"],[1,"text-container"],[1,"text"],[1,"button-container"],[1,"custom",3,"click","disabled"]],template:function(i,o){i&1&&(k(0,"ion-header",0),T(1,"app-toolbar",1),S(),k(2,"ion-content",2)(3,"div",3),L(4,nt,2,0,"div",4)(5,it,7,2),S()()),i&2&&(_("translucent",!0),A(2),_("fullscreen",!0),A(2),I(o.loadingAccountStatus()?4:5))},dependencies:[ne,re,fe,Z,ee,te,K,Q],styles:['.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:space-between;height:100%;position:relative}.container[_ngcontent-%COMP%]   .loading-spinner-container[_ngcontent-%COMP%]{width:100%;min-height:100%;display:flex;justify-content:center;align-items:center}.container[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]{margin-top:40%;text-align:center}.container[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{color:var(--ion-color-light-shade);font-size:var(--body-larger-size, 1.25rem);line-height:1.25rem}.container[_ngcontent-%COMP%]   .background-logo[_ngcontent-%COMP%]{width:60dvw;height:60dvw;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-image:url("./media/stripe-logo-GQXHQBW4.png");background-repeat:no-repeat;background-size:contain;background-position:center;opacity:.2}.container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-top: 0;--padding-bottom: 0;--padding-start: 0;--padding-end: 0}.container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]:has(ion-button.ios){margin-bottom:24px}.container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .stripe-logo-container[_ngcontent-%COMP%]{display:flex;width:fit-content;height:fit-content;margin-right:5%;opacity:.8;overflow:hidden}.container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .stripe-logo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:50px}']});let e=t;return e})()});ot();export{Mt as SetupPage};
