import{a as L,b as se}from"./chunk-UIHM3IIJ.js";import{a as ht,b as xt,c as vt,d as zt}from"./chunk-375QIGGA.js";import{a as ft,b as It,e as gt,f as Ut}from"./chunk-SYKTDXP7.js";import{D as ut,E as pt,F as dt,M as _t,a as H,b as et,d as tt,f as it,g as nt,l as ot,n as at,r as rt,t as lt,u as st,v as ct,y as mt}from"./chunk-QCXXS2IP.js";import"./chunk-7QGFDW3N.js";import"./chunk-CVZVN4BI.js";import"./chunk-6RPMLJXL.js";import"./chunk-ZDSPE5PQ.js";import"./chunk-XV6JN3SG.js";import"./chunk-G3RFF6YC.js";import"./chunk-ZSFULLTW.js";import"./chunk-JBWWZWAU.js";import"./chunk-ITJAHDAK.js";import"./chunk-WVJ73LOB.js";import"./chunk-5WOL6UCU.js";import"./chunk-UCDHUJSY.js";import"./chunk-67JKSNDF.js";import"./chunk-UUSPLNXY.js";import"./chunk-DH7DTWFE.js";import"./chunk-JT567OVO.js";import"./chunk-NY55XGVK.js";import"./chunk-UHVVQU73.js";import{a as Ct,b as Lt}from"./chunk-UIUTEOCP.js";import"./chunk-XSD52R3U.js";import{f as Q,g as He,h as B,j as Ke,k as Ye,n as We,o as Ot,t as Xe,u as Mt}from"./chunk-VQCHUAXV.js";import{b as Je,e as Nt}from"./chunk-K5TY53DO.js";import{Aa as Ze,Ba as $e,Ca as Qe,Q as ke,S as Ne,_ as Oe,aa as Me,ba as Ie,c as D,d as Se,da as Ue,e as we,i as De,j as Ee,k as Re,ka as Le,l as Fe,la as ze,oa as qe,q as Ve,s as Te,u as Pe,v as Ae,va as Be,wa as je,xa as Ge}from"./chunk-BQ2OOKCX.js";import{$ as m,Ab as xe,Ca as E,Cb as kt,D as b,Da as x,Ea as d,Kb as ve,L as g,Lb as be,M as C,Ma as ae,Na as fe,Pb as ye,Qa as c,Ra as re,Sa as ge,V as M,W as I,Y as h,Ya as le,_ as pe,ea as ie,fa as $,hb as U,ia as de,jb as Ce,ka as f,m as O,n as Tt,nb as R,qa as y,s as G,sa as _,ta as _e,ua as ne,v as Pt,va as oe,w as At,wa as l,xa as a,ya as S,z as Z,zb as he}from"./chunk-DHHGUDQP.js";import"./chunk-OHMQXWFK.js";import"./chunk-IZ5VZLPJ.js";import"./chunk-FTZN4423.js";import"./chunk-R4WQGMAA.js";import"./chunk-5WZLWBAD.js";import"./chunk-UAVZGLFE.js";import"./chunk-3VQMIGUA.js";import"./chunk-GWOLSY5V.js";import"./chunk-QQVLEOUP.js";import"./chunk-HJZG4HTK.js";import"./chunk-XR3M57TO.js";import"./chunk-3FE2HO5M.js";import"./chunk-ZKJSTCFA.js";import{a as q,f as k,j,k as N,m as ue,o as v}from"./chunk-FIPIWZQS.js";var Y,K,bt=k(()=>{"use strict";R();He();K=class{constructor(){N(this,Y,b(Q))}validate(){return o=>v(this,null,function*(){return(yield j(this,Y).getUserByEmail(o.value.toLowerCase(),!1))?{emailExists:!0}:null})}};Y=new WeakMap});var W,J,yt=k(()=>{"use strict";R();He();J=class{constructor(){N(this,W,b(Q))}validate(){return o=>v(this,null,function*(){return(yield j(this,W).getUserByUsername(o.value))?{usernameExists:!0}:null})}};W=new WeakMap});var X,St=k(()=>{"use strict";R();kt();Lt();Pt();se();X=class{constructor(){this.http=b(xe),this.API_KEY=Ct.zipcodeStack.apiKey,this.lastZipCode=null,this.lastCountry=null,this.lastResult=null}validate(){return o=>v(this,null,function*(){var p,u,w,V,T;let n=o.parent;if(!n)return null;let e=o.value,i=(p=n.get("country"))==null?void 0:p.value;if(!e||!i)return null;if(e===this.lastZipCode&&i===this.lastCountry)return this.lastResult;let r=(u=L.find(F=>F.nameES.toUpperCase()===i.toUpperCase()))==null?void 0:u.iso2;if(!r)return{zipValidationFailed:!0};let s=new he().set("apikey",this.API_KEY).set("codes",e).set("country",r);try{let F=yield O(this.http.get("https://api.zipcodestack.com/v1/search",{params:s}));console.log({response:F});let P=(w=F==null?void 0:F.results)!=null?w:[];if(!(P&&!Array.isArray(P)&&((V=P[e])==null?void 0:V.length)>0))return this.setCache(e,i,{invalidZipCode:!0}),{invalidZipCode:!0};let z=n.get("city");if(z){let A=(T=P[e][0])==null?void 0:T.city;A&&z.setValue(A)}return this.setCache(e,i,null),null}catch{return this.setCache(e,i,{zipValidationFailed:!0}),{zipValidationFailed:!0}}})}setCache(o,n,e){this.lastZipCode=o,this.lastCountry=n,this.lastResult=e}}});function Gt(t,o){t&1&&S(0,"ion-icon",12)}function Zt(t,o){if(t&1&&f(0,Gt,1,0,"ion-icon",12),t&2){let n,e=d(2);_(!((n=e.registerForm.get("emailData.email"))!=null&&n.pending)&&((n=e.registerForm.get("emailData.email"))!=null&&n.invalid)?0:-1)}}function $t(t,o){t&1&&(l(0,"ion-text",13),c(1,"El email es obligatorio"),a())}function Qt(t,o){t&1&&(l(0,"ion-text",13),c(1,"El email es inv\xE1lido"),a())}function Ht(t,o){if(t&1&&f(0,$t,2,0,"ion-text",13)(1,Qt,2,0,"ion-text",13),t&2){let n,e,i=d(2);_(!((n=i.registerForm.get("emailData.email"))==null||n.errors==null)&&n.errors.required?0:-1),m(),_(!((e=i.registerForm.get("emailData.email"))==null||e.errors==null)&&e.errors.email||!((e=i.registerForm.get("emailData.email"))==null||e.errors==null)&&e.errors.emailExists?1:-1)}}function Kt(t,o){if(t&1){let n=E();l(0,"div",1)(1,"div",8)(2,"ion-label",9),c(3,"Email"),a(),l(4,"ion-input",10),x("ionFocus",function(){g(n);let i=d();return C(i.controlFocus.emit("email"))})("ionBlur",function(){g(n);let i=d();return C(i.controlBlur.emit("email"))}),S(5,"ion-icon",11),f(6,Zt,1,1),a(),f(7,Ht,2,2),a()()}if(t&2){let n,e=d();m(6),_(e.submitAttempts().email()?6:-1),m(),_(e.submitAttempts().email()&&((n=e.registerForm.get("emailData.email"))!=null&&n.errors)?7:-1)}}function Yt(t,o){t&1&&(l(0,"ion-text",13),c(1,"El nombre de usuario es obligatorio"),a())}function Jt(t,o){t&1&&(l(0,"ion-text",13),c(1,"El nombre de usuario es demasiado corto"),a())}function Wt(t,o){t&1&&(l(0,"ion-text",13),c(1,"Ese nombre de usuario ya est\xE1 en uso"),a())}function Xt(t,o){if(t&1&&f(0,Yt,2,0,"ion-text",13)(1,Jt,2,0,"ion-text",13)(2,Wt,2,0,"ion-text",13),t&2){let n,e,i,r=d(2);_(!((n=r.registerForm.get("userData.username"))==null||n.errors==null)&&n.errors.required?0:-1),m(),_(!((e=r.registerForm.get("userData.username"))==null||e.errors==null)&&e.errors.minlength?1:-1),m(),_(!((i=r.registerForm.get("userData.username"))==null||i.errors==null)&&i.errors.usernameExists?2:-1)}}function ei(t,o){t&1&&(l(0,"ion-text",13),c(1,"La contrase\xF1a es obligatoria"),a())}function ti(t,o){t&1&&(l(0,"ion-text",13),c(1,"La contrase\xF1a debe tener al menos 6 caracteres, una letra y un n\xFAmero"),a())}function ii(t,o){if(t&1&&f(0,ei,2,0,"ion-text",13)(1,ti,2,0,"ion-text",13),t&2){let n,e,i=d(2);_(!((n=i.registerForm.get("userData.password"))==null||n.errors==null)&&n.errors.required?0:-1),m(),_(!((e=i.registerForm.get("userData.password"))==null||e.errors==null)&&e.errors.pattern?1:-1)}}function ni(t,o){if(t&1){let n=E();l(0,"div",2)(1,"div",8)(2,"ion-label",9),c(3,"Nombre de usuario"),a(),l(4,"ion-input",14),x("ionFocus",function(){g(n);let i=d();return C(i.controlFocus.emit("userData"))}),S(5,"ion-icon",15),a(),f(6,Xt,3,3),a(),l(7,"div",8)(8,"ion-label",9),c(9,"Contrase\xF1a"),a(),l(10,"ion-input",16),x("ionFocus",function(){g(n);let i=d();return C(i.controlFocus.emit("userData"))}),S(11,"ion-icon",17)(12,"ion-input-password-toggle",18),a(),f(13,ii,2,2),a(),l(14,"div",19)(15,"ion-label",9),c(16,"Avatar (opcional)"),a(),l(17,"ion-avatar",20),x("click",function(){g(n);let i=d();return C(i.uploadAvatar.emit())}),S(18,"img",21),a()()()}if(t&2){let n,e,i=d();m(6),_(i.submitAttempts().userData()&&((n=i.registerForm.get("userData.username"))!=null&&n.errors)?6:-1),m(4),y("clearOnEdit",!1),m(3),_(i.submitAttempts().userData()&&((e=i.registerForm.get("userData.password"))!=null&&e.errors)?13:-1),m(5),y("src",i.avatarDataURL()||"../../../../../../assets/user-avatar-default-shade.svg",pe)}}function oi(t,o){t&1&&(l(0,"ion-text",13),c(1,"El nombre es obligatorio"),a())}function ai(t,o){if(t&1&&f(0,oi,2,0,"ion-text",13),t&2){let n,e=d(2);_(!((n=e.registerForm.get("personalData.firstName"))==null||n.errors==null)&&n.errors.required?0:-1)}}function ri(t,o){t&1&&(l(0,"ion-text",13),c(1,"Los apellidos son obligatorios"),a())}function li(t,o){if(t&1&&f(0,ri,2,0,"ion-text",13),t&2){let n,e=d(2);_(!((n=e.registerForm.get("personalData.lastName"))==null||n.errors==null)&&n.errors.required?0:-1)}}function si(t,o){if(t&1&&(l(0,"ion-select-option",29),c(1),a()),t&2){let n=o.$implicit;y("value",n.nameES),m(),re(n.nameES)}}function ci(t,o){t&1&&(l(0,"ion-text",13),c(1,"El c\xF3digo postal es obligatorio"),a())}function mi(t,o){t&1&&(l(0,"ion-text",13),c(1,"El c\xF3digo postal es demasiado corto"),a())}function ui(t,o){if(t&1&&f(0,ci,2,0,"ion-text",13)(1,mi,2,0,"ion-text",13),t&2){let n,e,i=d(2);_(!((n=i.registerForm.get("personalData.zipcode"))==null||n.errors==null)&&n.errors.required?0:-1),m(),_(!((e=i.registerForm.get("personalData.zipcode"))==null||e.errors==null)&&e.errors.minlength?1:-1)}}function pi(t,o){t&1&&(l(0,"ion-text",13),c(1,"El c\xF3digo postal no es v\xE1lido"),a())}function di(t,o){t&1&&(l(0,"ion-text",13),c(1,"La ciudad es obligatoria"),a())}function _i(t,o){if(t&1&&f(0,di,2,0,"ion-text",13),t&2){let n,e=d(2);_(!((n=e.registerForm.get("personalData.city"))==null||n.errors==null)&&n.errors.required?0:-1)}}function fi(t,o){t&1&&(l(0,"ion-text",13),c(1,"La direcci\xF3n es obligatoria"),a())}function gi(t,o){if(t&1&&f(0,fi,2,0,"ion-text",13),t&2){let n,e=d(2);_(!((n=e.registerForm.get("personalData.address"))==null||n.errors==null)&&n.errors.required?0:-1)}}function Ci(t,o){if(t&1){let n=E();l(0,"div",3)(1,"div",8)(2,"ion-label",22),c(3,"Nombre"),a(),l(4,"ion-input",23),x("ionFocus",function(){g(n);let i=d();return C(i.controlFocus.emit("personalData"))}),S(5,"ion-icon",24),a(),f(6,ai,1,1),a(),l(7,"div",8)(8,"ion-label",9),c(9,"Apellidos"),a(),l(10,"ion-input",25),x("ionFocus",function(){g(n);let i=d();return C(i.controlFocus.emit("personalData"))}),S(11,"ion-icon",24),a(),f(12,li,1,1),a(),l(13,"div",26)(14,"ion-label",9),c(15,"Pa\xEDs"),a(),l(16,"ion-select",27),x("ionChange",function(i){g(n);let r=d();return C(r.onCountryChange(i))}),S(17,"ion-icon",28),ne(18,si,2,2,"ion-select-option",29,jt),a()(),l(20,"div",30)(21,"div",31)(22,"ion-label",9),c(23,"C\xF3digo postal"),a(),l(24,"ion-input",32),x("ionFocus",function(){g(n);let i=d();return C(i.controlFocus.emit("personalData"))}),S(25,"ion-icon",33),a(),f(26,ui,2,2)(27,pi,2,0,"ion-text",13),a(),l(28,"div",34)(29,"ion-label",9),c(30,"Ciudad"),a(),l(31,"ion-input",35),S(32,"ion-icon",36),a(),f(33,_i,1,1),a()(),l(34,"div",8)(35,"ion-label",9),c(36,"Direcci\xF3n"),a(),l(37,"ion-input",37),x("ionFocus",function(){g(n);let i=d();return C(i.controlFocus.emit("personalData"))}),S(38,"ion-icon",38),a(),f(39,gi,1,1),a()()}if(t&2){let n,e,i,r,s,p,u=d();m(6),_(u.submitAttempts().personalData()&&((n=u.registerForm.get("personalData.firstName"))!=null&&n.errors)?6:-1),m(6),_(u.submitAttempts().personalData()&&((e=u.registerForm.get("personalData.lastName"))!=null&&e.errors)?12:-1),m(4),y("interfaceOptions",le(7,qt)),m(2),oe(u.countries),m(8),_(u.submitAttempts().personalData()&&((i=u.registerForm.get("personalData.zipcode"))!=null&&i.errors)?26:-1),m(),_(!((r=u.registerForm.get("personalData.zipcode"))==null||r.errors==null)&&r.errors.invalidZipCode||!((r=u.registerForm.get("personalData.zipcode"))==null||r.errors==null)&&r.errors.zipValidationFailed?27:-1),m(6),_(u.submitAttempts().personalData()&&((s=u.registerForm.get("personalData.city"))!=null&&s.errors)?33:-1),m(6),_(u.submitAttempts().personalData()&&((p=u.registerForm.get("personalData.address"))!=null&&p.errors)?39:-1)}}function hi(t,o){if(t&1){let n=E();l(0,"div",41)(1,"ion-checkbox",44),x("ionChange",function(i){g(n);let r=d(2);return C(r.onRoleChange(i))}),c(2),a()()}if(t&2){let n=o.$implicit;m(),y("value",n),m(),ge(" ",n," ")}}function xi(t,o){if(t&1){let n=E();l(0,"div",4)(1,"div",8)(2,"ion-label",9),c(3,"Roles (opcional)"),a(),l(4,"ion-text",39),c(5,"Elige los roles que m\xE1s se identifiquen con tu actividad musical"),a(),l(6,"div",40),ne(7,hi,3,2,"div",41,_e),a()(),l(9,"div",42)(10,"ion-label",9),c(11,"Biograf\xEDa (opcional)"),a(),l(12,"ion-textarea",43),x("ionFocus",function(){g(n);let i=d();return C(i.controlFocus.emit("otherData"))}),a()()()}if(t&2){let n=d();m(7),oe(n.roles)}}function vi(t,o){t&1&&S(0,"ion-spinner",46)}function bi(t,o){if(t&1){let n=E();l(0,"div",6)(1,"ion-button",45),x("click",function(){g(n);let i=d();return C(i.nextStep.emit())}),c(2," Continuar "),f(3,vi,1,0,"ion-spinner",46),a(),l(4,"ion-text"),c(5,"\xBFYa tienes cuenta? "),l(6,"a",47),c(7,"Ingresar"),a()()()}if(t&2){let n=d();m(),y("disabled",n.loadingStates().email()),m(2),_(n.loadingStates().email()?3:-1),m(3),y("routerLink",le(3,Bt))}}function yi(t,o){t&1&&S(0,"ion-spinner",46)}function Si(t,o){if(t&1){let n=E();l(0,"ion-button",48),x("click",function(){g(n);let i=d();return C(i.nextStep.emit())}),c(1," Continuar "),f(2,yi,1,0,"ion-spinner",46),a()}if(t&2){let n=d();y("disabled",n.loadingStates().userData()),m(2),_(n.loadingStates().userData()?2:-1)}}function wi(t,o){t&1&&S(0,"ion-spinner",46)}function Di(t,o){if(t&1){let n=E();l(0,"ion-button",48),x("click",function(){g(n);let i=d();return C(i.nextStep.emit())}),c(1," Continuar "),f(2,wi,1,0,"ion-spinner",46),a()}if(t&2){let n=d();y("disabled",n.loadingStates().personalData()),m(2),_(n.loadingStates().personalData()?2:-1)}}function Ei(t,o){if(t&1&&(l(0,"ion-text",13),c(1),a()),t&2){let n=d(2);m(),re(n.authProviderErrorMessage())}}function Ri(t,o){t&1&&S(0,"ion-spinner",46)}function Fi(t,o){if(t&1){let n=E();f(0,Ei,2,1,"ion-text",13),l(1,"ion-button",48),x("click",function(){g(n);let i=d();return C(i.formSubmit.emit())}),c(2," Finalizar "),f(3,Ri,1,0,"ion-spinner",46),a()}if(t&2){let n=d();_(n.submitAttempts().register()&&n.authProviderErrorMessage()?0:-1),m(),y("disabled",n.loadingStates().register()),m(2),_(n.loadingStates().register()?3:-1)}}var qt,Bt,jt,ee,Dt=k(()=>{"use strict";R();ye();Ae();Qe();bt();yt();St();et();_t();se();Ye();R();Ae();qt=()=>({cssClass:"custom-action-sheet"}),Bt=()=>["/auth/login"],jt=(t,o)=>o.iso2;ee=(()=>{var o,wt;let e=class e{constructor(){N(this,o);this.fb=b(Te),this.emailValidator=new K,this.usernameValidator=new J,this.zipcodeValidator=new X,this.step=I(1),this.nextStep=M(),this.formSubmit=M(),this.submitAttempts=I({email:h(!1),userData:h(!1),personalData:h(!1),register:h(!1)}),this.loadingStates=I({email:h(!1),userData:h(!1),personalData:h(!1),register:h(!1)}),this.controlFocus=M(),this.controlBlur=M(),this.uploadAvatar=M(),this.authProviderErrorMessage=I(""),this.formattedDate=h(new Date().toLocaleDateString("es-ES")),this.avatarDataURL=I(""),this.countries=L,this.roles=[B.Amateur,B.Professional,B.Collector,B.Student],H({atOutline:it,personCircleOutline:ut,keyOutline:st,checkmarkCircleOutline:ot,closeCircleOutline:at,calendarOutline:nt,globeOutline:rt,pinOutline:dt,mailOutline:mt,homeOutline:lt,locationOutline:ct,personOutline:pt})}ngOnInit(){ue(this,o,wt).call(this)}onRoleChange(r){let s=this.registerForm.get("otherData.roles");if(r.detail.checked)s.push(this.fb.control(r.detail.value));else{let p=s.controls.findIndex(u=>u.value===r.detail.value);p>=0&&s.removeAt(p)}}onCountryChange(r){return v(this,null,function*(){let s=r.detail.value,p=this.registerForm.get("personalData.country"),u=this.registerForm.get("personalData.zipcode");p==null||p.setValue(s),u==null||u.updateValueAndValidity()})}};o=new WeakSet,wt=function(){this.registerForm=this.fb.group({emailData:this.fb.group({email:this.fb.control("",{validators:[D.required,D.email],asyncValidators:[this.emailValidator.validate()],updateOn:"blur"})}),userData:this.fb.group({username:this.fb.control("",{validators:[D.required,D.minLength(4)],asyncValidators:[this.usernameValidator.validate()],updateOn:"blur"}),password:this.fb.control("",{validators:[D.required,D.pattern(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/)],updateOn:"blur"})}),personalData:this.fb.group({firstName:this.fb.control("",{validators:[D.required],updateOn:"blur"}),lastName:this.fb.control("",{validators:[D.required],updateOn:"blur"}),address:this.fb.control("",{validators:[D.required],updateOn:"blur"}),country:this.fb.control("Espa\xF1a",{validators:[D.required],updateOn:"blur"}),zipcode:this.fb.control("",{validators:[D.required,D.minLength(3)],asyncValidators:[this.zipcodeValidator.validate()],updateOn:"blur"}),city:this.fb.control("",{validators:[D.required],updateOn:"blur"})}),otherData:this.fb.group({roles:this.fb.array([]),bio:this.fb.control("")})})},e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=$({type:e,selectors:[["app-register-form"]],inputs:{step:[1,"step"],submitAttempts:[1,"submitAttempts"],loadingStates:[1,"loadingStates"],authProviderErrorMessage:[1,"authProviderErrorMessage"],avatarDataURL:[1,"avatarDataURL"]},outputs:{nextStep:"nextStep",formSubmit:"formSubmit",controlFocus:"controlFocus",controlBlur:"controlBlur",uploadAvatar:"uploadAvatar"},decls:10,vars:3,consts:[[3,"formGroup"],["formGroupName","emailData",1,"inputs-container"],["formGroupName","userData",1,"inputs-container"],["formGroupName","personalData",1,"inputs-container"],["formGroupName","otherData",1,"inputs-container"],[1,"buttons-container"],[1,"button-subtitle-container"],["type","button",3,"disabled"],[1,"input-wrapper"],["color","light",1,"custom"],["formControlName","email","type","email",1,"custom",3,"ionFocus","ionBlur"],["slot","start","name","at-outline"],["slot","end","color","danger","name","close-circle-outline"],["color","danger",1,"error-text"],["formControlName","username","type","text",1,"custom",3,"ionFocus"],["name","person-circle-outline","slot","start"],["formControlName","password","type","password",1,"custom",3,"ionFocus","clearOnEdit"],["slot","start","name","key-outline"],["slot","end","color","light"],[1,"input-wrapper-row"],["slot","start",3,"click"],["alt","Avatar de usuario por defecto",3,"src"],[1,"custom"],["formControlName","firstName","type","text",1,"custom",3,"ionFocus"],["slot","start","name","person-outline"],["formControlName","lastName","type","text",1,"custom",3,"ionFocus"],[1,"input-wrapper","country-input-wrapper"],["formControlName","country","aria-label","Country","interface","action-sheet",1,"custom","select-input",3,"ionChange","interfaceOptions"],["slot","start","name","globe-outline"],["color","light",3,"value"],[1,"zipcode-city-container"],[1,"input-wrapper","zipcode-input"],["formControlName","zipcode","type","text","maxlength","5","inputmode","numeric",1,"custom",3,"ionFocus"],["name","mail-outline","slot","start"],[1,"input-wrapper","city-input"],["formControlName","city","type","text",1,"custom"],["slot","start","name","location-outline"],["formControlName","address","type","text",1,"custom",3,"ionFocus"],["slot","start","name","home-outline"],[1,"roles-subtitle"],[1,"checkboxes-container"],[1,"checkbox-wrapper"],[1,"input-wrapper","bio-wrapper"],["formControlName","bio",1,"custom",3,"ionFocus"],["labelPlacement","end","color","light",3,"ionChange","value"],[3,"click","disabled"],["name","crescent"],[1,"inline-link",3,"routerLink"],["type","button",3,"click","disabled"]],template:function(s,p){if(s&1&&(l(0,"form",0),f(1,Kt,8,2,"div",1)(2,ni,19,4,"div",2)(3,Ci,40,8,"div",3)(4,xi,13,0,"div",4),a(),l(5,"div",5),f(6,bi,8,4,"div",6)(7,Si,3,2,"ion-button",7)(8,Di,3,2,"ion-button",7)(9,Fi,4,3),a()),s&2){let u,w;y("formGroup",p.registerForm),m(),_((u=p.step())===1?1:u===2?2:u===3?3:u===4?4:-1),m(5),_((w=p.step())===1?6:w===2?7:w===3?8:w===4?9:-1)}},dependencies:[ze,be,$e,Be,Ne,je,qe,ke,Ge,Ie,Ue,Ze,Le,Pe,De,Se,we,Ve,Ee,Fe,Re],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1 0 0;justify-content:space-between;gap:3rem}ion-datetime-button.custom[_ngcontent-%COMP%]{min-height:3rem}ion-datetime-button[_ngcontent-%COMP%]::part(native){background-color:var(--ion-color-dark-tint);display:flex;flex-direction:row;align-items:center;align-self:stretch;gap:.5rem}.zipcode-city-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:1rem}.zipcode-city-container[_ngcontent-%COMP%]   .zipcode-input[_ngcontent-%COMP%]{width:40%;min-height:8rem}.zipcode-city-container[_ngcontent-%COMP%]   .city-input[_ngcontent-%COMP%]{width:55%}.country-input-wrapper[_ngcontent-%COMP%]{width:100%}.roles-subtitle[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--ion-color-light-shade);font-size:var(--body-medium-size, .875rem);font-style:normal;font-weight:var(--body-medium-weight, 400);line-height:var(--body-medium-line-height, 1.25rem);letter-spacing:var(--body-medium-tracking, .01563rem)}.checkboxes-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem}.checkbox-wrapper[_ngcontent-%COMP%]{display:flex;width:8rem}.bio-wrapper[_ngcontent-%COMP%]{margin-top:1rem}.buttons-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.buttons-container[_ngcontent-%COMP%]:has(ion-button.ios){margin-bottom:24px}.buttons-container[_ngcontent-%COMP%]   .button-subtitle-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}.custom-action-sheet[_ngcontent-%COMP%]{--button-color: var(--ion-color-light);--button-background-hover: var(--ion-color-light-tint);--button-color-activated: var(--ion-color-light-shade)}"]});let t=e;return t})()});var Et,Rt=k(()=>{"use strict";se();R();Et=(()=>{let o=class o{transform(e,...i){let r=L.find(s=>s.nameES.toUpperCase()===e.toUpperCase());return r?r.iso2:""}};o.\u0275fac=function(i){return new(i||o)},o.\u0275pipe=de({name:"countryNameToCode",type:o,pure:!0}),o.\u0275prov=Z({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})()});var Ft,Vt=k(()=>{"use strict";R();zt();Ye();Mt();Ot();It();Rt();R();Ft=(()=>{let o=class o{constructor(){this.authService=b(Xe),this.cartService=b(ft),this.cache=b(We),this.countryNameToCodePipe=b(Et),this.profilePictureDataURL=h(null),this.loading=h(!1),this.errorMessage=h(""),this.registerState=U(()=>{var e;return{profilePictureDataURL:(e=this.profilePictureDataURL())!=null?e:"",loading:this.loading(),errorMessage:this.errorMessage()}}),this.getAvatarData=()=>v(this,null,function*(){try{let e=yield vt.getPhoto({quality:80,allowEditing:!1,resultType:xt.DataUrl,source:ht.Prompt});this.profilePictureDataURL.set(e.dataUrl)}catch(e){console.error(`Error al seleccionar avatar: ${e}`)}}),this.setAvatarDataNotNative=e=>{var p;let i=e.target;if(!((p=i.files)!=null&&p.length))return;let r=i.files[0],s=new FileReader;s.onload=()=>{let u=s.result;this.profilePictureDataURL.set(u)},s.readAsDataURL(r)},this.removeProfilePicture=()=>v(this,null,function*(){this.profilePictureDataURL.set(null)}),this.registerUser=e=>v(this,null,function*(){var i,r,s,p,u,w,V,T,F,P,te,z;this.loading.set(!0);try{let A=yield this.cache.get("fcmToken"),me=yield this.authService.register({method:"email",userData:{email:(i=e.email)!=null?i:"",username:(r=e.username)!=null?r:"",password:(s=e.password)!=null?s:"",name:{first:(p=e.firstName)!=null?p:"",last:(u=e.lastName)!=null?u:""},address:{line1:(w=e.address)!=null?w:"",city:(V=e.city)!=null?V:"",country:(T=e.country)!=null?T:"",countryCode:this.countryNameToCodePipe.transform(e.country),zipcode:(F=e.zipcode)!=null?F:""},roles:(P=e.roles)!=null?P:[],bio:(te=e.bio)!=null?te:"",fcmToken:A,profilePictureDataURL:(z=this.profilePictureDataURL())!=null?z:""}});Ke(me)&&(yield this.cartService.createCart(me._id)),this.loading.set(!1),this.errorMessage.set("")}catch(A){console.error(A),this.loading.set(!1),this.errorMessage.set(A)}})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=Z({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})()});function Ti(t,o){t&1&&(l(0,"h1"),c(1,"\xBFCu\xE1l es tu email?"),a(),l(2,"h4"),c(3,"Introduce el email con el que quieres iniciar sesi\xF3n en BeatMarket"),a())}function Pi(t,o){t&1&&(l(0,"h1"),c(1,"Rellena tus datos de usuario"),a())}function Ai(t,o){t&1&&(l(0,"h1"),c(1,"Rellena tus datos personales"),a())}function ki(t,o){t&1&&(l(0,"h1"),c(1,"Cu\xE9ntanos sobre ti"),a())}var Vi,Mn,Ni=k(()=>{R();Tt();At();Qe();et();_t();Dt();Vt();Nt();ye();Ut();R();Vi=["fileInput"];Mn=(()=>{let o=class o{constructor(){this.router=b(ve),this.registerService=b(Ft),this.registerFormComponent=ie(ee),this.step=h(1),this.totalSteps=4,this.progressBarValue=U(()=>this.step()/this.totalSteps),this.errorMessage=U(()=>this.registerService.registerState().errorMessage),this.profilePictureDataURL=U(()=>this.registerService.registerState().profilePictureDataURL),this.submitAttempts={email:h(!1),userData:h(!1),personalData:h(!1),register:h(!1)},this.loadingStates={email:h(!1),userData:h(!1),personalData:h(!1),register:Ce(()=>this.registerService.registerState().loading)},this.nextStep=()=>{var e,i,r;if(this.step()===1){this.submitAttempts.email.set(!0),this.handleNextStepEmail((e=this.registerFormComponent())==null?void 0:e.registerForm);return}if(this.step()===2){this.submitAttempts.userData.set(!0),this.handleNextStepUserData((i=this.registerFormComponent())==null?void 0:i.registerForm);return}if(this.step()===3){this.submitAttempts.personalData.set(!0),this.handleNextStepPersonalData((r=this.registerFormComponent())==null?void 0:r.registerForm);return}},this.prevStep=()=>{this.step.set(this.step()-1)},this.fileInput=ie("fileInput"),this.onAvatarUpload=()=>v(this,null,function*(){var e;Je.isNativePlatform()?yield this.registerService.getAvatarData():(e=this.fileInput())==null||e.nativeElement.click()}),this.handleFileInput=e=>{this.registerService.setAvatarDataNotNative(e)},this.handleNextStepEmail=e=>v(this,null,function*(){var r;let i=e==null?void 0:e.get("emailData.email");if(i&&(i==null||i.updateValueAndValidity(),i.pending&&(this.loadingStates.email.set(!0),yield O(i.statusChanges.pipe(G(s=>s!=="PENDING"))),this.loadingStates.email.set(!1)),(r=e==null?void 0:e.get("emailData"))!=null&&r.valid)){this.step.set(this.step()+1);return}}),this.handleNextStepUserData=e=>v(this,null,function*(){var s;let i=e==null?void 0:e.get("userData.username"),r=e==null?void 0:e.get("userData.password");!i||!r||(i==null||i.updateValueAndValidity(),r==null||r.updateValueAndValidity(),i.pending&&(this.loadingStates.userData.set(!0),yield O(i.statusChanges.pipe(G(p=>p!=="PENDING"))),this.loadingStates.userData.set(!1)),(s=e==null?void 0:e.get("userData"))!=null&&s.valid&&this.step.set(this.step()+1))}),this.handleNextStepPersonalData=e=>v(this,null,function*(){var V;let i=e==null?void 0:e.get("personalData.firstName"),r=e==null?void 0:e.get("personalData.lastName"),s=e==null?void 0:e.get("personalData.address"),p=e==null?void 0:e.get("personalData.city"),u=e==null?void 0:e.get("personalData.zipcode"),w=e==null?void 0:e.get("personalData.country");!i||!r||!s||!p||!u||!w||(i==null||i.updateValueAndValidity(),r==null||r.updateValueAndValidity(),s==null||s.updateValueAndValidity(),p==null||p.updateValueAndValidity(),w==null||w.updateValueAndValidity(),i.pending&&(this.loadingStates.personalData.set(!0),yield O(i.statusChanges.pipe(G(T=>T!=="PENDING"))),this.loadingStates.personalData.set(!1)),(V=e==null?void 0:e.get("personalData"))!=null&&V.valid&&this.step.set(this.step()+1))}),H({arrowBackOutline:tt})}ionViewDidLeave(){this.registerService.removeProfilePicture()}onControlFocus(e){this.submitAttempts.email.set(!1),this.submitAttempts.userData.set(!1),this.submitAttempts.personalData.set(!1),this.submitAttempts.register.set(!1)}handleRegister(){return v(this,null,function*(){var i;let e=(i=this.registerFormComponent())==null?void 0:i.registerForm;yield this.registerService.registerUser(q(q(q(q({},e==null?void 0:e.value.emailData),e==null?void 0:e.value.userData),e==null?void 0:e.value.personalData),e==null?void 0:e.value.otherData)),this.errorMessage()||this.router.navigate(["/auth/welcome"])})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=$({type:o,selectors:[["app-register"]],viewQuery:function(i,r){i&1&&(ae(r.registerFormComponent,ee,5),ae(r.fileInput,Vi,5)),i&2&&fe(2)},decls:13,vars:12,consts:[["fileInput",""],["type","arrow-back","title","Registro",3,"backPressed","showSearch","showCart","showProgressBar","progressBarValue","backActionType"],[3,"fullscreen"],[1,"container"],[1,"title-form-container"],[1,"title-container"],[3,"controlFocus","uploadAvatar","nextStep","formSubmit","step","submitAttempts","loadingStates","avatarDataURL","authProviderErrorMessage"],["type","file","accept","image/*","hidden","",3,"change"]],template:function(i,r){if(i&1){let s=E();l(0,"ion-header")(1,"app-toolbar",1),x("backPressed",function(){return g(s),C(r.prevStep())}),a()(),l(2,"ion-content",2)(3,"div",3)(4,"div",4)(5,"div",5),f(6,Ti,4,0)(7,Pi,2,0,"h1")(8,Ai,2,0,"h1")(9,ki,2,0,"h1"),a(),l(10,"app-register-form",6),x("controlFocus",function(u){return g(s),C(r.onControlFocus(u))})("uploadAvatar",function(){return g(s),C(r.onAvatarUpload())})("nextStep",function(){return g(s),C(r.nextStep())})("formSubmit",function(){return g(s),C(r.handleRegister())}),a(),l(11,"input",7,0),x("change",function(u){return g(s),C(r.handleFileInput(u))}),a()()()()}if(i&2){let s;m(),y("showSearch",!1)("showCart",!1)("showProgressBar",!0)("progressBarValue",r.progressBarValue())("backActionType",r.step()===1?"default":"emit"),m(),y("fullscreen",!0),m(4),_((s=r.step())===1?6:s===2?7:s===3?8:s===4?9:-1),m(4),y("step",r.step())("submitAttempts",r.submitAttempts)("loadingStates",r.loadingStates)("avatarDataURL",r.profilePictureDataURL())("authProviderErrorMessage",r.errorMessage())}},dependencies:[gt,Oe,Me,ee],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;min-height:100%;gap:1rem}.title-form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;gap:1.5rem}.title-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-light)}"]});let t=o;return t})()});Ni();export{Mn as RegisterPage};
